import{c as x,ar as n,d as B,r as o,p as b,O as A,h as F,i as a,H as T,az as k,aA as c,aB as w,aC as U,v as m,aD as C,aE as E,n as $,B as D,j as h,s as I,aF as M,aG as P,aH as j,aI as z,Y as L}from"./index-R5yA_R4y.js";import{U as O}from"./upload-fzzLb6Li.js";import{a as S,N as V}from"./Upload-D5pi52BF.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=x("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),v={getByType:t=>n.get(`/files/${t}`),upload:(t,l)=>{const r=new FormData;return r.append("file",t),n.post("/files/upload",{data:r,params:l?{type:l}:void 0})},deleteByTypeAndName:(t,l)=>n.delete(`/files/${t}/${l}`),rename:(t,l,r)=>n.patch(`/files/${t}/${l}/rename`,{data:{name:r}})},R=B({setup(){const t=o("icon"),l=o([]);b(()=>t.value,()=>{d()}),A(()=>{d()});const r=o(!1),d=()=>{r.value=!0,v.getByType(t.value).then(e=>{l.value=e,r.value=!1})},u=o(!1),g=async e=>{if(t.value==="icon"||t.value==="avatar"||t.value==="photo"){if(e.file.file?.type.startsWith("image"))return!0;message.error("只能上传图片文件，请重新上传")}return!0},y=({file:e,event:s})=>{const i=s?.target,{url:f,name:p}=JSON.parse(i.responseText);return e.name=p,e.url=f,l.value.unshift({url:f,name:p}),e},{setActions:N}=F();return N(a(T,{variant:"info",onClick:()=>{u.value=!0},icon:a(O,null,null)},null)),()=>a(L,null,[a(k,{value:t.value,onUpdateValue:e=>{t.value=e}},{default:()=>[a(c,{tab:"图标",name:"icon"},null),a(c,{tab:"头像",name:"avatar"},null),a(c,{tab:"文件",name:"file"},null)]}),a(w,{loading:r.value,data:l,columns:[{key:"name",title:"文件名",width:300,ellipsis:{lineClamp:1,tooltip:!0}},{key:"url",title:"URL",render(e){return a(U,{placement:"bottom",class:"max-w-[400px]"},{trigger(){return a("a",{href:e.url,target:"_blank",rel:"noreferrer"},[e.url])},default(){return a(m,{bordered:!0},{default:()=>[a(C,{src:e.url},null)]})}})}},{key:"action",title:"操作",width:150,render(e){return a(E,null,{default:()=>[a($,{onPositiveClick:()=>{v.deleteByTypeAndName(t.value,e.name).then(()=>{message.success("删除成功"),l.value=l.value.filter(s=>s.name!==e.name)})}},{trigger(){return a(D,{quaternary:!0,type:"error",size:"tiny"},{default:()=>[h("删除")]})},default(){return`确定要删除 ${e.name} 吗？`}})]})}}]},null),a(I,{closable:!0,closeOnEsc:!0,onClose:()=>{u.value=!1},show:u.value,onUpdateShow:e=>{u.value=e}},{default:()=>[a(m,{title:"文件上传",class:"modal-card sm flex justify-center",closable:!0,onClose:()=>{u.value=!1}},{default:()=>[a(S,{class:"flex w-full flex-col items-center",headers:{authorization:P()||""},action:`${M}/files/upload?type=${t.value}`,"directory-dnd":!0,multiple:!0,onBeforeUpload:g,onFinish:y,onError:e=>{const s=e.event?.target;if(e.file.status="error",!s)return message.warning("网络异常"),e.file;const{message:i}=JSON.parse(s.responseText);return message.warning(i),e.file}},{default:()=>[a(V,{class:"m-auto flex w-full flex-col items-center justify-center py-28"},{default:()=>[a(j,{size:"48",depth:"3"},{default:()=>[a(H,null,null)]}),a(z,{class:"mt-2"},{default:()=>[h("点击或者拖动文件到该区域来上传")]})]})]})]})]})])}});export{R as default};
