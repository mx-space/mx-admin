import{d as g,as as w,at as k,au as z,r as p,ar as S,a as j,i as e,av as _,j as h,N as m,J as N,aw as B,ax as I,ay as x}from"./index-qXdkAhVq.js";import{C as L}from"./crown-BvXN8iM1.js";import{M as C}from"./mail-BqpvHMpa.js";var R=function(t,l,n,u){function v(c){return c instanceof n?c:new n(function(i){i(c)})}return new(n||(n=Promise))(function(c,i){function d(a){try{r(u.next(a))}catch(o){i(o)}}function s(a){try{r(u.throw(a))}catch(o){i(o)}}function r(a){a.done?c(a.value):v(a.value).then(d,s)}r((u=u.apply(t,l||[])).next())})};const A={distance:{type:Number,default:0},onLoad:Function,scrollbarProps:Object},F=g({name:"InfiniteScroll",props:A,setup(t){const l=p(null);let n=!1;const u=()=>R(this,void 0,void 0,function*(){var i;const{value:d}=l;if(d){const{containerRef:s}=d,r=s?.scrollHeight,a=s?.clientHeight,o=s?.scrollTop;if(s&&r!==void 0&&a!==void 0&&o!==void 0&&o+a>=r-t.distance){n=!0;try{yield(i=t.onLoad)===null||i===void 0?void 0:i.call(t)}catch{}n=!1}}});return{scrollbarInstRef:l,handleScroll:()=>{n||u()},handleWheel:i=>{i.deltaY<=0||n||u()}}},render(){return w(k,Object.assign({},this.scrollbarProps,{ref:"scrollbarInstRef",onWheel:this.handleWheel,onScroll:this.handleScroll}),{default:()=>z(this.$slots.default,()=>[])})}}),O={getList:t=>S.get("/readers",{params:t})};function P(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!B(t)}const $=()=>e("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24"},[e("path",{d:"M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z",fill:"currentColor"},null)]),V=20,G=g({setup(){const t=p([]),l=p(!0),n=p(!0),u=p(0),v=p(0),c=new Set,i=j(()=>t.value.filter(r=>r.isOwner).length),d=async r=>{const a=await O.getList({page:r,size:V}),o=a.data.map((f,y)=>{const b=`${f.id}-${f.provider||y}`;return{...f,_key:b}}).filter(f=>c.has(f._key)?!1:(c.add(f._key),!0));t.value.push(...o),u.value=a.pagination.currentPage,n.value=a.pagination.hasNextPage,v.value=a.pagination.total,l.value=!1},s=async()=>{n.value&&await d(u.value+1)};return d(1),()=>{let r;return e("div",{class:"flex h-full flex-col"},[e("div",{class:"mb-6 flex items-center justify-between"},[e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex size-10 items-center justify-center rounded-lg bg-blue-500/10 text-blue-500"},[e(_,{class:"size-5"},null)]),e("div",null,[e("h1",{class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[h("读者列表")]),e("p",{class:"text-sm text-neutral-500"},[l.value?e(m,{text:!0,style:{width:"80px"}},null):e("span",{class:"tabular-nums"},[h("共 "),v.value,h(" 位读者"),i.value>0&&e("span",{class:"ml-2 text-amber-500"},[h("· "),i.value,h(" 位站长")])])])])])]),e("div",{class:"min-h-0 flex-1 overflow-auto"},[l.value?e(E,null,null):t.value.length===0?e(N,{description:"暂无读者",class:"py-20"},null):e(F,{distance:200,onLoad:s},P(r=t.value.map((a,o)=>e(H,{key:a._key,reader:a,isLast:o===t.value.length-1&&!n.value},null)))?r:{default:()=>[r]})])])}}}),E=g({setup(){return()=>e("div",{class:"space-y-2"},[Array.from({length:8}).map((t,l)=>e("div",{key:l,class:"rounded-naive flex items-center gap-4 bg-neutral-50 p-4 dark:bg-neutral-800/50"},[e(m,{circle:!0,style:{width:"48px",height:"48px"}},null),e("div",{class:"flex-1 space-y-2"},[e(m,{text:!0,style:{width:"30%"}},null),e(m,{text:!0,style:{width:"50%"}},null)])]))])}}),H=g({props:{reader:{type:Object,required:!0},isLast:{type:Boolean,default:!1}},setup(t){return()=>{const{reader:l,isLast:n}=t;return e("div",{class:["group flex items-center gap-4 px-4 py-3 transition-colors","hover:bg-neutral-100 dark:hover:bg-neutral-800/80",!n&&"border-b border-neutral-100 dark:border-neutral-800"]},[e("div",{class:"relative shrink-0"},[e(I,{round:!0,size:48,src:l.image,fallbackSrc:`https://ui-avatars.com/api/?name=${encodeURIComponent(l.name)}&background=random`},null),l.provider&&e("div",{class:"absolute -bottom-1 -right-1 flex size-5 items-center justify-center rounded-full bg-white shadow-sm ring-1 ring-neutral-200 dark:bg-neutral-900 dark:ring-neutral-700"},[e(T,{provider:l.provider,size:12},null)])]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"truncate font-medium text-neutral-900 dark:text-neutral-100"},[l.name]),l.isOwner&&e(x,null,{trigger:()=>e("span",{class:"flex size-5 items-center justify-center rounded-full bg-amber-500/10 text-amber-500"},[e(L,{class:"size-3"},null)]),default:()=>"站长"})]),e("div",{class:"mt-0.5 flex items-center gap-3 text-sm text-neutral-500"},[l.handle&&e("span",{class:"flex items-center gap-1 truncate"},[e("span",{class:"text-neutral-400"},[h("@")]),e("span",{class:"truncate"},[l.handle])]),l.email&&e(x,null,{trigger:()=>e("span",{class:"flex shrink-0 items-center gap-1 opacity-60 transition-opacity group-hover:opacity-100"},[e(C,{class:"size-3"},null),e("span",{class:"hidden sm:inline"},[l.email])]),default:()=>l.email})])]),l.provider&&e("div",{class:"hidden shrink-0 sm:block"},[e("span",{class:"rounded-full bg-neutral-100 px-2.5 py-1 text-xs capitalize text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"},[l.provider])])])}}}),T=g({props:{provider:{type:String,required:!0},size:{type:Number,default:16}},setup(t){return()=>{const l={width:`${t.size}px`,height:`${t.size}px`};switch(t.provider){case"github":return e("span",{class:"flex items-center justify-center text-neutral-900 dark:text-neutral-100",style:l},[e($,null,null)]);case"google":return e("img",{style:l,src:"https://authjs.dev/img/providers/google.svg",alt:"Google",width:t.size,height:t.size},null);default:return e("img",{style:l,src:`https://authjs.dev/img/providers/${t.provider}.svg`,alt:t.provider,width:t.size,height:t.size},null)}}}});export{G as default};
