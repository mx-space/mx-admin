import{c as w,ar as m,d8 as y,d as b,h as A,r as f,O as B,i as e,H as x,d9 as D,Y as z,W as C,cA as g,j as r,B as d,n as k,T}from"./index-qXdkAhVq.js";import{U as q}from"./upload-B07Sqq2p.js";import{D as N}from"./download-CfobbG51.js";import{H as $}from"./history-CmY-YCC1.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=w("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),i={getList:()=>m.get("/backups"),createNew:()=>y("/backups/new",{method:"GET",responseType:"blob"}),download:a=>y(`/backups/${a}`,{method:"GET",responseType:"blob"}),delete:a=>m.delete("/backups",{params:{filename:a}}),rollback:a=>m.patch(`/backups/rollback/${a}`)},M=b({setup(){const{setActions:a}=A(),s=f([]),u=f(!1),l=async()=>{u.value=!0;try{const n=(await i.getList()).data;n.sort((o,F)=>F.filename.localeCompare(o.filename)),s.value=n}finally{u.value=!1}};B(()=>{l()});const c=async()=>{const t=message.info("备份中...",{duration:1e9,closable:!0});try{const n=await i.createNew();t.destroy(),message.success("备份完成"),g(n,"backup.zip"),l()}catch{t.destroy(),message.error("备份失败")}},p=async()=>{const t=document.createElement("input");t.type="file",t.style.cssText="position: absolute; opacity: 0; z-index: -9999; top: 0; left: 0",t.accept=".zip",document.body.append(t),t.click(),t.addEventListener("change",()=>{t.files[0]&&(message.error("上传恢复功能暂未实现"),t.remove())})},v=async t=>{await i.delete(t),message.success("删除成功");const n=s.value.findIndex(o=>o.filename===t);n!==-1&&s.value.splice(n,1)},h=async t=>{const n=message.info("回滚中...",{duration:1e9,closable:!0});try{await i.rollback(t),n.destroy(),message.success("回滚成功，页面将会重载"),setTimeout(()=>{location.reload()},1e3)}catch{n.destroy(),message.error("回滚失败")}},E=async t=>{const n=message.info("下载中...",{duration:1e9,closable:!0});try{const o=await i.download(t);n.destroy(),message.success("下载完成"),g(o,`${t}.zip`)}catch{n.destroy(),message.error("下载失败")}};return a(e(z,null,[e(x,{icon:e(D,null,null),name:"立即备份",variant:"primary",onClick:c},null),e(x,{icon:e(q,null,null),onClick:p,name:"上传恢复",variant:"info"},null)])),()=>e("div",{class:"space-y-4"},[e(C,{show:u.value},{default:()=>[e("div",{class:"min-h-[200px]"},[s.value.length===0&&!u.value?e(j,{onCreate:c},null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[s.value.map(t=>e(L,{key:t.filename,item:t,onDownload:()=>E(t.filename),onRollback:()=>h(t.filename),onDelete:()=>v(t.filename)},null))])])]})])}}),L=b({props:{item:{type:Object,required:!0},onDownload:{type:Function,required:!0},onRollback:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(a){const s=u=>{const l=u.match(/(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2}-\d{2})/);if(l){const c=l[1],p=l[2].replace(/-/g,":");return`${c} ${p}`}return u};return()=>e("div",{class:"group flex items-center gap-4 border-b border-neutral-200 px-4 py-4 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-800/50"},[e("div",{class:"flex size-10 shrink-0 items-center justify-center rounded-lg bg-blue-50 text-blue-500 dark:bg-blue-950/50 dark:text-blue-400"},[e(H,{class:"size-5"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"text-base font-medium text-neutral-900 dark:text-neutral-100"},[s(a.item.filename)]),e("div",{class:"mt-0.5 flex items-center gap-3 text-sm text-neutral-500 dark:text-neutral-400"},[e("span",{class:"tabular-nums"},[a.item.size]),e("span",{class:"font-mono text-xs text-neutral-400 dark:text-neutral-500"},[a.item.filename])])]),e("div",{class:"flex shrink-0 items-center gap-1"},[e(d,{size:"tiny",quaternary:!0,type:"primary",onClick:a.onDownload,"aria-label":"下载备份"},{icon:()=>e(N,{class:"size-3.5"},null),default:()=>e("span",{class:"hidden sm:inline"},[r("下载")])}),e(k,{positiveText:"取消",negativeText:"回滚",onNegativeClick:a.onRollback},{trigger:()=>e(d,{size:"tiny",quaternary:!0,type:"warning","aria-label":"回滚到此备份"},{icon:()=>e($,{class:"size-3.5"},null),default:()=>e("span",{class:"hidden sm:inline"},[r("回滚")])}),default:()=>e("span",{class:"max-w-48"},[r("确定要回滚到此备份吗？当前数据将被覆盖。")])}),e(k,{positiveText:"取消",negativeText:"删除",onNegativeClick:a.onDelete},{trigger:()=>e(d,{size:"tiny",quaternary:!0,type:"error","aria-label":"删除备份"},{default:()=>[e(T,{class:"size-3.5"},null)]}),default:()=>e("span",null,[r("确定要删除此备份吗？")])})])])}}),j=b({props:{onCreate:{type:Function,required:!0}},setup(a){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(D,{class:"size-8 text-neutral-400"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[r("暂无备份")]),e("p",{class:"mb-6 text-sm text-neutral-500 dark:text-neutral-400"},[r("创建备份以保护你的数据")]),e(d,{type:"primary",onClick:a.onCreate},{default:()=>[r("立即备份")]})])}});export{M as default};
