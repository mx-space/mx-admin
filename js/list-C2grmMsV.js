import{d as m,f as A,A as B,_ as S,q as o,o as z,e as M,a as h,g as v,h as N,w as U,i as e,aO as K,j as l,R as f,$ as R,aP as T,aw as x,M as g,K as b,Y as k,B as i,m as L,n as $,T as Q,aQ as V,aR as _,H,P as O}from"./index-DSr6uqVi.js";import{p as d}from"./projects-XiELrcVf.js";const I=m({name:"ProjectCard",props:{data:{type:Object,required:!0},checked:{type:Boolean,default:!1},onCheckedChange:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(n){const a=h(()=>n.data);return()=>e("div",{class:"group flex items-start gap-3 border-b border-neutral-200 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-900/50"},[e("div",{class:"flex shrink-0 pt-1"},[e(T,{checked:n.checked,onUpdateChecked:n.onCheckedChange,"aria-label":`选择项目 ${a.value.name}`},null)]),e("div",{class:"shrink-0"},[a.value.avatar?e(x,{round:!0,size:40,src:a.value.avatar,fallbackSrc:"",class:"ring-1 ring-neutral-200 dark:ring-neutral-700"},null):e(x,{round:!0,size:40,class:"bg-neutral-100 text-neutral-600 ring-1 ring-neutral-200 dark:bg-neutral-800 dark:text-neutral-300 dark:ring-neutral-700"},{default:()=>[a.value.name[0]?.toUpperCase()||"P"]})]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[a.value.projectUrl?e("a",{href:a.value.projectUrl,target:"_blank",rel:"noopener noreferrer",class:"truncate text-[14px] font-medium text-neutral-900 hover:text-blue-600 hover:underline dark:text-neutral-100 dark:hover:text-blue-400"},[a.value.name]):e("span",{class:"truncate text-[14px] font-medium text-neutral-900 dark:text-neutral-100"},[a.value.name]),a.value.projectUrl&&e(g,{class:"h-3.5 w-3.5 shrink-0 text-neutral-400"},null)]),a.value.description&&e("p",{class:"mt-1 line-clamp-2 text-[13px] text-neutral-600 dark:text-neutral-400"},[a.value.description]),e("div",{class:"mt-2 flex flex-wrap items-center gap-x-3 gap-y-1 text-[12px] text-neutral-500 dark:text-neutral-400"},[e(b,{time:a.value.created},null),a.value.modified&&e(k,null,[e("span",null,[l("·")]),e("span",{class:"flex items-center gap-1"},[l("更新于 "),e(b,{time:a.value.modified},null)])])])]),e("div",{class:"flex shrink-0 items-center gap-1 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},[a.value.projectUrl&&e("a",{href:a.value.projectUrl,target:"_blank",rel:"noopener noreferrer","aria-label":`访问 ${a.value.name} 项目`},[e(i,{quaternary:!0,size:"tiny",class:"!px-2"},{icon:()=>e(g,{class:"h-4 w-4 text-neutral-500"},null)})]),e(f,{to:`/projects/edit?id=${a.value.id}`,"aria-label":`编辑项目 ${a.value.name}`},{default:()=>[e(i,{quaternary:!0,size:"tiny",class:"!px-2"},{icon:()=>e(L,{class:"h-4 w-4 text-neutral-500"},null)})]}),e($,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>n.onDelete(a.value.id)},{trigger:()=>e(i,{quaternary:!0,size:"tiny",class:"!px-2","aria-label":`删除项目 ${a.value.name}`},{icon:()=>e(Q,{class:"h-4 w-4 text-red-500"},null)}),default:()=>e("span",{class:"max-w-48"},[l("确定要删除「"),a.value.name,l("」吗？")])})])])}}),J=m({setup(){const n=A(),a=B(),{data:c,pager:r,isLoading:y}=S({queryKey:t=>o.projects.list(t),queryFn:t=>d.getList({page:t.page,size:t.size}),pageSize:30}),u=z(new Set),p=M(V),w=h(()=>p.viewport.value.mobile||p.viewport.value.pad),C=v({mutationFn:d.delete,onSuccess:()=>{n.success("删除成功"),a.invalidateQueries({queryKey:o.projects.all})}}),j=t=>{C.mutate(t,{onSuccess:()=>{u.delete(t)}})},P=v({mutationFn:async t=>{await Promise.all(t.map(s=>d.delete(s)))},onSuccess:()=>{u.clear(),n.success("删除成功"),a.invalidateQueries({queryKey:o.projects.all})}}),{setActions:E}=N();U(()=>{E(e(k,null,[e(_,{checkedRowKeys:u,onDelete:()=>{P.mutate(Array.from(u.values()))}},null),e(H,{to:"/projects/edit",icon:e(O,null,null)},null)]))});const q=()=>e("div",{class:"flex flex-col items-center justify-center py-20"},[e("div",{class:"mb-4 rounded-full bg-neutral-100 p-4 dark:bg-neutral-800"},[e(K,{class:"h-8 w-8 text-neutral-400"},null)]),e("p",{class:"text-[14px] text-neutral-600 dark:text-neutral-400"},[l("暂无项目")]),e(f,{to:"/projects/edit",class:"mt-4 text-[14px] text-blue-500 hover:text-blue-600 hover:underline"},{default:()=>[l("创建第一个项目")]})]),D=()=>e("div",{class:"flex items-center justify-center py-20"},[e("span",{class:"text-[14px] text-neutral-400"},[l("加载中…")])]),F=()=>!r.value||r.value.totalPage<=1?null:w.value?e("div",{class:"flex items-center justify-center gap-4 border-t border-neutral-200 py-4 dark:border-neutral-800"},[e("button",{class:"rounded-md border border-neutral-200 px-3 py-1.5 text-[13px] transition-colors hover:bg-neutral-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-neutral-700 dark:hover:bg-neutral-800",disabled:!r.value.hasPrevPage,onClick:()=>{}},[l("上一页")]),e("span",{class:"text-[13px] text-neutral-500 dark:text-neutral-400"},[r.value.currentPage,l(" / "),r.value.totalPage]),e("button",{class:"rounded-md border border-neutral-200 px-3 py-1.5 text-[13px] transition-colors hover:bg-neutral-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-neutral-700 dark:hover:bg-neutral-800",disabled:!r.value.hasNextPage,onClick:()=>{}},[l("下一页")])]):e("div",{class:"flex justify-end border-t border-neutral-200 px-4 py-3 dark:border-neutral-800"},[e(R,{itemCount:r.value.total,pageCount:r.value.totalPage,page:r.value.currentPage,pageSize:r.value.size},null)]);return()=>e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[y.value?e(D,null,null):c.value.length===0?e(q,null,null):e("div",null,[c.value.map(t=>e(I,{key:t.id,data:t,checked:u.has(t.id),onCheckedChange:s=>{s?u.add(t.id):u.delete(t.id)},onDelete:j},null))]),e(F,null,null)])}});export{J as default};
