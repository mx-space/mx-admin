import{A as j,g as q,C as k,q as T,d as h,i as e,l as A,j as s,B as p,S as R,m as B,n as P,T as $,D as K,E as S,r as v,p as M,F as _,G as L,I as H,P as U,J,K as Q,L as W,M as G,X as N,O as X,Q as Y,U as Z,V as ee,o as I,s as te,W as ae,Y as le,z as C,Z as ue,_ as ne,h as re,H as se,$ as ie,a0 as oe}from"./index-qXdkAhVq.js";import{U as O}from"./index-BdAu42KH.js";import{N as de}from"./Upload-D_ZhN6TK.js";import{U as ce}from"./upload-B07Sqq2p.js";const me=()=>{const t=j();return q({mutationFn:k.delete,onSuccess:()=>{window.message.success("删除成功"),t.invalidateQueries({queryKey:T.topics.all})}})},V=t=>{if(!t)return"";const l=t.split(" ")[0];return l.length>4?t[0]:l},pe=h({name:"TopicListItem",props:{topic:{type:Object,required:!0},onEdit:{type:Function,required:!0},onDelete:{type:Function,required:!0},onViewDetail:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"group flex items-center gap-4 border-b border-neutral-200 px-4 py-4 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-900/50"},[e("div",{class:"shrink-0"},[t.topic.icon?e("img",{src:t.topic.icon,alt:`${t.topic.name} 图标`,class:"size-12 rounded-xl object-cover",loading:"lazy"},null):e("div",{class:"flex size-12 items-center justify-center rounded-xl bg-gradient-to-br from-neutral-100 to-neutral-200 text-lg font-semibold text-neutral-600 dark:from-neutral-800 dark:to-neutral-700 dark:text-neutral-300"},[V(t.topic.name)])]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex min-w-0 items-center gap-2"},[e("h3",{class:"shrink-0 truncate text-base font-medium text-neutral-900 dark:text-neutral-100",style:{maxWidth:"40%"}},[t.topic.name]),e("span",{class:"flex min-w-0 items-center gap-1 text-sm text-neutral-400"},[e(A,{class:"size-3.5 shrink-0","aria-hidden":"true"},null),e("span",{class:"truncate font-mono"},[t.topic.slug])])]),t.topic.introduce&&e("p",{class:"mt-1 line-clamp-1 text-sm text-neutral-500 dark:text-neutral-400"},[t.topic.introduce]),t.topic.description&&e("p",{class:"mt-0.5 line-clamp-1 text-sm text-neutral-400 dark:text-neutral-500"},[t.topic.description])]),e("div",{class:"flex shrink-0 items-center gap-1"},[e(p,{size:"tiny",quaternary:!0,onClick:()=>t.onViewDetail(t.topic.id),"aria-label":`查看 ${t.topic.name} 详情`},{icon:()=>e(R,{class:"size-3.5 text-neutral-500"},null),default:()=>e("span",{class:"hidden sm:inline"},[s("详情")])}),e(p,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>t.onEdit(t.topic.id),"aria-label":`编辑 ${t.topic.name}`},{icon:()=>e(B,{class:"size-3.5"},null),default:()=>e("span",{class:"hidden sm:inline"},[s("编辑")])}),e(P,{onPositiveClick:()=>t.onDelete(t.topic.id)},{trigger:()=>e(p,{size:"tiny",quaternary:!0,type:"error","aria-label":`删除 ${t.topic.name}`},{default:()=>[e($,{class:"size-3.5"},null)]}),default:()=>e("span",null,[s("确定要删除「"),t.topic.name,s("」吗？")])})])])}}),ve=h({name:"TopicEmptyState",props:{onAdd:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(A,{class:"size-8 text-neutral-400","aria-hidden":"true"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[s("暂无专栏")]),e("p",{class:"mb-6 text-sm text-neutral-500 dark:text-neutral-400"},[s("创建专栏来组织和分类你的日记")]),e(p,{type:"primary",onClick:t.onAdd},{default:()=>[s("创建第一个专栏")]})])}}),ge=h({name:"TopicListSkeleton",setup(){return()=>e("div",{class:"animate-pulse"},[[1,2,3,4].map(t=>e("div",{key:t,class:"flex items-center gap-4 border-b border-neutral-200 px-4 py-4 last:border-b-0 dark:border-neutral-800"},[e("div",{class:"size-12 rounded-xl bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"flex-1"},[e("div",{class:"h-5 w-36 rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"mt-2 h-4 w-56 rounded bg-neutral-100 dark:bg-neutral-800"},null)]),e("div",{class:"flex gap-2"},[e("div",{class:"h-7 w-14 rounded bg-neutral-100 dark:bg-neutral-800"},null),e("div",{class:"h-7 w-14 rounded bg-neutral-100 dark:bg-neutral-800"},null)])]))])}}),fe=K(t=>S.getList({page:t,size:50,select:"nid title _id id"})),be=h({name:"TopicDetailDrawer",props:{show:{type:Boolean,required:!0},topicId:{type:String,required:!0},onClose:{type:Function,required:!0},onEdit:{type:Function,required:!0}},setup(t){const l=L(),n=v(null),d=v([]),u=v(),c=v(!1),y=v(!1),g=async r=>{c.value=!0;try{const o=await k.getById(r);n.value=o,await f(r)}finally{c.value=!1}},f=async(r,o=1,F=10)=>{y.value=!0;try{const{data:w,pagination:z}=await S.getByTopic(r,{page:o,size:F});d.value=w,u.value=z}finally{y.value=!1}},i=q({mutationFn:r=>S.patch(r,{topicId:null}),onSuccess:(r,o)=>{message.success("已移除文章的专栏引用");const F=d.value.findIndex(w=>w.id===o);F!==-1&&d.value.splice(F,1)}}),b=r=>{i.mutate(r)},E=q({mutationFn:({id:r,icon:o})=>k.patch(r,{icon:o}),onSuccess:(r,{icon:o})=>{n.value&&(n.value.icon=o)}}),a=r=>{n.value&&E.mutate({id:n.value.id,icon:r})};M(()=>[t.show,t.topicId],([r,o])=>{r&&o&&g(o)},{immediate:!0});const x=v(!1);return()=>e(_,{show:t.show,width:480,class:"max-w-[90vw]",placement:"right",onUpdateShow:r=>{r||t.onClose()}},{default:()=>[e(H,{title:n.value?`专栏 - ${n.value.name}`:"专栏详情",closable:!0,nativeScrollbar:!1,bodyContentClass:"!p-0"},{header:()=>n.value&&e("div",{class:"flex items-center gap-2"},[e("span",{class:"text-base font-medium"},[s("专栏 - "),n.value.name]),e(p,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>t.onEdit(n.value.id),"aria-label":"编辑专栏"},{default:()=>[e(B,{class:"size-3.5"},null)]})]),default:()=>c.value?e(he,null,null):n.value?e("div",{class:"px-5 py-4"},[e("div",{class:"mb-6 rounded-xl border border-neutral-200 bg-neutral-50/50 p-4 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"flex items-start gap-4"},[e(O,{class:"shrink-0",type:"icon",onFinish:r=>{const o=JSON.parse((r.event?.target).responseText);return a(o.url),r.file},onError:r=>{try{const o=JSON.parse((r.event?.target).responseText);message.warning(o.message)}catch{}return r.file}},{default:()=>[e(de,{class:"!border-0 !bg-transparent !p-0"},{default:()=>[e("div",{class:"group relative cursor-pointer"},[n.value.icon?e("img",{src:n.value.icon,alt:`${n.value.name} 图标`,class:"size-16 rounded-xl object-cover transition-opacity group-hover:opacity-70"},null):e("div",{class:"flex size-16 items-center justify-center rounded-xl bg-gradient-to-br from-neutral-200 to-neutral-300 text-xl font-semibold text-neutral-600 transition-opacity group-hover:opacity-70 dark:from-neutral-700 dark:to-neutral-600 dark:text-neutral-300"},[V(n.value.name)]),e("div",{class:"absolute inset-0 flex items-center justify-center rounded-xl bg-black/40 opacity-0 transition-opacity group-hover:opacity-100"},[e(B,{class:"size-5 text-white"},null)])])]})]}),e("div",{class:"min-w-0 flex-1"},[e("h3",{class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[n.value.name]),e("div",{class:"mt-1 flex items-center gap-1 text-xs text-neutral-400"},[e(A,{class:"size-3","aria-hidden":"true"},null),e("span",{class:"font-mono"},[n.value.slug])]),n.value.introduce&&e("p",{class:"mt-2 text-sm text-neutral-600 dark:text-neutral-400"},[n.value.introduce])])]),n.value.description&&e("p",{class:"mt-4 text-sm text-neutral-500 dark:text-neutral-400"},[n.value.description])]),e("div",null,[e("div",{class:"mb-3 flex items-center justify-between"},[e("h4",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[s("包含的文章"),u.value&&e("span",{class:"ml-1 text-xs text-neutral-400"},[s("("),u.value.total,s(")")])]),e(p,{size:"small",type:"primary",secondary:!0,onClick:()=>x.value=!0,"aria-label":"添加文章到专栏"},{icon:()=>e(U,{class:"size-4"},null),default:()=>"添加"})]),y.value&&d.value.length===0?e(ke,null,null):d.value.length===0?e("div",{class:"flex flex-col items-center justify-center rounded-lg border border-dashed border-neutral-200 py-8 dark:border-neutral-800"},[e(J,{description:"暂无文章"},{extra:()=>e(p,{size:"small",onClick:()=>x.value=!0},{default:()=>[s("添加文章")]})})]):e("div",{class:"space-y-2"},[d.value.map(r=>e(xe,{key:r.id,note:r,onEdit:()=>{l.push({path:"/notes/edit",query:{id:r.id}})},onRemove:()=>b(r.id),topicName:n.value?.name},null)),u.value&&u.value.totalPage>1&&e("div",{class:"flex justify-center gap-2 pt-4"},[e(p,{size:"small",disabled:!u.value.hasPrevPage,onClick:()=>f(t.topicId,u.value.currentPage-1)},{default:()=>[s("上一页")]}),e("span",{class:"flex items-center text-sm text-neutral-500"},[u.value.currentPage,s(" /")," ",u.value.totalPage]),e(p,{size:"small",disabled:!u.value.hasNextPage,onClick:()=>f(t.topicId,u.value.currentPage+1)},{default:()=>[s("下一页")]})])])])]):null}),n.value&&e(ye,{show:x.value,topicId:n.value.id,onClose:()=>x.value=!1,onSuccess:()=>{x.value=!1,f(t.topicId)}},null)]})}}),xe=h({props:{note:{type:Object,required:!0},onEdit:{type:Function,required:!0},onRemove:{type:Function,required:!0},topicName:{type:String,required:!1}},setup(t){return()=>e("div",{class:"group flex items-center justify-between rounded-lg border border-neutral-200 px-3 py-2.5 transition-colors hover:border-neutral-300 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:border-neutral-700 dark:hover:bg-neutral-800/50"},[e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"shrink-0 font-mono text-xs text-neutral-400"},[s("#"),t.note.nid]),e("span",{class:"truncate text-sm font-medium text-neutral-900 dark:text-neutral-100"},[t.note.title])]),e("div",{class:"mt-0.5 text-xs text-neutral-400"},[e(Q,{time:t.note.created},null)])]),e("div",{class:"flex shrink-0 items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100"},[e("a",{href:W(t.note.id),target:"_blank",rel:"noopener noreferrer","aria-label":`预览 ${t.note.title}`},[e(p,{size:"tiny",quaternary:!0},{default:()=>[e(G,{class:"size-3.5"},null)]})]),e(p,{size:"tiny",quaternary:!0,type:"primary",onClick:t.onEdit,"aria-label":`编辑 ${t.note.title}`},{default:()=>[e(B,{class:"size-3.5"},null)]}),e(P,{onPositiveClick:t.onRemove},{trigger:()=>e(p,{size:"tiny",quaternary:!0,type:"error","aria-label":`从专栏移除 ${t.note.title}`},{default:()=>[e(N,{class:"size-3.5"},null)]}),default:()=>e("span",null,[s("确定要从专栏「"),t.topicName,s("」中移除此文章吗？")])})])])}}),ye=h({props:{show:{type:Boolean,required:!0},topicId:{type:String,required:!0},onClose:{type:Function,required:!0},onSuccess:{type:Function,required:!0}},setup(t){const{refresh:l,fetchNext:n,datalist:d,loading:u}=fe(),c=v([]),y=v(!1),g=async()=>{if(c.value.length===0){message.warning("请选择要添加的文章");return}y.value=!0;try{await Promise.all(c.value.map(i=>S.patch(i,{topicId:t.topicId}))),message.success("添加成功"),c.value=[],t.onSuccess()}finally{y.value=!1}},f=i=>{const b=i.currentTarget;b.scrollTop+b.offsetHeight+10>=b.scrollHeight&&n()};return X(()=>{d.value.length===0&&n()}),()=>Y(e("div",{class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:i=>{i.target===i.currentTarget&&t.onClose()}},[e("div",{class:"w-full max-w-md rounded-xl bg-white p-5 shadow-xl dark:bg-neutral-900",role:"dialog","aria-modal":"true","aria-labelledby":"add-note-dialog-title"},[e("div",{class:"mb-4 flex items-center justify-between"},[e("h3",{id:"add-note-dialog-title",class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[s("添加文章到专栏")]),e("button",{type:"button",class:"rounded-lg p-1 text-neutral-400 transition-colors hover:bg-neutral-100 hover:text-neutral-600 dark:hover:bg-neutral-800",onClick:t.onClose,"aria-label":"关闭"},[e(N,{class:"size-5"},null)])]),e("div",{class:"mb-4"},[e(ee,{multiple:!0,filterable:!0,clearable:!0,loading:u.value,value:c.value,onUpdateValue:i=>c.value=i,maxTagCount:3,options:d.value.map(i=>({label:i.title,value:i.id,key:i.id})),placeholder:"选择要添加的文章",resetMenuOnOptionsChange:!1,onClear:l,onScroll:f},null)]),e("div",{class:"flex justify-end gap-2"},[e(p,{onClick:t.onClose},{default:()=>[s("取消")]}),e(p,{type:"primary",loading:y.value,disabled:c.value.length===0,onClick:g},{default:()=>[s("添加 ("),c.value.length,s(")")]})])])]),[[Z,t.show]])}}),he=h({setup(){return()=>e("div",{class:"animate-pulse px-5 py-4"},[e("div",{class:"mb-6 rounded-xl border border-neutral-200 bg-neutral-50/50 p-4 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"flex items-start gap-4"},[e("div",{class:"size-16 rounded-xl bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"flex-1"},[e("div",{class:"h-6 w-32 rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"mt-2 h-4 w-20 rounded bg-neutral-100 dark:bg-neutral-800"},null),e("div",{class:"mt-3 h-4 w-full rounded bg-neutral-100 dark:bg-neutral-800"},null)])])]),e("div",{class:"space-y-2"},[[1,2,3].map(t=>e("div",{key:t,class:"h-16 rounded-lg bg-neutral-100 dark:bg-neutral-800"},null))])])}}),ke=h({setup(){return()=>e("div",{class:"animate-pulse space-y-2"},[[1,2,3].map(t=>e("div",{key:t,class:"h-16 rounded-lg bg-neutral-100 dark:bg-neutral-800"},null))])}}),D=h({props:{label:{type:String,required:!0},required:{type:Boolean,default:!1},error:{type:String,required:!1}},setup(t,{slots:l}){return()=>e("div",{class:"mb-4"},[e("label",{class:"mb-1.5 block text-sm font-medium text-neutral-700 dark:text-neutral-300"},[t.label,t.required&&e("span",{class:"ml-0.5 text-red-500"},[s("*")])]),l.default?.(),t.error&&e("p",{class:"mt-1 text-xs text-red-500",role:"alert"},[t.error])])}}),Ee=h({name:"TopicEditModal",props:{show:{type:Boolean,required:!0},onClose:{type:Function,required:!0},id:{type:String,required:!1},onSubmit:{type:Function,required:!1}},setup(t){const l=I({}),n=v(!1),d=v(!1),u=I({}),c=()=>{Object.keys(l).forEach(a=>{delete l[a]}),Object.keys(u).forEach(a=>{delete u[a]})},y=()=>(Object.keys(u).forEach(a=>delete u[a]),l.name?.trim()?l.name.length>50&&(u.name="名称不能超过 50 个字符"):u.name="请输入专栏名称",l.slug?.trim()?/^[\w-]+$/.test(l.slug)||(u.slug="ID 只能包含字母、数字、下划线和连字符"):u.slug="请输入专栏 ID",l.introduce?.trim()?l.introduce.length>100&&(u.introduce="简介不能超过 100 个字符"):u.introduce="请输入简介",l.description&&l.description.length>500&&(u.description="描述不能超过 500 个字符"),Object.keys(u).length===0);M(()=>t.id,a=>{a?(n.value=!0,k.getById(a).then(x=>{Object.assign(l,x)}).finally(()=>{n.value=!1})):c()});const g=()=>{t.onClose(),ue(()=>c())},f=q({mutationFn:a=>k.create(a),onSuccess:a=>{message.success("创建成功"),t.onSubmit?.(a),c()}}),i=q({mutationFn:({id:a,data:x})=>k.update(a,x),onSuccess:a=>{message.success("修改成功"),t.onSubmit?.(a),c()}}),b=()=>{y()&&(d.value=!0,t.id?i.mutate({id:t.id,data:l},{onSettled:()=>d.value=!1}):f.mutate(l,{onSettled:()=>d.value=!1}))},E=a=>{a.key==="Enter"&&(a.metaKey||a.ctrlKey)&&b()};return()=>e(te,{show:t.show,onUpdateShow:a=>{a||g()},closeOnEsc:!0,transformOrigin:"center"},{default:()=>[e("div",{class:"w-full max-w-lg rounded-xl bg-white shadow-xl dark:bg-neutral-900",role:"dialog","aria-modal":"true","aria-labelledby":"topic-modal-title",onKeydown:E},[e("div",{class:"flex items-center justify-between border-b border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e("h2",{id:"topic-modal-title",class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[t.id?"编辑专栏":"新建专栏"]),e("button",{type:"button",class:"rounded-lg p-1 text-neutral-400 transition-colors hover:bg-neutral-100 hover:text-neutral-600 dark:hover:bg-neutral-800",onClick:g,"aria-label":"关闭"},[e(N,{class:"size-5"},null)])]),e("div",{class:"px-5 py-4"},[n.value?e("div",{class:"flex items-center justify-center py-12"},[e(ae,{size:"medium"},null)]):e(le,null,[e(D,{label:"名称",required:!0,error:u.name},{default:()=>[e(C,{value:l.name,onUpdateValue:a=>l.name=a,placeholder:"输入专栏名称",maxlength:50,showCount:!0},null)]}),e(D,{label:"ID (Slug)",required:!0,error:u.slug},{default:()=>[e(C,{value:l.slug,onUpdateValue:a=>l.slug=a,placeholder:"输入唯一标识，如 my-topic"},null),e("p",{class:"mt-1 text-xs text-neutral-400"},[s("用于 URL，只能包含字母、数字、下划线和连字符")])]}),e(D,{label:"简介",required:!0,error:u.introduce},{default:()=>[e(C,{value:l.introduce,onUpdateValue:a=>l.introduce=a,placeholder:"简短介绍这个专栏",maxlength:100,showCount:!0},null)]}),e(D,{label:"图标"},{default:()=>[e("div",{class:"flex items-center gap-3"},[e(C,{value:l.icon,onUpdateValue:a=>l.icon=a,placeholder:"输入图标 URL 或上传",class:"flex-1"},null),e(O,{type:"icon",onFinish:a=>{const x=JSON.parse((a.event?.target).responseText);return l.icon=x.url,a.file}},{default:()=>[e(p,{quaternary:!0,type:"primary","aria-label":"上传图标"},{default:()=>[e(ce,{class:"size-4"},null)]})]})])]}),e(D,{label:"详细描述",error:u.description},{default:()=>[e(C,{type:"textarea",value:l.description,onUpdateValue:a=>l.description=a,placeholder:"可选的详细描述",autosize:{minRows:2,maxRows:5},maxlength:500,showCount:!0},null)]})])]),e("div",{class:"flex items-center justify-end gap-2 border-t border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e(p,{onClick:g},{default:()=>[s("取消")]}),e(p,{type:"primary",loading:d.value,disabled:n.value,onClick:b},{default:()=>[t.id?"保存修改":"创建专栏"]})])])]})}}),qe=h({name:"TopicListPage",setup(){const t=L(),l=oe(),n=j(),{data:d,pager:u,isLoading:c,refresh:y}=ne({queryKey:m=>T.topics.list(),queryFn:m=>k.getList({page:m.page,size:m.size}),pageSize:20}),g=v(""),f=v(!1),i=v(""),b=v(!1),E=()=>{f.value=!0,g.value=""},a=()=>{f.value=!1,g.value=""},x=me(),r=m=>{x.mutate(m,{onSuccess:()=>{y()}})},o=m=>{g.value=m,f.value=!0},F=m=>{i.value=m,b.value=!0},w=m=>{a(),n.invalidateQueries({queryKey:T.topics.all})},{setActions:z}=re();return z(e(se,{icon:e(U,null,null),onClick:E,variant:"success",name:"新建专栏"},null)),()=>e("div",{class:"space-y-4"},[c.value&&d.value.length===0?e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[e(ge,null,null)]):d.value.length===0?e(ve,{onAdd:E},null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[d.value.map(m=>e(pe,{key:m.id,topic:m,onEdit:o,onDelete:r,onViewDetail:F},null))]),u.value&&u.value.totalPage>1&&e("div",{class:"flex justify-center"},[e(ie,{page:u.value.currentPage,onUpdatePage:m=>{t.replace({query:{...l.query,page:m},params:{...l.params}})},pageCount:u.value.totalPage,pageSize:u.value.size,showQuickJumper:!0},null)]),e(be,{show:b.value,topicId:i.value,onClose:()=>{b.value=!1,i.value=""},onEdit:m=>{b.value=!1,o(m)}},null),e(Ee,{onClose:a,show:!!(f.value||g.value),id:g.value,onSubmit:w},null)])}});export{qe as default};
