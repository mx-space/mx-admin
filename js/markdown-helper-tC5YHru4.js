const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index-DoEgFLcO.js","assets/index-Bb0KFhA8.css"])))=>i.map(i=>d[i]);
import{c as E,ar as V,ca as O,ci as H,d as U,r as v,a as N,n as Y,cz as J,o as q,h as e,v as I,i as n,V as R,B as g,bJ as W,W as X,bS as G,p as K,bX as Q,s as m,cA as Z,T as ee}from"./index-DoEgFLcO.js";import{U as te}from"./upload-B3DfZtO4.js";import{F as ae}from"./file-text-CxNLTwjh.js";import{D as le}from"./download-o-2ttAD6.js";import{a as se}from"./Upload-BK8vilh7.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=E("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=E("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=E("file-down",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=E("file-up",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),T={import:u=>V.post("/markdown/import",{data:u}),export:async u=>{const{$api:s}=await O(async()=>{const{$api:a}=await import("./index-DoEgFLcO.js").then(o=>o.dV);return{$api:a}},__vite__mapDeps([0,1]));return s("/markdown/export",{params:u,responseType:"blob"})}};class oe{constructor(s){this.strList=s,this.strList=s}parse(s){const a=s,o=/-{3}\r?\n(.*?)-{3}\r?\n*(.*)$/gms.exec(a);if(!o)return{text:a};const c=o.pop(),p=H(o[1]),r={},{categories:A,tags:f,date:b,updated:F,created:C,title:B}=p;return(b||C)&&(r.date=new Date(b||C).toISOString()),F&&(r.updated=new Date(F).toISOString()),r.categories=A,r.tags=f,r.title=B,Object.keys(r).forEach(h=>{typeof r[h]>"u"&&delete r[h]}),{meta:r,text:c}}start(){const s=this.strList,a=[];for(const[o,c]of s.entries())try{a.push(this.parse(c))}catch(p){throw{idx:o,err:p}}return a}}var k=(function(u){return u.Post="post",u.Note="note",u})(k||{});const de=[{value:k.Post,label:"博文"},{label:"日记",value:k.Note}],he=U({name:"MarkdownHelper",setup(){const u=v(k.Post),s=v([]),a=v([]),o=v(!1),c=v(!1),p=v(!1),r=v(!1),A=N(()=>s.value.length>0),f=N(()=>a.value.length>0);function b(t){return new oe(t).start().map((l,d)=>{const w=(s.value[d].file?.name??"").replace(/\.md$/,"");return l.meta?l.meta.slug=l.meta.slug??w:l.meta={title:w,slug:w},l.meta?.date||(l.meta.date=new Date().toISOString()),l})}async function F(t){if(!A.value){m.warning("请先选择文件");return}o.value=!0;const i=[];try{for(const d of s.value){const x=await new Promise((w,M)=>{const y=d.file;if(!y){M(new Error("文件不存在"));return}const L=y.name.split(".").pop();if(y.type&&y.type!=="text/markdown"||!["md","markdown"].includes(L)){M(new Error(`只能解析 Markdown 文件，当前文件类型：${y.type||L}`));return}const S=new FileReader;S.addEventListener("load",j=>{w(j.target?.result||"")}),S.addEventListener("error",()=>{M(new Error("文件读取失败"))}),S.readAsText(y)});i.push(x)}const l=b(i);a.value=l.map((d,x)=>({...d,filename:s.value[x].file?.name??""})),m.success(`成功解析 ${l.length} 个文件`)}catch(l){m.error(l.message||"解析失败"),console.error(l)}finally{o.value=!1}}function C(t){if(t.stopPropagation(),t.preventDefault(),!f.value){m.warning("请先解析文件");return}r.value=!0}async function B(){c.value=!0;try{await T.import({type:u.value,data:a.value}),m.success(`成功导入 ${a.value.length} 条数据`),s.value=[],a.value=[]}catch(t){m.error(t.message||"导入失败")}finally{c.value=!1,r.value=!1}}const h=Y({includeYAMLHeader:!0,titleBigTitle:!1,filenameSlug:!1,withMetaJson:!0});async function D(){p.value=!0;try{const{includeYAMLHeader:t,filenameSlug:i,withMetaJson:l,titleBigTitle:d}=h,x=await T.export({slug:i,yaml:t,show_title:d,with_meta_json:l});Z(x,"markdown.zip"),m.success("导出成功")}catch(t){m.error(t.message||"导出失败")}finally{p.value=!1}}const z=J(t=>{s.value=t},250);q(s,t=>{t.length===0?a.value=[]:F()});function P(t){const i=t.file.name,l=a.value.findIndex(d=>d.filename===i);l!==-1&&a.value.splice(l,1)}const _=[{title:"文件名",key:"filename",width:200,ellipsis:{tooltip:!0}},{title:"标题",key:"meta.title",ellipsis:{tooltip:!0},render:t=>t.meta?.title||"—"},{title:"Slug",key:"meta.slug",width:150,ellipsis:{tooltip:!0},render:t=>t.meta?.slug||"—"},{title:"日期",key:"meta.date",width:180,render:t=>t.meta?.date?new Intl.DateTimeFormat("zh-CN",{dateStyle:"medium",timeStyle:"short"}).format(new Date(t.meta.date)):"—"},{title:"操作",key:"actions",width:80,render:t=>e(g,{size:"small",quaternary:!0,type:"error","aria-label":`删除 ${t.filename}`,onClick:()=>{const i=a.value.findIndex(l=>l.filename===t.filename);if(i!==-1){a.value.splice(i,1);const l=s.value.findIndex(d=>d.file?.name===t.filename);l!==-1&&s.value.splice(l,1)}}},{default:()=>[e(ee,{class:"h-4 w-4"},null)]})}],$=[{id:"includeYAMLHeader",label:"包含 YAML 头部",description:"在文件开头添加 Front Matter 元数据"},{id:"titleBigTitle",label:"首行显示标题",description:"在正文第一行添加 # 标题"},{id:"filenameSlug",label:"使用 Slug 作为文件名",description:"用 slug 而非标题命名文件"},{id:"withMetaJson",label:"导出元数据 JSON",description:"附带完整的元数据 JSON 文件"}];return()=>e("div",{class:"space-y-6"},[e(I,{title:"从 Markdown 导入",class:"overflow-hidden",headerExtra:()=>e("div",{class:"flex items-center gap-2"},[e(ie,{class:"h-5 w-5 text-neutral-400"},null)])},{default:()=>[e("div",{class:"space-y-4"},[e("div",{class:"flex items-center gap-4"},[e("label",{id:"import-type-label",class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[n("导入到")]),e(R,{options:de,value:u.value,onUpdateValue:t=>u.value=t,class:"w-32","aria-labelledby":"import-type-label"},null)]),e(se,{multiple:!0,accept:".md,.markdown",onChange:t=>z(t.fileList),onRemove:P,showFileList:!f.value},{default:()=>[e("div",{class:"flex w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-neutral-300 bg-neutral-50 px-6 py-8 transition-colors hover:border-blue-400 hover:bg-blue-50/50 dark:border-neutral-700 dark:bg-neutral-800/50 dark:hover:border-blue-500 dark:hover:bg-blue-900/20"},[e(te,{class:"mb-3 h-10 w-10 text-neutral-400"},null),e("p",{class:"mb-1 text-sm font-medium text-neutral-700 dark:text-neutral-300"},[n("点击或拖拽上传 Markdown 文件")]),e("p",{class:"text-xs text-neutral-500"},[n("支持 .md、.markdown 格式，可多选")])])]}),f.value&&e("div",{class:"space-y-3"},[e("div",{class:"flex items-center justify-between"},[e("div",{class:"flex items-center gap-2"},[e(ne,{class:"h-4 w-4 text-green-500"},null),e("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[n("已解析 "),a.value.length,n(" 个文件")])]),e(g,{size:"small",quaternary:!0,onClick:()=>{s.value=[],a.value=[]}},{default:()=>[n("清空")]})]),e(W,{columns:_,data:a.value,bordered:!0,size:"small",maxHeight:300,scrollX:700},null)]),o.value&&e("div",{class:"flex items-center justify-center py-4"},[e(X,{size:"small"},null),e("span",{class:"ml-2 text-sm text-neutral-500"},[n("解析中…")])]),e("div",{class:"flex justify-end gap-2 border-t border-neutral-200 pt-4 dark:border-neutral-700"},[e(g,{onClick:C,type:"primary",disabled:!f.value||c.value,loading:c.value,renderIcon:()=>e(ae,{class:"h-4 w-4"},null)},{default:()=>[n("导入")," ",f.value?`${a.value.length} 条数据`:"数据"]})])])]}),e(I,{title:"导出为 Markdown",class:"overflow-hidden",headerExtra:()=>e("div",{class:"flex items-center gap-2"},[e(ue,{class:"h-5 w-5 text-neutral-400"},null)])},{default:()=>[e("div",{class:"space-y-4"},[e("p",{class:"text-sm text-neutral-500"},[n("导出所有博文和日记为 Markdown 文件（Hexo YAML 格式）")]),e("div",{class:"grid gap-3 sm:grid-cols-2"},[$.map(t=>e("label",{key:t.id,class:"flex cursor-pointer items-start gap-3 rounded-lg border border-neutral-200 p-3 transition-colors hover:bg-neutral-50 dark:border-neutral-700 dark:hover:bg-neutral-800"},[e(G,{value:h[t.id],onUpdateValue:i=>h[t.id]=i,"aria-describedby":`${t.id}-desc`},null),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[t.label]),e("div",{id:`${t.id}-desc`,class:"text-xs text-neutral-500"},[t.description])])]))]),e("div",{class:"flex justify-end border-t border-neutral-200 pt-4 dark:border-neutral-700"},[e(g,{type:"primary",onClick:D,loading:p.value,disabled:p.value,renderIcon:()=>e(le,{class:"h-4 w-4"},null)},{default:()=>[n("导出 Markdown 压缩包")]})])])]}),e(K,{show:r.value,onUpdateShow:t=>r.value=t,preset:"card",title:"确认导入",style:{width:"400px",maxWidth:"90vw"}},{default:()=>[e("div",{class:"space-y-4"},[e("div",{class:"flex items-start gap-3"},[e(re,{class:"mt-0.5 h-5 w-5 flex-shrink-0 text-amber-500"},null),e("div",null,[e("p",{class:"text-sm text-neutral-700 dark:text-neutral-300"},[n("即将导入 "),e("strong",null,[a.value.length]),n(" 条数据到"),e(Q,{size:"small",class:"mx-1"},{default:()=>[u.value===k.Post?"博文":"日记"]})]),e("p",{class:"mt-1 text-xs text-neutral-500"},[n("此操作会创建新的内容，请确认数据无误")])])]),e("div",{class:"flex justify-end gap-2"},[e(g,{onClick:()=>r.value=!1},{default:()=>[n("取消")]}),e(g,{type:"primary",onClick:B,loading:c.value},{default:()=>[n("确认导入")]})])])]})])}});export{he as default};
