import{br as de,bs as Ne,bt as De,bu as Q,bv as U,bw as X,bx as Oe,by as Te,R as p,aP as fe,aM as pe,d as g,a as b,bz as z,c as e,g as d,bA as K,K as G,B as y,p as x,V as m,s as w,bq as T,n as me,bB as ve,u as N,bC as D,aj as Z,bD as ye,bE as Y,I as M,b8 as Ve,A as be,a0 as P,h as ge,a1 as L,i as A,j as q,bF as W,Z as he,y as J,o as F,a3 as B,r as E,w as I,bG as we,bH as _,F as k,v as Ce,bI as R,bJ as ee,bK as Ue,ai as qe,b4 as Ke,bL as Le,Q as je,bf as Re,H as te,$ as $e,av as xe,bM as ke,ab as Me,bN as _e,bO as He,bP as ae,bQ as ze,bR as Ge,f as We,bl as Ae,bS as Se,b2 as le,aa as Je,N as Qe,bp as Xe,b1 as Ze,b as Ye,bT as et,bU as ne,bV as tt,U as at,C as lt,am as nt,an as O}from"./index-Yj2E0y9v.js";import{C as ue}from"./CheckCircleOutlined-BUeBqhlT.js";import{a as ut,i as H}from"./isEmpty-BCIPiimf.js";import{N as st,a as rt}from"./ListItem-BJ8uTmsN.js";import{K as it}from"./index-CHVk6-VV.js";import{U as ot}from"./index-DWmKjm4C.js";import{N as ct}from"./Upload-Bra-tUBX.js";function dt(t){if(de(t))return t;if(Array.isArray(t)||Ne(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const l=Object.getPrototypeOf(t),u=l.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new u(t);if(t instanceof RegExp){const s=new u(t);return s.lastIndex=t.lastIndex,s}if(t instanceof DataView)return new u(t.buffer.slice(0));if(t instanceof Error){const s=new u(t.message);return s.stack=t.stack,s.name=t.name,s.cause=t.cause,s}if(typeof File<"u"&&t instanceof File)return new u([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const s=Object.create(l);return Object.assign(s,t)}return t}function ft(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}const pt=/\p{Lu}?\p{Ll}+|[0-9]+|\p{Lu}+(?!\p{Ll})|\p{Emoji_Presentation}|\p{Extended_Pictographic}|\p{L}+/gu;function mt(t){return Array.from(t.match(pt)??[])}function vt(t,...l){const u=l.slice(0,-1),s=l[l.length-1];let r=t;for(let o=0;o<u.length;o++){const n=u[o];r=V(r,n,s,new Map)}return r}function V(t,l,u,s){if(de(t)&&(t=Object(t)),l==null||typeof l!="object")return t;if(s.has(l))return dt(s.get(l));if(s.set(l,t),Array.isArray(l)){l=l.slice();for(let o=0;o<l.length;o++)l[o]=l[o]??void 0}const r=[...Object.keys(l),...De(l)];for(let o=0;o<r.length;o++){const n=r[o];let c=l[n],a=t[n];if(Q(c)&&(c={...c}),Q(a)&&(a={...a}),typeof Buffer<"u"&&Buffer.isBuffer(c)&&(c=U(c)),Array.isArray(c))if(typeof a=="object"&&a!=null){const f=[],h=Reflect.ownKeys(a);for(let v=0;v<h.length;v++){const C=h[v];f[C]=a[C]}a=f}else a=[];const i=u(a,c,n,t,l,s);i!=null?t[n]=i:Array.isArray(c)||X(a)&&X(c)?t[n]=V(a,c,u,s):a==null&&Oe(c)?t[n]=V({},c,u,s):a==null&&ut(c)?t[n]=U(c):(a===void 0||c!==void 0)&&(t[n]=c)}return t}function yt(t,...l){return vt(t,...l,Te)}function bt(t){const l=mt(t);if(l.length===0)return"";const[u,...s]=l;return`${u.toLowerCase()}${s.map(r=>ft(r)).join("")}`}function Be(t){if(t==null)return"";if(Array.isArray(t))return t.map(Be).join(",");const l=String(t);return l==="0"&&Object.is(Number(t),-0)?"-0":l}function gt(t){return typeof t!="string"&&(t=Be(t)),t.replace(/['\u2019]/g,"")}function ht(t){return bt(gt(t))}const wt=async()=>p.api.auth.session.get();function Ct(t){const l={};for(const u of t.providers){const s=u.type;s in t.public?l[s]={...t.public[s],enabled:u.enabled,type:s}:console.warn(`Provider type ${s} found in providers but not in public data.`)}return l}const Ie=Symbol.for("OauthDataInjectKey"),xt=()=>t=>pe(Ie,t),kt=()=>fe(Ie),Pe=(t,l)=>g({setup(){const u=async()=>{await ve.signIn.social({provider:t,callbackURL:`${location.href}?validate=true`})},s=kt(),r=b({clientId:"",secret:""}),o=b(!1);z(()=>{if(s.value[t]===void 0)return;const{clientId:i,enabled:f}=s.value[t];o.value=f,r.value.clientId=i});const n=b(null),c={clientId:[{required:!0,message:"Client Id 不能为空"}],secret:[{required:!0,message:"Client Secret 不能为空"}]},a=async()=>{await n.value?.validate(),p.api.options("oauth").patch({data:{providers:[{type:t,enabled:o.value}],secrets:{[t]:{clientSecret:r.value.secret}},public:{[t]:{clientId:r.value.clientId}}}})};return()=>e(me,{title:l.name},{default(){return e(x,{model:r.value,ref:n,rules:c},{default:()=>[e(m,{label:"Client Id",path:"clientId",required:!0},{default:()=>[e(w,{value:r.value.clientId,onUpdateValue:i=>{r.value.clientId=i}},null)]}),e(m,{label:"Client Secret",required:!0,path:"secret"},{default:()=>[e(w,{showPasswordToggle:!0,type:"password",value:r.value.secret,onUpdateValue:i=>{r.value.secret=i}},null)]}),e(T,{class:"text-sm"},{default:()=>[e("br",null,null),d(" Callback URL 填写")," ",e(y,{onClick:()=>{navigator.clipboard.writeText(`${p.endpoint}/auth/callback/${t}`),message.success("已复制到剪贴板")},text:!0},{default:()=>[p.endpoint,d("/auth/callback/"),t]})]})]})},action(){return e("div",{class:"flex justify-between"},[e("label",{class:"flex items-center gap-2"},[d("启用"),e(K,{value:o.value,onUpdateValue:i=>{o.value=i}},null)]),e(G,null,{default:()=>[e(y,{onClick:u,type:"tertiary",round:!0},{default:()=>[d("验证")]}),e(y,{onClick:a,type:"primary",round:!0},{default:()=>[d("保存")]})]})])}})}}),At=Pe("github",{name:"GitHub"}),St=Pe("google",{name:"Google"}),Bt=g({setup(){return()=>e("div",null,[e(It,null,null),e(Pt,null,null)])}}),It=g(()=>{const t=N(D),{data:l,mutate:u}=Z("passkey-table",()=>p.api.passkey.items.get()),s=a=>{p.api.passkey.items(a).delete().then(()=>{u()})},r=g(a=>{const i=b(""),f=h=>{h.preventDefault(),h.stopPropagation(),Y.createPassKey(i.value).then(()=>{u(),a.dialog.destroy()})};return()=>e(x,{onSubmit:f},{default:()=>[e(m,{label:"名称",required:!0},{default:()=>[e(w,{value:i.value,onUpdateValue:h=>{i.value=h}},null)]}),e("div",{class:"flex justify-end"},[e(y,{disabled:i.value.length===0,type:"primary",onClick:f,round:!0,size:"small"},{default:()=>[d("创建")]})])]})}),{data:o,mutate:n}=Z("current-disable-status",async()=>{const{data:a}=await p.api.options("authSecurity").get();return a}),c=a=>{p.api.options("authSecurity").patch({data:{disablePasswordLogin:a}}).then(()=>{n()})};return r.props=["dialog"],()=>e(W,{embedded:!0,class:"!overflow-visible"},{default:()=>[e("div",{class:"flex items-center justify-between"},[e(ye,{class:"mb-0"},{default:()=>[d("通行秘钥")]}),e(G,null,{default:()=>[e(y,{type:"tertiary",onClick:()=>{Y.validate(!0)},round:!0},{default:()=>[e(M,null,{default:()=>[e(Ve,null,null)]}),e("span",{class:"ml-2"},[d("验证")])]}),e(y,{round:!0,type:"primary",onClick:()=>{const a=dialog.create({title:"创建 Passkey",content:()=>e(r,{dialog:a},null)})}},{default:()=>[e(M,null,{default:()=>[e(be,null,null)]}),e("span",{class:"ml-2"},[d("新增")])]})]})]),e(x,{class:"mt-4",labelAlign:"left",labelPlacement:"left"},{default:()=>[e(m,{label:"禁止密码登入"},{default:()=>[e(K,{value:o.value?.disablePasswordLogin,onUpdateValue:a=>{l.value?.length||message.error("至少需要一个 Passkey 才能开启这个功能"),c(a)}},null)]}),e("div",{class:"-mt-8 mb-4"},[e(P,{class:"mb-2 text-xs",depth:3},{default:()=>[e("span",null,[d("禁用密码登录需要至少开启 Oauth 或者 PassKey 登录的一项")])]})])]}),e(ge,{scrollX:Math.max(800,t.contentWidth.value-t.contentInsetWidth.value),remote:!0,bordered:!1,data:l.value,columns:[{key:"name",title:"名称"},{title:"创建时间",key:"created",render({created:a}){return e(L,{time:a},null)}},{title:"操作",key:"id",render({id:a,name:i}){return e(A,null,{default:()=>[e(q,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{s(a)}},{trigger:()=>e(y,{text:!0,type:"error"},{default:()=>[d("删除")]}),default:()=>e("span",{class:"max-w-48"},[d('确定要删除 Passkey "'),i,d('"?')])})]})}}]},null)]})}),Pt=g(()=>{const t=he(),l=J(),u=b({});return F(async()=>{const s=await p.api.options("oauth").get();u.value=Ct(s.data)}),xt()(u),F(async()=>{const s=t.query.validate;l.replace({query:{...t.query,validate:""}}),s&&await wt()&&(message.success("验证成功"),dialog.create({title:"设定为主人账户？",positiveText:"是",negativeText:"否",onPositiveClick(o){p.api.auth("as-owner").patch()}}))}),()=>e(W,{embedded:!0,class:"mt-12 !overflow-visible"},{default:()=>[e(ye,{class:"mb-0"},{default:()=>[d("OAuth")]}),e("div",{class:"mt-8 grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3"},[e(At,null,null),e(St,null,null)])]})}),se=g({props:{condition:{type:[Boolean,Function],required:!0}},setup(t,{slots:l}){const u=()=>{if(typeof t.condition=="function"?t.condition():t.condition)return l.default?.()};return()=>u()}});function $(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Ce(t)}const Ft="mt-6",Et={class:Ft,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},Fe=Symbol("JSONSchemaFormInject"),Nt=g({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:t=>t},extendConfigView:{type:Object}},setup(t,{slots:l}){const u=b(t.initialValue);z(()=>{t.onValueChange?.(u.value)},{flush:"post"});const s=B(()=>t.schema.definitions),r=B(()=>new Map(Object.entries(t.schema.definitions)));pe(Fe,{schema:t.schema,definitions:r,getKey:t.getKey});const o=B(()=>Object.keys(s.value)),n=b([o.value[0]]),c=N(D),a=E(Et);return I(()=>c.viewport.value.mobile,i=>{i?(a.labelPlacement="top",a.labelAlign="left"):(a.labelPlacement="left",a.labelAlign="right")},{immediate:!0}),()=>{let i,f;const{schema:h}=t;return e(k,null,[e(we,{accordion:!0,defaultExpandedNames:n.value,displayDirective:"if"},$(i=o.value.map(v=>{const C=s.value[v];if(!C.title)return null;switch((C?.["ui:options"]||{})?.type){case"hidden":return null}return e(_,{title:C.title,"data-schema":JSON.stringify(C)},{default:()=>[e(x,a,{default:()=>[e(Ee,{dataKey:t.getKey(v),formData:u,schema:C,property:v},null),t.extendConfigView?.[v],l[v]?.()]})]})}))?i:{default:()=>[i]}),h.ps.length?e(A,{vertical:!0},$(f=h.ps.map(v=>e(P,{class:"ml-4 mt-8 inline-block text-xs",depth:3},$(v)?v:{default:()=>[v]})))?f:{default:()=>[f]}):null])}}}),Ee=g({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0},property:{type:String}},setup(t){const{definitions:l,getKey:u}=fe(Fe,{});return()=>{const{schema:s,formData:r,dataKey:o,property:n}=t;return s?e(k,null,[Object.keys(s.properties).map(c=>{const a=s.properties[c];if(a.$ref){const i=l.value.get(a.$ref.split("/").at(-1));return e(Ee,{dataKey:`${u(o)}.${c}`,formData:r,schema:i,property:c},null)}return e(Dt,{value:R(r.value,`${u(o)}.${c}`,void 0),onUpdateValue:i=>{R(r.value,u(o))?ee(r.value,`${u(o)}.${c}`,i):ee(r.value,u(o),{...R(r.value,u(o),{}),[c]:i})},title:a.title,type:a.type,options:a?.["ui:options"],description:a.description},null)})]):null}}}),Dt=g({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(t){const l=b(t.value);z(()=>{t.onUpdateValue(l.value)});const u=()=>{const{options:o}=t;switch(t.type){case"url":case"string":{const{type:n}=o;switch(n){case"select":const{values:c}=o;return e(je,{value:l.value,onUpdateValue:a=>{l.value=a},options:c,filterable:!0},null);default:return e(w,{inputProps:{id:Le()},value:l.value,onUpdateValue:a=>{l.value=a},type:n||"text",showPasswordOn:"click",autosize:n=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}}case"array":return e(Ke,{value:l.value,onUpdateValue:n=>{l.value=n}},null);case"boolean":return e(K,{value:l.value,onUpdateValue:n=>{l.value=n}},null);case"number":case"integer":return e(qe,{value:l.value,onUpdateValue:n=>{l.value=n}},null);default:return null}},s=N(D),r=B(()=>s.viewport.value.mobile?1:2);return()=>{const{title:o,options:n,description:c}=t,a=e(k,null,[e(m,{label:o},{default:()=>[c?e(A,{class:"w-full",vertical:!0},{default:()=>[u(),e(P,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:Ue.parse(c)},null)]})]}):u()]})]);return n.halfGrid&&r.value===2?e("div",{class:"inline-block w-1/2"},[a]):a}}}),Ot="mt-6",Tt={class:Ot,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},re={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},Vt=g(()=>{const{setHeaderButtons:t}=Re();F(()=>{t(e(te,{disabled:!0,onClick:o,icon:e(ue,null,null)},null))}),$e(()=>{t(null)});const l=b();xe(async()=>{l.value=await p.api.config.jsonschema.get({transform:!1}),await n()});let u={};const s=E({}),r=b({});I(()=>s,i=>{r.value=ke(u,Me(i))},{deep:!0}),I(()=>r.value,i=>{let f=!1;H(i)?f=!1:f=!0,t(e(te,{disabled:!f,icon:e(ue,null,null),onClick:o},null))});async function o(){if(H(r.value))return;const i=Object.entries(r.value);for await(const[f,h]of i){const v=Object.fromEntries(Object.entries(h).map(([C,j])=>Array.isArray(j)?[C,s[f][C]]:[C,j]));await p.api.options(f).patch({data:v})}await n(),message.success("修改成功")}const n=async()=>{let i=await p.api.options.get();i=yt(l.value.default,i),u=U(i),Object.assign(s,i)},c=N(D),a=E(Tt);return I(()=>c.viewport.value.mobile,i=>{i?(a.labelPlacement="top",a.labelAlign="left"):(a.labelPlacement="left",a.labelAlign="right")},{immediate:!0}),()=>e(k,null,[e("div",{class:"pt-4"},null),l.value&&e(Nt,{initialValue:s,getKey:i=>i.split(".").map(f=>ht(f)).join(".").replace("Dto",""),schema:l.value},{AdminExtraDto(){return e(k,null,[e(m,{label:"主题色"},{default:()=>[e(Ut,null,null)]})])}})])}),Ut=g({setup(){const t=_e(),l=document.createElement("style");return l.innerHTML="* { transition: none !important; }",()=>e("div",{class:"flex items-center gap-2"},[e(He,{class:"w-36",value:t.value.primaryColor,onUpdateValue:u=>{document.head.appendChild(l),Object.assign(ae.value,ze(u)),setTimeout(()=>{document.head.removeChild(l)})}},null),e(y,{size:"small",ghost:!0,onClick:()=>{Object.assign(ae.value,Ge)}},{default:()=>[e("span",null,[d("重置")])]})])}});function ie(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Ce(t)}const qt=g(()=>{const t=b([]),l=async()=>{const r=await p.api.user.session.get({});t.value=[...r.data]};F(()=>{l()});const u=async(r,o)=>{r?(await p.api.user.logout.post({}),Se(),await ve.signOut(),window.location.reload()):(await p.api.user.session(o).delete({}),t.value=t.value.filter(n=>n.id!==o))},s=async()=>{await p.api.user.session.all.delete({}),await l()};return()=>{let r;return e(k,null,[e(We,{class:"flex items-center justify-between"},{default:()=>[e("span",{class:"ml-4"},[d("登录设备")]),e(q,{onPositiveClick:s},{trigger(){return e(y,{size:"small",quaternary:!0,type:"error",disabled:t.value.length==1&&t.value[0].current},{default:()=>[d("踢掉全部")]})},default(){return"确定踢掉全部登录设备（除当前会话）？"}})]}),e(st,{bordered:!0},ie(r=t.value.map(({id:o,ua:n,ip:c,date:a,current:i})=>e(rt,{key:o},{prefix(){return e("div",{class:"w-20 text-center"},[i?"当前":null])},suffix(){return e(G,null,{default:()=>[e(q,{onPositiveClick:()=>u(!!i,o)},{trigger(){return e(y,{tertiary:!0,type:"error"},{default:()=>[i?"注销":"踢"]})},default(){return i?"登出？":"确定要踢出吗？"}})]})},default(){return e(A,{vertical:!0},{default:()=>[e(se,{condition:!!n},{default:()=>[e(T,null,{default:()=>[d("User Agent: "),n]})]}),e(se,{condition:!!c},{default:()=>[e(T,null,{default:()=>[d("IP:")," ",e(Ae,{ip:c,triggerEl:e(y,{quaternary:!0,size:"tiny",type:"primary"},ie(c)?c:{default:()=>[c]})},null)]})]}),e(T,null,{default:()=>[i?"活跃时间":"登录时间",d(":")," ",e(L,{time:a},null)]})]})}})))?r:{default:()=>[r]}),e("div",{class:"pt-4"},null),e(we,{defaultExpandedNames:[""],displayDirective:"show"},{default:()=>[e(_,{name:"reset",title:"修改密码"},{default:()=>[e(Lt,null,null)]}),e(_,{name:"token",title:"API Token"},{default:()=>[e(Kt,null,null)]})]})])}}),Kt=g(()=>{const t=b([]),l=()=>({name:"",expired:!1,expiredTime:new Date}),u=E(l()),s=async()=>{const{data:a}=await p.api.auth.token.get();t.value=a};xe(()=>{s()});const r=b(!1),o=async()=>{const a={name:u.name,expired:u.expired?u.expiredTime.toISOString():void 0},i=await p.api.auth.token.post({data:a});await navigator.clipboard.writeText(i.token),r.value=!1;const f=l();for(const v in f)u[v]=f[v];message.success(`生成成功，Token 已复制，${i.token}`),await s();const h=t.value.findIndex(v=>v.name===a.name);h!==-1&&(t.value[h].token=i.token)},n=async a=>{await p.api.auth.token.delete({params:{id:a}}),message.success("删除成功");const i=t.value.findIndex(f=>f.id===a);i!=-1&&t.value.splice(i,1)},c=N(D);return()=>e(W,{class:"!overflow-visible"},{default:()=>[e(Qe,{transformOrigin:"center",show:r.value,onUpdateShow:a=>void(r.value=a)},{default:()=>[e(me,{bordered:!1,title:"创建 Token",class:"w-[500px] max-w-full"},{default:()=>[e(x,null,{default:()=>[e(m,{label:"名称",required:!0},{default:()=>[e(w,{value:u.name,onInput:a=>void(u.name=a)},null)]}),e(m,{label:"是否过期"},{default:()=>[e(K,{value:u.expired,onUpdateValue:a=>void(u.expired=a)},null)]}),e(m,{label:"过期时间"},{default:()=>[e(Xe,{disabled:!u.expired,value:u.expiredTime,type:"datetime",onUpdateValue:a=>void(u.expiredTime=new Date(a))},null)]})]}),e(A,null,{default:()=>[e(y,{round:!0,onClick:()=>void(r.value=!1)},{default:()=>[d("取消")]}),e(y,{round:!0,type:"primary",onClick:o},{default:()=>[d("确定")]})]})]})]}),e(y,{class:"absolute right-0 top-[-3rem]",round:!0,type:"primary",onClick:()=>{r.value=!0}},{default:()=>[e(M,null,{default:()=>[e(be,null,null)]}),e("span",{class:"ml-2"},[d("新增")])]}),e(ge,{scrollX:Math.max(800,c.contentWidth.value-c.contentInsetWidth.value),remote:!0,bordered:!1,data:t.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render({token:a}){return"*".repeat(40)}},{title:"创建时间",key:"created",render({created:a}){return e(L,{time:a},null)}},{title:"过期时间",key:"expired",render({expired:a}){return Ze(a,"yyyy 年 M 月 d 日 HH:mm:ss")}},{title:"操作",key:"id",render({id:a,name:i}){return e(A,null,{default:()=>[e(q,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{n(a)}},{trigger:()=>e(y,{text:!0,type:"error"},{default:()=>[d("删除")]}),default:()=>e("span",{class:"max-w-48"},[d('确定要删除 Token "'),i,d('"?')])})]})}}]},null)]})}),Lt=g(()=>{const t=E({password:"",reenteredPassword:""}),l=b(),u=J(),s=async()=>{l.value&&l.value.validate(async o=>{o?console.log(o):(await p.api.master.patch({data:{password:t.password}}),message.success("更改成功"),Se(),u.push({name:Je.Login}))})};function r(o,n){return console.log(o),n===t.password}return()=>e(x,{class:"max-w-[300px]",ref:l,model:t,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:r,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},{default:()=>[e(m,{label:"新密码",required:!0,path:"password"},{default:()=>[e(w,le(re,{value:t.password,onInput:o=>void(t.password=o),type:"password"}),null)]}),e(m,{label:"重复密码",required:!0,path:"reenteredPassword"},{default:()=>[e(w,le(re,{value:t.reenteredPassword,onInput:o=>void(t.reenteredPassword=o),type:"password"}),null)]}),e("div",{class:"quaternary-right w-full"},[e(y,{onClick:s,type:"primary",round:!0},{default:()=>[d("保存")]})])]})}),oe={GitHub:"github",Weibo:"weibo",网易云:"netease",哔哩哔哩:"bilibili"},jt="_avatar_1o1mi_3",ce={"tab-user":"_tab-user_1o1mi_1",avatar:jt},Rt=g(()=>{const t=b({});let l;async function u(){const n=await p.api.master.get();t.value=n,l={...n}}F(async()=>{await u()});const s=Ye(),r=B(()=>ke(l,t.value)),o=async()=>{const n=U(at(r));n.socialIds&&(n.socialIds=t.value.socialIds),await p.api.master.patch({data:n}),s.success("保存成功~"),await u()};return()=>e(k,null,[e(et,{cols:"1 400:1 600:2",class:ce["tab-user"],xGap:20,yGap:20},{default:()=>[e(ne,null,{default:()=>[e(x,{class:"flex flex-col items-center justify-center"},{default:()=>[e(m,null,{default:()=>[e("div",{class:ce.avatar},[e(ot,{type:"avatar",onFinish:n=>{const{file:c,event:a}=n;try{const i=JSON.parse((a?.target).responseText);t.value.avatar=i.url}catch{}return c}},{default:()=>[e(ct,{class:"border-0 bg-transparent hover:border-0"},{default:()=>[e(tt,{class:"flex",src:t.value.avatar,size:200},null)]})]})])]}),e(m,{label:"上次登录时间",class:"!mt-4"},{default:()=>[e("div",{class:"w-full text-center"},[e(P,null,{default:()=>[t.value.lastLoginTime?e(L,{time:t.value.lastLoginTime},null):"N/A"]})])]}),e(m,{label:"上次登录地址"},{default:()=>[e("div",{class:"w-full text-center"},[t.value.lastLoginIp?e(Ae,{trigger:"hover",ip:t.value.lastLoginIp,triggerEl:e(P,{class:"cursor-pointer"},{default:()=>[t.value.lastLoginIp]})},null):"N/A"])]}),e(m,null,{default:()=>[e(y,{round:!0,class:"-mt-14",type:"primary",onClick:o,disabled:H(r.value)},{default:()=>[d("保存")]})]})]})]}),e(ne,null,{default:()=>[e(x,null,{default:()=>[e(m,{label:"主人名 (username)"},{default:()=>[e(w,{value:t.value.username,onInput:n=>{t.value.username=n?.trim()||""}},null)]}),e(m,{label:"主人昵称 (name)"},{default:()=>[e(w,{value:t.value.name,onInput:n=>{t.value.name=n?.trim()||""}},null)]}),e(m,{label:"主人邮箱 (mail)"},{default:()=>[e(w,{value:t.value.mail,onInput:n=>{t.value.mail=n}},null)]}),e(m,{label:"个人首页"},{default:()=>[e(w,{value:t.value.url,onInput:n=>{t.value.url=n}},null)]}),e(m,{label:"头像"},{default:()=>[e(w,{value:t.value.avatar,onInput:n=>{t.value.avatar=n}},null)]}),e(m,{label:"个人介绍"},{default:()=>[e(w,{type:"textarea",resizable:!1,value:t.value.introduce,onInput:n=>{t.value.introduce=n}},null)]}),e(m,{label:"社交平台 ID 录入"},{default:()=>[e(it,{key:t.value.id,options:Object.keys(oe).map(n=>({label:n,value:oe[n]})),onChange:n=>{t.value.socialIds=n},value:t.value.socialIds||{}},null)]})]})]})]})])});var S=function(t){return t.User="user",t.System="system",t.Security="security",t.Auth="auth",t}(S||{});const Jt=g({setup(){const t=he(),l=J(),u=b(t.params.type);I(()=>t.params.type,r=>{r&&(u.value=r)});const s=b(null);return()=>e(lt,{actionsElement:s.value},{default:()=>[e(nt,{value:u.value,onUpdateValue:r=>{l.replace({...t,params:{...t.params,type:r}})}},{default:()=>[e(O,{tab:"用户",name:S.User},{default:()=>[e(Rt,null,null)]}),e(O,{tab:"系统",name:S.System},{default:()=>[e(Vt,null,null)]}),e(O,{tab:"安全",name:S.Security},{default:()=>[e(qt,null,null)]}),e(O,{tab:"登入方式",name:S.Auth},{default:()=>[e(Bt,null,null)]})]})]})}});export{Jt as default};
