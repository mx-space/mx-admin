import{d as C,a as I,av as P,aw as E,ax as u,at as F,r as k,a3 as D,o as B,R as r,a4 as N,c as e,F as y,a9 as f,H as i,ay as h,az as T,C as A,y as H,aa as v,aA as L,ab as M,Z as q,p as z,V as c,s as d}from"./index-D5BxuJyQ.js";const $=C({setup(){const g=q(),m=H(),x=()=>({text:"",author:"",source:""}),n=I({});P(()=>{E([u.原创,u.哲学,u.文学,u.诗词]).then(a=>{n.value={source:a.from,text:a.hitokoto,author:a.from_who||a.creator}})});const w=F(),b=async()=>{const a=async()=>{await r.api.says.post({data:n.value}),message.success("发布成功"),m.push({name:v.ListSay})};t.text||t.author||t.source?w.create({title:"警告",content:"发布一言会覆盖现有的内容，要继续吗",type:"warning",negativeText:"取消",positiveText:"确定",onPositiveClick(){a()}}):a()},S=a=>N(t)(a),t=k(x()),l=D(()=>g.query.id);B(async()=>{const a=l.value;if(a&&typeof a=="string"){const s=(await r.api.says(a).get({})).data;S(s)}});const p=async()=>{const a=()=>{try{if(!t.text||t.text.trim().length==0)throw"内容为空";return{...L(M(t),(o,s,R)=>(o[R]=typeof s>"u"?null:typeof s=="string"&&s.length==0?"":s,o)),text:t.text.trim()}}catch(o){throw message.error(o),o}};if(l.value){if(!f(l.value))return;const o=l.value;await r.api.says(o).put({data:a()}),message.success("修改成功")}else await r.api.says.post({data:a()}),message.success("发布成功");m.push({name:v.ListSay})};return()=>e(A,{actionsElement:e(y,null,[f(l)?e(i,{name:"更新",variant:"info",onClick:p,icon:e(h,null,null)},null):e(y,null,[e(i,{name:"发布一言",variant:"info",onClick:b,icon:e(T,null,null)},null),e(i,{name:"发布自己说的",variant:"primary",onClick:p,icon:e(h,null,null)},null)])])},{default:()=>[e(z,null,{default:()=>[e(c,{label:"内容",required:!0,labelPlacement:"left",labelStyle:{width:"4rem"}},{default:()=>[e(d,{type:"textarea",autofocus:!0,autosize:{minRows:6,maxRows:8},placeholder:n.value.text,value:t.text,onInput:a=>void(t.text=a)},null)]}),e(c,{label:"作者",labelPlacement:"left",labelStyle:{width:"4rem"}},{default:()=>[e(d,{placeholder:n.value.author,value:t.author,onInput:a=>void(t.author=a)},null)]}),e(c,{label:"来源",labelPlacement:"left",labelStyle:{width:"4rem"}},{default:()=>[e(d,{placeholder:n.value.source,value:t.source,onInput:a=>void(t.source=a)},null)]})]})]})}});export{$ as default};
