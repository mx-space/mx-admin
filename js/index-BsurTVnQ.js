import{d as y,f as m,A as v,u as k,g as h,a1 as p,i as e,F as B,I,W as w,J as H,j as l,K as F,n as E,B as f,r as D,a as C,a2 as i,h as z,w as j,R as A,m as U,T as V,G as q,a3 as o,a4 as K,a5 as L,a6 as M,a7 as O,V as Q,a8 as G,H as J,P as W,Y}from"./index-qXdkAhVq.js";import{R as X}from"./rotate-ccw-CwnNdy_C.js";import{H as Z}from"./history-CmY-YCC1.js";const _=y({name:"HistoryPanel",props:{draftId:{type:String,required:!0},show:{type:Boolean,default:!1},onUpdateShow:{type:Function,required:!0}},setup(t){const s=m(),r=v(),{data:u,isLoading:c}=k({queryKey:["drafts","history",t.draftId],queryFn:()=>p.getHistory(t.draftId),enabled:()=>t.show,select:a=>Array.isArray(a)?a:Array.isArray(a?.data)?a.data:[]}),d=h({mutationFn:a=>p.restoreVersion(t.draftId,a),onSuccess:()=>{s.success("版本已恢复"),r.invalidateQueries({queryKey:["drafts"]}),t.onUpdateShow(!1)},onError:()=>{s.error("恢复失败")}}),g=a=>{d.mutate(a)};return()=>e(B,{show:t.show,onUpdateShow:t.onUpdateShow,width:360,placement:"right"},{default:()=>[e(I,{title:"版本历史",closable:!0},{default:()=>[c.value?e("div",{class:"flex items-center justify-center py-8"},[e(w,null,null)]):!u.value||u.value.length===0?e(H,{description:"暂无历史版本"},null):e("div",{class:"space-y-3"},[u.value.map((a,x)=>e("div",{key:a.version,class:["rounded-lg border p-3",x===0?"border-neutral-300 bg-neutral-50 dark:border-neutral-600 dark:bg-neutral-800":"border-neutral-200 dark:border-neutral-700"]},[e("div",{class:"flex items-start justify-between gap-2"},[e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"text-sm font-medium text-neutral-900 dark:text-neutral-100"},[l("版本 "),a.version]),x===0&&e("span",{class:"rounded bg-blue-100 px-1.5 py-0.5 text-xs text-blue-600 dark:bg-blue-900/50 dark:text-blue-400"},[l("当前")])]),e("p",{class:"mt-1 truncate text-xs text-neutral-500 dark:text-neutral-400"},[a.title||"无标题"]),e("p",{class:"mt-0.5 text-xs text-neutral-400 dark:text-neutral-500"},[e(F,{time:a.savedAt},null)])]),x!==0&&e(E,{positiveText:"取消",negativeText:"恢复",onNegativeClick:()=>g(a.version)},{trigger:()=>e(f,{size:"tiny",quaternary:!0,loading:d.isPending.value},{icon:()=>e(X,{class:"h-3.5 w-3.5"},null),default:()=>"恢复"}),default:()=>e("span",null,[l("确定要恢复到版本 "),a.version,l("？")])})])]))])]})]})}}),$={[i.Post]:{label:"文章",icon:O,editRoute:o.EditPost,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-950/50"},[i.Note]:{label:"手记",icon:M,editRoute:o.EditNote,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-950/50"},[i.Page]:{label:"页面",icon:L,editRoute:o.EditPage,color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-50 dark:bg-purple-950/50"}},ee=y({name:"DraftItem",props:{draft:{type:Object,required:!0},onDelete:{type:Function,required:!0}},setup(t){const s=q(),r=D(!1),u=C(()=>$[t.draft.refType]),c=()=>{s.push({name:u.value.editRoute,query:{draftId:t.draft.id}})};return()=>e("div",{class:"flex items-center gap-3 border-b border-neutral-200 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-900/50"},[e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[e(A,{to:{name:u.value.editRoute,query:{draftId:t.draft.id}},class:"truncate text-sm font-medium text-neutral-900 hover:text-blue-600 dark:text-neutral-100 dark:hover:text-blue-400"},{default:()=>[t.draft.title||"无标题"]})]),e("div",{class:"mt-1 flex flex-wrap items-center gap-x-2 gap-y-0.5 text-xs"},[e("span",{class:["rounded px-1.5 py-0.5 text-xs",u.value.bgColor,u.value.color]},[u.value.label]),t.draft.refId?e("span",{class:"rounded bg-amber-50 px-1.5 py-0.5 text-xs text-amber-600 dark:bg-amber-950/50 dark:text-amber-400"},[l("编辑中")]):e("span",{class:"rounded bg-neutral-100 px-1.5 py-0.5 text-xs text-neutral-500 dark:bg-neutral-800 dark:text-neutral-400"},[l("新建")]),e("span",{class:"text-neutral-300 dark:text-neutral-600"},[l("·")]),e("span",{class:"text-neutral-400 dark:text-neutral-500"},[l("v"),t.draft.version]),e("span",{class:"text-neutral-300 dark:text-neutral-600"},[l("·")]),e(F,{time:t.draft.updated,class:"text-neutral-400 dark:text-neutral-500"},null)])]),e("div",{class:"flex shrink-0 items-center gap-1"},[e(f,{quaternary:!0,size:"tiny",onClick:c},{icon:()=>e(U,{class:"h-3.5 w-3.5 text-neutral-500"},null)}),e(f,{quaternary:!0,size:"tiny",onClick:()=>r.value=!0},{icon:()=>e(Z,{class:"h-3.5 w-3.5 text-neutral-500"},null)}),e(E,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>t.onDelete(t.draft.id)},{trigger:()=>e(f,{quaternary:!0,size:"tiny"},{icon:()=>e(V,{class:"h-3.5 w-3.5 text-red-500"},null)}),default:()=>e("span",{class:"max-w-48"},[l("确定要删除「"),t.draft.title||"无标题",l("」？")])})]),e(_,{draftId:t.draft.id,show:r.value,onUpdateShow:d=>r.value=d},null)])}}),te=y({name:"EmptyState",setup(){const t=[{label:"新建文章",key:"post",route:o.EditPost},{label:"新建手记",key:"note",route:o.EditNote},{label:"新建页面",key:"page",route:o.EditPage}];return()=>e("div",{class:"flex flex-col items-center justify-center py-16"},[e(K,{class:"h-12 w-12 text-neutral-300 dark:text-neutral-600"},null),e("p",{class:"mt-4 text-sm text-neutral-500 dark:text-neutral-400"},[l("暂无草稿")]),e("p",{class:"mt-1 text-xs text-neutral-400 dark:text-neutral-500"},[l("草稿会在编辑时自动保存到这里")]),e("div",{class:"mt-6 flex gap-2"},[t.map(s=>e(A,{key:s.key,to:{name:s.route}},{default:()=>[e(f,{size:"small",tertiary:!0},{default:()=>[s.label]})]}))])])}}),ue=y({name:"DraftsView",setup(){const t=m(),s=v(),r=D("all"),{data:u,isLoading:c}=k({queryKey:["drafts","list",r],queryFn:()=>p.getList({page:1,size:50,refType:r.value==="all"?void 0:r.value})}),d=h({mutationFn:p.delete,onSuccess:()=>{t.success("删除成功"),s.invalidateQueries({queryKey:["drafts"]})},onError:()=>{t.error("删除失败")}}),g=n=>{d.mutate(n)},a=C(()=>u.value?.data||[]),x=[{label:"全部",value:"all"},{label:"文章",value:i.Post},{label:"手记",value:i.Note},{label:"页面",value:i.Page}],N=[{label:"新建文章",key:"post"},{label:"新建手记",key:"note"},{label:"新建页面",key:"page"}],P=q(),S=n=>{const b={post:o.EditPost,note:o.EditNote,page:o.EditPage};P.push({name:b[n]})},{setActions:R,setHeaderSubtitle:T}=z();return j(()=>{const n=a.value.length;T(n>0?e("span",{class:"text-sm text-neutral-500"},[n,l(" 个草稿")]):null),R(e(Y,null,[e(Q,{value:r.value,onUpdateValue:b=>r.value=b,options:x,size:"small",style:{width:"100px"}},null),e(G,{options:N,onSelect:S,trigger:"click"},{default:()=>[e(J,{icon:e(W,null,null),name:"新建"},null)]})]))}),()=>c.value?e("div",{class:"flex items-center justify-center py-16"},[e(w,null,null)]):a.value.length===0?e(te,null,null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[a.value.map(n=>e(ee,{key:n.id,draft:n,onDelete:g},null))])}});export{ue as default};
