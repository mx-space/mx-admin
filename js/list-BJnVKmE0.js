import{d,Y as k,Z as x,R as i,b as D,at as F,w as R,o as T,c as a,C,F as B,au as N,H as S,A as b,r as q,a1 as A,m as y,B as p,g as u,j as L,i as M,ao as K}from"./index-D5BxuJyQ.js";const $=d({name:"SayList",setup(P,V){const{checkedRowKeys:n,data:g,pager:l,loading:f,fetchDataFn:m}=k((t,e)=>async(v=r.query.page||1,w=30)=>{const c=await i.api.says.get({params:{page:v,size:w,select:"title text _id id created modified author source"}});t.value=c.data,e.value=c.pagination}),o=D();F();const r=x(),s=m;R(()=>r.query.page,async t=>{await s(t)}),T(async()=>{await s()});const h=d({setup(){const t=q([{type:"selection",options:["none","all"]},{title:"创建于",key:"created",width:100,render(e){return a(y,{to:`/says/edit?id=${e.id}`},{default:()=>[a(A,{time:e.created},null)]})}},{title:"内容",key:"text"},{title:"作者",key:"author"},{title:"来源",key:"source"},{title:"操作",fixed:"right",key:"id",width:130,render(e){return a(M,{wrap:!1},{default:()=>[a(y,{to:`/says/edit?id=${e.id}`},{default:()=>[a(p,{quaternary:!0,type:"primary",size:"tiny"},{default:()=>[u("编辑")]})]}),a(L,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await i.api.says(e.id).delete(),o.success("删除成功"),await s(l.value.currentPage)}},{trigger:()=>a(p,{quaternary:!0,type:"error",size:"tiny"},{default:()=>[u("移除")]}),default:()=>a("span",{class:"max-w-48"},[u("确定要删除“"),e.text,u("” ?")])})]})}}]);return()=>a(K,{loading:f.value,columns:t,data:g,onFetchData:s,pager:l,onUpdateCheckedRowKeys:e=>{n.value=e}},null)}});return()=>a(C,null,{actions:()=>a(B,null,[a(N,{checkedRowKeys:n.value,onDelete:async()=>{const t=await Promise.allSettled(n.value.map(e=>i.api.says(e).delete()));for(const e of t)e.status==="rejected"&&o.success(`删除失败，${e.reason.message}`);n.value.length=0,s()}},null),a(S,{to:"/says/edit",icon:a(b,null,null)},null)]),default:()=>a(h,null,null)})}});export{$ as default};
