import{bs as we,bt as Le,bu as je,bv as se,bw as _,bx as re,by as $e,bz as _e,R as g,aP as Ae,aM as Ce,d as x,a as w,bA as ae,c as e,g as v,bB as M,K as le,B as C,p as I,V as m,s as F,br as j,n as S,bC as xe,u as q,bD as K,aj as oe,bE as Fe,bF as ie,I as Q,b8 as ze,A as ke,a0 as k,h as Be,a1 as G,i as B,j as z,bG as ue,Z as Ee,y as ne,o as U,a3 as E,r as V,w as T,bH as Ie,bI as X,F as P,v as De,bJ as H,bK as de,bL as Ge,ai as He,b4 as We,bM as Je,Q as R,H as Z,au as Qe,bg as Xe,$ as Ze,av as Oe,bN as Pe,ab as Ye,bO as et,bP as tt,bQ as ce,bR as at,bS as lt,f as ut,bm as Se,bT as Te,b2 as pe,aa as nt,N as fe,bq as st,b1 as ve,b as rt,bU as ot,bV as me,bW as it,U as dt,C as ct,am as pt,an as L}from"./index-D5BxuJyQ.js";import{C as Y}from"./CheckCircleOutlined-NqIEF2AG.js";import{a as ft,i as ee}from"./isEmpty-BSk68hqG.js";import{N as vt,a as mt}from"./ListItem-CovWBJPR.js";import{K as yt}from"./index-hrWu-5rm.js";import{U as bt}from"./index-DLQ7RJNG.js";import{N as gt}from"./Upload-8WBwDIV0.js";function ht(t){if(we(t))return t;if(Array.isArray(t)||Le(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const a=Object.getPrototypeOf(t),l=a.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new l(t);if(t instanceof RegExp){const d=new l(t);return d.lastIndex=t.lastIndex,d}if(t instanceof DataView)return new l(t.buffer.slice(0));if(t instanceof Error){const d=new l(t.message);return d.stack=t.stack,d.name=t.name,d.cause=t.cause,d}if(typeof File<"u"&&t instanceof File)return new l([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const d=Object.create(a);return Object.assign(d,t)}return t}function wt(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}const At=/\p{Lu}?\p{Ll}+|[0-9]+|\p{Lu}+(?!\p{Ll})|\p{Emoji_Presentation}|\p{Extended_Pictographic}|\p{L}+/gu;function Ct(t){return Array.from(t.match(At)??[])}function xt(t,...a){const l=a.slice(0,-1),d=a[a.length-1];let n=t;for(let p=0;p<l.length;p++){const u=l[p];n=$(n,u,d,new Map)}return n}function $(t,a,l,d){if(we(t)&&(t=Object(t)),a==null||typeof a!="object")return t;if(d.has(a))return ht(d.get(a));if(d.set(a,t),Array.isArray(a)){a=a.slice();for(let p=0;p<a.length;p++)a[p]=a[p]??void 0}const n=[...Object.keys(a),...je(a)];for(let p=0;p<n.length;p++){const u=n[p];let s=a[u],r=t[u];if(se(s)&&(s={...s}),se(r)&&(r={...r}),typeof Buffer<"u"&&Buffer.isBuffer(s)&&(s=_(s)),Array.isArray(s))if(typeof r=="object"&&r!=null){const y=[],A=Reflect.ownKeys(r);for(let o=0;o<A.length;o++){const i=A[o];y[i]=r[i]}r=y}else r=[];const c=l(r,s,u,t,a,d);c!=null?t[u]=c:Array.isArray(s)||re(r)&&re(s)?t[u]=$(r,s,l,d):r==null&&$e(s)?t[u]=$({},s,l,d):r==null&&ft(s)?t[u]=_(s):(r===void 0||s!==void 0)&&(t[u]=s)}return t}function Ft(t,...a){return xt(t,...a,_e)}function kt(t){const a=Ct(t);if(a.length===0)return"";const[l,...d]=a;return`${l.toLowerCase()}${d.map(n=>wt(n)).join("")}`}function Me(t){if(t==null)return"";if(Array.isArray(t))return t.map(Me).join(",");const a=String(t);return a==="0"&&Object.is(Number(t),-0)?"-0":a}function Bt(t){return typeof t!="string"&&(t=Me(t)),t.replace(/['\u2019]/g,"")}function Et(t){return kt(Bt(t))}const It=async()=>g.api.auth.session.get();function Dt(t){const a={};for(const l of t.providers){const d=l.type;d in t.public?a[d]={...t.public[d],enabled:l.enabled,type:d}:console.warn(`Provider type ${d} found in providers but not in public data.`)}return a}const Ue=Symbol.for("OauthDataInjectKey"),Ot=()=>t=>Ce(Ue,t),Pt=()=>Ae(Ue),Ne=(t,a)=>x({setup(){const l=async()=>{await xe.signIn.social({provider:t,callbackURL:`${location.href}?validate=true`})},d=Pt(),n=w({clientId:"",secret:""}),p=w(!1);ae(()=>{if(d.value[t]===void 0)return;const{clientId:c,enabled:y}=d.value[t];p.value=y,n.value.clientId=c});const u=w(null),s={clientId:[{required:!0,message:"Client Id ä¸èƒ½ä¸ºç©º"}],secret:[{required:!0,message:"Client Secret ä¸èƒ½ä¸ºç©º"}]},r=async()=>{await u.value?.validate(),g.api.options("oauth").patch({data:{providers:[{type:t,enabled:p.value}],secrets:{[t]:{clientSecret:n.value.secret}},public:{[t]:{clientId:n.value.clientId}}}})};return()=>e(S,{title:a.name},{default(){return e(I,{model:n.value,ref:u,rules:s},{default:()=>[e(m,{label:"Client Id",path:"clientId",required:!0},{default:()=>[e(F,{value:n.value.clientId,onUpdateValue:c=>{n.value.clientId=c}},null)]}),e(m,{label:"Client Secret",required:!0,path:"secret"},{default:()=>[e(F,{showPasswordToggle:!0,type:"password",value:n.value.secret,onUpdateValue:c=>{n.value.secret=c}},null)]}),e(j,{class:"text-sm"},{default:()=>[e("br",null,null),v(" Callback URL å¡«å†™")," ",e(C,{onClick:()=>{navigator.clipboard.writeText(`${g.endpoint}/auth/callback/${t}`),message.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")},text:!0},{default:()=>[g.endpoint,v("/auth/callback/"),t]})]})]})},action(){return e("div",{class:"flex justify-between"},[e("label",{class:"flex items-center gap-2"},[v("å¯ç”¨"),e(M,{value:p.value,onUpdateValue:c=>{p.value=c}},null)]),e(le,null,{default:()=>[e(C,{onClick:l,type:"tertiary",round:!0},{default:()=>[v("éªŒè¯")]}),e(C,{onClick:r,type:"primary",round:!0},{default:()=>[v("ä¿å­˜")]})]})])}})}}),St=Ne("github",{name:"GitHub"}),Tt=Ne("google",{name:"Google"}),Mt=x({setup(){return()=>e("div",null,[e(Ut,null,null),e(Nt,null,null)])}}),Ut=x(()=>{const t=q(K),{data:a,mutate:l}=oe("passkey-table",()=>g.api.passkey.items.get()),d=r=>{g.api.passkey.items(r).delete().then(()=>{l()})},n=x(r=>{const c=w(""),y=A=>{A.preventDefault(),A.stopPropagation(),ie.createPassKey(c.value).then(()=>{l(),r.dialog.destroy()})};return()=>e(I,{onSubmit:y},{default:()=>[e(m,{label:"åç§°",required:!0},{default:()=>[e(F,{value:c.value,onUpdateValue:A=>{c.value=A}},null)]}),e("div",{class:"flex justify-end"},[e(C,{disabled:c.value.length===0,type:"primary",onClick:y,round:!0,size:"small"},{default:()=>[v("åˆ›å»º")]})])]})}),{data:p,mutate:u}=oe("current-disable-status",async()=>{const{data:r}=await g.api.options("authSecurity").get();return r}),s=r=>{g.api.options("authSecurity").patch({data:{disablePasswordLogin:r}}).then(()=>{u()})};return n.props=["dialog"],()=>e(ue,{embedded:!0,class:"!overflow-visible"},{default:()=>[e("div",{class:"flex items-center justify-between"},[e(Fe,{class:"mb-0"},{default:()=>[v("é€šè¡Œç§˜é’¥")]}),e(le,null,{default:()=>[e(C,{type:"tertiary",onClick:()=>{ie.validate(!0)},round:!0},{default:()=>[e(Q,null,{default:()=>[e(ze,null,null)]}),e("span",{class:"ml-2"},[v("éªŒè¯")])]}),e(C,{round:!0,type:"primary",onClick:()=>{const r=dialog.create({title:"åˆ›å»º Passkey",content:()=>e(n,{dialog:r},null)})}},{default:()=>[e(Q,null,{default:()=>[e(ke,null,null)]}),e("span",{class:"ml-2"},[v("æ–°å¢ž")])]})]})]),e(I,{class:"mt-4",labelAlign:"left",labelPlacement:"left"},{default:()=>[e(m,{label:"ç¦æ­¢å¯†ç ç™»å…¥"},{default:()=>[e(M,{value:p.value?.disablePasswordLogin,onUpdateValue:r=>{a.value?.length||message.error("è‡³å°‘éœ€è¦ä¸€ä¸ª Passkey æ‰èƒ½å¼€å¯è¿™ä¸ªåŠŸèƒ½"),s(r)}},null)]}),e("div",{class:"-mt-8 mb-4"},[e(k,{class:"mb-2 text-xs",depth:3},{default:()=>[e("span",null,[v("ç¦ç”¨å¯†ç ç™»å½•éœ€è¦è‡³å°‘å¼€å¯ Oauth æˆ–è€… PassKey ç™»å½•çš„ä¸€é¡¹")])]})])]}),e(Be,{scrollX:Math.max(800,t.contentWidth.value-t.contentInsetWidth.value),remote:!0,bordered:!1,data:a.value,columns:[{key:"name",title:"åç§°"},{title:"åˆ›å»ºæ—¶é—´",key:"created",render({created:r}){return e(G,{time:r},null)}},{title:"æ“ä½œ",key:"id",render({id:r,name:c}){return e(B,null,{default:()=>[e(z,{positiveText:"å–æ¶ˆ",negativeText:"åˆ é™¤",onNegativeClick:()=>{d(r)}},{trigger:()=>e(C,{text:!0,type:"error"},{default:()=>[v("åˆ é™¤")]}),default:()=>e("span",{class:"max-w-48"},[v('ç¡®å®šè¦åˆ é™¤ Passkey "'),c,v('"?')])})]})}}]},null)]})}),Nt=x(()=>{const t=Ee(),a=ne(),l=w({});return U(async()=>{const d=await g.api.options("oauth").get();l.value=Dt(d.data)}),Ot()(l),U(async()=>{const d=t.query.validate;a.replace({query:{...t.query,validate:""}}),d&&await It()&&(message.success("éªŒè¯æˆåŠŸ"),dialog.create({title:"è®¾å®šä¸ºä¸»äººè´¦æˆ·ï¼Ÿ",positiveText:"æ˜¯",negativeText:"å¦",onPositiveClick(p){g.api.auth("as-owner").patch()}}))}),()=>e(ue,{embedded:!0,class:"mt-12 !overflow-visible"},{default:()=>[e(Fe,{class:"mb-0"},{default:()=>[v("OAuth")]}),e("div",{class:"mt-8 grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3"},[e(St,null,null),e(Tt,null,null)])]})}),ye=x({props:{condition:{type:[Boolean,Function],required:!0}},setup(t,{slots:a}){const l=()=>{if(typeof t.condition=="function"?t.condition():t.condition)return a.default?.()};return()=>l()}});function W(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!De(t)}const Vt="mt-6",Rt={class:Vt,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},Ve=Symbol("JSONSchemaFormInject"),qt=x({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:t=>t},extendConfigView:{type:Object}},setup(t,{slots:a}){const l=w(t.initialValue);ae(()=>{t.onValueChange?.(l.value)},{flush:"post"});const d=E(()=>t.schema.definitions),n=E(()=>new Map(Object.entries(t.schema.definitions)));Ce(Ve,{schema:t.schema,definitions:n,getKey:t.getKey});const p=E(()=>Object.keys(d.value)),u=w([p.value[0]]),s=q(K),r=V(Rt);return T(()=>s.viewport.value.mobile,c=>{c?(r.labelPlacement="top",r.labelAlign="left"):(r.labelPlacement="left",r.labelAlign="right")},{immediate:!0}),()=>{let c,y;const{schema:A}=t;return e(P,null,[e(Ie,{accordion:!0,defaultExpandedNames:u.value,displayDirective:"if"},W(c=p.value.map(o=>{const i=d.value[o];if(!i.title)return null;switch((i?.["ui:options"]||{})?.type){case"hidden":return null}const h=!!a[o];return e(X,{title:i.title,"data-schema":JSON.stringify(i)},{default:()=>[e(I,r,{default:()=>[h?a[o]?.():e(P,null,[e(Re,{dataKey:t.getKey(o),formData:l,schema:i,property:o},null),t.extendConfigView?.[o]])]})]})}))?c:{default:()=>[c]}),A.ps.length?e(B,{vertical:!0},W(y=A.ps.map(o=>e(k,{class:"ml-4 mt-8 inline-block text-xs",depth:3},W(o)?o:{default:()=>[o]})))?y:{default:()=>[y]}):null])}}}),Re=x({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0},property:{type:String}},setup(t){const{definitions:a,getKey:l}=Ae(Ve,{});return()=>{const{schema:d,formData:n,dataKey:p,property:u}=t;return d?e(P,null,[Object.keys(d.properties).map(s=>{const r=d.properties[s];if(r.$ref){const c=a.value.get(r.$ref.split("/").at(-1));return e(Re,{dataKey:`${l(p)}.${s}`,formData:n,schema:c,property:s},null)}return e(Kt,{value:H(n.value,`${l(p)}.${s}`,void 0),onUpdateValue:c=>{H(n.value,l(p))?de(n.value,`${l(p)}.${s}`,c):de(n.value,l(p),{...H(n.value,l(p),{}),[s]:c})},title:r.title,type:r.type,options:r?.["ui:options"],description:r.description},null)})]):null}}}),Kt=x({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(t){const a=w(t.value);ae(()=>{t.onUpdateValue(a.value)});const l=()=>{const{options:p}=t;switch(t.type){case"url":case"string":{const{type:u}=p;switch(u){case"select":{const{values:s}=p;return e(R,{value:a.value,onUpdateValue:r=>{a.value=r},options:s,filterable:!0},null)}default:return e(F,{inputProps:{id:Je()},value:a.value,onUpdateValue:s=>{a.value=s},type:u||"text",showPasswordOn:"click",autosize:u=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}}case"array":return e(We,{value:a.value,onUpdateValue:u=>{a.value=u}},null);case"boolean":return e(M,{value:a.value,onUpdateValue:u=>{a.value=u}},null);case"number":case"integer":return e(He,{value:a.value,onUpdateValue:u=>{a.value=u}},null);default:return null}},d=q(K),n=E(()=>d.viewport.value.mobile?1:2);return()=>{const{title:p,options:u,description:s}=t,r=e(P,null,[e(m,{label:p},{default:()=>[s?e(B,{class:"w-full",vertical:!0},{default:()=>[l(),e(k,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:Ge.parse(s)},null)]})]}):l()]})]);return u.halfGrid&&n.value===2?e("div",{class:"inline-block w-1/2"},[r]):r}}});var b=(function(t){return t.OpenAI="openai",t.OpenAICompatible="openai-compatible",t.Anthropic="anthropic",t.OpenRouter="openrouter",t})(b||{});const qe=[{label:"OpenAI",value:b.OpenAI},{label:"OpenAI å…¼å®¹ (DeepSeek/Groq ç­‰)",value:b.OpenAICompatible},{label:"Anthropic (Claude)",value:b.Anthropic},{label:"OpenRouter",value:b.OpenRouter}],Lt=t=>qe.find(a=>a.value===t)?.label||t,jt=t=>{const a=t.name?.trim(),l=Lt(t.type);return a||l},Ke=t=>{switch(t){case b.Anthropic:return"claude-sonnet-4.5";case b.OpenAI:return"gpt-5-mini";case b.OpenRouter:return"anthropic/claude-sonnet-4.5";case b.OpenAICompatible:return"";default:return""}},$t=t=>{switch(t){case b.Anthropic:return"å¦‚ Claude Sonnet";case b.OpenAI:return"å¦‚ OpenAI GPT-4o";case b.OpenRouter:return"å¦‚ OpenRouter";case b.OpenAICompatible:return"å¦‚ DeepSeek";default:return""}},_t=t=>{switch(t){case b.Anthropic:return"å¦‚ claude-sonnet-4.5";case b.OpenAI:return"å¦‚ gpt-5-mini";case b.OpenRouter:return"å¦‚ anthropic/claude-sonnet-4.5";case b.OpenAICompatible:return"å¦‚ deepseek-chat";default:return""}},zt=x({props:{provider:{type:Object,required:!0},onUpdate:{type:Function,required:!0},onDelete:{type:Function,required:!0},onTest:{type:Function},availableModels:{type:Array,default:()=>[]},isLoadingModels:{type:Boolean,default:!1},isTesting:{type:Boolean,default:!1},onRefreshModels:{type:Function}},setup(t){const a=w({...t.provider});T(()=>t.provider,s=>{a.value={...s}},{deep:!0});const l=(s,r)=>{a.value[s]=r,t.onUpdate(a.value)},d=s=>{a.value.type=s,a.value.defaultModel=Ke(s),t.onUpdate(a.value)},n=E(()=>t.availableModels.map(s=>({label:s.name||s.id,value:s.id}))),p=E(()=>a.value.type===b.OpenAICompatible||a.value.type===b.OpenAI||a.value.type===b.OpenRouter),u=E(()=>{if(a.value.name)return a.value.name;switch(a.value.type){case b.Anthropic:return"Anthropic (Claude)";case b.OpenAI:return"OpenAI";case b.OpenRouter:return"OpenRouter";case b.OpenAICompatible:return"OpenAI å…¼å®¹";default:return"æ–° Provider"}});return()=>e(S,{title:u.value,size:"small",class:"mb-4"},{default:()=>e(I,{labelPlacement:"left",labelWidth:120},{default:()=>[e(m,{label:"ç±»åž‹"},{default:()=>[e(R,{value:a.value.type,onUpdateValue:d,options:qe},null)]}),e(m,{label:"æ˜¾ç¤ºåç§°"},{default:()=>[e(F,{value:a.value.name,onUpdateValue:s=>l("name",s),placeholder:$t(a.value.type)},null)]}),e(m,{label:"API Key"},{default:()=>[e(F,{type:"password",showPasswordOn:"click",value:a.value.apiKey,onUpdateValue:s=>l("apiKey",s),placeholder:a.value.type===b.Anthropic?"sk-ant-...":a.value.type===b.OpenRouter?"sk-or-...":"sk-..."},null)]}),p.value&&e(m,{label:"Endpoint"},{default:()=>[e(F,{value:a.value.endpoint,onUpdateValue:s=>l("endpoint",s),placeholder:a.value.type===b.OpenAICompatible?"å¿…å¡«ï¼Œå¦‚ https://api.deepseek.com":a.value.type===b.OpenRouter?"å¯é€‰ï¼Œé»˜è®¤ https://openrouter.ai/api/v1":"å¯é€‰ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤"},null)]}),e(m,{label:"é»˜è®¤æ¨¡åž‹"},{default:()=>[e(B,{align:"center"},{default:()=>[t.availableModels.length>0?e(R,{value:a.value.defaultModel,onUpdateValue:s=>l("defaultModel",s),options:n.value,filterable:!0,tag:!0,style:"min-width: 200px",placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ¨¡åž‹å"},null):e(F,{value:a.value.defaultModel,onUpdateValue:s=>l("defaultModel",s),placeholder:_t(a.value.type),style:"min-width: 200px"},null),e(C,{tertiary:!0,type:"primary",loading:t.isLoadingModels,onClick:()=>t.onRefreshModels?.()},{default:()=>[v("èŽ·å–æ¨¡åž‹åˆ—è¡¨")]})]})]}),e(m,{label:"å¯ç”¨"},{default:()=>[e(M,{value:a.value.enabled,onUpdateValue:s=>l("enabled",s)},null)]})]}),action:()=>e("div",{class:"flex justify-end"},[e(B,{align:"center"},{default:()=>[e(Z,{variant:"success",icon:e(Y,null,null),name:"æµ‹è¯•è¿žæŽ¥",disabled:t.isTesting||!a.value.defaultModel,onClick:()=>t.onTest?.(a.value)},null),e(Qe,{onDelete:()=>t.onDelete(),message:"ç¡®å®šåˆ é™¤æ­¤ Providerï¼Ÿ"},null)]})])})}}),J=x({props:{label:{type:String,required:!0},description:{type:String},assignment:{type:Object},providers:{type:Array,required:!0},providerModels:{type:Object,default:()=>({})},onUpdate:{type:Function,required:!0}},setup(t){const a=w(t.assignment?.providerId||""),l=w(t.assignment?.model||"");T(()=>t.assignment,c=>{a.value=c?.providerId||"",l.value=c?.model||""},{deep:!0});const d=E(()=>t.providers.map(c=>({label:jt(c),value:c.id,disabled:!c.enabled}))),n=E(()=>a.value?t.providerModels[a.value]||[]:[]),p=E(()=>{const c=n.value.map(A=>({label:A.name||A.id,value:A.id})),y=t.providers.find(A=>A.id===a.value);return y?.defaultModel&&(c.some(o=>o.value===y.defaultModel)||c.unshift({label:`${y.defaultModel} (é»˜è®¤)`,value:y.defaultModel})),c}),u=c=>{a.value=c,l.value="",r()},s=c=>{l.value=c,r()},r=()=>{a.value?t.onUpdate({providerId:a.value,model:l.value||void 0}):t.onUpdate(void 0)};return()=>e(m,{label:t.label},{default:()=>[e(B,{vertical:!0,class:"w-full"},{default:()=>[e(B,null,{default:()=>[e(R,{value:a.value||null,onUpdateValue:u,options:d.value,placeholder:"é€‰æ‹© Provider",clearable:!0,style:"min-width: 180px"},null),e(R,{value:l.value||null,onUpdateValue:s,options:p.value,placeholder:"ä½¿ç”¨ Provider é»˜è®¤æ¨¡åž‹",clearable:!0,filterable:!0,tag:!0,style:"min-width: 200px",disabled:!a.value},null)]}),t.description&&e(k,{depth:3,class:"text-xs"},{default:()=>[t.description]})]})]})}}),Gt=x({props:{value:{type:Object,required:!0},onUpdate:{type:Function,required:!0}},setup(t){const a=w({}),l=w(new Set),d=w(new Set),n=E({get:()=>t.value,set:o=>t.onUpdate(o)}),p=async o=>{l.value.add(o.id);try{const i=await g.api.ai.models.list.post({data:{providerId:o.id,type:o.type,apiKey:o.apiKey||void 0,endpoint:o.endpoint||void 0}});i.models&&(a.value[o.id]=i.models),i.error&&message.warning(`èŽ·å–æ¨¡åž‹åˆ—è¡¨: ${i.error}`)}catch(i){console.error(`Failed to fetch models for ${o.id}:`,i),i?.response||message.error(`èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥: ${i.message||i}`)}finally{l.value.delete(o.id)}},u=async()=>{try{const o=await g.api.ai.models.get();for(const i of o)i.models&&(a.value[i.providerId]=i.models)}catch(o){console.error("Failed to fetch all models:",o)}},s=async o=>{if(!o.defaultModel){message.warning("è¯·å…ˆå¡«å†™é»˜è®¤æ¨¡åž‹");return}d.value.add(o.id);try{await g.api.ai.test.post({data:{providerId:o.id,type:o.type,apiKey:o.apiKey||void 0,endpoint:o.endpoint||void 0,model:o.defaultModel||void 0}}),message.success("è¿žæŽ¥å¯ç”¨")}catch(i){console.error(`Failed to test provider ${o.id}:`,i),i?.response||message.error(`è¿žæŽ¥å¤±è´¥: ${i.message||i}`)}finally{d.value.delete(o.id)}};U(()=>{n.value.providers?.some(o=>o.enabled)&&u()});const r=o=>{t.onUpdate({...n.value,...o})},c=(o,i)=>{const f=[...n.value.providers||[]];f[o]=i,r({providers:f})},y=o=>{const i=(n.value.providers||[]).filter((f,h)=>h!==o);r({providers:i})},A=()=>{const o=b.OpenAI,i={id:crypto.randomUUID(),name:"",type:o,apiKey:"",defaultModel:Ke(o),enabled:!0};r({providers:[...n.value.providers||[],i]})};return()=>e(B,{vertical:!0,size:"large",class:"w-full"},{default:()=>[e(S,{title:"AI Providers",size:"small"},{default:()=>[e(B,{vertical:!0,class:"w-full"},{default:()=>[n.value.providers?.map((o,i)=>e(zt,{key:o.id,provider:o,onUpdate:f=>c(i,f),onDelete:()=>y(i),onTest:f=>s(f),availableModels:a.value[o.id]||[],isLoadingModels:l.value.has(o.id),isTesting:d.value.has(o.id),onRefreshModels:()=>p(o)},null)),e(C,{onClick:A,dashed:!0,block:!0},{default:()=>[v("+ æ·»åŠ  Provider")]})]})]}),e(S,{title:"åŠŸèƒ½æ¨¡åž‹åˆ†é…",size:"small"},{default:()=>[e(I,{labelPlacement:"left",labelWidth:150},{default:()=>[e(J,{label:"æ‘˜è¦åŠŸèƒ½",description:"ç”¨äºŽç”Ÿæˆæ–‡ç« æ‘˜è¦çš„æ¨¡åž‹",assignment:n.value.summaryModel,providers:n.value.providers||[],providerModels:a.value,onUpdate:o=>r({summaryModel:o})},null),e(J,{label:"å†™ä½œåŠ©æ‰‹",description:"ç”¨äºŽç”Ÿæˆæ ‡é¢˜ã€Slug ç­‰çš„æ¨¡åž‹",assignment:n.value.writerModel,providers:n.value.providers||[],providerModels:a.value,onUpdate:o=>r({writerModel:o})},null),e(J,{label:"è¯„è®ºå®¡æ ¸",description:"ç”¨äºŽå®¡æ ¸è¯„è®ºçš„æ¨¡åž‹",assignment:n.value.commentReviewModel,providers:n.value.providers||[],providerModels:a.value,onUpdate:o=>r({commentReviewModel:o})},null)]})]}),e(S,{title:"åŠŸèƒ½å¼€å…³",size:"small"},{default:()=>[e(I,{labelPlacement:"left",labelWidth:200},{default:()=>[e(m,{label:"å¯ç”¨ AI æ‘˜è¦"},{default:()=>[e(M,{value:n.value.enableSummary,onUpdateValue:o=>r({enableSummary:o})},null)]}),e(m,{label:"è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦"},{default:()=>[e(B,{vertical:!0},{default:()=>[e(M,{value:n.value.enableAutoGenerateSummary,onUpdateValue:o=>r({enableAutoGenerateSummary:o}),disabled:!n.value.enableSummary},null),e(k,{depth:3,class:"text-xs"},{default:()=>[v("å‘å¸ƒæ–‡ç« æ—¶è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦")]})]})]}),e(m,{label:"æ‘˜è¦ç›®æ ‡è¯­è¨€"},{default:()=>[e(F,{value:n.value.aiSummaryTargetLanguage,onUpdateValue:o=>r({aiSummaryTargetLanguage:o}),placeholder:"auto æˆ– ISO 639-1 è¯­è¨€ä»£ç ",style:"max-width: 200px"},null)]})]})]})]})}}),Ht="mt-6",Wt={class:Ht,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},be={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},Jt=x(()=>{const{setHeaderButtons:t}=Xe();U(()=>{t(e(Z,{disabled:!0,onClick:p,icon:e(Y,null,null)},null))}),Ze(()=>{t(null)});const a=w();Oe(async()=>{a.value=await g.api.config.jsonschema.get({transform:!1}),await u()});let l={};const d=V({}),n=w({});T(()=>d,c=>{n.value=Pe(l,Ye(c))},{deep:!0}),T(()=>n.value,c=>{let y=!1;ee(c)?y=!1:y=!0,t(e(Z,{disabled:!y,icon:e(Y,null,null),onClick:p},null))});async function p(){if(ee(n.value))return;const c=Object.entries(n.value);for await(const[y,A]of c){const o=Object.fromEntries(Object.entries(A).map(([i,f])=>Array.isArray(f)?[i,d[y][i]]:[i,f]));await g.api.options(y).patch({data:o})}await u(),message.success("ä¿®æ”¹æˆåŠŸ")}const u=async()=>{let c=await g.api.options.get();c=Ft(a.value.default,c),l=_(c),Object.assign(d,c)},s=q(K),r=V(Wt);return T(()=>s.viewport.value.mobile,c=>{c?(r.labelPlacement="top",r.labelAlign="left"):(r.labelPlacement="left",r.labelAlign="right")},{immediate:!0}),()=>e(P,null,[e("div",{class:"pt-4"},null),a.value&&e(qt,{initialValue:d,getKey:c=>c.split(".").map(y=>Et(y)).join(".").replace("Dto",""),schema:a.value},{AdminExtraDto:()=>e(P,null,[e(m,{label:"ä¸»é¢˜è‰²"},{default:()=>[e(Qt,null,null)]})]),AIDto:()=>e(Gt,{value:d.ai||{},onUpdate:c=>{d.ai=c}},null)})])}),Qt=x({setup(){const t=et(),a=document.createElement("style");return a.innerHTML="* { transition: none !important; }",()=>e("div",{class:"flex items-center gap-2"},[e(tt,{class:"w-36",value:t.value.primaryColor,onUpdateValue:l=>{document.head.appendChild(a),Object.assign(ce.value,at(l)),setTimeout(()=>{document.head.removeChild(a)})}},null),e(C,{size:"small",ghost:!0,onClick:()=>{Object.assign(ce.value,lt)}},{default:()=>[e("span",null,[v("é‡ç½®")])]})])}});function te(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!De(t)}const Xt=x(()=>{const t=w([]),a=async()=>{const n=await g.api.user.session.get({});t.value=n.data||[]};U(()=>{a()});const l=async(n,p)=>{n?(await g.api.user.logout.post({}),Te(),await xe.signOut(),window.location.reload()):(await g.api.user.session(p).delete({}),t.value=t.value.filter(u=>u.id!==p))},d=async()=>{await g.api.user.session.all.delete({}),await a()};return()=>{let n;return e(P,null,[e(ut,{class:"flex items-center justify-between"},{default:()=>[e("span",{class:"ml-4"},[v("ç™»å½•è®¾å¤‡")]),e(z,{onPositiveClick:d},{trigger(){return e(C,{size:"small",quaternary:!0,type:"error",disabled:t.value.length==1&&t.value[0].current},{default:()=>[v("è¸¢æŽ‰å…¨éƒ¨")]})},default(){return"ç¡®å®šè¸¢æŽ‰å…¨éƒ¨ç™»å½•è®¾å¤‡ï¼ˆé™¤å½“å‰ä¼šè¯ï¼‰ï¼Ÿ"}})]}),e(vt,{bordered:!0},te(n=t.value.map(({id:p,ua:u,ip:s,date:r,current:c})=>e(mt,{key:p},{prefix(){return e("div",{class:"w-20 text-center"},[c?"å½“å‰":null])},suffix(){return e(le,null,{default:()=>[e(z,{onPositiveClick:()=>l(!!c,p)},{trigger(){return e(C,{tertiary:!0,type:"error"},{default:()=>[c?"æ³¨é”€":"è¸¢"]})},default(){return c?"ç™»å‡ºï¼Ÿ":"ç¡®å®šè¦è¸¢å‡ºå—ï¼Ÿ"}})]})},default(){return e(B,{vertical:!0},{default:()=>[e(ye,{condition:!!u},{default:()=>[e(j,null,{default:()=>[v("User Agent: "),u]})]}),e(ye,{condition:!!s},{default:()=>[e(j,null,{default:()=>[v("IP:")," ",e(Se,{ip:s,triggerEl:e(C,{quaternary:!0,size:"tiny",type:"primary"},te(s)?s:{default:()=>[s]})},null)]})]}),e(j,null,{default:()=>[c?"æ´»è·ƒæ—¶é—´":"ç™»å½•æ—¶é—´",v(":")," ",e(G,{time:r},null)]})]})}})))?n:{default:()=>[n]}),e("div",{class:"pt-4"},null),e(Ie,{defaultExpandedNames:[""],displayDirective:"show"},{default:()=>[e(X,{name:"reset",title:"ä¿®æ”¹å¯†ç "},{default:()=>[e(Yt,null,null)]}),e(X,{name:"token",title:"API Token"},{default:()=>[e(Zt,null,null)]})]})])}}),Zt=x(()=>{const t=w([]),a=()=>({name:"",expired:!1,expiredTime:new Date}),l=V(a()),d=async()=>{const{data:i}=await g.api.auth.token.get();t.value=i};Oe(()=>{d()});const n=w(!1),p=w(!1),u=w(null),s=w(new Set),r=async()=>{try{const i={name:l.name,expired:l.expired?l.expiredTime.toISOString():void 0},f=await g.api.auth.token.post({data:i});try{await navigator.clipboard.writeText(f.token)}catch(O){console.warn("å¤åˆ¶åˆ°å‰ªè´´æ¿å¤±è´¥:",O)}n.value=!1;const h=a();for(const O in h)l[O]=h[O];u.value=f,p.value=!0,await d();const D=t.value.findIndex(O=>O.name===i.name);D!==-1&&(t.value[D].token=f.token)}catch{alert("åˆ›å»º Token å¤±è´¥ï¼Œè¯·é‡è¯•")}},c=async i=>{await g.api.auth.token.delete({params:{id:i}}),message.success("åˆ é™¤æˆåŠŸ");const f=t.value.findIndex(h=>h.id===i);f!=-1&&t.value.splice(f,1)},y=async i=>{const f=i.id;if(s.value.has(f))s.value.delete(f);else try{const h=await g.api.auth.token.get({params:{id:f}}),D=t.value.findIndex(O=>O.id===f);D!==-1&&(t.value[D].token=h.token),s.value.add(f)}catch(h){console.error("èŽ·å–Tokenè¯¦æƒ…å¤±è´¥:",h),alert("èŽ·å–Tokenè¯¦æƒ…å¤±è´¥ï¼Œè¯·é‡è¯•")}},A=async i=>{try{await navigator.clipboard.writeText(i),message.success("Token å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{const h=document.createElement("textarea");h.value=i,h.style.position="fixed",h.style.left="-9999px",document.body.appendChild(h),h.focus(),h.select();try{document.execCommand("copy"),message.success("Token å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch(D){console.warn("å¤åˆ¶å¤±è´¥:",D),alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶Token")}document.body.removeChild(h)}},o=q(K);return()=>e(ue,{class:"!overflow-visible"},{default:()=>[e(fe,{transformOrigin:"center",show:n.value,onUpdateShow:i=>void(n.value=i)},{default:()=>[e(S,{bordered:!1,title:"åˆ›å»º Token",class:"w-[500px] max-w-full"},{default:()=>[e(I,null,{default:()=>[e(m,{label:"åç§°",required:!0},{default:()=>[e(F,{value:l.name,onInput:i=>void(l.name=i)},null)]}),e(m,{label:"æ˜¯å¦è¿‡æœŸ"},{default:()=>[e(M,{value:l.expired,onUpdateValue:i=>void(l.expired=i)},null)]}),e(m,{label:"è¿‡æœŸæ—¶é—´"},{default:()=>[e(st,{disabled:!l.expired,value:l.expiredTime,type:"datetime",onUpdateValue:i=>void(l.expiredTime=new Date(i))},null)]})]}),e(B,null,{default:()=>[e(C,{round:!0,onClick:()=>void(n.value=!1)},{default:()=>[v("å–æ¶ˆ")]}),e(C,{round:!0,type:"primary",disabled:!l.name.trim(),onClick:r},{default:()=>[v("ç¡®å®š")]})]})]})]}),e(fe,{transformOrigin:"center",show:p.value,onUpdateShow:i=>void(p.value=i)},{default:()=>[e(S,{bordered:!1,title:"Token åˆ›å»ºæˆåŠŸ",class:"w-[600px] max-w-full",closable:!0,onClose:()=>void(p.value=!1)},{default:()=>[e("div",{class:"space-y-4"},[e("div",null,[e(k,{depth:3,class:"text-sm"},{default:()=>[v("Token åˆ›å»ºæˆåŠŸï¼Œè¯·å¦¥å–„ä¿å­˜ä»¥ä¸‹ä¿¡æ¯ï¼š")]})]),e("div",{class:"space-y-3"},[e("div",null,[e(k,{strong:!0},{default:()=>[v("Token åç§°ï¼š")]}),e(k,null,{default:()=>[u.value?.name]})]),e("div",null,[e(k,{strong:!0},{default:()=>[v("Tokenï¼š")]}),e("div",{class:"mt-2 flex items-center gap-2 rounded border bg-gray-50 p-3 dark:bg-gray-800"},[e(k,{code:!0,class:"flex-1 break-all text-gray-900 dark:text-gray-100"},{default:()=>[u.value?.token]}),e(C,{size:"small",type:"primary",onClick:async()=>{if(u.value?.token)try{await navigator.clipboard.writeText(u.value.token),message.success("Token å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{const f=document.createElement("textarea");f.value=u.value.token,f.style.position="fixed",f.style.left="-9999px",document.body.appendChild(f),f.focus(),f.select();try{document.execCommand("copy"),message.success("Token å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch(h){console.warn("å¤åˆ¶å¤±è´¥:",h),alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶Token")}document.body.removeChild(f)}}},{default:()=>[v("å¤åˆ¶")]})])]),u.value?.expired&&e("div",null,[e(k,{strong:!0},{default:()=>[v("è¿‡æœŸæ—¶é—´ï¼š")]}),e(k,null,{default:()=>[u.value.expired?ve(u.value.expired,"yyyy å¹´ M æœˆ d æ—¥ HH:mm:ss"):"æ°¸ä¸è¿‡æœŸ"]})])]),e("div",{class:"pt-2"},[e(k,{depth:3,class:"text-sm"},{default:()=>[v("ðŸ’¡ å»ºè®®å°†æ­¤ Token ä¿å­˜åœ¨å®‰å…¨çš„åœ°æ–¹ï¼Œé¿å…æ³„éœ²ç»™ä»–äººã€‚")]})])]),e("div",{class:"mt-6 flex justify-end"},[e(C,{type:"primary",onClick:()=>void(p.value=!1)},{default:()=>[v("ç¡®å®š")]})])]})]}),e(C,{class:"absolute right-0 top-[-3rem]",round:!0,type:"primary",onClick:()=>{n.value=!0}},{default:()=>[e(Q,null,{default:()=>[e(ke,null,null)]}),e("span",{class:"ml-2"},[v("æ–°å¢ž")])]}),e(Be,{scrollX:Math.max(800,o.contentWidth.value-o.contentInsetWidth.value),remote:!0,bordered:!1,data:t.value,columns:[{key:"name",title:"åç§°"},{key:"token",title:"Token",render(i){const{token:f,id:h}=i;return s.value.has(h)&&f&&f!=="*".repeat(40)?e(C,{text:!0,type:"primary",onClick:()=>A(f),class:"max-w-[200px] truncate text-left font-mono"},te(f)?f:{default:()=>[f]}):"*".repeat(40)}},{title:"åˆ›å»ºæ—¶é—´",key:"created",render({created:i}){return e(G,{time:i},null)}},{title:"è¿‡æœŸæ—¶é—´",key:"expired",render({expired:i}){return ve(i,"yyyy å¹´ M æœˆ d æ—¥ HH:mm:ss")}},{title:"æ“ä½œ",key:"id",render(i){const{id:f,name:h}=i,D=s.value.has(f);return e(B,null,{default:()=>[e(C,{text:!0,type:"primary",onClick:()=>y(i)},{default:()=>[D?"éšè—":"æŸ¥çœ‹"]}),e(z,{positiveText:"å–æ¶ˆ",negativeText:"åˆ é™¤",onNegativeClick:()=>{c(f)}},{trigger:()=>e(C,{text:!0,type:"error"},{default:()=>[v("åˆ é™¤")]}),default:()=>e("span",{class:"max-w-48"},[v('ç¡®å®šè¦åˆ é™¤ Token "'),h,v('"?')])})]})}}]},null)]})}),Yt=x(()=>{const t=V({password:"",reenteredPassword:""}),a=w(),l=ne(),d=async()=>{a.value&&a.value.validate(async p=>{p||(await g.api.master.patch({data:{password:t.password}}),message.success("æ›´æ”¹æˆåŠŸ"),Te(),l.push({name:nt.Login}))})};function n(p,u){return u===t.password}return()=>e(I,{class:"max-w-[300px]",ref:a,model:t,rules:{password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç "}],reenteredPassword:[{required:!0,message:"è¯·å†æ¬¡è¾“å…¥å¯†ç ",trigger:["input","blur"]},{validator:n,message:"ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´",trigger:["blur","password-input"]}]}},{default:()=>[e(m,{label:"æ–°å¯†ç ",required:!0,path:"password"},{default:()=>[e(F,pe(be,{value:t.password,onInput:p=>void(t.password=p),type:"password"}),null)]}),e(m,{label:"é‡å¤å¯†ç ",required:!0,path:"reenteredPassword"},{default:()=>[e(F,pe(be,{value:t.reenteredPassword,onInput:p=>void(t.reenteredPassword=p),type:"password"}),null)]}),e("div",{class:"quaternary-right w-full"},[e(C,{onClick:d,type:"primary",round:!0},{default:()=>[v("ä¿å­˜")]})])]})}),ge={GitHub:"github",Weibo:"weibo",ç½‘æ˜“äº‘:"netease",å“”å“©å“”å“©:"bilibili"},ea="_avatar_1o1mi_3",he={"tab-user":"_tab-user_1o1mi_1",avatar:ea},ta=x(()=>{const t=w({});let a;async function l(){const u=await g.api.master.get();t.value=u,a={...u}}U(async()=>{await l()});const d=rt(),n=E(()=>Pe(a,t.value)),p=async()=>{const u=_(dt(n));u.socialIds&&(u.socialIds=t.value.socialIds),await g.api.master.patch({data:u}),d.success("ä¿å­˜æˆåŠŸ~"),await l()};return()=>e(P,null,[e(ot,{cols:"1 400:1 600:2",class:he["tab-user"],xGap:20,yGap:20},{default:()=>[e(me,null,{default:()=>[e(I,{class:"flex flex-col items-center justify-center"},{default:()=>[e(m,null,{default:()=>[e("div",{class:he.avatar},[e(bt,{type:"avatar",onFinish:u=>{const{file:s,event:r}=u;try{const c=JSON.parse((r?.target).responseText);t.value.avatar=c.url}catch{}return s}},{default:()=>[e(gt,{class:"border-0 bg-transparent hover:border-0"},{default:()=>[e(it,{class:"flex",src:t.value.avatar,size:200},null)]})]})])]}),e(m,{label:"ä¸Šæ¬¡ç™»å½•æ—¶é—´",class:"!mt-4"},{default:()=>[e("div",{class:"w-full text-center"},[e(k,null,{default:()=>[t.value.lastLoginTime?e(G,{time:t.value.lastLoginTime},null):"N/A"]})])]}),e(m,{label:"ä¸Šæ¬¡ç™»å½•åœ°å€"},{default:()=>[e("div",{class:"w-full text-center"},[t.value.lastLoginIp?e(Se,{trigger:"hover",ip:t.value.lastLoginIp,triggerEl:e(k,{class:"cursor-pointer"},{default:()=>[t.value.lastLoginIp]})},null):"N/A"])]}),e(m,null,{default:()=>[e(C,{round:!0,class:"-mt-14",type:"primary",onClick:p,disabled:ee(n.value)},{default:()=>[v("ä¿å­˜")]})]})]})]}),e(me,null,{default:()=>[e(I,null,{default:()=>[e(m,{label:"ä¸»äººå (username)"},{default:()=>[e(F,{value:t.value.username,onInput:u=>{t.value.username=u?.trim()||""}},null)]}),e(m,{label:"ä¸»äººæ˜µç§° (name)"},{default:()=>[e(F,{value:t.value.name,onInput:u=>{t.value.name=u?.trim()||""}},null)]}),e(m,{label:"ä¸»äººé‚®ç®± (mail)"},{default:()=>[e(F,{value:t.value.mail,onInput:u=>{t.value.mail=u}},null)]}),e(m,{label:"ä¸ªäººé¦–é¡µ"},{default:()=>[e(F,{value:t.value.url,onInput:u=>{t.value.url=u}},null)]}),e(m,{label:"å¤´åƒ"},{default:()=>[e(F,{value:t.value.avatar,onInput:u=>{t.value.avatar=u}},null)]}),e(m,{label:"ä¸ªäººä»‹ç»"},{default:()=>[e(F,{type:"textarea",resizable:!1,value:t.value.introduce,onInput:u=>{t.value.introduce=u}},null)]}),e(m,{label:"ç¤¾äº¤å¹³å° ID å½•å…¥"},{default:()=>[e(yt,{key:t.value.id,options:Object.keys(ge).map(u=>({label:u,value:ge[u]})),onChange:u=>{t.value.socialIds=u},value:t.value.socialIds||{}},null)]})]})]})]})])});var N=(function(t){return t.User="user",t.System="system",t.Security="security",t.Auth="auth",t})(N||{});const ia=x({setup(){const t=Ee(),a=ne(),l=w(t.params.type);T(()=>t.params.type,n=>{n&&(l.value=n)});const d=w(null);return()=>e(ct,{actionsElement:d.value},{default:()=>[e(pt,{value:l.value,onUpdateValue:n=>{a.replace({...t,params:{...t.params,type:n}})}},{default:()=>[e(L,{tab:"ç”¨æˆ·",name:N.User},{default:()=>[e(ta,null,null)]}),e(L,{tab:"ç³»ç»Ÿ",name:N.System},{default:()=>[e(Jt,null,null)]}),e(L,{tab:"å®‰å…¨",name:N.Security},{default:()=>[e(Xt,null,null)]}),e(L,{tab:"ç™»å…¥æ–¹å¼",name:N.Auth},{default:()=>[e(Mt,null,null)]})]})]})}});export{ia as default};
