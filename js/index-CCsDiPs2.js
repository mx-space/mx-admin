import{c as z,d as f,r as u,b0 as j,f as L,O as F,i as e,s as A,X as R,V as M,H as x,bt as V,W as C,Y as B,j as c,T as D,da as P,aU as S,aa as U,db as E,a as q,G as O,a0 as N}from"./index-R5yA_R4y.js";import{h as k}from"./health-BwdY3LBV.js";import{X as T}from"./index-DUMK9Ey8.js";import{F as v}from"./file-text-Cg4mMqcI.js";import{c as g,b as y}from"./index-Dlw5YAY1.js";import{E as w}from"./types-w5g51IlY.js";import{P as H}from"./play-w9XLB0Fh.js";import{R as I}from"./rotate-ccw-B4xSK1eS.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=z("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),Q=f({setup(){const l=u([]),a=u(!1),n=u("native"),o=j(),s=L(),r=async()=>{a.value=!0;try{l.value=await k.getLogList()}finally{a.value=!1}};F(()=>{r()});const i=u(""),d=u(!1),b=u(""),p=async t=>{const m=await k.getLogContent(t.filename);i.value=m,b.value=t.filename,d.value=!0},h=t=>{o.warning({title:"确认删除",content:`确定要删除日志文件「${t.filename}」吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{await k.deleteLog(t.filename),l.value=l.value.filter(m=>m.filename!==t.filename),s.success("删除成功")}})};return()=>e(B,null,[e(A,{transformOrigin:"center",show:d.value,onUpdateShow:t=>d.value=t},{default:()=>[e("div",{class:"w-full max-w-4xl rounded-xl bg-neutral-900 shadow-2xl"},[e("div",{class:"flex items-center justify-between border-b border-neutral-800 px-5 py-4"},[e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex size-8 items-center justify-center rounded-lg bg-neutral-800"},[e(v,{class:"size-4 text-neutral-400"},null)]),e("h2",{class:"text-base font-medium text-white"},[b.value||"查看日志"])]),e("button",{type:"button",class:"rounded-lg p-1.5 text-neutral-400 transition-colors hover:bg-neutral-800 hover:text-white",onClick:()=>d.value=!1,"aria-label":"关闭"},[e(R,{class:"size-5"},null)])]),e("div",{class:"p-4"},[e(G,{data:i.value},null)])])]}),e("div",{class:"space-y-4"},[e("div",{class:"flex items-center justify-between"},[e(M,{class:"w-36",value:n.value,onUpdateValue:t=>{n.value=t,r()},options:[{label:"PM2 日志",value:"pm2"},{label:"系统日志",value:"native"}],"aria-label":"选择日志类型"},null),e(x,{icon:e(V,null,null),name:"刷新",onClick:r,disabled:a.value},null)]),e(C,{show:a.value},{default:()=>[e("div",{class:"min-h-[300px]"},[l.value.length===0&&!a.value?e($,null,null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[l.value.map(t=>e(W,{key:t.filename,item:t,onView:()=>p(t),onDelete:()=>h(t)},null))])])]})])])}}),W=f({props:{item:{type:Object,required:!0},onView:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(l){return()=>{const{item:a}=l,n=a.type==="error"||a.filename.includes("error");return e("div",{class:"group flex items-center gap-4 border-b border-neutral-200 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-800/50"},[e("div",{class:["flex size-10 shrink-0 items-center justify-center rounded-lg",n?"bg-red-50 text-red-500 dark:bg-red-950/50 dark:text-red-400":"bg-neutral-100 text-neutral-500 dark:bg-neutral-800 dark:text-neutral-400"]},[e(v,{class:"size-5"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"truncate text-base font-medium text-neutral-900 dark:text-neutral-100",title:a.filename},[a.filename]),e("span",{class:["shrink-0 rounded-full px-2 py-0.5 text-xs",n?"bg-red-50 text-red-600 dark:bg-red-950/50 dark:text-red-400":"bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"]},[a.type])]),e("div",{class:"mt-0.5 text-sm tabular-nums text-neutral-500 dark:text-neutral-400"},[a.size])]),e("div",{class:"flex shrink-0 items-center gap-2"},[e("button",{onClick:l.onView,class:["rounded-lg px-3 py-1.5 text-sm font-medium","bg-neutral-900 text-white dark:bg-white dark:text-neutral-900","hover:bg-neutral-800 dark:hover:bg-neutral-100","transition-colors duration-150"]},[c("查看")]),e("button",{onClick:l.onDelete,"aria-label":`删除 ${a.filename}`,class:["flex size-8 items-center justify-center rounded-lg","text-neutral-400 hover:text-red-500","hover:bg-red-50 dark:hover:bg-red-950/50","transition-colors duration-150"]},[e(D,{class:"size-4"},null)])])])}}}),$=f({setup(){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(v,{class:"size-8 text-neutral-400"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[c("暂无日志文件")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[c("当前没有可用的日志文件")])])}}),G=f({props:{data:{type:String,default:""}},setup(l){const a=u(!0);return F(()=>{setTimeout(()=>{a.value=!1},300)}),()=>e("div",{class:"relative flex h-[60vh] max-h-[600px] min-h-[300px] overflow-hidden rounded-lg"},[a.value?e("div",{class:"flex h-full w-full items-center justify-center"},[e(C,{show:!0,strokeWidth:14},null)]):e(T,{darkMode:!0,class:"h-full w-full",onReady:n=>{n.write(l.data)}},null)])}}),Y=f({setup(){const l=u(!1),a=u(!1);let n=null;const o=[],s=[],r=(t=!0)=>{g?.socket?.emit("log",{prevLog:t})},i=t=>{if(a.value=!0,l.value){s.push(t);return}n?(o.length>0&&d(n),n.write(t)):o.push(t)},d=t=>{for(;o.length;){const m=o.shift();t.write(m)}},b=()=>{n?.clear(),a.value=!1},p=()=>{if(l.value=!l.value,!l.value&&n&&s.length>0)for(;s.length;){const t=s.shift();n.write(t)}},h=()=>{r(!0)};return P(()=>{r(),y.on(w.STDOUT,i)}),S(()=>{const t=()=>{r(!1)};return g?.socket?.io?.on("open",t),()=>{g?.socket?.io?.off("open",t)}}),U(()=>{g?.socket?.emit("unlog"),y.off(w.STDOUT,i)}),()=>e("div",{class:"flex h-full flex-col"},[e("div",{class:"mb-4 flex items-center justify-between"},[e("div",{class:["flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium",l.value?"bg-amber-50 text-amber-600 dark:bg-amber-950/50 dark:text-amber-400":"bg-green-50 text-green-600 dark:bg-green-950/50 dark:text-green-400"]},[e("span",{class:["size-2 rounded-full",l.value?"bg-amber-500":"animate-pulse bg-green-500"]},null),e("span",null,[l.value?"已暂停":"实时接收中"]),l.value&&s.length>0&&e("span",{class:"rounded-md bg-amber-100 px-1.5 py-0.5 text-xs tabular-nums dark:bg-amber-900/50"},[s.length,c(" 条待处理")])]),e("div",{class:"flex items-center gap-1"},[e(x,{icon:l.value?e(H,null,null):e(X,null,null),name:l.value?"恢复":"暂停",onClick:p},null),e(x,{icon:e(D,null,null),name:"清空",onClick:b,disabled:!a.value},null),e(x,{icon:e(I,null,null),name:"重连",onClick:h},null)])]),e("div",{class:["relative flex-1 overflow-hidden rounded-xl border","border-neutral-200 dark:border-neutral-800","bg-neutral-900"]},[!a.value&&e("div",{class:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-neutral-900/80"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-800"},[e(E,{class:"size-8 text-neutral-500"},null)]),e("p",{class:"mb-1 text-base font-medium text-neutral-300"},[c("等待日志输出...")]),e("p",{class:"text-sm text-neutral-500"},[c("日志将会实时显示在这里")])]),e(T,{darkMode:!0,class:"h-full w-full",onReady:t=>{n=t,d(n)}},null)])])}}),J=[{key:"0",label:"日志文件",icon:v},{key:"1",label:"实时日志",icon:E}],se=f({setup(){const l=N(),a=O(),n=q(()=>l.query.tab?.toString()||"0"),o=s=>{a.replace({...l,query:{...l.query,tab:s}})};return()=>e("div",{class:"flex h-full flex-col"},[e("div",{class:"mb-4 flex items-center gap-1 border-b border-neutral-200 dark:border-neutral-800"},[J.map(s=>{const r=s.icon,i=n.value===s.key;return e("button",{key:s.key,onClick:()=>o(s.key),class:["relative flex items-center gap-2 px-4 py-2.5 text-sm font-medium","transition-colors duration-150","focus-visible:outline-none focus-visible:ring-2","focus-visible:ring-neutral-400 focus-visible:ring-offset-2","dark:focus-visible:ring-neutral-500 dark:focus-visible:ring-offset-neutral-900",i?"text-neutral-900 dark:text-white":"text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200"]},[e(r,{class:"size-4"},null),s.label,i&&e("span",{class:"absolute bottom-0 left-0 right-0 h-0.5 bg-neutral-900 dark:bg-white"},null)])})]),e("div",{class:"min-h-0 flex-1"},[n.value==="0"?e(Q,null,null):e(Y,null,null)])])}});export{se as default};
