import{c as R,u as D,a as h,t as C,q,b as m,d as o,e as V,f as T,r as v,w as K,g as E,h as Q,i as e,P as _,H as U,j as l,R as G,k as J,N as y,B as f,l as W,m as X,n as Y,T as Z,o as ee,p as te,s as ae,v as ue,x as le,y as B,z as A}from"./index-qXdkAhVq.js";import{F}from"./folder-open-CV0oJknW.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=R("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),re=()=>D({queryKey:q.tags.list(),queryFn:m.getTags}),ne=t=>D({queryKey:h(()=>q.tags.postsByTag(C(t))),queryFn:()=>m.getPostsByTag(C(t)),enabled:h(()=>!!C(t))}),be=o(t=>{const a=V(J),g=T(),{data:b,isLoading:n}=re(),p=h(()=>b.value?.data??[]),c=v(""),{data:j,isLoading:L}=ne(c),S=h(()=>j.value?.data??[]),k=v(!0),M=a.fetch;K(async()=>{k.value=!0,await M(),k.value=!1});const d=v(!1),w=()=>({name:"",slug:""}),x=v(w()),N=E({mutationFn:m.delete,onSuccess:async()=>{g.success("删除成功"),await a.fetch(!0)}}),I=E({mutationFn:m.create,onSuccess:u=>{g.success("创建成功"),a.data.value.push(u.data),d.value=!1}}),$=E({mutationFn:({id:u,data:r})=>m.update(u,r),onSuccess:(u,{id:r,data:s})=>{g.success("修改成功");const i=a.data.value.findIndex(O=>O.id==r);i!==-1&&(a.data.value[i]={...a.data.value[i],name:s.name,slug:s.slug}),d.value=!1}}),{setActions:H}=Q();return H(e(U,{variant:"success",icon:e(_,null,null),name:"新建分类",onClick:()=>{d.value=!0,x.value=w()}},null)),()=>e("div",{class:"space-y-8"},[e("section",null,[e("div",{class:"mb-4 flex items-center gap-2"},[e(F,{class:"size-5 text-neutral-500","aria-hidden":"true"},null),e("h2",{class:"text-lg font-medium text-neutral-900 dark:text-neutral-100"},[l("分类")]),e("span",{class:"rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"},[a.data.value?.length||0])]),k.value?e(ce,null,null):a.data.value?.length?e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[a.data.value.map(u=>e(se,{key:u.id,category:u,onEdit:r=>{const s=a.data.value?.find(i=>i.id===r);s&&(x.value={name:s.name,slug:s.slug},d.value=r)},onDelete:r=>N.mutate(r)},null))]):e(ie,{onAdd:()=>{d.value=!0,x.value=w()}},null)]),e("section",null,[e("div",{class:"mb-4 flex items-center gap-2"},[e(z,{class:"size-5 text-neutral-500","aria-hidden":"true"},null),e("h2",{class:"text-lg font-medium text-neutral-900 dark:text-neutral-100"},[l("标签")]),e("span",{class:"rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"},[p.value.length])]),n.value?e(ge,null,null):p.value.length===0?e(oe,null,null):e("div",{class:"flex flex-wrap gap-2"},[p.value.map(u=>e(de,{key:u.name,tag:u,selected:c.value===u.name,onSelect:r=>{c.value=c.value===r?"":r}},null))]),c.value&&e("div",{class:"mt-4"},[e("h3",{class:"mb-3 text-sm font-medium text-neutral-600 dark:text-neutral-400"},[l("「"),c.value,l("」关联的文章")]),L.value?e("div",{class:"animate-pulse space-y-2"},[[1,2,3].map(u=>e("div",{key:u,class:"h-10 rounded-lg bg-neutral-100 dark:bg-neutral-800"},null))]):S.value.length===0?e("p",{class:"text-sm text-neutral-500"},[l("暂无关联文章")]):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[S.value.map(u=>e(G,{key:u.id,to:`/posts/edit?id=${u.id}`,class:"flex items-center justify-between border-b border-neutral-100 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-800/50"},{default:()=>[e("span",{class:"font-medium text-neutral-800 dark:text-neutral-200"},[u.title]),e("span",{class:"text-sm text-neutral-500"},[u.category?.name])]}))])])]),e(P,{show:d,onSubmit:u=>{const{name:r,slug:s}=u,i=typeof d.value=="string"?d.value:null;i?$.mutate({id:i,data:{name:r,slug:s,type:0}}):I.mutate({name:r,slug:s})},initialState:x.value},null)])}),se=o({props:{category:{type:Object,required:!0},onEdit:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"group relative flex items-center gap-4 border-b border-neutral-100 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-800/50"},[e("div",{class:"flex size-10 shrink-0 items-center justify-center rounded-lg bg-neutral-100 dark:bg-neutral-800"},[e(F,{class:"size-5 text-neutral-500","aria-hidden":"true"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[e("h3",{class:"truncate font-medium text-neutral-900 dark:text-neutral-100"},[t.category.name]),e("span",{class:"flex shrink-0 items-center gap-1 text-sm text-neutral-400"},[e(W,{class:"size-3.5","aria-hidden":"true"},null),e("span",{class:"font-mono"},[t.category.slug])])])]),e("div",{class:"shrink-0 transition-opacity group-hover:opacity-0"},[e("span",{class:"rounded-full bg-neutral-100 px-2.5 py-1 text-xs font-medium text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"},[t.category.count||0,l(" 篇")])]),e("div",{class:"absolute right-4 flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100"},[e(f,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>t.onEdit(t.category.id),"aria-label":`编辑分类 ${t.category.name}`},{icon:()=>e(X,{class:"size-3.5"},null),default:()=>"编辑"}),e(Y,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>t.onDelete(t.category.id)},{trigger:()=>e(f,{size:"tiny",quaternary:!0,type:"error","aria-label":`删除分类 ${t.category.name}`},{icon:()=>e(Z,{class:"size-3.5"},null),default:()=>"删除"}),default:()=>e("span",{class:"max-w-48"},[l("确定要删除分类「"),t.category.name,l("」吗？")])})])])}}),de=o({props:{tag:{type:Object,required:!0},selected:{type:Boolean,default:!1},onSelect:{type:Function,required:!0}},setup(t){return()=>e("button",{type:"button",onClick:()=>t.onSelect(t.tag.name),"aria-pressed":t.selected,"aria-label":`标签 ${t.tag.name}，${t.tag.count} 篇文章`,class:["inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-sm font-medium transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neutral-400 focus-visible:ring-offset-2","dark:focus-visible:ring-neutral-500 dark:focus-visible:ring-offset-neutral-900",t.selected?"bg-neutral-900 text-white dark:bg-white dark:text-neutral-900":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200 dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700"]},[e("span",null,[t.tag.name]),e("span",{class:["rounded-full px-1.5 py-0.5 text-xs",t.selected?"bg-white/20 text-white dark:bg-neutral-900/20 dark:text-neutral-900":"bg-neutral-200 text-neutral-500 dark:bg-neutral-700 dark:text-neutral-400"]},[t.tag.count])])}}),ie=o({props:{onAdd:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-12 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-14 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(F,{class:"size-7 text-neutral-400","aria-hidden":"true"},null)]),e("h3",{class:"mb-1 text-base font-medium text-neutral-900 dark:text-neutral-100"},[l("暂无分类")]),e("p",{class:"mb-5 text-sm text-neutral-500 dark:text-neutral-400"},[l("创建分类来组织你的文章")]),e(f,{type:"primary",onClick:t.onAdd},{default:()=>[l("创建第一个分类")]})])}}),oe=o({setup(){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-10 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-3 flex size-12 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(z,{class:"size-6 text-neutral-400","aria-hidden":"true"},null)]),e("h3",{class:"mb-1 text-base font-medium text-neutral-900 dark:text-neutral-100"},[l("暂无标签")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[l("在文章中添加标签后会自动显示在这里")])])}}),ce=o({setup(){return()=>e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[[1,2,3,4].map(t=>e("div",{key:t,class:"flex items-center gap-4 border-b border-neutral-100 px-4 py-3 last:border-b-0 dark:border-neutral-800"},[e(y,{width:40,height:40,class:"rounded-lg"},null),e("div",{class:"flex-1"},[e(y,{width:"30%",height:20,class:"rounded"},null)]),e(y,{width:50,height:24,class:"rounded-full"},null)]))])}}),ge=o({setup(){return()=>e("div",{class:"flex flex-wrap gap-2"},[[1,2,3,4,5,6].map(t=>e(y,{key:t,width:80+Math.random()*40,height:32,class:"rounded-full"},null))])}}),P=o(t=>{const a=ee(t.initialState??{name:"",slug:""});te(()=>t.initialState,n=>{n&&(a.name=n.name,a.slug=n.slug)});const g=T(),b=()=>{if(!a.name||!a.slug){g.error("名称和路径不能为空");return}t.onSubmit(a),t.show.value=!1};return()=>e(ae,{transformOrigin:"center",show:!!t.show.value,onUpdateShow:n=>{t.show.value=n}},{default:()=>e(ue,{style:"width: 480px; max-width: 90vw",headerStyle:{textAlign:"center"},title:typeof t.show.value=="string"?"编辑分类":"新建分类",bordered:!1,class:"!rounded-xl"},{default:()=>[e(le,{onSubmit:b,model:a},{default:()=>[e(B,{path:"name",label:"名称",rule:{required:!0,message:"请输入分类名称",trigger:["input","blur"]}},{default:()=>[e(A,{placeholder:"输入分类名称…",onInput:n=>{a.name=n},value:a.name,autofocus:!0,inputProps:{autocomplete:"off"}},null)]}),e(B,{path:"slug",label:"路径",rule:{required:!0,message:"请输入分类路径",trigger:["input","blur"]}},{default:()=>[e(A,{placeholder:"输入分类路径…",onInput:n=>{a.slug=n},value:a.slug,inputProps:{autocomplete:"off"}},null)]}),e("div",{class:"mt-6 flex justify-end gap-3"},[e(f,{onClick:()=>t.show.value=!1,round:!0},{default:()=>[l("取消")]}),e(f,{type:"primary",onClick:b,round:!0},{default:()=>[l("确定")]})])]})]})})});P.props=["initialState","onSubmit","show"];export{be as CategoryView};
