import{c as S,ar as i,d as y,i as e,j as r,B as c,K as B,m as q,n as D,T as z,o as A,r as b,p as L,a as M,s as P,X as K,z as g,A as j,_ as V,q as p,g as U,h as N,P as I,H as Q,$ as R,G as T,a0 as O}from"./index-qXdkAhVq.js";import{U as $}from"./user-DJBbAICO.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=S("quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]),x={getList:t=>i.get("/says",{params:t}),getById:t=>i.get(`/says/${t}`),create:t=>i.post("/says",{data:t}),update:(t,u)=>i.put(`/says/${t}`,{data:u}),delete:t=>i.delete(`/says/${t}`)},H=y({name:"SayListItem",props:{say:{type:Object,required:!0},onEdit:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"group border-b border-neutral-200 px-4 py-4 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-900/50"},[e("div",{class:"flex gap-3"},[e("div",{class:"shrink-0 pt-0.5"},[e(k,{class:"size-5 text-neutral-300 dark:text-neutral-600","aria-hidden":"true"},null)]),e("div",{class:"min-w-0 flex-1"},[e("p",{class:"text-base leading-relaxed text-neutral-800 dark:text-neutral-200"},[t.say.text]),e("div",{class:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-neutral-500 dark:text-neutral-400"},[t.say.author&&e("span",{class:"flex items-center gap-1"},[e($,{class:"size-3.5","aria-hidden":"true"},null),t.say.author]),t.say.source&&e("span",{class:"text-neutral-400 dark:text-neutral-500"},[r("—— "),t.say.source]),t.say.created&&e(B,{time:t.say.created,class:"text-neutral-400 dark:text-neutral-500"},null)])]),e("div",{class:"flex shrink-0 items-start gap-1 opacity-0 transition-opacity group-hover:opacity-100"},[e(c,{size:"tiny",quaternary:!0,type:"primary",onClick:t.onEdit,"aria-label":"编辑一言"},{icon:()=>e(q,{class:"size-3.5"},null),default:()=>e("span",{class:"hidden sm:inline"},[r("编辑")])}),e(D,{onPositiveClick:()=>t.onDelete(t.say.id)},{trigger:()=>e(c,{size:"tiny",quaternary:!0,type:"error","aria-label":"删除一言"},{default:()=>[e(z,{class:"size-3.5"},null)]}),default:()=>e("span",{class:"max-w-64 break-all"},[r("确定要删除「"),t.say.text.slice(0,30),t.say.text.length>30?"…":"",r("」吗？")])})])])])}}),G=y({name:"SayEditModal",props:{show:{type:Boolean,required:!0},say:{type:Object,default:null},onClose:{type:Function,required:!0},onSuccess:{type:Function,required:!0}},setup(t){const u=A({text:"",author:"",source:""}),o=b(!1),n=b("");L(()=>[t.show,t.say],([a,s])=>{a&&(s?(u.text=s.text||"",u.author=s.author||"",u.source=s.source||""):(u.text="",u.author="",u.source=""),n.value="")},{immediate:!0});const d=M(()=>!!t.say?.id),m=async()=>{if(!u.text.trim()){n.value="请输入内容";return}n.value="",o.value=!0;try{let a;const s={text:u.text.trim(),author:u.author.trim()||void 0,source:u.source.trim()||void 0};d.value?(a=await x.update(t.say.id,s),message.success("修改成功")):(a=await x.create(s),message.success("发布成功")),t.onSuccess(a)}finally{o.value=!1}},v=a=>{a.key==="Enter"&&(a.metaKey||a.ctrlKey)&&m()};return()=>e(P,{show:t.show,onUpdateShow:a=>{a||t.onClose()},closeOnEsc:!0,transformOrigin:"center"},{default:()=>[e("div",{class:"w-full max-w-lg rounded-xl bg-white shadow-xl dark:bg-neutral-900",role:"dialog","aria-modal":"true","aria-labelledby":"say-modal-title",onKeydown:v},[e("div",{class:"flex items-center justify-between border-b border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e("h2",{id:"say-modal-title",class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[d.value?"编辑一言":"添加一言"]),e("button",{type:"button",class:"rounded-lg p-1 text-neutral-400 transition-colors hover:bg-neutral-100 hover:text-neutral-600 dark:hover:bg-neutral-800",onClick:t.onClose,"aria-label":"关闭"},[e(K,{class:"size-5"},null)])]),e("div",{class:"px-5 py-4"},[e("div",{class:"mb-4"},[e("label",{class:"mb-1.5 block text-sm font-medium text-neutral-700 dark:text-neutral-300"},[r("内容 "),e("span",{class:"text-red-500"},[r("*")])]),e(g,{type:"textarea",value:u.text,onUpdateValue:a=>u.text=a,placeholder:"记录一句有意思的话…",autosize:{minRows:3,maxRows:8},status:n.value?"error":void 0},null),n.value&&e("p",{class:"mt-1 text-xs text-red-500"},[n.value])]),e("div",{class:"mb-4"},[e("label",{class:"mb-1.5 block text-sm font-medium text-neutral-700 dark:text-neutral-300"},[r("作者")]),e(g,{value:u.author,onUpdateValue:a=>u.author=a,placeholder:"谁说的？"},null)]),e("div",{class:"mb-4"},[e("label",{class:"mb-1.5 block text-sm font-medium text-neutral-700 dark:text-neutral-300"},[r("来源")]),e(g,{value:u.source,onUpdateValue:a=>u.source=a,placeholder:"出自哪里？"},null)])]),e("div",{class:"flex items-center justify-end gap-2 border-t border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e("span",{class:"mr-auto text-xs text-neutral-400"},[r("Cmd/Ctrl + Enter 快速保存")]),e(c,{onClick:t.onClose},{default:()=>[r("取消")]}),e(c,{type:"primary",loading:o.value,onClick:m},{default:()=>[d.value?"保存":"发布"]})])])]})}}),J=y({name:"SayEmptyState",props:{onCreate:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(k,{class:"size-8 text-neutral-400","aria-hidden":"true"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[r("暂无一言")]),e("p",{class:"mb-6 text-sm text-neutral-500 dark:text-neutral-400"},[r("记录一些有意思的话语吧")]),e(c,{type:"primary",onClick:t.onCreate},{default:()=>[r("添加第一条一言")]})])}}),X=y({name:"SayListSkeleton",setup(){return()=>e("div",{class:"animate-pulse"},[[1,2,3,4,5].map(t=>e("div",{key:t,class:"flex gap-3 border-b border-neutral-200 px-4 py-4 last:border-b-0 dark:border-neutral-800"},[e("div",{class:"size-5 rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"flex-1"},[e("div",{class:"h-5 w-full rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"mt-2 h-5 w-3/4 rounded bg-neutral-100 dark:bg-neutral-800"},null),e("div",{class:"mt-3 flex gap-4"},[e("div",{class:"h-4 w-20 rounded bg-neutral-100 dark:bg-neutral-800"},null),e("div",{class:"h-4 w-24 rounded bg-neutral-100 dark:bg-neutral-800"},null)])])]))])}}),Y=y({name:"SayList",setup(){const t=O(),u=T(),o=j(),{data:n,pager:d,isLoading:m}=V({queryKey:l=>p.says.list(l),queryFn:l=>x.getList({page:l.page,size:l.size}),pageSize:20}),v=U({mutationFn:x.delete,onSuccess:()=>{message.success("删除成功"),o.invalidateQueries({queryKey:p.says.all})}}),a=b(!1),s=b(null),h=()=>{s.value=null,a.value=!0},w=l=>{s.value=l,a.value=!0},f=()=>{a.value=!1,s.value=null},F=()=>{o.invalidateQueries({queryKey:p.says.all}),f()},E=async l=>{v.mutate(l)},{setActions:C}=N();return C(e(Q,{onClick:h,icon:e(I,null,null),name:"添加一言"},null)),()=>e("div",{class:"space-y-4"},[m.value&&n.value.length===0?e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[e(X,null,null)]):n.value.length===0?e(J,{onCreate:h},null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[n.value.map(l=>e(H,{key:l.id,say:l,onEdit:()=>w(l),onDelete:E},null))]),d.value&&d.value.totalPage>1&&e("div",{class:"flex justify-center"},[e(R,{page:d.value.currentPage,onUpdatePage:l=>{u.replace({query:{...t.query,page:l},params:{...t.params}})},pageCount:d.value.totalPage,pageSize:d.value.size,showQuickJumper:!0},null)]),e(G,{show:a.value,say:s.value,onClose:f,onSuccess:F},null)])}});export{Y as default};
