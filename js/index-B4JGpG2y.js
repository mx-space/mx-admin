import{d as P,a as y,ck as re,cM as ie,c,cu as se,cs as le,cN as oe,w as U,bf as ce,at as ue,cq as fe,H as X,b8 as de,T as me,F as he,o as pe,R,p as ve,V as _e,Q as ge,bU as G,g as we,C as Ee,am as ye,an as z}from"./index-C4z0i8Ru.js";import{T as be}from"./two-col-DVthIHst.js";const Le=P({props:{value:{type:String,required:!0},onChange:{type:Function,required:!0}},setup(n){const f=y(),d=re(n),l=ie(f,d,n.onChange,{language:"html"});return()=>c("div",{class:"relative h-full w-full"},[c("div",{ref:f,class:"relative h-full w-full"},null),!l.loaded.value&&c(se,{description:"Monaco 体积较大耐心等待加载完成..."},null)])}});var j={},k={},Z;function Te(){return Z||(Z=1,function(n){var f=/[|\\{}()[\]^$+*?.]/g,d=Object.prototype.hasOwnProperty,l=function(s,o){return d.apply(s,[o])};n.escapeRegExpChars=function(s){return s?String(s).replace(f,"\\$&"):""};var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},F=/[&<>'"]/g;function O(s){return b[s]||s}var S=`var _ENCODE_HTML_RULES = {
      "&": "&amp;"
    , "<": "&lt;"
    , ">": "&gt;"
    , '"': "&#34;"
    , "'": "&#39;"
    }
  , _MATCH_HTML = /[&<>'"]/g;
function encode_char(c) {
  return _ENCODE_HTML_RULES[c] || c;
};
`;n.escapeXML=function(s){return s==null?"":String(s).replace(F,O)};function g(){return Function.prototype.toString.call(this)+`;
`+S}try{typeof Object.defineProperty=="function"?Object.defineProperty(n.escapeXML,"toString",{value:g}):n.escapeXML.toString=g}catch{console.warn("Unable to set escapeXML.toString (is the Function prototype frozen?)")}n.shallowCopy=function(s,o){if(o=o||{},s!=null)for(var h in o)l(o,h)&&(h==="__proto__"||h==="constructor"||(s[h]=o[h]));return s},n.shallowCopyFromList=function(s,o,h){if(h=h||[],o=o||{},s!=null)for(var T=0;T<h.length;T++){var w=h[T];if(typeof o[w]<"u"){if(!l(o,w)||w==="__proto__"||w==="constructor")continue;s[w]=o[w]}}return s},n.cache={_data:{},set:function(s,o){this._data[s]=o},get:function(s){return this._data[s]},remove:function(s){delete this._data[s]},reset:function(){this._data={}}},n.hyphenToCamel=function(s){return s.replace(/-[a-z]/g,function(o){return o[1].toUpperCase()})},n.createNullProtoObjWherePossible=function(){return typeof Object.create=="function"?function(){return Object.create(null)}:{__proto__:null}instanceof Object?function(){return{}}:function(){return{__proto__:null}}}(),n.hasOwnOnlyObject=function(s){var o=n.createNullProtoObjWherePossible();for(var h in s)l(s,h)&&(o[h]=s[h]);return o}}(k)),k}const Fe="3.1.10",Oe={version:Fe};var Q;function Se(){return Q||(Q=1,function(n){/**
 * @file Embedded JavaScript templating engine. {@link http://ejs.co}
 * @author Matthew Eernisse <mde@fleegix.org>
 * @author Tiancheng "Timothy" Gu <timothygu99@gmail.com>
 * @project EJS
 * @license {@link http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0}
 */var f=oe,d=le(),l=Te(),b=!1,F=Oe.version,O="<",S=">",g="%",s="locals",o="ejs",h="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",T=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],w=T.concat("cache"),x=/^\uFEFF/,I=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;n.cache=l.cache,n.fileLoader=f.readFileSync,n.localsName=s,n.promiseImpl=new Function("return this;")().Promise,n.resolveInclude=function(t,r,e){var a=d.dirname,i=d.extname,u=d.resolve,p=u(e?r:a(r),t),E=i(t);return E||(p+=".ejs"),p};function H(t,r){var e;if(r.some(function(a){return e=n.resolveInclude(t,a,!0),f.existsSync(e)}))return e}function K(t,r){var e,a,i=r.views,u=/^[A-Za-z]+:\\|^\//.exec(t);if(u&&u.length)t=t.replace(/^\/*/,""),Array.isArray(r.root)?e=H(t,r.root):e=n.resolveInclude(t,r.root||"/",!0);else if(r.filename&&(a=n.resolveInclude(t,r.filename),f.existsSync(a)&&(e=a)),!e&&Array.isArray(i)&&(e=H(t,i)),!e&&typeof r.includer!="function")throw new Error('Could not find the include file "'+r.escapeFunction(t)+'"');return e}function A(t,r){var e,a=t.filename,i=arguments.length>1;if(t.cache){if(!a)throw new Error("cache option requires a filename");if(e=n.cache.get(a),e)return e;i||(r=q(a).toString().replace(x,""))}else if(!i){if(!a)throw new Error("Internal EJS error: no file name or template provided");r=q(a).toString().replace(x,"")}return e=n.compile(r,t),t.cache&&n.cache.set(a,e),e}function Y(t,r,e){var a;if(e){try{a=A(t)(r)}catch(i){return e(i)}e(null,a)}else{if(typeof n.promiseImpl=="function")return new n.promiseImpl(function(i,u){try{a=A(t)(r),i(a)}catch(p){u(p)}});throw new Error("Please provide a callback function")}}function q(t){return n.fileLoader(t)}function ee(t,r){var e=l.shallowCopy(l.createNullProtoObjWherePossible(),r);if(e.filename=K(t,e),typeof r.includer=="function"){var a=r.includer(t,e.filename);if(a&&(a.filename&&(e.filename=a.filename),a.template))return A(e,a.template)}return A(e)}function B(t,r,e,a,i){var u=r.split(`
`),p=Math.max(a-3,0),E=Math.min(u.length,a+3),_=i(e),L=u.slice(p,E).map(function(C,D){var N=D+p+1;return(N==a?" >> ":"    ")+N+"| "+C}).join(`
`);throw t.path=_,t.message=(_||"ejs")+":"+a+`
`+L+`

`+t.message,t}function V(t){return t.replace(/;(\s*$)/,"$1")}n.compile=function(r,e){var a;return e&&e.scope&&(b||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),b=!0),e.context||(e.context=e.scope),delete e.scope),a=new m(r,e),a.compile()},n.render=function(t,r,e){var a=r||l.createNullProtoObjWherePossible(),i=e||l.createNullProtoObjWherePossible();return arguments.length==2&&l.shallowCopyFromList(i,a,T),A(i,t)(a)},n.renderFile=function(){var t=Array.prototype.slice.call(arguments),r=t.shift(),e,a={filename:r},i,u;return typeof arguments[arguments.length-1]=="function"&&(e=t.pop()),t.length?(i=t.shift(),t.length?l.shallowCopy(a,t.pop()):(i.settings&&(i.settings.views&&(a.views=i.settings.views),i.settings["view cache"]&&(a.cache=!0),u=i.settings["view options"],u&&l.shallowCopy(a,u)),l.shallowCopyFromList(a,i,w)),a.filename=r):i=l.createNullProtoObjWherePossible(),Y(a,i,e)},n.Template=m,n.clearCache=function(){n.cache.reset()};function m(t,r){var e=l.hasOwnOnlyObject(r),a=l.createNullProtoObjWherePossible();this.templateText=t,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",a.client=e.client||!1,a.escapeFunction=e.escape||e.escapeFunction||l.escapeXML,a.compileDebug=e.compileDebug!==!1,a.debug=!!e.debug,a.filename=e.filename,a.openDelimiter=e.openDelimiter||n.openDelimiter||O,a.closeDelimiter=e.closeDelimiter||n.closeDelimiter||S,a.delimiter=e.delimiter||n.delimiter||g,a.strict=e.strict||!1,a.context=e.context,a.cache=e.cache||!1,a.rmWhitespace=e.rmWhitespace,a.root=e.root,a.includer=e.includer,a.outputFunctionName=e.outputFunctionName,a.localsName=e.localsName||n.localsName||s,a.views=e.views,a.async=e.async,a.destructuredLocals=e.destructuredLocals,a.legacyInclude=typeof e.legacyInclude<"u"?!!e.legacyInclude:!0,a.strict?a._with=!1:a._with=typeof e._with<"u"?e._with:!0,this.opts=a,this.regex=this.createRegex()}m.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},m.prototype={createRegex:function(){var t=h,r=l.escapeRegExpChars(this.opts.delimiter),e=l.escapeRegExpChars(this.opts.openDelimiter),a=l.escapeRegExpChars(this.opts.closeDelimiter);return t=t.replace(/%/g,r).replace(/</g,e).replace(/>/g,a),new RegExp(t)},compile:function(){var t,r,e=this.opts,a="",i="",u=e.escapeFunction,p,E=e.filename?JSON.stringify(e.filename):"undefined";if(!this.source){if(this.generateSource(),a+=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
`,e.outputFunctionName){if(!I.test(e.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");a+="  var "+e.outputFunctionName+` = __append;
`}if(e.localsName&&!I.test(e.localsName))throw new Error("localsName is not a valid JS identifier.");if(e.destructuredLocals&&e.destructuredLocals.length){for(var _="  var __locals = ("+e.localsName+` || {}),
`,L=0;L<e.destructuredLocals.length;L++){var C=e.destructuredLocals[L];if(!I.test(C))throw new Error("destructuredLocals["+L+"] is not a valid JS identifier.");L>0&&(_+=`,
  `),_+=C+" = __locals."+C}a+=_+`;
`}e._with!==!1&&(a+="  with ("+e.localsName+` || {}) {
`,i+=`  }
`),i+=`  return __output;
`,this.source=a+this.source+i}e.compileDebug?t=`var __line = 1
  , __lines = `+JSON.stringify(this.templateText)+`
  , __filename = `+E+`;
try {
`+this.source+`} catch (e) {
  rethrow(e, __lines, __filename, __line, escapeFn);
}
`:t=this.source,e.client&&(t="escapeFn = escapeFn || "+u.toString()+`;
`+t,e.compileDebug&&(t="rethrow = rethrow || "+B.toString()+`;
`+t)),e.strict&&(t=`"use strict";
`+t),e.debug&&console.log(t),e.compileDebug&&e.filename&&(t=t+`
//# sourceURL=`+E+`
`);try{if(e.async)try{p=new Function("return (async function(){}).constructor;")()}catch(v){throw v instanceof SyntaxError?new Error("This environment does not support async/await"):v}else p=Function;r=new p(e.localsName+", escapeFn, include, rethrow",t)}catch(v){throw v instanceof SyntaxError&&(e.filename&&(v.message+=" in "+e.filename),v.message+=` while compiling ejs

`,v.message+=`If the above error is not helpful, you may want to try EJS-Lint:
`,v.message+="https://github.com/RyanZim/EJS-Lint",e.async||(v.message+=`
`,v.message+="Or, if you meant to create an async function, pass `async: true` as an option.")),v}var D=e.client?r:function($){var ae=function(ne,J){var M=l.shallowCopy(l.createNullProtoObjWherePossible(),$);return J&&(M=l.shallowCopy(M,J)),ee(ne,e)(M)};return r.apply(e.context,[$||l.createNullProtoObjWherePossible(),u,ae,B])};if(e.filename&&typeof Object.defineProperty=="function"){var N=e.filename,te=d.basename(N,d.extname(N));try{Object.defineProperty(D,"name",{value:te,writable:!1,enumerable:!1,configurable:!0})}catch{}}return D},generateSource:function(){var t=this.opts;t.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var r=this,e=this.parseTemplateText(),a=this.opts.delimiter,i=this.opts.openDelimiter,u=this.opts.closeDelimiter;e&&e.length&&e.forEach(function(p,E){var _;if(p.indexOf(i+a)===0&&p.indexOf(i+a+a)!==0&&(_=e[E+2],!(_==a+u||_=="-"+a+u||_=="_"+a+u)))throw new Error('Could not find matching close tag for "'+p+'".');r.scanLine(p)})},parseTemplateText:function(){for(var t=this.templateText,r=this.regex,e=r.exec(t),a=[],i;e;)i=e.index,i!==0&&(a.push(t.substring(0,i)),t=t.slice(i)),a.push(e[0]),t=t.slice(e[0].length),e=r.exec(t);return t&&a.push(t),a},_addOutput:function(t){if(this.truncate&&(t=t.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!t)return t;t=t.replace(/\\/g,"\\\\"),t=t.replace(/\n/g,"\\n"),t=t.replace(/\r/g,"\\r"),t=t.replace(/"/g,'\\"'),this.source+='    ; __append("'+t+`")
`},scanLine:function(t){var r=this,e=this.opts.delimiter,a=this.opts.openDelimiter,i=this.opts.closeDelimiter,u=0;switch(u=t.split(`
`).length-1,t){case a+e:case a+e+"_":this.mode=m.modes.EVAL;break;case a+e+"=":this.mode=m.modes.ESCAPED;break;case a+e+"-":this.mode=m.modes.RAW;break;case a+e+"#":this.mode=m.modes.COMMENT;break;case a+e+e:this.mode=m.modes.LITERAL,this.source+='    ; __append("'+t.replace(a+e+e,a+e)+`")
`;break;case e+e+i:this.mode=m.modes.LITERAL,this.source+='    ; __append("'+t.replace(e+e+i,e+i)+`")
`;break;case e+i:case"-"+e+i:case"_"+e+i:this.mode==m.modes.LITERAL&&this._addOutput(t),this.mode=null,this.truncate=t.indexOf("-")===0||t.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case m.modes.EVAL:case m.modes.ESCAPED:case m.modes.RAW:t.lastIndexOf("//")>t.lastIndexOf(`
`)&&(t+=`
`)}switch(this.mode){case m.modes.EVAL:this.source+="    ; "+t+`
`;break;case m.modes.ESCAPED:this.source+="    ; __append(escapeFn("+V(t)+`))
`;break;case m.modes.RAW:this.source+="    ; __append("+V(t)+`)
`;break;case m.modes.COMMENT:break;case m.modes.LITERAL:this._addOutput(t);break}}else this._addOutput(t)}r.opts.compileDebug&&u&&(this.currentLine+=u,this.source+="    ; __line = "+this.currentLine+`
`)}},n.escapeXML=l.escapeXML,n.__express=n.renderFile,n.VERSION=F,n.name=o,typeof window<"u"&&(window.ejs=n)}(j)),j}var Ae=Se();const Ce=P({props:{template:{type:String,required:!0},data:{type:Object,required:!0},onError:{type:Function}},setup(n){const f=y("");return U(()=>n.template,async()=>{f.value=await Ae.render(n.template,n.data,{async:!0}).catch(d=>(n.onError?.(d),console.error(d),f.value))},{immediate:!0}),()=>c("div",{class:"h-full overflow-auto  bg-white"},[c("div",{innerHTML:f.value},null)])}});let W=function(n){return n.Owner="owner",n.Guest="guest",n}({}),Ne=function(n){return n.Newsletter="newsletter",n}({});const Pe=P({setup(){const n=y(""),f=y(""),d=y(W.Guest),l=y(null),{setHeaderButtons:b}=ce(),F=async()=>{await R.api.options.email.template.put({params:{type:d.value},data:{source:f.value}}),await g()},O=ue(),S=()=>{O.warning({title:"确认重置？",content:"重置后，模板将被恢复为默认模板",async onNegativeClick(){await R.api.options.email.template.delete({params:{type:d.value}}),await g()},onPositiveClick(){},negativeText:"嗯",positiveText:"达咩"})};fe(()=>(b(c(he,null,[c(X,{icon:c(de,null,null),name:"提交",onClick:F,variant:"success"},null),c(X,{icon:c(me,null,null),name:"重置自定义模板",onClick:S,variant:"error"},null)])),()=>{b(null)})),pe(()=>{g()});const g=async()=>{const{template:o,props:h}=await R.api.options.email.template.get({params:{type:d.value},transform:!1});n.value=o,f.value=o,l.value=h};U(()=>d.value,g);const s=y(!1);return U(()=>f.value,()=>{s.value=!1}),()=>c("div",null,[c(ve,{class:"w-[300px]"},{default:()=>[c(_e,{label:"模板类型",labelPlacement:"left"},{default:()=>[c(ge,{value:d.value,onUpdateValue:o=>d.value=o,options:[{label:"回复邮件（访客）",value:W.Guest},{label:"回复邮件（博主）",value:W.Owner},{label:"订阅邮件",value:Ne.Newsletter}]},null)]})]}),c("div",{class:"pb-4"},null),c(be,null,{default:()=>[c(G,{span:18,class:s.value&&"outline outline-[3px] outline-red-300"},{default:()=>[c(Le,{onChange:o=>{f.value=o},value:n.value},null)]}),c(G,{span:18,class:"relative h-[calc(100vh-15rem)] "},{default:()=>[c(Ce,{data:l.value,template:f.value,onError:o=>{s.value=!0}},null)]})]})])}}),De=P({setup(){return()=>c("div",null,[we("即将推出")])}}),Re=P({setup(){const n=y("1");return()=>c(Ee,null,{default:()=>[c(ye,{value:n.value,size:"medium",onUpdateValue:f=>{n.value=f}},{default:()=>[c(z,{name:"1",tab:"邮件模板"},{default:()=>[c(Pe,null,null)]}),c(z,{name:"2",tab:"预览 Markdown 模板"},{default:()=>[c(De,null,null)]})]})]})}});export{Re as default};
