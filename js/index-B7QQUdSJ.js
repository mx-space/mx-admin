import{c as j,ar as v,cq as L,cr as z,cs as T,ct as P,d as b,u as h,a as i,r as R,h as U,w as M,i as e,av as O,j as s,bS as V,J as H,B as y,bU as I,N as o,K,n as X,T as _,bX as J,aw as Q,H as B,bt as Y,Y as $}from"./index-qXdkAhVq.js";import{M as S}from"./mail-BqpvHMpa.js";import{D as G}from"./download-CfobbG51.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=j("mail-x",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h9",key:"1j9vog"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m17 17 4 4",key:"1b3523"}],["path",{d:"m21 17-4 4",key:"uinynz"}]]),m={getStatus:()=>v.get("/subscribe/status"),getList:t=>v.get("/subscribe",{params:t}),unsubscribe:t=>v.get("/subscribe/unsubscribe",{params:t}),export:()=>v.get("/subscribe/export")},Z=new Map([[L,"博文"],[z,"手记"],[T,"速记"],[P,"说说"]]);function ee(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Q(t)}const k=b({props:{title:{type:String,required:!0}},setup(t,{slots:r}){return()=>e("div",{class:"mb-4"},[e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-medium text-neutral-700 dark:text-neutral-300"},[t.title]),r.extra?.()]),e("div",{class:"mt-2 h-px bg-neutral-200 dark:bg-neutral-700"},null)])}}),w=b({props:{icon:{type:Object,required:!0},label:{type:String,required:!0},value:{type:[String,Number],required:!0},description:{type:String},variant:{type:String,default:"default"}},setup(t){const r={default:"bg-neutral-50 dark:bg-neutral-800/50",success:"bg-green-50 dark:bg-green-950/30",warning:"bg-amber-50 dark:bg-amber-950/30"},a={default:"text-neutral-400",success:"text-green-500",warning:"text-amber-500"};return()=>e("div",{class:["flex items-center gap-4 rounded-lg p-4",r[t.variant]]},[e("div",{class:["shrink-0 text-2xl",a[t.variant]]},[t.icon]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"text-2xl font-semibold tabular-nums"},[typeof t.value=="number"?Intl.NumberFormat("zh-CN").format(t.value):t.value]),e("div",{class:"text-xs text-neutral-500"},[t.label]),t.description&&e("div",{class:"mt-1 text-xs text-neutral-400"},[t.description])])])}}),te=b({props:{email:{type:String,required:!0},subscribe:{type:Number,required:!0},created:{type:String,required:!0},onDelete:{type:Function,required:!0}},setup(t){const r=i(()=>{const a=[];for(const[n,c]of Z.entries())n&t.subscribe&&a.push(e(J,{size:"small",round:!0,bordered:!1,class:"!bg-neutral-100 !text-neutral-600 dark:!bg-neutral-700 dark:!text-neutral-300"},ee(c)?c:{default:()=>[c]}));return a});return()=>e("div",{class:"group flex items-center gap-4 rounded-lg border border-neutral-200 bg-white p-4 transition-colors hover:border-neutral-300 dark:border-neutral-700 dark:bg-neutral-800/50 dark:hover:border-neutral-600"},[e("div",{class:"flex size-10 shrink-0 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-700"},[e(S,{class:"size-5 text-neutral-500 dark:text-neutral-400"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"truncate font-medium text-neutral-800 dark:text-neutral-200"},[t.email]),e("div",{class:"mt-1.5 flex flex-wrap items-center gap-1.5"},[r.value])]),e("div",{class:"flex shrink-0 items-center gap-3"},[e("div",{class:"text-right"},[e("div",{class:"text-xs text-neutral-400"},[s("订阅于")]),e("div",{class:"text-sm text-neutral-500"},[e(K,{time:t.created},null)])]),e(X,{positiveText:"取消",negativeText:"删除",onNegativeClick:t.onDelete},{trigger:()=>e("button",{class:"rounded-lg p-2 text-neutral-400 opacity-0 transition-all hover:bg-red-50 hover:text-red-500 group-hover:opacity-100 dark:hover:bg-red-950/50","aria-label":"删除订阅者"},[e(_,{class:"size-4"},null)]),default:()=>e("span",{class:"max-w-48"},[s("确定要移除该订阅者吗？")])})])])}}),ae=b({setup(){return()=>e("div",{class:"flex items-center gap-4 rounded-lg border border-neutral-200 bg-white p-4 dark:border-neutral-700 dark:bg-neutral-800/50"},[e(o,{circle:!0,width:40,height:40},null),e("div",{class:"flex-1 space-y-2"},[e(o,{text:!0,width:"60%"},null),e(o,{text:!0,width:"40%"},null)]),e("div",{class:"space-y-1 text-right"},[e(o,{text:!0,width:60},null),e(o,{text:!0,width:80},null)])])}}),re=b({setup(){const{data:t,refetch:r}=h({queryKey:["subscribe","status"],queryFn:()=>m.getStatus()}),a=i(()=>t.value?.enabled??!1),n=R(1),c=20,{data:x,isLoading:A,refetch:p}=h({queryKey:i(()=>["subscribe","list",n.value]),queryFn:()=>m.getList({page:n.value,size:c})}),f=i(()=>x.value?.data??[]),l=i(()=>x.value?.pagination),F=i(()=>l.value?.total??0),E=async()=>{await I.patch("featureList",{emailSubscribe:!a.value}),r()},C=async u=>{await m.unsubscribe({email:u}),message.success("已移除订阅者"),p()},N=async()=>{try{const u=await m.export(),g=window.URL.createObjectURL(u),d=document.createElement("a");d.href=g,d.download=`subscribers-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(g),document.body.removeChild(d),message.success("导出成功")}catch{message.error("导出失败")}},q=()=>{p(),r()},{setActions:D}=U();return M(()=>{D(e($,null,[e(B,{icon:e(Y,null,null),onClick:q,name:"刷新"},null),e(B,{icon:e(G,null,null),onClick:N,name:"导出订阅者",variant:"info"},null)]))}),()=>e("div",{class:"space-y-8"},[e("section",null,[e(k,{title:"概览"},null),e("div",{class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},[e(w,{icon:e(O,null,null),label:"总订阅者",value:F.value,variant:"default"},null),e(w,{icon:a.value?e(S,null,null):e(W,null,null),label:"订阅功能",value:a.value?"已启用":"已禁用",variant:a.value?"success":"warning"},null),e("div",{class:"flex items-center justify-between rounded-lg bg-neutral-50 p-4 dark:bg-neutral-800/50"},[e("div",null,[e("div",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[s("启用邮件订阅")]),e("div",{class:"mt-1 text-xs text-neutral-500"},[s("允许访客订阅新内容通知")])]),e(V,{value:a.value,onUpdateValue:E},null)])])]),e("section",null,[e(k,{title:"订阅者列表"},{extra:()=>l.value&&e("span",{class:"text-sm text-neutral-500"},[s("共 "),l.value.total,s(" 位订阅者")])}),A.value?e("div",{class:"space-y-3"},[Array.from({length:5}).map((u,g)=>e(ae,{key:g},null))]):f.value.length===0?e("div",{class:"rounded-lg border border-dashed border-neutral-200 py-16 dark:border-neutral-700"},[e(H,{description:"暂无订阅者"},{extra:()=>e("div",{class:"mt-2 text-sm text-neutral-500"},[s("开启订阅功能后，访客可以订阅您的内容更新")])})]):e("div",{class:"space-y-3"},[f.value.map(u=>e(te,{key:u.id,email:u.email,subscribe:u.subscribe,created:u.created,onDelete:()=>C(u.email)},null))]),l.value&&l.value.totalPage>1&&e("div",{class:"mt-6 flex items-center justify-center gap-2"},[e(y,{size:"small",disabled:!l.value.hasPrevPage,onClick:()=>n.value=n.value-1},{default:()=>[s("上一页")]}),e("span",{class:"px-4 text-sm text-neutral-500"},[l.value.currentPage,s(" / "),l.value.totalPage]),e(y,{size:"small",disabled:!l.value.hasNextPage,onClick:()=>n.value=n.value+1},{default:()=>[s("下一页")]})])])])}});export{re as default};
