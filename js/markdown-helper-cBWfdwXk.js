const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index-R5yA_R4y.js","assets/index-BfXH-7zy.css"])))=>i.map(i=>d[i]);
import{c as E,ar as O,ca as U,ci as V,d as H,r as v,f as Y,a as L,o as J,cz as q,p as R,i as e,v as N,j as n,V as W,B as g,bJ as X,W as G,bS as K,s as Q,bX as Z,cA as ee,T as te}from"./index-R5yA_R4y.js";import{U as ae}from"./upload-fzzLb6Li.js";import{F as le}from"./file-text-Cg4mMqcI.js";import{D as se}from"./download-DU3QHgyF.js";import{a as re}from"./Upload-D5pi52BF.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=E("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=E("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=E("file-down",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=E("file-up",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),I={import:u=>O.post("/markdown/import",{data:u}),export:async u=>{const{$api:s}=await U(async()=>{const{$api:a}=await import("./index-R5yA_R4y.js").then(o=>o.dU);return{$api:a}},__vite__mapDeps([0,1]));return s("/markdown/export",{params:u,responseType:"blob"})}};class de{constructor(s){this.strList=s,this.strList=s}parse(s){const a=s,o=/-{3,}\r?\n(.*?)-{3,}\r?\n*(.*)$/gms.exec(a);if(!o)return{text:a};const p=o.pop(),m=V(o[1]),r={},{categories:c,tags:A,date:f,updated:k,created:b,title:B}=m;return(f||b)&&(r.date=new Date(f||b).toISOString()),k&&(r.updated=new Date(k).toISOString()),r.categories=c,r.tags=A,r.title=B,Object.keys(r).forEach(F=>{typeof r[F]>"u"&&delete r[F]}),{meta:r,text:p}}start(){const s=this.strList,a=[];for(const[o,p]of s.entries())try{a.push(this.parse(p))}catch(m){throw{idx:o,err:m}}return a}}var w=(function(u){return u.Post="post",u.Note="note",u})(w||{});const ce=[{value:w.Post,label:"博文"},{label:"日记",value:w.Note}],xe=H({name:"MarkdownHelper",setup(){const u=v(w.Post),s=v([]),a=v([]),o=v(!1),p=v(!1),m=v(!1),r=v(!1),c=Y(),A=L(()=>s.value.length>0),f=L(()=>a.value.length>0);function k(t){return new de(t).start().map((l,d)=>{const y=(s.value[d].file?.name??"").replace(/\.md$/,"");return l.meta?l.meta.slug=l.meta.slug??y:l.meta={title:y,slug:y},l.meta?.date||(l.meta.date=new Date().toISOString()),l})}async function b(t){if(!A.value){c.warning("请先选择文件");return}o.value=!0;const i=[];try{for(const d of s.value){const h=await new Promise((y,M)=>{const x=d.file;if(!x){M(new Error("文件不存在"));return}const D=x.name.split(".").pop();if(x.type&&x.type!=="text/markdown"||!["md","markdown"].includes(D)){M(new Error(`只能解析 Markdown 文件，当前文件类型：${x.type||D}`));return}const S=new FileReader;S.addEventListener("load",j=>{y(j.target?.result||"")}),S.addEventListener("error",()=>{M(new Error("文件读取失败"))}),S.readAsText(x)});i.push(h)}const l=k(i);a.value=l.map((d,h)=>({...d,filename:s.value[h].file?.name??""})),c.success(`成功解析 ${l.length} 个文件`)}catch(l){c.error(l.message||"解析失败"),console.error(l)}finally{o.value=!1}}function B(t){if(t.stopPropagation(),t.preventDefault(),!f.value){c.warning("请先解析文件");return}r.value=!0}async function F(){p.value=!0;try{await I.import({type:u.value,data:a.value}),c.success(`成功导入 ${a.value.length} 条数据`),s.value=[],a.value=[]}catch(t){c.error(t.message||"导入失败")}finally{p.value=!1,r.value=!1}}const C=J({includeYAMLHeader:!0,titleBigTitle:!1,filenameSlug:!1,withMetaJson:!0});async function T(){m.value=!0;try{const{includeYAMLHeader:t,filenameSlug:i,withMetaJson:l,titleBigTitle:d}=C,h=await I.export({slug:i,yaml:t,show_title:d,with_meta_json:l});ee(h,"markdown.zip"),c.success("导出成功")}catch(t){c.error(t.message||"导出失败")}finally{m.value=!1}}const z=q(t=>{s.value=t},250);R(s,t=>{t.length===0?a.value=[]:b()});function P(t){const i=t.file.name,l=a.value.findIndex(d=>d.filename===i);l!==-1&&a.value.splice(l,1)}const _=[{title:"文件名",key:"filename",width:200,ellipsis:{tooltip:!0}},{title:"标题",key:"meta.title",ellipsis:{tooltip:!0},render:t=>t.meta?.title||"—"},{title:"Slug",key:"meta.slug",width:150,ellipsis:{tooltip:!0},render:t=>t.meta?.slug||"—"},{title:"日期",key:"meta.date",width:180,render:t=>t.meta?.date?new Intl.DateTimeFormat("zh-CN",{dateStyle:"medium",timeStyle:"short"}).format(new Date(t.meta.date)):"—"},{title:"操作",key:"actions",width:80,render:t=>e(g,{size:"small",quaternary:!0,type:"error","aria-label":`删除 ${t.filename}`,onClick:()=>{const i=a.value.findIndex(l=>l.filename===t.filename);if(i!==-1){a.value.splice(i,1);const l=s.value.findIndex(d=>d.file?.name===t.filename);l!==-1&&s.value.splice(l,1)}}},{default:()=>[e(te,{class:"h-4 w-4"},null)]})}],$=[{id:"includeYAMLHeader",label:"包含 YAML 头部",description:"在文件开头添加 Front Matter 元数据"},{id:"titleBigTitle",label:"首行显示标题",description:"在正文第一行添加 # 标题"},{id:"filenameSlug",label:"使用 Slug 作为文件名",description:"用 slug 而非标题命名文件"},{id:"withMetaJson",label:"导出元数据 JSON",description:"附带完整的元数据 JSON 文件"}];return()=>e("div",{class:"space-y-6"},[e(N,{title:"从 Markdown 导入",class:"overflow-hidden",headerExtra:()=>e("div",{class:"flex items-center gap-2"},[e(oe,{class:"h-5 w-5 text-neutral-400"},null)])},{default:()=>[e("div",{class:"space-y-4"},[e("div",{class:"flex items-center gap-4"},[e("label",{id:"import-type-label",class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[n("导入到")]),e(W,{options:ce,value:u.value,onUpdateValue:t=>u.value=t,class:"w-32","aria-labelledby":"import-type-label"},null)]),e(re,{multiple:!0,accept:".md,.markdown",onChange:t=>z(t.fileList),onRemove:P,showFileList:!f.value},{default:()=>[e("div",{class:"flex w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-neutral-300 bg-neutral-50 px-6 py-8 transition-colors hover:border-blue-400 hover:bg-blue-50/50 dark:border-neutral-700 dark:bg-neutral-800/50 dark:hover:border-blue-500 dark:hover:bg-blue-900/20"},[e(ae,{class:"mb-3 h-10 w-10 text-neutral-400"},null),e("p",{class:"mb-1 text-sm font-medium text-neutral-700 dark:text-neutral-300"},[n("点击或拖拽上传 Markdown 文件")]),e("p",{class:"text-xs text-neutral-500"},[n("支持 .md、.markdown 格式，可多选")])])]}),f.value&&e("div",{class:"space-y-3"},[e("div",{class:"flex items-center justify-between"},[e("div",{class:"flex items-center gap-2"},[e(ue,{class:"h-4 w-4 text-green-500"},null),e("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[n("已解析 "),a.value.length,n(" 个文件")])]),e(g,{size:"small",quaternary:!0,onClick:()=>{s.value=[],a.value=[]}},{default:()=>[n("清空")]})]),e(X,{columns:_,data:a.value,bordered:!0,size:"small",maxHeight:300,scrollX:700},null)]),o.value&&e("div",{class:"flex items-center justify-center py-4"},[e(G,{size:"small"},null),e("span",{class:"ml-2 text-sm text-neutral-500"},[n("解析中…")])]),e("div",{class:"flex justify-end gap-2 border-t border-neutral-200 pt-4 dark:border-neutral-700"},[e(g,{onClick:B,type:"primary",disabled:!f.value||p.value,loading:p.value,renderIcon:()=>e(le,{class:"h-4 w-4"},null)},{default:()=>[n("导入")," ",f.value?`${a.value.length} 条数据`:"数据"]})])])]}),e(N,{title:"导出为 Markdown",class:"overflow-hidden",headerExtra:()=>e("div",{class:"flex items-center gap-2"},[e(ie,{class:"h-5 w-5 text-neutral-400"},null)])},{default:()=>[e("div",{class:"space-y-4"},[e("p",{class:"text-sm text-neutral-500"},[n("导出所有博文和日记为 Markdown 文件（Hexo YAML 格式）")]),e("div",{class:"grid gap-3 sm:grid-cols-2"},[$.map(t=>e("label",{key:t.id,class:"flex cursor-pointer items-start gap-3 rounded-lg border border-neutral-200 p-3 transition-colors hover:bg-neutral-50 dark:border-neutral-700 dark:hover:bg-neutral-800"},[e(K,{value:C[t.id],onUpdateValue:i=>C[t.id]=i,"aria-describedby":`${t.id}-desc`},null),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[t.label]),e("div",{id:`${t.id}-desc`,class:"text-xs text-neutral-500"},[t.description])])]))]),e("div",{class:"flex justify-end border-t border-neutral-200 pt-4 dark:border-neutral-700"},[e(g,{type:"primary",onClick:T,loading:m.value,disabled:m.value,renderIcon:()=>e(se,{class:"h-4 w-4"},null)},{default:()=>[n("导出 Markdown 压缩包")]})])])]}),e(Q,{show:r.value,onUpdateShow:t=>r.value=t,preset:"card",title:"确认导入",style:{width:"400px",maxWidth:"90vw"}},{default:()=>[e("div",{class:"space-y-4"},[e("div",{class:"flex items-start gap-3"},[e(ne,{class:"mt-0.5 h-5 w-5 flex-shrink-0 text-amber-500"},null),e("div",null,[e("p",{class:"text-sm text-neutral-700 dark:text-neutral-300"},[n("即将导入 "),e("strong",null,[a.value.length]),n(" 条数据到"),e(Z,{size:"small",class:"mx-1"},{default:()=>[u.value===w.Post?"博文":"日记"]})]),e("p",{class:"mt-1 text-xs text-neutral-500"},[n("此操作会创建新的内容，请确认数据无误")])])]),e("div",{class:"flex justify-end gap-2"},[e(g,{onClick:()=>r.value=!1},{default:()=>[n("取消")]}),e(g,{type:"primary",onClick:F,loading:p.value},{default:()=>[n("确认导入")]})])])]})])}});export{xe as default};
