import{c as V,ba as K,bb as Y,d as o,as as C,a_ as Q,bc as W,bd as F,be as x,bf as J,bg as H,a as y,bh as X,bi as Z,bj as ee,bk as te,bl as ae,bm as ne,bn as k,a0 as le,h as e,u as R,g as se,P as w,H as re,aY as ue,G as ie,aL as S,r as p,N as h,bo as I,B as T,i as m,Y as v,bp as q,bq as D,ay as g,l as E,m as P,br as f,T as L,q as z,$ as oe,aM as ce,R as B,z as N}from"./index-DoEgFLcO.js";import{A as me}from"./arrow-left-CH7IVZ35.js";import{C as M}from"./calendar-Dmu97VkP.js";import{F as b}from"./file-text-CxNLTwjh.js";import{C as de}from"./chevron-right-CEOKKkLg.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=V("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),ye=K("collapse-transition",{width:"100%"},[Y()]),pe=Object.assign(Object.assign({},x.props),{show:{type:Boolean,default:!0},appear:Boolean,collapsed:{type:Boolean,default:void 0}}),fe=o({name:"CollapseTransition",props:pe,inheritAttrs:!1,setup(t){const{mergedClsPrefixRef:n,inlineThemeDisabled:l,mergedRtlRef:s}=F(t),i=x("CollapseTransition","-collapse-transition",ye,J,t,n),r=H("CollapseTransition",s,n),d=y(()=>t.collapsed!==void 0?t.collapsed:t.show),c=y(()=>{const{self:{bezier:_}}=i.value;return{"--n-bezier":_}}),u=l?X("collapse-transition",void 0,c,t):void 0;return{rtlEnabled:r,mergedShow:d,mergedClsPrefix:n,cssVars:l?void 0:c,themeClass:u?.themeClass,onRender:u?.onRender}},render(){return C(W,{appear:this.appear},{default:()=>{var t;if(this.mergedShow)return(t=this.onRender)===null||t===void 0||t.call(this),C("div",Q({class:[`${this.mergedClsPrefix}-collapse-transition`,this.rtlEnabled&&`${this.mergedClsPrefix}-collapse-transition--rtl`,this.themeClass],style:this.cssVars},this.$attrs),this.$slots)}})}}),ge=Object.assign(Object.assign({},x.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,reverse:Boolean,size:{type:[String,Number,Array],default:"medium"},wrap:{type:Boolean,default:!0}}),j=o({name:"Flex",props:ge,setup(t){const{mergedClsPrefixRef:n,mergedRtlRef:l}=F(t),s=x("Flex","-flex",void 0,te,t,n);return{rtlEnabled:H("Flex",l,n),mergedClsPrefix:n,margin:y(()=>{const{size:r}=t;if(Array.isArray(r))return{horizontal:r[0],vertical:r[1]};if(typeof r=="number")return{horizontal:r,vertical:r};const{self:{[ae("gap",r)]:d}}=s.value,{row:c,col:u}=ne(d);return{horizontal:k(u),vertical:k(c)}})}},render(){const{vertical:t,reverse:n,align:l,inline:s,justify:i,margin:r,wrap:d,mergedClsPrefix:c,rtlEnabled:u}=this,_=Z(ee(this),!1);return _.length?C("div",{role:"none",class:[`${c}-flex`,u&&`${c}-flex--rtl`],style:{display:s?"inline-flex":"flex",flexDirection:t&&!n?"column":t&&n?"column-reverse":!t&&n?"row-reverse":"row",justifyContent:i,flexWrap:!d||t?"nowrap":"wrap",alignItems:l,gap:`${r.vertical}px ${r.horizontal}px`}},_):null}}),_e="_container_1qfxn_2",ve="_list_1qfxn_7",xe="_articleGroup_1qfxn_12",he="_articleHeader_1qfxn_20",be="_expandToggle_1qfxn_28",Ce="_expandIcon_1qfxn_48",Ie="_articleHeaderLink_1qfxn_52",Te="_articleTypeIcon_1qfxn_56",qe="_articleHeaderTitle_1qfxn_60",ke="_articleTypeBadge_1qfxn_72",Be="_summaryCount_1qfxn_80",Ae="_manageLink_1qfxn_88",Fe="_summariesList_1qfxn_103",He="_summaryItem_1qfxn_112",Re="_summaryItemActions_1qfxn_118",we="_summaryItemHeader_1qfxn_128",Se="_summaryTime_1qfxn_132",De="_timeIcon_1qfxn_140",Ee="_summaryItemContent_1qfxn_144",Pe="_card_1qfxn_154",Le="_actions_1qfxn_160",ze="_cardHeader_1qfxn_171",Ne="_langBadge_1qfxn_203",Me="_summaryContent_1qfxn_212",$e="_summaryText_1qfxn_216",je="_summaryTextCollapsed_1qfxn_224",Ge="_expandButton_1qfxn_228",Oe="_cardFooter_1qfxn_237",Ue="_meta_1qfxn_241",Ve="_metaItem_1qfxn_249",Ke="_metaIcon_1qfxn_253",Ye="_actionButton_1qfxn_263",Qe="_deleteButton_1qfxn_287",We="_empty_1qfxn_298",Je="_emptyIcon_1qfxn_302",Xe="_emptyTitle_1qfxn_314",Ze="_emptyDescription_1qfxn_322",et="_skeleton_1qfxn_331",tt="_skeletonHeader_1qfxn_339",at="_skeletonContent_1qfxn_343",nt="_pagination_1qfxn_352",lt="_pageHeader_1qfxn_368",st="_backButton_1qfxn_372",rt="_pageTitle_1qfxn_392",a={container:_e,list:ve,articleGroup:xe,articleHeader:he,expandToggle:be,expandIcon:Ce,articleHeaderLink:Ie,articleTypeIcon:Te,articleHeaderTitle:qe,articleTypeBadge:ke,summaryCount:Be,manageLink:Ae,summariesList:Fe,summaryItem:He,summaryItemActions:Re,summaryItemHeader:we,summaryTime:Se,timeIcon:De,summaryItemContent:Ee,card:Pe,actions:Le,cardHeader:ze,langBadge:Ne,summaryContent:Me,summaryText:$e,summaryTextCollapsed:je,expandButton:Ge,cardFooter:Oe,meta:Ue,metaItem:Ve,metaIcon:Ke,actionButton:Ye,deleteButton:Qe,empty:We,emptyIcon:Je,emptyTitle:Xe,emptyDescription:Ze,skeleton:et,skeletonHeader:tt,skeletonContent:at,pagination:nt,pageHeader:lt,backButton:st,pageTitle:rt},ut={Post:"文章",Note:"笔记",Page:"页面",Recently:"速记"},it={Post:b,Note:ce,Page:b,Recently:b},xt=o({setup(){const t=le();return()=>{const n=t.query.refId;return e("div",{class:a.container},[n?e(dt,{refId:n},null):e(ot,null,null)])}}}),ot=o({setup(){const t=p(1),{data:n,refetch:l,isPending:s}=R({queryKey:y(()=>z.ai.summariesGrouped({page:t.value})),queryFn:()=>f.getSummariesGrouped({page:t.value})}),i=y(()=>s.value);return()=>e(S,{name:"fade",mode:"out-in"},{default:()=>[i.value?e(O,{key:"loading"},null):!n.value||n.value.data.length===0?e(G,{key:"empty"},null):e("div",{key:"content"},[e("div",{class:a.list,role:"feed","aria-label":"AI 摘要列表"},[n.value.data.map(r=>e(ct,{key:r.article.id,article:r.article,summaries:r.summaries,onMutate:l},null))]),n.value.pagination.totalPage>1&&e("div",{class:a.pagination},[e(oe,{page:n.value.pagination.currentPage,pageCount:n.value.pagination.totalPage,onUpdatePage:r=>{t.value=r,l()}},null)])])]})}}),ct=o({props:{article:{type:Object,required:!0},summaries:{type:Array,required:!0},onMutate:{type:Function,required:!0}},setup(t){const n=p(!0),l=it[t.article.type];return()=>e("section",{class:a.articleGroup,"aria-label":`${t.article.title} 的摘要`},[e("header",{class:a.articleHeader},[e("button",{type:"button",class:a.expandToggle,onClick:()=>n.value=!n.value,"aria-expanded":n.value,"aria-label":n.value?"收起":"展开"},[n.value?e(q,{class:a.expandIcon},null):e(de,{class:a.expandIcon},null)]),e(B,{to:`/${t.article.type}/edit?id=${t.article.id}`,class:a.articleHeaderLink},{default:()=>[e(l,{class:a.articleTypeIcon},null),e("h2",{class:a.articleHeaderTitle},[t.article.title])]}),e("span",{class:a.articleTypeBadge},[ut[t.article.type]]),e("span",{class:a.summaryCount},[t.summaries.length,m(" 条摘要")]),e(g,{trigger:"hover",placement:"top"},{trigger:()=>e(B,{to:`/ai/summary?refId=${t.article.id}`,class:a.manageLink,"aria-label":"管理此文章的摘要"},{default:()=>[e(I,{class:"size-4"},null)]}),default:()=>"管理摘要"})]),e(fe,{show:n.value},{default:()=>[e("div",{class:a.summariesList},[t.summaries.map(s=>e(mt,{key:s.id,item:s,onMutate:t.onMutate},null))])]})])}}),mt=o({props:{item:{type:Object,required:!0},onMutate:{type:Function,required:!0}},setup(t){const n=p(!1),l=y(()=>t.item.summary.length>150||t.item.summary.includes(`
`));return()=>e("div",{class:a.summaryItem},[e("div",{class:a.summaryItemHeader},[e("span",{class:a.langBadge},[t.item.lang.toUpperCase()]),e("span",{class:a.summaryTime},[e(M,{class:a.timeIcon},null),e("time",{datetime:t.item.created},[D(new Date(t.item.created),"yyyy-MM-dd HH:mm")])])]),e("div",{class:a.summaryItemContent},[e("p",{class:[a.summaryText,!n.value&&l.value?a.summaryTextCollapsed:""]},[t.item.summary]),l.value&&e("button",{type:"button",class:a.expandButton,onClick:()=>n.value=!n.value,"aria-expanded":n.value},[n.value?e(v,null,[e($,{class:"mr-1 inline size-3"},null),m("收起")]):e(v,null,[e(q,{class:"mr-1 inline size-3"},null),m("展开")])])]),e("div",{class:a.summaryItemActions},[e(g,{trigger:"hover",placement:"top"},{trigger:()=>e("button",{type:"button",class:a.actionButton,onClick:()=>U(t.item,t.onMutate),"aria-label":"编辑摘要"},[e(E,null,null)]),default:()=>"编辑"}),e(P,{placement:"left",positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await f.deleteSummary(t.item.id),t.onMutate()}},{trigger:()=>e(g,{trigger:"hover",placement:"top"},{trigger:()=>e("button",{type:"button",class:[a.actionButton,a.deleteButton],"aria-label":"删除摘要"},[e(L,null,null)]),default:()=>"删除"}),default:()=>"确定要删除这条摘要吗？"})])])}}),dt=o({props:{refId:{type:String,required:!0}},setup(t){const n=ie(),l=t.refId,{data:s,refetch:i,isPending:r}=R({queryKey:z.ai.summaryByRef(l),queryFn:()=>f.getSummaryByRef(l)}),{setActions:d}=se();d(e(re,{icon:e(w,null,null),name:"生成摘要",onClick:()=>{A(l,u=>{u&&s.value?.summaries.push(u)})}},null)),ue(()=>{d(null)});const c=y(()=>r.value);return()=>e("div",null,[e("header",{class:a.pageHeader},[e("button",{type:"button",class:a.backButton,onClick:()=>n.back(),"aria-label":"返回"},[e(me,null,null)]),e("h1",{class:a.pageTitle},[s.value?.article.document.title||"摘要管理"])]),e(S,{name:"fade",mode:"out-in"},{default:()=>[c.value?e(O,{key:"loading",count:2},null):!s.value||s.value.summaries.length===0?e(G,{key:"empty",title:"暂无摘要",description:"为这篇文章生成 AI 摘要",showAction:!0,onAction:()=>{A(l,u=>{u&&s.value?.summaries.push(u)})}},null):e("div",{key:"content",class:a.list},[s.value.summaries.map(u=>e(yt,{key:u.id,item:u,onMutate:i},null))])]})])}}),yt=o({props:{item:{type:Object,required:!0},onMutate:{type:Function,required:!0}},setup(t){const n=p(!1),l=y(()=>t.item.summary.length>200||t.item.summary.includes(`
`));return()=>e("article",{class:a.card,"aria-label":"AI 摘要"},[e("header",{class:a.cardHeader},[e("span",{class:a.langBadge},[t.item.lang.toUpperCase()])]),e("div",{class:a.summaryContent},[e("p",{class:[a.summaryText,!n.value&&l.value?a.summaryTextCollapsed:""]},[t.item.summary]),l.value&&e("button",{type:"button",class:a.expandButton,onClick:()=>n.value=!n.value,"aria-expanded":n.value},[n.value?e(v,null,[e($,{class:"mr-1 inline size-3"},null),m("收起")]):e(v,null,[e(q,{class:"mr-1 inline size-3"},null),m("展开全部")])])]),e("footer",{class:a.cardFooter},[e("div",{class:a.meta},[e("span",{class:a.metaItem,"aria-label":"创建时间"},[e(M,{class:a.metaIcon},null),e("time",{datetime:t.item.created},[D(new Date(t.item.created),"yyyy-MM-dd HH:mm")])])]),e("div",{class:a.actions,role:"group","aria-label":"操作"},[e(g,{trigger:"hover",placement:"top"},{trigger:()=>e("button",{type:"button",class:a.actionButton,onClick:()=>U(t.item,t.onMutate),"aria-label":"编辑摘要"},[e(E,null,null)]),default:()=>"编辑"}),e(P,{placement:"left",positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await f.deleteSummary(t.item.id),t.onMutate()}},{trigger:()=>e(g,{trigger:"hover",placement:"top"},{trigger:()=>e("button",{type:"button",class:[a.actionButton,a.deleteButton],"aria-label":"删除摘要"},[e(L,null,null)]),default:()=>"删除"}),default:()=>"确定要删除这条摘要吗？"})])])])}}),G=o({props:{title:{type:String,default:"暂无 AI 摘要"},description:{type:String,default:"这里会显示所有文章的 AI 生成摘要"},showAction:{type:Boolean,default:!1},onAction:{type:Function}},setup(t){return()=>e("div",{class:a.empty,role:"status","aria-label":"暂无内容"},[e("div",{class:a.emptyIcon,"aria-hidden":"true"},[e(I,null,null)]),e("h3",{class:a.emptyTitle},[t.title]),e("p",{class:a.emptyDescription},[t.description]),t.showAction&&t.onAction&&e(T,{type:"primary",onClick:t.onAction},{default:()=>[e(w,{class:"mr-1.5"},null),m("生成摘要")]})])}}),O=o({props:{count:{type:Number,default:3}},setup(t){return()=>e("div",{class:a.list,"aria-busy":"true","aria-label":"加载中"},[Array.from({length:t.count}).map((n,l)=>e("div",{key:l,class:a.skeleton},[e("div",{class:a.skeletonHeader},[e(h,{text:!0,style:{width:"200px"}},null),e(h,{text:!0,style:{width:"60px"}},null)]),e("div",{class:a.skeletonContent},[e(h,{text:!0,repeat:2},null)])]))])}});function A(t,n){const l=p(!1),s=p("zh"),i=dialog.create({title:"生成 AI 摘要",content(){return e(j,{vertical:!0,size:"large"},{default:()=>[e("div",null,[e("label",{class:"mb-2 block text-sm text-neutral-600"},[m("目标语言")]),e(N,{value:s.value,onUpdateValue:r=>s.value=r,placeholder:"zh, en, ja..."},null)]),e("div",{class:"text-right"},[e(T,{type:"primary",loading:l.value,onClick:()=>{s.value&&(l.value=!0,f.generateSummary({refId:t,lang:s.value}).then(r=>{n(r),i.destroy()}).finally(()=>{l.value=!1}))}},{default:()=>[e(I,{class:"mr-1.5 size-4"},null),m("生成")]})])]})}})}function U(t,n){const l=p(t.summary),s=dialog.create({title:"编辑摘要",content(){return e(j,{vertical:!0,size:"large"},{default:()=>[e(N,{value:l.value,onUpdateValue:i=>l.value=i,type:"textarea",rows:6,placeholder:"摘要内容"},null),e("div",{class:"text-right"},[e(T,{type:"primary",onClick:()=>{l.value&&f.updateSummary(t.id,{summary:l.value}).then(()=>{n(),s.destroy()})}},{default:()=>[m("保存")]})])]})}})}export{xt as default};
