import{c as j,ar as g,cq as z,cr as T,cs as P,ct as R,d as b,u as y,a as i,r as U,g as M,w as O,h as e,av as V,i as l,bS as H,J as I,B,bU as K,s as x,N as o,K as X,m as _,T as J,bX as Q,aw as Y,H as k,bt as $,Y as G}from"./index-DoEgFLcO.js";import{M as A}from"./mail-DuL8MAe9.js";import{D as W}from"./download-o-2ttAD6.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=j("mail-x",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h9",key:"1j9vog"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m17 17 4 4",key:"1b3523"}],["path",{d:"m21 17-4 4",key:"uinynz"}]]),m={getStatus:()=>g.get("/subscribe/status"),getList:t=>g.get("/subscribe",{params:t}),unsubscribe:t=>g.get("/subscribe/unsubscribe",{params:t}),export:()=>g.get("/subscribe/export")},ee=new Map([[z,"博文"],[T,"手记"],[P,"速记"],[R,"说说"]]);function te(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Y(t)}const w=b({props:{title:{type:String,required:!0}},setup(t,{slots:r}){return()=>e("div",{class:"mb-4"},[e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-medium text-neutral-700 dark:text-neutral-300"},[t.title]),r.extra?.()]),e("div",{class:"mt-2 h-px bg-neutral-200 dark:bg-neutral-700"},null)])}}),S=b({props:{icon:{type:Object,required:!0},label:{type:String,required:!0},value:{type:[String,Number],required:!0},description:{type:String},variant:{type:String,default:"default"}},setup(t){const r={default:"bg-neutral-50 dark:bg-neutral-800/50",success:"bg-green-50 dark:bg-green-950/30",warning:"bg-amber-50 dark:bg-amber-950/30"},a={default:"text-neutral-400",success:"text-green-500",warning:"text-amber-500"};return()=>e("div",{class:["flex items-center gap-4 rounded-lg p-4",r[t.variant]]},[e("div",{class:["shrink-0 text-2xl",a[t.variant]]},[t.icon]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"text-2xl font-semibold tabular-nums"},[typeof t.value=="number"?Intl.NumberFormat("zh-CN").format(t.value):t.value]),e("div",{class:"text-xs text-neutral-500"},[t.label]),t.description&&e("div",{class:"mt-1 text-xs text-neutral-400"},[t.description])])])}}),ae=b({props:{email:{type:String,required:!0},subscribe:{type:Number,required:!0},created:{type:String,required:!0},onDelete:{type:Function,required:!0}},setup(t){const r=i(()=>{const a=[];for(const[n,c]of ee.entries())n&t.subscribe&&a.push(e(Q,{size:"small",round:!0,bordered:!1,class:"!bg-neutral-100 !text-neutral-600 dark:!bg-neutral-700 dark:!text-neutral-300"},te(c)?c:{default:()=>[c]}));return a});return()=>e("div",{class:"group flex items-center gap-4 rounded-lg border border-neutral-200 bg-white p-4 transition-colors hover:border-neutral-300 dark:border-neutral-700 dark:bg-neutral-800/50 dark:hover:border-neutral-600"},[e("div",{class:"flex size-10 shrink-0 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-700"},[e(A,{class:"size-5 text-neutral-500 dark:text-neutral-400"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"truncate font-medium text-neutral-800 dark:text-neutral-200"},[t.email]),e("div",{class:"mt-1.5 flex flex-wrap items-center gap-1.5"},[r.value])]),e("div",{class:"flex shrink-0 items-center gap-3"},[e("div",{class:"text-right"},[e("div",{class:"text-xs text-neutral-400"},[l("订阅于")]),e("div",{class:"text-sm text-neutral-500"},[e(X,{time:t.created},null)])]),e(_,{positiveText:"取消",negativeText:"删除",onNegativeClick:t.onDelete},{trigger:()=>e("button",{class:"rounded-lg p-2 text-neutral-400 opacity-0 transition-all hover:bg-red-50 hover:text-red-500 group-hover:opacity-100 dark:hover:bg-red-950/50","aria-label":"删除订阅者"},[e(J,{class:"size-4"},null)]),default:()=>e("span",{class:"max-w-48"},[l("确定要移除该订阅者吗？")])})])])}}),ue=b({setup(){return()=>e("div",{class:"flex items-center gap-4 rounded-lg border border-neutral-200 bg-white p-4 dark:border-neutral-700 dark:bg-neutral-800/50"},[e(o,{circle:!0,width:40,height:40},null),e("div",{class:"flex-1 space-y-2"},[e(o,{text:!0,width:"60%"},null),e(o,{text:!0,width:"40%"},null)]),e("div",{class:"space-y-1 text-right"},[e(o,{text:!0,width:60},null),e(o,{text:!0,width:80},null)])])}}),ne=b({setup(){const{data:t,refetch:r}=y({queryKey:["subscribe","status"],queryFn:()=>m.getStatus()}),a=i(()=>t.value?.enabled??!1),n=U(1),c=20,{data:p,isLoading:F,refetch:f}=y({queryKey:i(()=>["subscribe","list",n.value]),queryFn:()=>m.getList({page:n.value,size:c})}),h=i(()=>p.value?.data??[]),s=i(()=>p.value?.pagination),E=i(()=>s.value?.total??0),C=async()=>{await K.patch("featureList",{emailSubscribe:!a.value}),r()},N=async u=>{await m.unsubscribe({email:u}),x.success("已移除订阅者"),f()},q=async()=>{try{const u=await m.export(),v=window.URL.createObjectURL(u),d=document.createElement("a");d.href=v,d.download=`subscribers-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(v),document.body.removeChild(d),x.success("导出成功")}catch{x.error("导出失败")}},D=()=>{f(),r()},{setActions:L}=M();return O(()=>{L(e(G,null,[e(k,{icon:e($,null,null),onClick:D,name:"刷新"},null),e(k,{icon:e(W,null,null),onClick:q,name:"导出订阅者",variant:"info"},null)]))}),()=>e("div",{class:"space-y-8"},[e("section",null,[e(w,{title:"概览"},null),e("div",{class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},[e(S,{icon:e(V,null,null),label:"总订阅者",value:E.value,variant:"default"},null),e(S,{icon:a.value?e(A,null,null):e(Z,null,null),label:"订阅功能",value:a.value?"已启用":"已禁用",variant:a.value?"success":"warning"},null),e("div",{class:"flex items-center justify-between rounded-lg bg-neutral-50 p-4 dark:bg-neutral-800/50"},[e("div",null,[e("div",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},[l("启用邮件订阅")]),e("div",{class:"mt-1 text-xs text-neutral-500"},[l("允许访客订阅新内容通知")])]),e(H,{value:a.value,onUpdateValue:C},null)])])]),e("section",null,[e(w,{title:"订阅者列表"},{extra:()=>s.value&&e("span",{class:"text-sm text-neutral-500"},[l("共 "),s.value.total,l(" 位订阅者")])}),F.value?e("div",{class:"space-y-3"},[Array.from({length:5}).map((u,v)=>e(ue,{key:v},null))]):h.value.length===0?e("div",{class:"rounded-lg border border-dashed border-neutral-200 py-16 dark:border-neutral-700"},[e(I,{description:"暂无订阅者"},{extra:()=>e("div",{class:"mt-2 text-sm text-neutral-500"},[l("开启订阅功能后，访客可以订阅您的内容更新")])})]):e("div",{class:"space-y-3"},[h.value.map(u=>e(ae,{key:u.id,email:u.email,subscribe:u.subscribe,created:u.created,onDelete:()=>N(u.email)},null))]),s.value&&s.value.totalPage>1&&e("div",{class:"mt-6 flex items-center justify-center gap-2"},[e(B,{size:"small",disabled:!s.value.hasPrevPage,onClick:()=>n.value=n.value-1},{default:()=>[l("上一页")]}),e("span",{class:"px-4 text-sm text-neutral-500"},[s.value.currentPage,l(" / "),s.value.totalPage]),e(B,{size:"small",disabled:!s.value.hasNextPage,onClick:()=>n.value=n.value+1},{default:()=>[l("下一页")]})])])])}});export{ne as default};
