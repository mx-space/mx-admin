import{c as B,ar as s,d as b,r as o,o as A,O as F,g as T,h as a,H as k,az as w,aA as d,aB as U,aC as C,v as h,aD as E,aE as $,m as D,s as i,B as I,i as v,p as M,aF as P,aG as z,aH as L,aI as O,Y as S}from"./index-DoEgFLcO.js";import{U as V}from"./upload-B3DfZtO4.js";import{a as j,N as H}from"./Upload-BK8vilh7.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=B("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),y={getByType:t=>s.get(`/files/${t}`),upload:(t,l)=>{const r=new FormData;return r.append("file",t),s.post("/files/upload",{data:r,params:l?{type:l}:void 0})},deleteByTypeAndName:(t,l)=>s.delete(`/files/${t}/${l}`),rename:(t,l,r)=>s.patch(`/files/${t}/${l}/rename`,{data:{name:r}})},_=b({setup(){const t=o("icon"),l=o([]);A(()=>t.value,()=>{f()}),F(()=>{f()});const r=o(!1),f=()=>{r.value=!0,y.getByType(t.value).then(e=>{l.value=e,r.value=!1})},n=o(!1),g=async e=>{if(t.value==="icon"||t.value==="avatar"||t.value==="photo"){if(e.file.file?.type.startsWith("image"))return!0;i.error("只能上传图片文件，请重新上传")}return!0},N=({file:e,event:u})=>{const c=u?.target,{url:p,name:m}=JSON.parse(c.responseText);return e.name=m,e.url=p,l.value.unshift({url:p,name:m}),e},{setActions:x}=T();return x(a(k,{variant:"info",onClick:()=>{n.value=!0},icon:a(V,null,null)},null)),()=>a(S,null,[a(w,{value:t.value,onUpdateValue:e=>{t.value=e}},{default:()=>[a(d,{tab:"图标",name:"icon"},null),a(d,{tab:"头像",name:"avatar"},null),a(d,{tab:"文件",name:"file"},null)]}),a(U,{loading:r.value,data:l,columns:[{key:"name",title:"文件名",width:300,ellipsis:{lineClamp:1,tooltip:!0}},{key:"url",title:"URL",render(e){return a(C,{placement:"bottom",class:"max-w-[400px]"},{trigger(){return a("a",{href:e.url,target:"_blank",rel:"noreferrer"},[e.url])},default(){return a(h,{bordered:!0},{default:()=>[a(E,{src:e.url},null)]})}})}},{key:"action",title:"操作",width:150,render(e){return a($,null,{default:()=>[a(D,{onPositiveClick:()=>{y.deleteByTypeAndName(t.value,e.name).then(()=>{i.success("删除成功"),l.value=l.value.filter(u=>u.name!==e.name)})}},{trigger(){return a(I,{quaternary:!0,type:"error",size:"tiny"},{default:()=>[v("删除")]})},default(){return`确定要删除 ${e.name} 吗？`}})]})}}]},null),a(M,{closable:!0,closeOnEsc:!0,onClose:()=>{n.value=!1},show:n.value,onUpdateShow:e=>{n.value=e}},{default:()=>[a(h,{title:"文件上传",class:"modal-card sm flex justify-center",closable:!0,onClose:()=>{n.value=!1}},{default:()=>[a(j,{class:"flex w-full flex-col items-center",headers:{authorization:z()||""},action:`${P}/files/upload?type=${t.value}`,"directory-dnd":!0,multiple:!0,onBeforeUpload:g,onFinish:N,onError:e=>{const u=e.event?.target;if(e.file.status="error",!u)return i.warning("网络异常"),e.file;const{message:c}=JSON.parse(u.responseText);return i.warning(c),e.file}},{default:()=>[a(H,{class:"m-auto flex w-full flex-col items-center justify-center py-28"},{default:()=>[a(L,{size:"48",depth:"3"},{default:()=>[a(q,null,null)]}),a(O,{class:"mt-2"},{default:()=>[v("点击或者拖动文件到该区域来上传")]})]})]})]})]})])}});export{_ as default};
