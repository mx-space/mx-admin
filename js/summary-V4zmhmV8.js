import{d as o,ba as E,bb as F,aK as R,aH as A,aI as x,bc as N,bd as $,a3 as B,aS as P,be as j,bf as v,Z as D,c as e,C as T,a as h,aj as b,J as I,i as q,O as z,F as S,at as L,bg as k,A as H,R as f,s as C,B as p,g as m,H as O,bh as V,m as K,bi as M,K as W,W as G,T as U,v as _}from"./index-D5BxuJyQ.js";import{a as J,N as Z}from"./ListItem-CovWBJPR.js";const Q=Object.assign(Object.assign({},x.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,reverse:Boolean,size:{type:[String,Number,Array],default:"medium"},wrap:{type:Boolean,default:!0}}),X=o({name:"Flex",props:Q,setup(t){const{mergedClsPrefixRef:a,mergedRtlRef:r}=A(t),n=x("Flex","-flex",void 0,N,t,a);return{rtlEnabled:$("Flex",r,a),mergedClsPrefix:a,margin:B(()=>{const{size:u}=t;if(Array.isArray(u))return{horizontal:u[0],vertical:u[1]};if(typeof u=="number")return{horizontal:u,vertical:u};const{self:{[P("gap",u)]:s}}=n.value,{row:c,col:i}=j(s);return{horizontal:v(i),vertical:v(c)}})}},render(){const{vertical:t,reverse:a,align:r,inline:n,justify:l,margin:u,wrap:s,mergedClsPrefix:c,rtlEnabled:i}=this,d=E(F(this),!1);return d.length?R("div",{role:"none",class:[`${c}-flex`,i&&`${c}-flex--rtl`],style:{display:n?"inline-flex":"flex",flexDirection:t&&!a?"column":t&&a?"column-reverse":!t&&a?"row-reverse":"row",justifyContent:l,flexWrap:!s||t?"nowrap":"wrap",alignItems:r,gap:`${u.vertical}px ${u.horizontal}px`}},d):null}});function Y(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!_(t)}const ue=o({setup(){const t=D();return()=>{const a=t.query.refId;return e(T,null,{default:()=>[a?e(te,{refId:a},null):e(ee,null,null)]})}}}),ee=o({setup(){const t=h(1),{data:a,mutate:r}=b("/api/ai/summaries",async()=>await f.api.ai.summaries.get({params:{page:t.value}}),{revalidateOnFocus:!1});return()=>a.value?.data.length===0?e(I,null,null):e(S,null,[e(w,{summaries:a.value?.data||[],getArticle:n=>{const l=a.value?.articles[n];if(!l)throw new Error("article not found");return{type:l.type,document:{title:l.title}}},mutate:r},null),e(q,{class:"mt-6",justify:"end"},{default:()=>[e(z,{page:a.value?.pagination.currentPage,pageCount:a.value?.pagination.totalPage,onUpdatePage:n=>{t.value=n,r()}},null)]})])}}),te=o({props:{refId:{type:String,required:!0}},setup(t){const a=t.refId,{data:r,mutate:n}=b(`/api/ai/summary/${a}`,async()=>await f.api.ai.summaries.ref(a).get()),l=L(),{setHeaderButtons:u}=k();return u(e(O,{icon:e(H,null,null),name:"生成摘要",onClick:()=>{const s=l.create({title:"生成摘要",content(){return e(o({setup(){const i=h(!1);return()=>e("form",{onSubmit:d=>{d.preventDefault();const g=d.target.querySelector("input[name=lang]")?.value;g&&(i.value=!0,f.api.ai.summaries.generate.post({data:{refId:a,lang:g}}).then(y=>{y&&r.value?.summaries.push(y),s.destroy()}).finally(()=>{i.value=!1}))}},[e(C,{type:"text",inputProps:{name:"lang"},defaultValue:"zh",placeholder:"目标语言"},null),e("div",{class:"mt-4 text-right"},[e(p,{attrType:"submit",loading:i.value,round:!0,type:"primary"},{default:()=>[m("生成")]})])])}}),null,null)}})}},null)),V(()=>{u(null)}),()=>!r.value||r.value.summaries.length===0?e(I,null,null):e(w,{summaries:r.value?.summaries||[],getArticle:()=>r.value.article,mutate:n},null)}}),w=o({props:{summaries:{type:Array,required:!0},getArticle:{type:Function,required:!0},mutate:{type:Function,required:!0}},setup(t){return()=>{let a;return e(Z,{bordered:!0,showDivider:!0},Y(a=t.summaries.map(r=>e(J,{class:"ml-2",key:r.id},{suffix(){return e(W,null,{default:()=>[e(p,{onClick:()=>{const n=dialog.create({title:"修改摘要",content(){return e("form",{onSubmit:l=>{l.preventDefault();const s=l.target.querySelector("textarea")?.value;s&&f.api.ai.summaries(r.id).patch({data:{summary:s}}).then(()=>{t.mutate(),n.destroy()})}},[e(X,{vertical:!0},{default:()=>[e(C,{inputProps:{name:"summary"},rows:6,type:"textarea",defaultValue:r.summary},null),e("div",{class:"text-right"},[e(p,{type:"primary",attrType:"submit",round:!0},{default:()=>[m("保存")]})])]})])}})},round:!0},{default:()=>[m("修改")]}),e(p,{onClick:()=>{const n=dialog.create({title:"确定？",content:"确定要删除吗？",type:"error",positiveText:"删除",negativeText:"取消",onPositiveClick(){f.api.ai.summaries(r.id).delete().then(()=>{t.mutate(),n.destroy()})}})},round:!0,type:"error"},{default:()=>[e(G,null,{default:()=>[e(U,{class:"text-white"},null)]})]})]})},default(){const n=t.getArticle(r.refId);return e(S,null,[e(K,{to:`/${n.type}/edit?id=${r.refId}`},{default:()=>[e("h2",{"data-article-id":r.refId},[n.document.title])]}),e("small",null,[m("目标语言："),r.lang,m(" /")," ",M(new Date(r.created),"yyyy-MM-dd HH:mm")]),e("p",{class:"mt-2"},[r.summary])])}})))?a:{default:()=>[a]})}}});export{ue as default};
