import{c as j,bK as Oe,bL as vt,bM as mt,bN as ft,bO as yt,bP as we,bQ as Y,bR as Be,bS as bt,bT as V,bU as Te,bV as Ue,d as _,r as B,w as he,i as e,v as O,Y as P,x as R,b1 as S,z as F,j as d,aE as Ce,B as w,bW as ze,bX as q,b7 as ge,bY as qe,bZ as G,e as le,aQ as ue,u as me,O as W,a0 as Le,G as xe,M as ht,q as H,b_ as Fe,P as X,N as D,bI as Ve,K as re,n as ee,T as Q,a as I,A as oe,g as Z,b$ as $,t as gt,c0 as ie,m as xt,o as J,p as T,s as fe,X as kt,W as wt,V as U,aP as Bt,Z as Ct,c1 as Ft,c2 as _t,b6 as z,aH as se,av as Re,c3 as ce,c4 as At,an as Et,b2 as St,c5 as It,bq as de,H as te,aR as Dt,h as He,aa as je,bu as Ke,aU as Ne,c6 as Ge,ap as Pt,by as Mt,bw as $e,c7 as N,c8 as We,aZ as _e,a3 as Ot,c9 as Ae,ca as Tt,bH as Ut,bF as zt,f as qt,cb as Lt,cc as Vt,cd as Rt}from"./index-BfIRmUdd.js";import{G as Ht}from"./grip-vertical-9qto-BSo.js";import{L as Qe}from"./lock-CW4vrJBN.js";import{C as ae}from"./circle-check-D8mlhJYU.js";import{a as jt,i as ye}from"./isEmpty-BdIk7fgx.js";import{G as Je}from"./globe-E0u1sXdn.js";import{U as Kt}from"./index-DmuNAxHs.js";import{M as Nt}from"./mail-D3FTBNW9.js";import{C as Gt}from"./calendar-Qborp-EL.js";import{U as Xe}from"./user-lKyqKCRq.js";import"./Upload-BYSEKdXl.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=j("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=j("fingerprint-pattern",[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=j("github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=j("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=j("list-plus",[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 19H3",key:"zzsher"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=j("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=j("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=j("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function Jt(t){if(Oe(t))return t;if(Array.isArray(t)||vt(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const a=Object.getPrototypeOf(t),r=a.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const n=new r(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const n=new r(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(a);return Object.assign(n,t)}return t}function Xt(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}const Zt=/\p{Lu}?\p{Ll}+|[0-9]+|\p{Lu}+(?!\p{Ll})|\p{Emoji_Presentation}|\p{Extended_Pictographic}|\p{L}+/gu;function Yt(t){return Array.from(t.match(Zt)??[])}function Ee(t,a,r){const n=Array.isArray(a)?a:typeof a=="string"?mt(a):[a];let s=t;for(let p=0;p<n.length-1;p++){const u=n[p],o=n[p+1];s[u]==null&&(s[u]=ft(o)?[]:{}),s=s[u]}const c=n[n.length-1];return s[c]=r,t}function ea(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let a=t;for(;Object.getPrototypeOf(a)!==null;)a=Object.getPrototypeOf(a);return Object.getPrototypeOf(t)===a}function ta(t,...a){const r=a.slice(0,-1),n=a[a.length-1];let s=t;for(let c=0;c<r.length;c++){const p=r[c];s=ne(s,p,n,new Map)}return s}function ne(t,a,r,n){if(Oe(t)&&(t=Object(t)),a==null||typeof a!="object")return t;if(n.has(a))return Jt(n.get(a));if(n.set(a,t),Array.isArray(a)){a=a.slice();for(let c=0;c<a.length;c++)a[c]=a[c]??void 0}const s=[...Object.keys(a),...yt(a)];for(let c=0;c<s.length;c++){const p=s[c];let u=a[p],o=t[p];if(we(u)&&(u={...u}),we(o)&&(o={...o}),typeof Buffer<"u"&&Buffer.isBuffer(u)&&(u=Y(u)),Array.isArray(u))if(typeof o=="object"&&o!=null){const x=[],h=Reflect.ownKeys(o);for(let i=0;i<h.length;i++){const b=h[i];x[b]=o[b]}o=x}else o=[];const v=r(o,u,p,t,a,n);v!=null?t[p]=v:Array.isArray(u)||Be(o)&&Be(u)?t[p]=ne(o,u,r,n):o==null&&ea(u)?t[p]=ne({},u,r,n):o==null&&jt(u)?t[p]=Y(u):(o===void 0||u!==void 0)&&(t[p]=u)}return t}function aa(t,...a){return ta(t,...a,bt)}function la(t){const a=Yt(t);if(a.length===0)return"";const[r,...n]=a;return`${r.toLowerCase()}${n.map(s=>Xt(s)).join("")}`}function tt(t){if(t==null)return"";if(Array.isArray(t))return t.map(tt).join(",");const a=String(t);return a==="0"&&Object.is(Number(t),-0)?"-0":a}function ua(t){return typeof t!="string"&&(t=tt(t)),t.replace(/['\u2019]/g,"")}function sa(t){return la(ua(t))}const na="_container_9b3ha_4",ra="_sidebar_9b3ha_9",oa="_navList_9b3ha_17",ia="_navItem_9b3ha_27",ca="_navItemActive_9b3ha_47",da="_navIcon_9b3ha_55",pa="_content_9b3ha_60",va="_card_9b3ha_65",ma="_sectionHeader_9b3ha_90",fa="_sectionTitle_9b3ha_94",ya="_sectionSubtitle_9b3ha_102",ba="_avatarContainer_9b3ha_127",ha="_avatarWrapper_9b3ha_136",ga="_avatarUploadOverlay_9b3ha_152",xa="_avatarUploadIcon_9b3ha_160",ka="_formGrid_9b3ha_209",wa="_formGroup_9b3ha_213",Ba="_formLabel_9b3ha_217",Ca="_formDescription_9b3ha_225",Fa="_formGroupFull_9b3ha_233",_a="_sessionList_9b3ha_263",Aa="_sessionItem_9b3ha_267",Ea="_sessionItemCurrent_9b3ha_279",Sa="_sessionHeader_9b3ha_287",Ia="_sessionBadge_9b3ha_291",Da="_sessionBadgeCurrent_9b3ha_295",Pa="_sessionBadgeOther_9b3ha_303",Ma="_sessionContent_9b3ha_311",Oa="_sessionRow_9b3ha_315",Ta="_sessionLabel_9b3ha_319",Ua="_sessionUA_9b3ha_335",za="_tokenCard_9b3ha_344",qa="_tokenHeader_9b3ha_352",La="_tokenTitle_9b3ha_356",Va="_passwordSection_9b3ha_365",Ra="_passwordHeader_9b3ha_373",Ha="_passwordIcon_9b3ha_377",ja="_passwordTitle_9b3ha_389",Ka="_authGrid_9b3ha_398",Na="_authProviderIcon_9b3ha_418",Ga="_authProviderName_9b3ha_430",$a="_authProviderStatus_9b3ha_438",Wa="_authProviderEnabled_9b3ha_442",Qa="_authProviderDisabled_9b3ha_450",Ja="_empty_9b3ha_504",Xa="_emptyIcon_9b3ha_508",Za="_emptyTitle_9b3ha_520",Ya="_emptyDescription_9b3ha_528",el="_infoRow_9b3ha_542",tl="_infoLabel_9b3ha_558",al="_infoValue_9b3ha_566",ll="_tabContent_9b3ha_575",ul="_settingsGroup_9b3ha_580",sl="_userTabContainer_9b3ha_668",nl="_userSection_9b3ha_672",rl="_userSectionHeader_9b3ha_676",ol="_userHeaderInfo_9b3ha_680",il="_userName_9b3ha_684",cl="_userHandle_9b3ha_692",dl="_userMeta_9b3ha_700",pl="_userMetaItem_9b3ha_704",vl="_userMetaIcon_9b3ha_712",ml="_userSectionTitle_9b3ha_716",fl="_userSectionTitleRow_9b3ha_724",yl="_socialList_9b3ha_733",bl="_socialRow_9b3ha_737",hl="_socialSelect_9b3ha_741",gl="_socialInput_9b3ha_745",xl="_socialRemoveBtn_9b3ha_749",kl="_socialEmpty_9b3ha_769",l={container:na,sidebar:ra,navList:oa,navItem:ia,navItemActive:ca,navIcon:da,content:pa,card:va,sectionHeader:ma,sectionTitle:fa,sectionSubtitle:ya,avatarContainer:ba,avatarWrapper:ha,avatarUploadOverlay:ga,avatarUploadIcon:xa,formGrid:ka,formGroup:wa,formLabel:Ba,formDescription:Ca,formGroupFull:Fa,sessionList:_a,sessionItem:Aa,sessionItemCurrent:Ea,sessionHeader:Sa,sessionBadge:Ia,sessionBadgeCurrent:Da,sessionBadgeOther:Pa,sessionContent:Ma,sessionRow:Oa,sessionLabel:Ta,sessionUA:Ua,tokenCard:za,tokenHeader:qa,tokenTitle:La,passwordSection:Va,passwordHeader:Ra,passwordIcon:Ha,passwordTitle:ja,authGrid:Ka,authProviderIcon:Na,authProviderName:Ga,authProviderStatus:$a,authProviderEnabled:Wa,authProviderDisabled:Qa,empty:Ja,emptyIcon:Xa,emptyTitle:Za,emptyDescription:Ya,infoRow:el,infoLabel:tl,infoValue:al,tabContent:ll,settingsGroup:ul,userTabContainer:sl,userSection:nl,userSectionHeader:rl,userHeaderInfo:ol,userName:il,userHandle:cl,userMeta:dl,userMetaItem:pl,userMetaIcon:vl,userSectionTitle:ml,userSectionTitleRow:fl,socialList:yl,socialRow:bl,socialSelect:hl,socialInput:gl,socialRemoveBtn:xl,socialEmpty:kl},wl=async()=>V.getSession();function Bl(t){const a={};for(const r of t.providers){const n=r.type;n in t.public?a[n]={...t.public[n],enabled:r.enabled,type:n}:console.warn(`Provider type ${n} found in providers but not in public data.`)}return a}const at=Symbol.for("OauthDataInjectKey"),Cl=()=>t=>Ue(at,t),Fl=()=>Te(at),_l=()=>e("svg",{viewBox:"0 0 24 24",class:"size-5"},[e("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"},null),e("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"},null),e("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"},null),e("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"},null)]),Al={github:Ze,google:_l},lt=(t,a)=>_({setup(){const r=async()=>{await qe.signIn.social({provider:t,callbackURL:`${location.href}?validate=true`})},n=Fl(),s=B({clientId:"",secret:""}),c=B(!1);he(()=>{if(n.value[t]===void 0)return;const{clientId:h,enabled:i}=n.value[t];c.value=i,s.value.clientId=h});const p=B(null),u={clientId:[{required:!0,message:"Client Id 不能为空"}],secret:[{required:!0,message:"Client Secret 不能为空"}]},o=async()=>{await p.value?.validate(),await G.patch("oauth",{providers:[{type:t,enabled:c.value}],secrets:{[t]:{clientSecret:s.value.secret}},public:{[t]:{clientId:s.value.clientId}}}),message.success("保存成功")},v=async()=>{const h=`${Ce}/auth/callback/${t}`;try{await navigator.clipboard.writeText(h),message.success("已复制到剪贴板")}catch{message.error("复制失败")}},x=Al[t]||Ze;return()=>e(O,{size:"small"},{header:()=>e("div",{class:"flex items-center gap-3"},[e("div",{class:l.authProviderIcon},[e(x,null,null)]),e("div",{class:"flex-1"},[e("h3",{class:l.authProviderName},[a.name]),e("div",{class:l.authProviderStatus},[c.value?e("span",{class:l.authProviderEnabled},[e(ge,{class:"size-3"},null),d("已启用")]):e("span",{class:l.authProviderDisabled},[d("未启用")])])])]),default:()=>e(P,null,[e(R,{model:s.value,ref:p,rules:u,labelPlacement:"left",labelWidth:100},{default:()=>[e(S,{label:"Client ID",path:"clientId",required:!0},{default:()=>[e(F,{value:s.value.clientId,onUpdateValue:h=>{s.value.clientId=h},placeholder:"输入 Client ID"},null)]}),e(S,{label:"Client Secret",required:!0,path:"secret"},{default:()=>[e(F,{showPasswordToggle:!0,type:"password",value:s.value.secret,onUpdateValue:h=>{s.value.secret=h},placeholder:"输入 Client Secret"},null)]})]}),e("div",{class:"mt-4 rounded-lg bg-neutral-50 p-3 dark:bg-neutral-800"},[e("div",{class:"mb-1 text-xs text-neutral-500 dark:text-neutral-400"},[d("Callback URL")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"flex-1 truncate font-mono text-sm text-neutral-700 dark:text-neutral-200"},[Ce,d("/auth/callback/"),t]),e(w,{text:!0,type:"primary",onClick:v},{default:()=>[e(ze,{class:"size-4"},null)]})])]),e("div",{class:"mt-4 flex items-center justify-between"},[e("label",{class:"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-300"},[d("启用"),e(q,{value:c.value,onUpdateValue:h=>{c.value=h}},null)]),e("div",{class:"flex gap-2"},[e(w,{onClick:r,tertiary:!0,size:"small"},{default:()=>[d("验证")]}),e(w,{onClick:o,type:"primary",size:"small"},{default:()=>[d("保存")]})])])])})}}),El=lt("github",{name:"GitHub"}),Sl=lt("google",{name:"Google"}),Il=_({setup(){return()=>e("div",{class:l.tabContent},[e(Dl,null,null),e(Pl,null,null)])}}),Dl=_(()=>{const t=le(ue),{data:a,refetch:r}=me({queryKey:H.auth.passkeys(),queryFn:()=>V.getPasskeys()}),n=o=>{V.deletePasskey(o).then(()=>{r()})},s=_(o=>{const v=B(""),x=h=>{h.preventDefault(),h.stopPropagation(),Fe.createPassKey(v.value).then(()=>{r(),o.dialog.destroy()})};return()=>e(R,{onSubmit:x},{default:()=>[e(S,{label:"名称",required:!0},{default:()=>[e(F,{value:v.value,onUpdateValue:h=>{v.value=h},placeholder:"为这个 Passkey 起个名字…"},null)]}),e("div",{class:"flex justify-end"},[e(w,{disabled:v.value.length===0,type:"primary",onClick:x},{default:()=>[d("创建")]})])]})}),{data:c,refetch:p}=me({queryKey:H.options.detail("authSecurity"),queryFn:async()=>{const{data:o}=await G.get("authSecurity");return o}}),u=o=>{G.patch("authSecurity",{disablePasswordLogin:o}).then(()=>{p()})};return s.props=["dialog"],()=>e(O,{size:"small"},{default:()=>[e("div",{class:"mb-6 flex items-center justify-between"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[e(be,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("通行密钥")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[d("使用生物识别或安全密钥登录")])]),e("div",{class:"flex items-center gap-2"},[e(w,{type:"tertiary",onClick:()=>{Fe.validate(!0)}},{default:()=>[e(Wt,{class:"mr-1 size-4"},null),d("验证")]}),e(w,{type:"primary",onClick:()=>{const o=dialog.create({title:"创建 Passkey",content:()=>e(s,{dialog:o},null)})}},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("新增")]})])]),e("div",{class:"mb-4 flex items-center justify-between rounded-lg border border-neutral-200 bg-white px-4 py-3 dark:border-neutral-800 dark:bg-neutral-900"},[e("div",{class:"flex flex-col gap-0.5"},[e("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-200"},[d("禁止密码登录")]),e("span",{class:"text-xs text-neutral-500 dark:text-neutral-400"},[d("开启后只能通过 Passkey 或 OAuth 登录")])]),e(q,{value:c.value?.disablePasswordLogin,onUpdateValue:o=>{if(o&&!a.value?.length){message.error("至少需要一个 Passkey 才能开启这个功能");return}u(o)}},null)]),e("div",null,[a.value?a.value.length===0?e("div",{class:l.empty},[e("div",{class:l.emptyIcon},[e(Ye,null,null)]),e("h3",{class:l.emptyTitle},[d("暂无通行密钥")]),e("p",{class:l.emptyDescription},[d("添加一个通行密钥以启用无密码登录")])]):e(Ve,{scrollX:Math.max(600,t.contentWidth.value-t.contentInsetWidth.value),remote:!0,bordered:!1,data:a.value,columns:[{key:"name",title:"名称",render({name:o}){return e("div",{class:"flex items-center gap-2"},[e(be,{class:"size-4 text-blue-500"},null),e("span",{class:"font-medium"},[o])])}},{title:"创建时间",key:"created",render({created:o}){return e(re,{time:o},null)}},{title:"操作",key:"id",width:100,render({id:o,name:v}){return e(ee,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{n(o)}},{trigger:()=>e(w,{text:!0,type:"error"},{default:()=>[e(Q,{class:"size-4"},null)]}),default:()=>e("span",{class:"max-w-48"},[d('确定要删除 Passkey "'),v,d('"?')])})}}]},null):e(D,{text:!0,style:{width:"100%",height:"150px"}},null)])]})}),Pl=_(()=>{const t=Le(),a=xe(),r=B({});return W(async()=>{const{data:n}=await G.get("oauth");r.value=Bl(n)}),Cl()(r),W(async()=>{const n=t.query.validate;a.replace({query:{...t.query,validate:""}}),n&&await wl()&&(message.success("验证成功"),dialog.create({title:"设定为主人账户？",positiveText:"是",negativeText:"否",onPositiveClick(c){V.authAsOwner()}}))}),()=>e("section",{class:[l.settingsGroup,"mt-8"]},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(ht,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("OAuth 登录")]),e("p",{class:l.sectionSubtitle},[d("配置第三方账号登录方式")])])]),e("div",{class:l.authGrid},[e(El,null,null),e(Sl,null,null)])])}),Ml=t=>me({queryKey:I(()=>H.metaPresets.list()),queryFn:()=>$.getAll(gt(t)),select:a=>Array.isArray(a)?a:a?.data??[]}),Ol=()=>{const t=oe();return Z({mutationFn:({id:a,data:r})=>$.update(a,r),onSuccess:(a,{id:r})=>{window.message.success("修改成功"),t.invalidateQueries({queryKey:H.metaPresets.detail(r)}),t.invalidateQueries({queryKey:H.metaPresets.list()})}})},Tl=()=>{const t=oe();return Z({mutationFn:$.delete,onSuccess:()=>{window.message.success("删除成功"),t.invalidateQueries({queryKey:H.metaPresets.all})}})},Ul=()=>{const t=oe();return Z({mutationFn:a=>$.updateOrder(a),onSuccess:()=>{t.invalidateQueries({queryKey:H.metaPresets.list()})}})},zl={text:"文本",textarea:"多行文本",number:"数字",url:"URL",select:"单选","multi-select":"多选",checkbox:"复选框",tags:"标签",boolean:"开关",object:"对象"},ql={post:"博文",note:"笔记",both:"通用"},Ll={post:"info",note:"success",both:"warning"},Vl=_({name:"MetaPresetCard",props:{preset:{type:Object,required:!0},onEdit:{type:Function,required:!0},onDelete:{type:Function,required:!0},onToggleEnabled:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"group flex items-center gap-3 border-b border-neutral-200 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-900/50"},[!t.preset.isBuiltin&&e("div",{class:"shrink-0 cursor-grab text-neutral-300 dark:text-neutral-600"},[e(Ht,{class:"size-4"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex flex-wrap items-center gap-2"},[e("span",{class:"font-medium text-neutral-900 dark:text-neutral-100"},[t.preset.label]),e("code",{class:"rounded bg-neutral-100 px-1.5 py-0.5 font-mono text-xs text-neutral-500 dark:bg-neutral-800 dark:text-neutral-400"},[t.preset.key]),t.preset.isBuiltin&&e(ie,{size:"tiny",type:"default",round:!0},{icon:()=>e(Qe,{class:"size-3"},null),default:()=>e("span",{class:"text-xs"},[d("内置")])})]),e("div",{class:"mt-1 flex flex-wrap items-center gap-2 text-sm text-neutral-500 dark:text-neutral-400"},[e(ie,{size:"tiny",type:"info",bordered:!1},{default:()=>[zl[t.preset.type]]}),e(ie,{size:"tiny",type:Ll[t.preset.scope],bordered:!1},{default:()=>[ql[t.preset.scope]]}),t.preset.description&&e("span",{class:"truncate"},[t.preset.description])])]),e("div",{class:"ml-auto flex shrink-0 items-center gap-2"},[e(q,{size:"small",value:t.preset.enabled,onUpdateValue:()=>t.onToggleEnabled(t.preset)},null),!t.preset.isBuiltin&&e(w,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>t.onEdit(t.preset.id)},{default:()=>[e(xt,{class:"size-3.5"},null)]}),!t.preset.isBuiltin&&e(ee,{onPositiveClick:()=>t.onDelete(t.preset.id),positiveText:"删除",negativeText:"取消"},{trigger:()=>e(w,{size:"tiny",quaternary:!0,type:"error"},{default:()=>[e(Q,{class:"size-3.5"},null)]}),default:()=>e("span",null,[d("确定要删除预设字段「"),t.preset.label,d("」吗？")])})])])}}),Se=[{label:"文本",value:"text"},{label:"多行文本",value:"textarea"},{label:"数字",value:"number"},{label:"URL",value:"url"},{label:"单选",value:"select"},{label:"多选",value:"multi-select"},{label:"复选框",value:"checkbox"},{label:"标签",value:"tags"},{label:"开关",value:"boolean"},{label:"对象",value:"object"}],Rl=[{label:"博文",value:"post"},{label:"笔记",value:"note"},{label:"通用",value:"both"}],Ie=["select","multi-select","checkbox"],L=_({props:{label:{type:String,required:!0},required:{type:Boolean,default:!1},error:{type:String,required:!1},hint:{type:String,required:!1}},setup(t,{slots:a}){return()=>e("div",{class:"mb-4"},[e("label",{class:"mb-1.5 block text-sm font-medium text-neutral-700 dark:text-neutral-300"},[t.label,t.required&&e("span",{class:"ml-0.5 text-red-500"},[d("*")])]),a.default?.(),t.hint&&!t.error&&e("p",{class:"mt-1 text-xs text-neutral-400"},[t.hint]),t.error&&e("p",{class:"mt-1 text-xs text-red-500",role:"alert"},[t.error])])}}),Hl=_({name:"MetaPresetModal",props:{show:{type:Boolean,required:!0},onClose:{type:Function,required:!0},id:{type:String,required:!1},onSubmit:{type:Function,required:!1}},setup(t){const a=J({type:"text",scope:"both",enabled:!0}),r=B(!1),n=B(!1),s=J({}),c=()=>{Object.keys(a).forEach(m=>{delete a[m]}),a.type="text",a.scope="both",a.enabled=!0,Object.keys(s).forEach(m=>{delete s[m]})},p=()=>(Object.keys(s).forEach(m=>delete s[m]),a.key?.trim()?/^[\w-]+$/.test(a.key)||(s.key="Key 只能包含字母、数字、下划线和连字符"):s.key="请输入字段 Key",a.label?.trim()||(s.label="请输入显示名称"),a.type||(s.type="请选择字段类型"),Ie.includes(a.type)&&(!a.options||a.options.length===0)&&(s.options="请至少添加一个选项"),a.type==="object"&&(!a.children||a.children.length===0)&&(s.children="请至少添加一个子字段"),Object.keys(s).length===0);T(()=>t.id,m=>{m?(r.value=!0,$.getById(m).then(A=>{Object.assign(a,A)}).finally(()=>{r.value=!1})):c()});const u=()=>{t.onClose(),Ct(()=>c())},o=Z({mutationFn:m=>$.create(m),onSuccess:m=>{message.success("创建成功"),t.onSubmit?.(m),c()}}),v=Z({mutationFn:({id:m,data:A})=>$.update(m,A),onSuccess:m=>{message.success("修改成功"),t.onSubmit?.(m),c()}}),x=()=>{p()&&(n.value=!0,t.id?v.mutate({id:t.id,data:a},{onSettled:()=>n.value=!1}):o.mutate(a,{onSettled:()=>n.value=!1}))},h=m=>{m.key==="Enter"&&(m.metaKey||m.ctrlKey)&&x()},i=()=>{a.options||(a.options=[]),a.options.push({value:"",label:""})},b=m=>{a.options?.splice(m,1)},y=()=>{a.children||(a.children=[]),a.children.push({key:"",label:"",type:"text"})},g=m=>{a.children?.splice(m,1)};return()=>e(fe,{show:t.show,onUpdateShow:m=>{m||u()},closeOnEsc:!0,transformOrigin:"center"},{default:()=>[e("div",{class:"max-h-[90vh] w-full max-w-2xl overflow-hidden rounded-xl bg-white shadow-xl dark:bg-neutral-900",role:"dialog","aria-modal":"true","aria-labelledby":"meta-preset-modal-title",onKeydown:h},[e("div",{class:"flex items-center justify-between border-b border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e("h2",{id:"meta-preset-modal-title",class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[t.id?"编辑预设字段":"新建预设字段"]),e("button",{type:"button",class:"rounded-lg p-1 text-neutral-400 transition-colors hover:bg-neutral-100 hover:text-neutral-600 dark:hover:bg-neutral-800",onClick:u,"aria-label":"关闭"},[e(kt,{class:"size-5"},null)])]),e("div",{class:"max-h-[calc(90vh-140px)] overflow-y-auto px-5 py-4"},[r.value?e("div",{class:"flex items-center justify-center py-12"},[e(wt,{size:"medium"},null)]):e(P,null,[e("div",{class:"grid grid-cols-2 gap-4"},[e(L,{label:"字段 Key",required:!0,error:s.key},{default:()=>[e(F,{value:a.key,onUpdateValue:m=>a.key=m,placeholder:"如: music, movie"},null)]}),e(L,{label:"显示名称",required:!0,error:s.label},{default:()=>[e(F,{value:a.label,onUpdateValue:m=>a.label=m,placeholder:"如: 音乐, 电影"},null)]})]),e("div",{class:"grid grid-cols-2 gap-4"},[e(L,{label:"字段类型",required:!0,error:s.type},{default:()=>[e(U,{value:a.type,onUpdateValue:m=>a.type=m,options:Se},null)]}),e(L,{label:"作用域"},{default:()=>[e(U,{value:a.scope,onUpdateValue:m=>a.scope=m,options:Rl},null)]})]),e(L,{label:"描述",hint:"可选的字段描述"},{default:()=>[e(F,{value:a.description,onUpdateValue:m=>a.description=m,placeholder:"字段用途说明"},null)]}),e(L,{label:"占位文本",hint:"输入框占位提示文本"},{default:()=>[e(F,{value:a.placeholder,onUpdateValue:m=>a.placeholder=m,placeholder:"请输入..."},null)]}),Ie.includes(a.type)&&e(L,{label:"选项配置",required:!0,error:s.options},{default:()=>[e("div",{class:"space-y-2"},[a.options?.map((m,A)=>e("div",{key:A,class:"flex items-center gap-2"},[e(F,{value:m.value,onUpdateValue:f=>m.value=f,placeholder:"值",class:"flex-1"},null),e(F,{value:m.label,onUpdateValue:f=>m.label=f,placeholder:"显示文本",class:"flex-1"},null),e(w,{quaternary:!0,type:"error",onClick:()=>b(A)},{default:()=>[e(Q,{class:"size-4"},null)]})])),e(w,{quaternary:!0,type:"primary",onClick:i},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("添加选项")]})]),(a.type==="select"||a.type==="multi-select")&&e("div",{class:"mt-2 flex items-center gap-2"},[e(Bt,{checked:a.allowCustomOption,onUpdateChecked:m=>a.allowCustomOption=m},{default:()=>[d("允许自定义选项")]})])]}),a.type==="object"&&e(L,{label:"子字段配置",required:!0,error:s.children},{default:()=>[e("div",{class:"space-y-3"},[a.children?.map((m,A)=>e("div",{key:A,class:"rounded-lg border border-neutral-200 p-3 dark:border-neutral-700"},[e("div",{class:"mb-2 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-400"},[d("子字段 "),A+1]),e(w,{quaternary:!0,type:"error",size:"tiny",onClick:()=>g(A)},{default:()=>[e(Q,{class:"size-3.5"},null)]})]),e("div",{class:"grid grid-cols-3 gap-2"},[e(F,{value:m.key,onUpdateValue:f=>m.key=f,placeholder:"Key",size:"small"},null),e(F,{value:m.label,onUpdateValue:f=>m.label=f,placeholder:"显示名称",size:"small"},null),e(U,{value:m.type,onUpdateValue:f=>m.type=f,options:Se.filter(f=>f.value!=="object"),size:"small"},null)])])),e(w,{quaternary:!0,type:"primary",onClick:y},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("添加子字段")]})])]}),e("div",{class:"flex items-center justify-between rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 dark:border-neutral-700 dark:bg-neutral-800"},[e("div",null,[e("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-200"},[d("启用此预设")]),e("p",{class:"text-xs text-neutral-500 dark:text-neutral-400"},[d("禁用后不会在写作页面显示")])]),e(q,{value:a.enabled,onUpdateValue:m=>a.enabled=m},null)])])]),e("div",{class:"flex items-center justify-end gap-2 border-t border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e(w,{onClick:u},{default:()=>[d("取消")]}),e(w,{type:"primary",loading:n.value,disabled:r.value,onClick:x},{default:()=>[t.id?"保存修改":"创建预设"]})])])]})}}),jl=_({name:"TabMetaPresets",setup(){const t=oe(),{data:a,isLoading:r}=Ml(),n=Tl(),s=Ol(),c=Ul(),p=B(!1),u=B(""),o=()=>{u.value="",p.value=!0},v=k=>{u.value=k,p.value=!0},x=k=>{n.mutate(k)},h=k=>{s.mutate({id:k.id,data:{enabled:!k.enabled}})},i=()=>{p.value=!1,u.value=""},b=()=>{i(),t.invalidateQueries({queryKey:H.metaPresets.all})},y=B(null),g=k=>{y.value=k},m=(k,E)=>{k.preventDefault(),y.value===null||y.value},A=(k,E)=>{if(k.preventDefault(),y.value===null||!a.value)return;const M=[...a.value],[ct]=M.splice(y.value,1);M.splice(E,0,ct);const dt=M.map(pt=>pt.id);c.mutate(dt),y.value=null},f=()=>{y.value=null};return()=>e("div",{class:l.tabContent},[e(O,{size:"small"},{default:()=>[e("div",{class:"mb-6 flex items-center justify-between"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[e(ke,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("Meta 预设字段")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[d("配置可复用的自定义 meta 字段（如音乐、电影、书籍等元数据模板）")])]),e(w,{type:"primary",onClick:o},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("新增预设")]})]),r.value?e(Nl,null,null):!a.value||a.value.length===0?e(Kl,{onAdd:o},null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[a.value.map((k,E)=>e("div",{key:k.id,draggable:!k.isBuiltin,onDragstart:()=>g(E),onDragover:M=>m(M,E),onDrop:M=>A(M,E),onDragend:f,class:["transition-all",y.value===E&&"opacity-50"]},[e(Vl,{preset:k,onEdit:v,onDelete:x,onToggleEnabled:h},null)]))])]}),e(Hl,{show:p.value,id:u.value,onClose:i,onSubmit:b},null)])}}),Kl=_({props:{onAdd:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(ke,{class:"size-8 text-neutral-400","aria-hidden":"true"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[d("暂无预设字段")]),e("p",{class:"mb-6 text-sm text-neutral-500 dark:text-neutral-400"},[d("创建预设字段来快速配置文章和笔记的元数据")]),e(w,{type:"primary",onClick:t.onAdd},{default:()=>[d("创建第一个预设")]})])}}),Nl=_({setup(){return()=>e("div",{class:"animate-pulse overflow-hidden rounded-lg border border-neutral-200 dark:border-neutral-800"},[[1,2,3].map(t=>e("div",{key:t,class:"flex items-center gap-4 border-b border-neutral-200 px-4 py-4 last:border-b-0 dark:border-neutral-800"},[e("div",{class:"size-5 rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"flex-1"},[e("div",{class:"h-5 w-32 rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"mt-2 h-4 w-48 rounded bg-neutral-100 dark:bg-neutral-800"},null)]),e("div",{class:"flex gap-2"},[e("div",{class:"h-6 w-16 rounded bg-neutral-100 dark:bg-neutral-800"},null),e("div",{class:"h-6 w-16 rounded bg-neutral-100 dark:bg-neutral-800"},null)])]))])}});function pe(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Re(t)}const Gl="mt-6",$l={class:Gl,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},ut=Symbol("JSONSchemaFormInject"),Wl=_({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:t=>t},extendConfigView:{type:Object}},setup(t,{slots:a}){const r=B(t.initialValue);he(()=>{t.onValueChange?.(r.value)},{flush:"post"});const n=I(()=>t.schema.definitions),s=I(()=>new Map(Object.entries(t.schema.definitions)));Ue(ut,{schema:t.schema,definitions:s,getKey:t.getKey});const c=I(()=>Object.keys(n.value)),p=B([c.value[0]]),u=le(ue),o=J($l);return T(()=>u.viewport.value.mobile,v=>{v?(o.labelPlacement="top",o.labelAlign="left"):(o.labelPlacement="left",o.labelAlign="right")},{immediate:!0}),()=>{let v,x;const{schema:h}=t;return e(P,null,[e(Ft,{accordion:!0,defaultExpandedNames:p.value,displayDirective:"if"},pe(v=c.value.map(i=>{const b=n.value[i];if(!b.title)return null;switch((b?.["ui:options"]||{})?.type){case"hidden":return null}const g=!!a[i];return e(_t,{title:b.title,"data-schema":JSON.stringify(b)},{default:()=>[e(R,o,{default:()=>[g?a[i]?.():e(P,null,[e(st,{dataKey:t.getKey(i),formData:r,schema:b,property:i},null),t.extendConfigView?.[i]])]})]})}))?v:{default:()=>[v]}),h.ps.length?e(z,{vertical:!0},pe(x=h.ps.map(i=>e(se,{class:"ml-4 mt-8 inline-block text-xs",depth:3},pe(i)?i:{default:()=>[i]})))?x:{default:()=>[x]}):null])}}}),st=_({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0},property:{type:String}},setup(t){const{definitions:a,getKey:r}=Te(ut,{});return()=>{const{schema:n,formData:s,dataKey:c,property:p}=t;return n?e(P,null,[Object.keys(n.properties).map(u=>{const o=n.properties[u];if(o.$ref){const v=a.value.get(o.$ref.split("/").at(-1));return e(st,{dataKey:`${r(c)}.${u}`,formData:s,schema:v,property:u},null)}return e(Ql,{value:ce(s.value,`${r(c)}.${u}`,void 0),onUpdateValue:v=>{ce(s.value,r(c))?Ee(s.value,`${r(c)}.${u}`,v):Ee(s.value,r(c),{...ce(s.value,r(c),{}),[u]:v})},title:o.title,type:o.type,options:o?.["ui:options"],description:o.description},null)})]):null}}}),Ql=_({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(t){const a=B(t.value);he(()=>{t.onUpdateValue(a.value)});const r=()=>{const{options:c}=t;switch(t.type){case"url":case"string":{const{type:p}=c;switch(p){case"select":{const{values:u}=c;return e(U,{value:a.value,onUpdateValue:o=>{a.value=o},options:u,filterable:!0},null)}default:return e(F,{inputProps:{id:It()},value:a.value,onUpdateValue:u=>{a.value=u},type:p||"text",showPasswordOn:"click",autosize:p=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}}case"array":return e(St,{value:a.value,onUpdateValue:p=>{a.value=p}},null);case"boolean":return e(q,{value:a.value,onUpdateValue:p=>{a.value=p}},null);case"number":case"integer":return e(Et,{value:a.value,onUpdateValue:p=>{a.value=p}},null);default:return null}},n=le(ue),s=I(()=>n.viewport.value.mobile?1:2);return()=>{const{title:c,options:p,description:u}=t,o=e(P,null,[e(S,{label:c},{default:()=>[u?e(z,{class:"w-full",vertical:!0},{default:()=>[r(),e(se,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:At.parse(u)},null)]})]}):r()]})]);return p.halfGrid&&s.value===2?e("div",{class:"inline-block w-1/2"},[o]):o}}});var C=(function(t){return t.OpenAI="openai",t.OpenAICompatible="openai-compatible",t.Anthropic="anthropic",t.OpenRouter="openrouter",t})(C||{});const nt=[{label:"OpenAI",value:C.OpenAI},{label:"OpenAI 兼容 (DeepSeek/Groq 等)",value:C.OpenAICompatible},{label:"Anthropic (Claude)",value:C.Anthropic},{label:"OpenRouter",value:C.OpenRouter}],Jl=t=>nt.find(a=>a.value===t)?.label||t,Xl=t=>{const a=t.name?.trim(),r=Jl(t.type);return a||r},rt=t=>{switch(t){case C.Anthropic:return"claude-sonnet-4.5";case C.OpenAI:return"gpt-5-mini";case C.OpenRouter:return"anthropic/claude-sonnet-4.5";case C.OpenAICompatible:return"";default:return""}},Zl=t=>{switch(t){case C.Anthropic:return"如 Claude Sonnet";case C.OpenAI:return"如 OpenAI GPT-4o";case C.OpenRouter:return"如 OpenRouter";case C.OpenAICompatible:return"如 DeepSeek";default:return""}},Yl=t=>{switch(t){case C.Anthropic:return"如 claude-sonnet-4.5";case C.OpenAI:return"如 gpt-5-mini";case C.OpenRouter:return"如 anthropic/claude-sonnet-4.5";case C.OpenAICompatible:return"如 deepseek-chat";default:return""}},eu=_({props:{provider:{type:Object,required:!0},onUpdate:{type:Function,required:!0},onDelete:{type:Function,required:!0},onTest:{type:Function},availableModels:{type:Array,default:()=>[]},isLoadingModels:{type:Boolean,default:!1},isTesting:{type:Boolean,default:!1},onRefreshModels:{type:Function}},setup(t){const a=B({...t.provider});T(()=>t.provider,u=>{a.value={...u}},{deep:!0});const r=(u,o)=>{a.value[u]=o,t.onUpdate(a.value)},n=u=>{a.value.type=u,a.value.defaultModel=rt(u),t.onUpdate(a.value)},s=I(()=>t.availableModels.map(u=>({label:u.name||u.id,value:u.id}))),c=I(()=>a.value.type===C.OpenAICompatible||a.value.type===C.OpenAI||a.value.type===C.OpenRouter),p=I(()=>{if(a.value.name)return a.value.name;switch(a.value.type){case C.Anthropic:return"Anthropic (Claude)";case C.OpenAI:return"OpenAI";case C.OpenRouter:return"OpenRouter";case C.OpenAICompatible:return"OpenAI 兼容";default:return"新 Provider"}});return()=>e(O,{title:p.value,size:"small",class:"mb-4"},{default:()=>e(R,{labelPlacement:"left",labelWidth:120},{default:()=>[e(S,{label:"类型"},{default:()=>[e(U,{value:a.value.type,onUpdateValue:n,options:nt},null)]}),e(S,{label:"显示名称"},{default:()=>[e(F,{value:a.value.name,onUpdateValue:u=>r("name",u),placeholder:Zl(a.value.type)},null)]}),e(S,{label:"API Key"},{default:()=>[e(F,{type:"password",showPasswordOn:"click",value:a.value.apiKey,onUpdateValue:u=>r("apiKey",u),placeholder:a.value.type===C.Anthropic?"sk-ant-...":a.value.type===C.OpenRouter?"sk-or-...":"sk-..."},null)]}),c.value&&e(S,{label:"Endpoint"},{default:()=>[e(F,{value:a.value.endpoint,onUpdateValue:u=>r("endpoint",u),placeholder:a.value.type===C.OpenAICompatible?"必填，如 https://api.deepseek.com":a.value.type===C.OpenRouter?"可选，默认 https://openrouter.ai/api/v1":"可选，留空使用默认"},null)]}),e(S,{label:"默认模型"},{default:()=>[e(z,{align:"center"},{default:()=>[t.availableModels.length>0?e(U,{value:a.value.defaultModel,onUpdateValue:u=>r("defaultModel",u),options:s.value,filterable:!0,tag:!0,style:"min-width: 200px",placeholder:"选择或输入模型名"},null):e(F,{value:a.value.defaultModel,onUpdateValue:u=>r("defaultModel",u),placeholder:Yl(a.value.type),style:"min-width: 200px"},null),e(w,{tertiary:!0,type:"primary",loading:t.isLoadingModels,onClick:()=>t.onRefreshModels?.()},{default:()=>[d("获取模型列表")]})]})]}),e(S,{label:"启用"},{default:()=>[e(q,{value:a.value.enabled,onUpdateValue:u=>r("enabled",u)},null)]})]}),action:()=>e("div",{class:"flex justify-end"},[e(z,{align:"center"},{default:()=>[e(te,{variant:"success",icon:e(ae,null,null),name:"测试连接",disabled:t.isTesting||!a.value.defaultModel,onClick:()=>t.onTest?.(a.value)},null),e(Dt,{onDelete:()=>t.onDelete(),message:"确定删除此 Provider？"},null)]})])})}}),ve=_({props:{label:{type:String,required:!0},description:{type:String},assignment:{type:Object},providers:{type:Array,required:!0},providerModels:{type:Object,default:()=>({})},onUpdate:{type:Function,required:!0}},setup(t){const a=B(t.assignment?.providerId||""),r=B(t.assignment?.model||"");T(()=>t.assignment,v=>{a.value=v?.providerId||"",r.value=v?.model||""},{deep:!0});const n=I(()=>t.providers.map(v=>({label:Xl(v),value:v.id,disabled:!v.enabled}))),s=I(()=>a.value?t.providerModels[a.value]||[]:[]),c=I(()=>{const v=s.value.map(h=>({label:h.name||h.id,value:h.id})),x=t.providers.find(h=>h.id===a.value);return x?.defaultModel&&(v.some(i=>i.value===x.defaultModel)||v.unshift({label:`${x.defaultModel} (默认)`,value:x.defaultModel})),v}),p=v=>{a.value=v,r.value="",o()},u=v=>{r.value=v,o()},o=()=>{a.value?t.onUpdate({providerId:a.value,model:r.value||void 0}):t.onUpdate(void 0)};return()=>e(S,{label:t.label},{default:()=>[e(z,{vertical:!0,class:"w-full"},{default:()=>[e(z,null,{default:()=>[e(U,{value:a.value||null,onUpdateValue:p,options:n.value,placeholder:"选择 Provider",clearable:!0,style:"min-width: 180px"},null),e(U,{value:r.value||null,onUpdateValue:u,options:c.value,placeholder:"使用 Provider 默认模型",clearable:!0,filterable:!0,tag:!0,style:"min-width: 200px",disabled:!a.value},null)]}),t.description&&e(se,{depth:3,class:"text-xs"},{default:()=>[t.description]})]})]})}}),tu=_({props:{value:{type:Object,required:!0},onUpdate:{type:Function,required:!0}},setup(t){const a=B({}),r=B(new Set),n=B(new Set),s=I({get:()=>t.value,set:i=>t.onUpdate(i)}),c=async i=>{r.value.add(i.id);try{const b=await de.getModelList({providerId:i.id,type:i.type,apiKey:i.apiKey||void 0,endpoint:i.endpoint||void 0});b.models&&(a.value[i.id]=b.models),b.error&&message.warning(`获取模型列表: ${b.error}`)}catch(b){console.error(`Failed to fetch models for ${i.id}:`,b),b?.response||message.error(`获取模型列表失败: ${b.message||b}`)}finally{r.value.delete(i.id)}},p=async()=>{try{const i=await de.getModels();for(const b of i)b.models&&(a.value[b.provider]=b.models)}catch(i){console.error("Failed to fetch all models:",i)}},u=async i=>{if(!i.defaultModel){message.warning("请先填写默认模型");return}n.value.add(i.id);try{await de.testConfig({providerId:i.id,type:i.type,apiKey:i.apiKey||void 0,endpoint:i.endpoint||void 0,model:i.defaultModel||void 0}),message.success("连接可用")}catch(b){console.error(`Failed to test provider ${i.id}:`,b),b?.response||message.error(`连接失败: ${b.message||b}`)}finally{n.value.delete(i.id)}};W(()=>{s.value.providers?.some(i=>i.enabled)&&p()});const o=i=>{t.onUpdate({...s.value,...i})},v=(i,b)=>{const y=[...s.value.providers||[]];y[i]=b,o({providers:y})},x=i=>{const b=(s.value.providers||[]).filter((y,g)=>g!==i);o({providers:b})},h=()=>{const i=C.OpenAI,b={id:crypto.randomUUID(),name:"",type:i,apiKey:"",defaultModel:rt(i),enabled:!0};o({providers:[...s.value.providers||[],b]})};return()=>e(z,{vertical:!0,size:"large",class:"w-full"},{default:()=>[e(O,{title:"AI Providers",size:"small"},{default:()=>[e(z,{vertical:!0,class:"w-full"},{default:()=>[s.value.providers?.map((i,b)=>e(eu,{key:i.id,provider:i,onUpdate:y=>v(b,y),onDelete:()=>x(b),onTest:y=>u(y),availableModels:a.value[i.id]||[],isLoadingModels:r.value.has(i.id),isTesting:n.value.has(i.id),onRefreshModels:()=>c(i)},null)),e(w,{onClick:h,dashed:!0,block:!0},{default:()=>[d("+ 添加 Provider")]})]})]}),e(O,{title:"功能模型分配",size:"small"},{default:()=>[e(R,{labelPlacement:"left",labelWidth:150},{default:()=>[e(ve,{label:"摘要功能",description:"用于生成文章摘要的模型",assignment:s.value.summaryModel,providers:s.value.providers||[],providerModels:a.value,onUpdate:i=>o({summaryModel:i})},null),e(ve,{label:"写作助手",description:"用于生成标题、Slug 等的模型",assignment:s.value.writerModel,providers:s.value.providers||[],providerModels:a.value,onUpdate:i=>o({writerModel:i})},null),e(ve,{label:"评论审核",description:"用于审核评论的模型",assignment:s.value.commentReviewModel,providers:s.value.providers||[],providerModels:a.value,onUpdate:i=>o({commentReviewModel:i})},null)]})]}),e(O,{title:"功能开关",size:"small"},{default:()=>[e(R,{labelPlacement:"left",labelWidth:200},{default:()=>[e(S,{label:"启用 AI 摘要"},{default:()=>[e(q,{value:s.value.enableSummary,onUpdateValue:i=>o({enableSummary:i})},null)]}),e(S,{label:"自动生成摘要"},{default:()=>[e(z,{vertical:!0},{default:()=>[e(q,{value:s.value.enableAutoGenerateSummary,onUpdateValue:i=>o({enableAutoGenerateSummary:i}),disabled:!s.value.enableSummary},null),e(se,{depth:3,class:"text-xs"},{default:()=>[d("发布文章时自动生成摘要")]})]})]}),e(S,{label:"摘要目标语言"},{default:()=>[e(F,{value:s.value.aiSummaryTargetLanguage,onUpdateValue:i=>o({aiSummaryTargetLanguage:i}),placeholder:"auto 或 ISO 639-1 语言代码",style:"max-width: 200px"},null)]})]})]})]})}}),au="mt-6",lu={class:au,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},De={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},uu=_(()=>{const{setActions:t}=He();W(()=>{t(e(te,{disabled:!0,onClick:c,icon:e(ae,null,null)},null))}),je(()=>{t(null)});const a=B();Ke(async()=>{a.value=await G.getJsonSchema(),await p()});let r={};const n=J({}),s=B({});T(()=>n,v=>{s.value=Ge(r,Pt(v))},{deep:!0}),T(()=>s.value,v=>{let x=!1;ye(v)?x=!1:x=!0,t(e(te,{disabled:!x,icon:e(ae,null,null),onClick:c},null))});async function c(){if(ye(s.value))return;const v=Object.entries(s.value);for await(const[x,h]of v){const i=Object.fromEntries(Object.entries(h).map(([b,y])=>Array.isArray(y)?[b,n[x][b]]:[b,y]));await G.patch(x,i)}await p(),message.success("修改成功")}const p=async()=>{let v=await G.getAll();v=aa(a.value.default,v),r=Y(v),Object.assign(n,v)},u=le(ue),o=J(lu);return T(()=>u.viewport.value.mobile,v=>{v?(o.labelPlacement="top",o.labelAlign="left"):(o.labelPlacement="left",o.labelAlign="right")},{immediate:!0}),()=>e("div",{class:l.tabContent},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(Ne,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("系统设置")]),e("p",{class:l.sectionSubtitle},[d("配置站点信息、SEO 设置、邮件服务等")])])]),e("div",{class:l.card},[a.value&&e(Wl,{initialValue:n,getKey:v=>v.split(".").map(x=>sa(x)).join(".").replace("Dto",""),schema:a.value},{AIDto:()=>e(tu,{value:n.ai||{},onUpdate:v=>{n.ai=v}},null)})])])});function ot(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Re(t)}const su=_(()=>{const t=B([]),a=B(!0),r=async()=>{a.value=!0;const c=await N.getSessions();t.value=c.data?.map(p=>({...p,date:p.lastActiveAt}))||[],a.value=!1};W(()=>{r()});const n=async(c,p)=>{c?(await N.logout(),We(),await qe.signOut(),window.location.reload()):(await N.deleteSession(p),t.value=t.value.filter(u=>u.id!==p))},s=async()=>{await N.deleteAllSessions(),await r()};return()=>e("div",{class:l.tabContent},[e("div",{class:l.settingsGroup},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(Mt,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("登录设备")]),e("p",{class:l.sectionSubtitle},[d("管理你的登录会话，保护账户安全")])]),e(ee,{onPositiveClick:s},{trigger:()=>e(w,{size:"small",type:"error",tertiary:!0,disabled:t.value.length===1&&t.value[0]?.current},{default:()=>[e(Q,{class:"mr-1 size-4"},null),d("踢掉全部")]}),default:()=>"确定踢掉全部登录设备（除当前会话）？"})]),a.value?e(nu,null,null):e("div",{class:l.sessionList},[t.value.map(({id:c,ua:p,ip:u,date:o,current:v})=>e("div",{key:c,class:[l.sessionItem,v&&l.sessionItemCurrent]},[e("div",{class:l.sessionHeader},[e("span",{class:[l.sessionBadge,v?l.sessionBadgeCurrent:l.sessionBadgeOther]},[v?e(P,null,[e(ge,{class:"size-3"},null),d("当前设备")]):e(P,null,[e(Qt,{class:"size-3"},null),d("其他设备")])]),e(ee,{onPositiveClick:()=>n(!!v,c)},{trigger:()=>e(w,{size:"small",type:v?"warning":"error",tertiary:!0},{default:()=>[v?"注销":"踢出"]}),default:()=>v?"确定要注销当前会话？":"确定要踢出此设备？"})]),e("div",{class:l.sessionContent},[p&&e("div",{class:l.sessionUA},[p]),e("div",{class:"mt-3 flex flex-wrap items-center gap-4 text-sm"},[u&&e("div",{class:l.sessionRow},[e(Je,{class:"size-4 text-neutral-400"},null),e($e,{ip:u,triggerEl:e(w,{quaternary:!0,size:"tiny",type:"primary"},ot(u)?u:{default:()=>[u]})},null)]),e("div",{class:l.sessionRow},[e("span",{class:l.sessionLabel},[v?"活跃时间:":"登录时间:"]),e(re,{time:o},null)])])])]))])]),e("div",{class:l.settingsGroup},[e(ou,null,null)]),e("div",{class:l.settingsGroup},[e(ru,null,null)])])}),nu=_(()=>()=>e("div",{class:l.sessionList},[Array.from({length:3}).map((t,a)=>e("div",{key:a,class:l.sessionItem},[e("div",{class:l.sessionHeader},[e(D,{text:!0,style:{width:"80px",height:"24px"}},null),e(D,{text:!0,style:{width:"60px",height:"28px"}},null)]),e(D,{text:!0,style:{width:"100%",height:"40px",marginTop:"12px"}},null),e("div",{class:"mt-3 flex gap-4"},[e(D,{text:!0,style:{width:"100px"}},null),e(D,{text:!0,style:{width:"120px"}},null)])]))])),ru=_(()=>{const t=B([]),a=B(!0),r=()=>({name:"",expired:!1,expiredTime:new Date}),n=J(r()),s=async()=>{a.value=!0;const{data:y}=await V.getTokens();t.value=y,a.value=!1};Ke(()=>{s()});const c=B(!1),p=B(!1),u=B(null),o=B(new Set),v=async()=>{try{const y={name:n.name,expired:n.expired?n.expiredTime.toISOString():void 0},g=await V.createToken(y);try{await navigator.clipboard.writeText(g.token)}catch{console.warn("复制到剪贴板失败")}c.value=!1;const m=r();for(const f in m)n[f]=m[f];u.value=g,p.value=!0,await s();const A=t.value.findIndex(f=>f.name===y.name);A!==-1&&(t.value[A].token=g.token)}catch{message.error("创建 Token 失败，请重试")}},x=async y=>{await V.deleteToken(y),message.success("删除成功");const g=t.value.findIndex(m=>m.id===y);g!==-1&&t.value.splice(g,1)},h=async y=>{const g=y.id;if(o.value.has(g))o.value.delete(g);else try{const m=await V.getToken(g),A=t.value.findIndex(f=>f.id===g);A!==-1&&(t.value[A].token=m.token),o.value.add(g)}catch(m){console.error("获取Token详情失败:",m),message.error("获取Token详情失败，请重试")}},i=async y=>{try{await navigator.clipboard.writeText(y),message.success("Token 已复制到剪贴板")}catch{const g=document.createElement("textarea");g.value=y,g.style.position="fixed",g.style.left="-9999px",document.body.appendChild(g),g.focus(),g.select();try{document.execCommand("copy"),message.success("Token 已复制到剪贴板")}catch{message.error("复制失败，请手动复制Token")}document.body.removeChild(g)}},b=le(ue);return()=>e(P,null,[e("div",{class:l.tokenCard},[e("div",{class:l.tokenHeader},[e("div",null,[e("h3",{class:l.tokenTitle},[e(Ye,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("API Token")]),e("p",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-400"},[d("用于 API 调用的访问令牌")])]),e(w,{type:"primary",onClick:()=>{c.value=!0}},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("新增 Token")]})]),a.value?e(D,{text:!0,style:{width:"100%",height:"200px"}},null):e(Ve,{scrollX:Math.max(800,b.contentWidth.value-b.contentInsetWidth.value),remote:!0,bordered:!1,data:t.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render(y){const{token:g,id:m}=y;return o.value.has(m)&&g&&g!=="*".repeat(40)?e(w,{text:!0,type:"primary",onClick:()=>i(g),class:"max-w-[200px] truncate text-left font-mono"},ot(g)?g:{default:()=>[g]}):e("span",{class:"font-mono text-neutral-400"},["•".repeat(32)])}},{title:"创建时间",key:"created",render({created:y}){return e(re,{time:y},null)}},{title:"过期时间",key:"expired",render({expired:y}){return y?Ae(y,"yyyy 年 M 月 d 日 HH:mm:ss"):e("span",{class:"text-neutral-400"},[d("永不过期")])}},{title:"操作",key:"id",render(y){const{id:g,name:m}=y,A=o.value.has(g);return e("div",{class:"flex items-center gap-2"},[e(w,{text:!0,type:"primary",onClick:()=>h(y)},{default:()=>[A?e(Tt,{class:"size-4"},null):e(Ut,{class:"size-4"},null)]}),e(ee,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{x(g)}},{trigger:()=>e(w,{text:!0,type:"error"},{default:()=>[e(Q,{class:"size-4"},null)]}),default:()=>e("span",{class:"max-w-48"},[d('确定要删除 Token "'),m,d('"?')])})])}}]},null)]),e(fe,{transformOrigin:"center",show:c.value,onUpdateShow:y=>void(c.value=y)},{default:()=>[e(O,{bordered:!1,title:"创建 Token",class:"w-[500px] max-w-full"},{default:()=>[e(R,null,{default:()=>[e(S,{label:"名称",required:!0},{default:()=>[e(F,{value:n.name,onInput:y=>void(n.name=y),placeholder:"为这个 Token 起个名字…"},null)]}),e(S,{label:"是否过期"},{default:()=>[e(q,{value:n.expired,onUpdateValue:y=>void(n.expired=y)},null)]}),e(S,{label:"过期时间"},{default:()=>[e(zt,{disabled:!n.expired,value:n.expiredTime.getTime(),type:"datetime",onUpdateValue:y=>void(n.expiredTime=new Date(y))},null)]})]}),e("div",{class:"flex justify-end gap-3"},[e(w,{onClick:()=>void(c.value=!1)},{default:()=>[d("取消")]}),e(w,{type:"primary",disabled:!n.name.trim(),onClick:v},{default:()=>[d("确定")]})])]})]}),e(fe,{transformOrigin:"center",show:p.value,onUpdateShow:y=>void(p.value=y)},{default:()=>[e(O,{bordered:!1,title:"Token 创建成功",class:"w-[600px] max-w-full",closable:!0,onClose:()=>void(p.value=!1)},{default:()=>[e("div",{class:"space-y-4"},[e("div",{class:"flex items-center gap-2 rounded-lg bg-green-50 px-4 py-3 text-green-700 dark:bg-green-900/20 dark:text-green-400"},[e(ge,{class:"size-5"},null),e("span",null,[d("Token 创建成功，请妥善保存")])]),e("div",{class:"space-y-3"},[e("div",{class:l.infoRow},[e("span",{class:l.infoLabel},[d("Token 名称:")]),e("span",{class:l.infoValue},[u.value?.name])]),e("div",null,[e("div",{class:"mb-2 text-sm font-medium text-neutral-700 dark:text-neutral-300"},[d("Token:")]),e("div",{class:"flex items-center gap-2 rounded-lg border border-neutral-200 bg-neutral-50 p-3 dark:border-neutral-700 dark:bg-neutral-800"},[e(se,{code:!0,class:"flex-1 break-all text-sm"},{default:()=>[u.value?.token]}),e(w,{size:"small",type:"primary",onClick:async()=>{u.value?.token&&await i(u.value.token)}},{default:()=>[e(ze,{class:"size-4"},null)]})])]),u.value?.expired&&e("div",{class:l.infoRow},[e("span",{class:l.infoLabel},[d("过期时间:")]),e("span",{class:l.infoValue},[Ae(u.value.expired,"yyyy 年 M 月 d 日 HH:mm:ss")])])]),e("div",{class:"rounded-lg bg-amber-50 px-4 py-3 text-sm text-amber-700 dark:bg-amber-900/20 dark:text-amber-400"},[d("请将此 Token 保存在安全的地方，关闭此窗口后将无法再次查看完整 Token。")])]),e("div",{class:"mt-6 flex justify-end"},[e(w,{type:"primary",onClick:()=>void(p.value=!1)},{default:()=>[d("我已保存")]})])]})]})])}),ou=_(()=>{const t=J({password:"",reenteredPassword:""}),a=B(),r=xe(),n=async()=>{a.value&&a.value.validate(async c=>{c||(await N.updateMaster({password:t.password}),message.success("密码修改成功，请重新登录"),We(),r.push({name:Ot.Login}))})};function s(c,p){return p===t.password}return()=>e("div",{class:l.passwordSection},[e("div",{class:l.passwordHeader},[e("div",{class:l.passwordIcon},[e(Qe,null,null)]),e("div",null,[e("h3",{class:l.passwordTitle},[d("修改密码")]),e("p",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-400"},[d("修改后需要重新登录")])])]),e(R,{ref:a,model:t,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:s,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},{default:()=>[e("div",{class:"grid gap-4 md:grid-cols-2"},[e(S,{label:"新密码",required:!0,path:"password"},{default:()=>[e(F,_e(De,{value:t.password,onInput:c=>void(t.password=c),type:"password",showPasswordOn:"click",placeholder:"输入新密码"}),null)]}),e(S,{label:"确认密码",required:!0,path:"reenteredPassword"},{default:()=>[e(F,_e(De,{value:t.reenteredPassword,onInput:c=>void(t.reenteredPassword=c),type:"password",showPasswordOn:"click",placeholder:"再次输入新密码"}),null)]})]),e("div",{class:"mt-4 flex justify-end"},[e(w,{onClick:n,type:"primary"},{default:()=>[e(et,{class:"mr-1 size-4"},null),d("修改密码")]})])]})])}),Pe={GitHub:"github",Weibo:"weibo",网易云:"netease",哔哩哔哩:"bilibili"},it=_(()=>{const t=B({}),a=B(!0);let r;async function n(){a.value=!0;const f=await N.getMaster();t.value=f,r=Y(f),a.value=!1}W(async()=>{await n()});const s=qt(),c=I(()=>Ge(r,t.value)),p=I(()=>!ye(c.value)),{setActions:u}=He(),o=Z({mutationFn:N.updateMaster,onSuccess:async()=>{s.success("保存成功"),await n()}}),v=()=>{if(!p.value)return;const f=Y(Rt(c));f.socialIds&&(f.socialIds=t.value.socialIds),o.mutate(f)};W(()=>{u(e(te,{disabled:!0,onClick:v,icon:e(ae,null,null)},null))}),je(()=>{u(null)}),T(()=>p.value,f=>{u(e(te,{disabled:!f,icon:e(ae,null,null),onClick:v},null))});const x=Object.keys(Pe).map(f=>({label:f,value:Pe[f]})),h=I(()=>{const f=t.value.socialIds||{};return Object.entries(f).map(([k,E])=>({key:k,value:String(E)}))}),i=I(()=>new Set(h.value.map(f=>f.key))),b=()=>{t.value.socialIds||(t.value.socialIds={});const f=x.find(k=>!i.value.has(k.value))?.value||"";t.value.socialIds={...t.value.socialIds,[f]:""}},y=(f,k)=>{if(f===k)return;const E={...t.value.socialIds},M=E[f];delete E[f],E[k]=M,t.value.socialIds=E},g=(f,k)=>{t.value.socialIds={...t.value.socialIds,[f]:k}},m=f=>{const k={...t.value.socialIds};delete k[f],t.value.socialIds=k},A=f=>{const k=JSON.parse((f.event?.target).responseText);return f.file.url=k.url,t.value.avatar=k.url,f.file};return()=>e("div",{class:l.userTabContainer},[a.value?e(iu,null,null):e(P,null,[e("section",{class:l.userSection},[e("div",{class:l.userSectionHeader},[e("div",{class:l.avatarContainer},[e(Kt,{onFinish:A,type:"avatar"},{default:()=>e("div",{class:l.avatarWrapper},[e(Lt,{src:t.value.avatar,size:128},null),e("div",{class:l.avatarUploadOverlay},[e($t,{class:l.avatarUploadIcon},null)])])})]),e("div",{class:l.userHeaderInfo},[e("h2",{class:l.userName},[t.value.name||"–"]),e("p",{class:l.userHandle},[d("@"),t.value.username]),e("div",{class:l.userMeta},[t.value.mail&&e("span",{class:l.userMetaItem},[e(Nt,{class:l.userMetaIcon,"aria-hidden":"true"},null),t.value.mail]),t.value.lastLoginTime&&e("span",{class:l.userMetaItem},[e(Gt,{class:l.userMetaIcon,"aria-hidden":"true"},null),d("上次登录: "),e(re,{time:t.value.lastLoginTime},null)]),t.value.lastLoginIp&&e("span",{class:l.userMetaItem},[e(Je,{class:l.userMetaIcon,"aria-hidden":"true"},null),e($e,{ip:t.value.lastLoginIp,triggerEl:e(w,{quaternary:!0,size:"tiny",type:"primary"},{default:()=>[t.value.lastLoginIp]})},null)])])])])]),e("section",{class:l.userSection},[e("h3",{class:l.userSectionTitle},[e(Xe,{class:"mr-1.5 inline-block size-4","aria-hidden":"true"},null),d("基本信息")]),e("div",{class:l.formGrid},[e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-name"},[d("昵称")]),e(F,{value:t.value.name,onInput:f=>t.value.name=f,placeholder:"输入昵称…",inputProps:{id:"user-name",autocomplete:"name"}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-username"},[d("用户名")]),e(F,{value:t.value.username,onInput:f=>t.value.username=f,placeholder:"输入用户名…",inputProps:{id:"user-username",autocomplete:"username",spellcheck:!1}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-mail"},[d("邮箱")]),e(F,{value:t.value.mail,onInput:f=>t.value.mail=f,placeholder:"输入邮箱地址…",inputProps:{id:"user-mail",type:"email",inputmode:"email",autocomplete:"email",spellcheck:!1}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-url"},[d("个人网站")]),e(F,{value:t.value.url,onInput:f=>t.value.url=f,placeholder:"https://example.com",inputProps:{id:"user-url",type:"url",inputmode:"url",autocomplete:"url",spellcheck:!1}},null)]),e("div",{class:[l.formGroup,l.formGroupFull]},[e("label",{class:l.formLabel,for:"user-introduce"},[d("个人简介")]),e(F,{value:t.value.introduce,onInput:f=>t.value.introduce=f,type:"textarea",placeholder:"介绍一下自己…",autosize:{minRows:3,maxRows:6},inputProps:{id:"user-introduce"}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-avatar"},[d("头像 URL")]),e(F,{value:t.value.avatar,onInput:f=>t.value.avatar=f,placeholder:"https://example.com/avatar.jpg",inputProps:{id:"user-avatar",type:"url",inputmode:"url",spellcheck:!1}},null),e("p",{class:l.formDescription},[d("也可以点击上方头像直接上传图片")])])])]),e("section",{class:l.userSection},[e("div",{class:l.userSectionTitleRow},[e("h3",{class:l.userSectionTitle},[e(Vt,{class:"mr-1.5 inline-block size-4","aria-hidden":"true"},null),d("社交链接")]),e(w,{size:"small",type:"primary",tertiary:!0,onClick:b,disabled:i.value.size>=x.length},{default:()=>[e(X,{class:"mr-1 size-4","aria-hidden":"true"},null),d("添加")]})]),h.value.length===0?e("div",{class:l.socialEmpty},[d("暂未添加任何社交链接")]):e("div",{class:l.socialList},[h.value.map(({key:f,value:k})=>e("div",{class:l.socialRow,key:f},[e(U,{class:l.socialSelect,value:f,options:x.map(E=>({...E,disabled:i.value.has(E.value)&&E.value!==f})),onUpdateValue:E=>y(f,E)},null),e(F,{class:l.socialInput,value:k,onInput:E=>g(f,E),placeholder:"输入链接或 ID…",inputProps:{spellcheck:!1}},null),e("button",{type:"button",class:l.socialRemoveBtn,onClick:()=>m(f),"aria-label":`删除 ${f} 社交链接`},[e(Q,{class:"size-4","aria-hidden":"true"},null)])]))])])])])}),iu=_(()=>()=>e("div",{class:l.userTabContainer},[e("section",{class:l.userSection},[e("div",{class:l.userSectionHeader},[e(D,{circle:!0,style:{width:"128px",height:"128px"}},null),e("div",{class:l.userHeaderInfo},[e(D,{text:!0,style:{width:"120px",height:"28px"}},null),e(D,{text:!0,style:{width:"80px",height:"18px",marginTop:"4px"}},null),e("div",{class:"mt-3 flex gap-4"},[e(D,{text:!0,style:{width:"150px"}},null),e(D,{text:!0,style:{width:"120px"}},null)])])])]),e("section",{class:l.userSection},[e(D,{text:!0,style:{width:"80px",height:"20px"}},null),e("div",{class:"mt-4 grid gap-6 md:grid-cols-2"},[Array.from({length:4}).map((t,a)=>e("div",{key:a},[e(D,{text:!0,style:{width:"60px",height:"16px",marginBottom:"8px"}},null),e(D,{text:!0,style:{width:"100%",height:"34px"}},null)]))])])]));var K=(function(t){return t.User="user",t.System="system",t.Security="security",t.Auth="auth",t.MetaPreset="meta-preset",t})(K||{});const Me=[{key:K.User,label:"用户",icon:Xe,component:it},{key:K.System,label:"系统",icon:Ne,component:uu},{key:K.Security,label:"安全",icon:et,component:su},{key:K.Auth,label:"登入方式",icon:be,component:Il},{key:K.MetaPreset,label:"Meta 预设",icon:ke,component:jl}],ku=_({setup(){const t=Le(),a=xe(),r=B(t.params.type||K.User);T(()=>t.params.type,s=>{s&&(r.value=s)});const n=s=>{a.replace({name:t.name,params:{...t.params,type:s}})};return()=>{const s=Me.find(c=>c.key===r.value)?.component||it;return e("div",{class:l.container},[e("nav",{class:l.sidebar},[e("ul",{class:l.navList},[Me.map(c=>{const p=c.icon,u=r.value===c.key;return e("li",{key:c.key},[e("button",{class:[l.navItem,u&&l.navItemActive],onClick:()=>n(c.key),type:"button"},[e(p,{class:l.navIcon,"aria-hidden":"true"},null),e("span",null,[c.label])])])})])]),e("main",{class:l.content},[e(s,null,null)])])}}});export{ku as default};
