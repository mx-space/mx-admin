import{c as w,ar as b,d8 as y,d as f,g as B,r as x,O as A,h as e,H as k,d9 as g,Y as z,W as C,s as a,cA as D,i as r,B as p,m as v,T}from"./index-DoEgFLcO.js";import{U as q}from"./upload-B3DfZtO4.js";import{D as N}from"./download-o-2ttAD6.js";import{H as $}from"./history-BZ8iew76.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=w("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),c={getList:()=>b.get("/backups"),createNew:()=>y("/backups/new",{method:"GET",responseType:"blob"}),download:n=>y(`/backups/${n}`,{method:"GET",responseType:"blob"}),delete:n=>b.delete("/backups",{params:{filename:n}}),rollback:n=>b.patch(`/backups/rollback/${n}`)},M=f({setup(){const{setActions:n}=B(),s=x([]),l=x(!1),o=async()=>{l.value=!0;try{const t=await c.getList();t.sort((u,i)=>i.filename.localeCompare(u.filename)),s.value=t}finally{l.value=!1}};A(()=>{o()});const d=async()=>{const t=a.info("备份中...",{duration:1e9,closeButton:!0});try{const u=await c.createNew();a.dismiss(t),a.success("备份完成"),D(u,"backup.zip"),o()}catch{a.dismiss(t),a.error("备份失败")}},m=async()=>{const t=document.createElement("input");t.type="file",t.style.cssText="position: absolute; opacity: 0; z-index: -9999; top: 0; left: 0",t.accept=".zip",document.body.append(t),t.click(),t.addEventListener("change",()=>{t.files[0]&&(a.error("上传恢复功能暂未实现"),t.remove())})},h=async t=>{await c.delete(t),a.success("删除成功");const u=s.value.findIndex(i=>i.filename===t);u!==-1&&s.value.splice(u,1)},E=async t=>{const u=a.info("回滚中...",{duration:1e9,closeButton:!0});try{await c.rollback(t),a.dismiss(u),a.success("回滚成功，页面将会重载"),setTimeout(()=>{location.reload()},1e3)}catch{a.dismiss(u),a.error("回滚失败")}},F=async t=>{const u=a.info("下载中...",{duration:1e9,closeButton:!0});try{const i=await c.download(t);a.dismiss(u),a.success("下载完成"),D(i,`${t}.zip`)}catch{a.dismiss(u),a.error("下载失败")}};return n(e(z,null,[e(k,{icon:e(g,null,null),name:"立即备份",variant:"primary",onClick:d},null),e(k,{icon:e(q,null,null),onClick:m,name:"上传恢复",variant:"info"},null)])),()=>e("div",{class:"space-y-4"},[e(C,{show:l.value},{default:()=>[e("div",{class:"min-h-[200px]"},[s.value.length===0&&!l.value?e(R,{onCreate:d},null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[s.value.map(t=>e(L,{key:t.filename,item:t,onDownload:()=>F(t.filename),onRollback:()=>E(t.filename),onDelete:()=>h(t.filename)},null))])])]})])}}),L=f({props:{item:{type:Object,required:!0},onDownload:{type:Function,required:!0},onRollback:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(n){const s=l=>{const o=l.match(/(\d{4}-\d{2}-\d{2})_(\d{2}-\d{2}-\d{2})/);if(o){const d=o[1],m=o[2].replace(/-/g,":");return`${d} ${m}`}return l};return()=>e("div",{class:"group flex items-center gap-4 border-b border-neutral-200 px-4 py-4 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-800/50"},[e("div",{class:"flex size-10 shrink-0 items-center justify-center rounded-lg bg-blue-50 text-blue-500 dark:bg-blue-950/50 dark:text-blue-400"},[e(H,{class:"size-5"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"text-base font-medium text-neutral-900 dark:text-neutral-100"},[s(n.item.filename)]),e("div",{class:"mt-0.5 flex items-center gap-3 text-sm text-neutral-500 dark:text-neutral-400"},[e("span",{class:"tabular-nums"},[n.item.size]),e("span",{class:"font-mono text-xs text-neutral-400 dark:text-neutral-500"},[n.item.filename])])]),e("div",{class:"flex shrink-0 items-center gap-1"},[e(p,{size:"tiny",quaternary:!0,type:"primary",onClick:n.onDownload,"aria-label":"下载备份"},{icon:()=>e(N,{class:"size-3.5"},null),default:()=>e("span",{class:"hidden sm:inline"},[r("下载")])}),e(v,{positiveText:"取消",negativeText:"回滚",onNegativeClick:n.onRollback},{trigger:()=>e(p,{size:"tiny",quaternary:!0,type:"warning","aria-label":"回滚到此备份"},{icon:()=>e($,{class:"size-3.5"},null),default:()=>e("span",{class:"hidden sm:inline"},[r("回滚")])}),default:()=>e("span",{class:"max-w-48"},[r("确定要回滚到此备份吗？当前数据将被覆盖。")])}),e(v,{positiveText:"取消",negativeText:"删除",onNegativeClick:n.onDelete},{trigger:()=>e(p,{size:"tiny",quaternary:!0,type:"error","aria-label":"删除备份"},{default:()=>[e(T,{class:"size-3.5"},null)]}),default:()=>e("span",null,[r("确定要删除此备份吗？")])})])])}}),R=f({props:{onCreate:{type:Function,required:!0}},setup(n){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(g,{class:"size-8 text-neutral-400"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[r("暂无备份")]),e("p",{class:"mb-6 text-sm text-neutral-500 dark:text-neutral-400"},[r("创建备份以保护你的数据")]),e(p,{type:"primary",onClick:n.onCreate},{default:()=>[r("立即备份")]})])}});export{M as default};
