import{c as N,bK as Ce,bL as tt,bM as at,bN as lt,bO as st,bP as pe,bQ as K,bR as ve,bS as nt,bT as O,bU as Fe,bV as Ie,d as C,r as w,w as oe,i as e,v as M,Y as T,x as L,b1 as A,z as k,j as v,aE as me,B as x,bW as Be,bX as z,b7 as ie,bY as Se,bZ as V,e as J,aQ as Q,u as fe,O as H,a0 as Ee,G as ce,M as ut,q as he,b_ as ye,P as de,N as I,bI as De,K as ee,n as Z,T as te,a as B,o as j,p as U,b$ as rt,c0 as ot,b6 as P,aH as X,av as Pe,c1 as ae,c2 as it,an as ct,b2 as dt,c3 as pt,V as G,bq as le,H as $,aR as vt,h as Te,aa as Oe,bu as Me,aU as Ue,c4 as Le,ap as mt,by as ft,bw as Re,c5 as R,c6 as Ve,aZ as be,a3 as ht,c7 as ge,c8 as yt,bH as bt,s as _e,bF as gt,f as _t,g as wt,c9 as xt,ca as kt,cb as At}from"./index-DSr6uqVi.js";import{C as W}from"./circle-check-CUVpYnHI.js";import{a as Ct,i as ue}from"./isEmpty-BY8chTw8.js";import{G as ze}from"./globe-BGHfwK3J.js";import{L as Ft}from"./lock-CMJnzlaF.js";import{U as It}from"./index-BS2n2s6U.js";import{M as Bt}from"./mail-inCjV8mt.js";import{C as St}from"./calendar-gkQj-5dc.js";import{U as He}from"./user-wqzOFgkS.js";import"./Upload-CimRmYkT.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=N("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=N("fingerprint-pattern",[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=N("github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=N("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=N("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=N("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=N("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function Tt(t){if(Ce(t))return t;if(Array.isArray(t)||tt(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const a=Object.getPrototypeOf(t),o=a.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new o(t);if(t instanceof RegExp){const n=new o(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new o(t.buffer.slice(0));if(t instanceof Error){const n=new o(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new o([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(a);return Object.assign(n,t)}return t}function Ot(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}const Mt=/\p{Lu}?\p{Ll}+|[0-9]+|\p{Lu}+(?!\p{Ll})|\p{Emoji_Presentation}|\p{Extended_Pictographic}|\p{L}+/gu;function Ut(t){return Array.from(t.match(Mt)??[])}function we(t,a,o){const n=Array.isArray(a)?a:typeof a=="string"?at(a):[a];let i=t;for(let p=0;p<n.length-1;p++){const s=n[p],u=n[p+1];i[s]==null&&(i[s]=lt(u)?[]:{}),i=i[s]}const c=n[n.length-1];return i[c]=o,t}function Lt(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const o=t[Symbol.toStringTag];return o==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${o}]`}let a=t;for(;Object.getPrototypeOf(a)!==null;)a=Object.getPrototypeOf(a);return Object.getPrototypeOf(t)===a}function Rt(t,...a){const o=a.slice(0,-1),n=a[a.length-1];let i=t;for(let c=0;c<o.length;c++){const p=o[c];i=Y(i,p,n,new Map)}return i}function Y(t,a,o,n){if(Ce(t)&&(t=Object(t)),a==null||typeof a!="object")return t;if(n.has(a))return Tt(n.get(a));if(n.set(a,t),Array.isArray(a)){a=a.slice();for(let c=0;c<a.length;c++)a[c]=a[c]??void 0}const i=[...Object.keys(a),...st(a)];for(let c=0;c<i.length;c++){const p=i[c];let s=a[p],u=t[p];if(pe(s)&&(s={...s}),pe(u)&&(u={...u}),typeof Buffer<"u"&&Buffer.isBuffer(s)&&(s=K(s)),Array.isArray(s))if(typeof u=="object"&&u!=null){const g=[],y=Reflect.ownKeys(u);for(let r=0;r<y.length;r++){const h=y[r];g[h]=u[h]}u=g}else u=[];const d=o(u,s,p,t,a,n);d!=null?t[p]=d:Array.isArray(s)||ve(u)&&ve(s)?t[p]=Y(u,s,o,n):u==null&&Lt(s)?t[p]=Y({},s,o,n):u==null&&Ct(s)?t[p]=K(s):(u===void 0||s!==void 0)&&(t[p]=s)}return t}function Vt(t,...a){return Rt(t,...a,nt)}function zt(t){const a=Ut(t);if(a.length===0)return"";const[o,...n]=a;return`${o.toLowerCase()}${n.map(i=>Ot(i)).join("")}`}function Ke(t){if(t==null)return"";if(Array.isArray(t))return t.map(Ke).join(",");const a=String(t);return a==="0"&&Object.is(Number(t),-0)?"-0":a}function Ht(t){return typeof t!="string"&&(t=Ke(t)),t.replace(/['\u2019]/g,"")}function Nt(t){return zt(Ht(t))}const qt="_container_9b3ha_4",Gt="_sidebar_9b3ha_9",Kt="_navList_9b3ha_17",jt="_navItem_9b3ha_27",$t="_navItemActive_9b3ha_47",Wt="_navIcon_9b3ha_55",Jt="_content_9b3ha_60",Qt="_card_9b3ha_65",Xt="_sectionHeader_9b3ha_90",Yt="_sectionTitle_9b3ha_94",Zt="_sectionSubtitle_9b3ha_102",ea="_avatarContainer_9b3ha_127",ta="_avatarWrapper_9b3ha_136",aa="_avatarUploadOverlay_9b3ha_152",la="_avatarUploadIcon_9b3ha_160",sa="_formGrid_9b3ha_209",na="_formGroup_9b3ha_213",ua="_formLabel_9b3ha_217",ra="_formDescription_9b3ha_225",oa="_formGroupFull_9b3ha_233",ia="_sessionList_9b3ha_263",ca="_sessionItem_9b3ha_267",da="_sessionItemCurrent_9b3ha_279",pa="_sessionHeader_9b3ha_287",va="_sessionBadge_9b3ha_291",ma="_sessionBadgeCurrent_9b3ha_295",fa="_sessionBadgeOther_9b3ha_303",ha="_sessionContent_9b3ha_311",ya="_sessionRow_9b3ha_315",ba="_sessionLabel_9b3ha_319",ga="_sessionUA_9b3ha_335",_a="_tokenCard_9b3ha_344",wa="_tokenHeader_9b3ha_352",xa="_tokenTitle_9b3ha_356",ka="_passwordSection_9b3ha_365",Aa="_passwordHeader_9b3ha_373",Ca="_passwordIcon_9b3ha_377",Fa="_passwordTitle_9b3ha_389",Ia="_authGrid_9b3ha_398",Ba="_authProviderIcon_9b3ha_418",Sa="_authProviderName_9b3ha_430",Ea="_authProviderStatus_9b3ha_438",Da="_authProviderEnabled_9b3ha_442",Pa="_authProviderDisabled_9b3ha_450",Ta="_empty_9b3ha_504",Oa="_emptyIcon_9b3ha_508",Ma="_emptyTitle_9b3ha_520",Ua="_emptyDescription_9b3ha_528",La="_infoRow_9b3ha_542",Ra="_infoLabel_9b3ha_558",Va="_infoValue_9b3ha_566",za="_tabContent_9b3ha_575",Ha="_settingsGroup_9b3ha_580",Na="_userTabContainer_9b3ha_668",qa="_userSection_9b3ha_672",Ga="_userSectionHeader_9b3ha_676",Ka="_userHeaderInfo_9b3ha_680",ja="_userName_9b3ha_684",$a="_userHandle_9b3ha_692",Wa="_userMeta_9b3ha_700",Ja="_userMetaItem_9b3ha_704",Qa="_userMetaIcon_9b3ha_712",Xa="_userSectionTitle_9b3ha_716",Ya="_userSectionTitleRow_9b3ha_724",Za="_socialList_9b3ha_733",el="_socialRow_9b3ha_737",tl="_socialSelect_9b3ha_741",al="_socialInput_9b3ha_745",ll="_socialRemoveBtn_9b3ha_749",sl="_socialEmpty_9b3ha_769",l={container:qt,sidebar:Gt,navList:Kt,navItem:jt,navItemActive:$t,navIcon:Wt,content:Jt,card:Qt,sectionHeader:Xt,sectionTitle:Yt,sectionSubtitle:Zt,avatarContainer:ea,avatarWrapper:ta,avatarUploadOverlay:aa,avatarUploadIcon:la,formGrid:sa,formGroup:na,formLabel:ua,formDescription:ra,formGroupFull:oa,sessionList:ia,sessionItem:ca,sessionItemCurrent:da,sessionHeader:pa,sessionBadge:va,sessionBadgeCurrent:ma,sessionBadgeOther:fa,sessionContent:ha,sessionRow:ya,sessionLabel:ba,sessionUA:ga,tokenCard:_a,tokenHeader:wa,tokenTitle:xa,passwordSection:ka,passwordHeader:Aa,passwordIcon:Ca,passwordTitle:Fa,authGrid:Ia,authProviderIcon:Ba,authProviderName:Sa,authProviderStatus:Ea,authProviderEnabled:Da,authProviderDisabled:Pa,empty:Ta,emptyIcon:Oa,emptyTitle:Ma,emptyDescription:Ua,infoRow:La,infoLabel:Ra,infoValue:Va,tabContent:za,settingsGroup:Ha,userTabContainer:Na,userSection:qa,userSectionHeader:Ga,userHeaderInfo:Ka,userName:ja,userHandle:$a,userMeta:Wa,userMetaItem:Ja,userMetaIcon:Qa,userSectionTitle:Xa,userSectionTitleRow:Ya,socialList:Za,socialRow:el,socialSelect:tl,socialInput:al,socialRemoveBtn:ll,socialEmpty:sl},nl=async()=>O.getSession();function ul(t){const a={};for(const o of t.providers){const n=o.type;n in t.public?a[n]={...t.public[n],enabled:o.enabled,type:n}:console.warn(`Provider type ${n} found in providers but not in public data.`)}return a}const je=Symbol.for("OauthDataInjectKey"),rl=()=>t=>Ie(je,t),ol=()=>Fe(je),il=()=>e("svg",{viewBox:"0 0 24 24",class:"size-5"},[e("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"},null),e("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"},null),e("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"},null),e("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"},null)]),cl={github:Ne,google:il},$e=(t,a)=>C({setup(){const o=async()=>{await Se.signIn.social({provider:t,callbackURL:`${location.href}?validate=true`})},n=ol(),i=w({clientId:"",secret:""}),c=w(!1);oe(()=>{if(n.value[t]===void 0)return;const{clientId:y,enabled:r}=n.value[t];c.value=r,i.value.clientId=y});const p=w(null),s={clientId:[{required:!0,message:"Client Id 不能为空"}],secret:[{required:!0,message:"Client Secret 不能为空"}]},u=async()=>{await p.value?.validate(),await V.patch("oauth",{providers:[{type:t,enabled:c.value}],secrets:{[t]:{clientSecret:i.value.secret}},public:{[t]:{clientId:i.value.clientId}}}),message.success("保存成功")},d=async()=>{const y=`${me}/auth/callback/${t}`;try{await navigator.clipboard.writeText(y),message.success("已复制到剪贴板")}catch{message.error("复制失败")}},g=cl[t]||Ne;return()=>e(M,{size:"small"},{header:()=>e("div",{class:"flex items-center gap-3"},[e("div",{class:l.authProviderIcon},[e(g,null,null)]),e("div",{class:"flex-1"},[e("h3",{class:l.authProviderName},[a.name]),e("div",{class:l.authProviderStatus},[c.value?e("span",{class:l.authProviderEnabled},[e(ie,{class:"size-3"},null),v("已启用")]):e("span",{class:l.authProviderDisabled},[v("未启用")])])])]),default:()=>e(T,null,[e(L,{model:i.value,ref:p,rules:s,labelPlacement:"left",labelWidth:100},{default:()=>[e(A,{label:"Client ID",path:"clientId",required:!0},{default:()=>[e(k,{value:i.value.clientId,onUpdateValue:y=>{i.value.clientId=y},placeholder:"输入 Client ID"},null)]}),e(A,{label:"Client Secret",required:!0,path:"secret"},{default:()=>[e(k,{showPasswordToggle:!0,type:"password",value:i.value.secret,onUpdateValue:y=>{i.value.secret=y},placeholder:"输入 Client Secret"},null)]})]}),e("div",{class:"mt-4 rounded-lg bg-neutral-50 p-3 dark:bg-neutral-800"},[e("div",{class:"mb-1 text-xs text-neutral-500 dark:text-neutral-400"},[v("Callback URL")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"flex-1 truncate font-mono text-sm text-neutral-700 dark:text-neutral-200"},[me,v("/auth/callback/"),t]),e(x,{text:!0,type:"primary",onClick:d},{default:()=>[e(Be,{class:"size-4"},null)]})])]),e("div",{class:"mt-4 flex items-center justify-between"},[e("label",{class:"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-300"},[v("启用"),e(z,{value:c.value,onUpdateValue:y=>{c.value=y}},null)]),e("div",{class:"flex gap-2"},[e(x,{onClick:o,tertiary:!0,size:"small"},{default:()=>[v("验证")]}),e(x,{onClick:u,type:"primary",size:"small"},{default:()=>[v("保存")]})])])])})}}),dl=$e("github",{name:"GitHub"}),pl=$e("google",{name:"Google"}),vl=C({setup(){return()=>e("div",{class:l.tabContent},[e(ml,null,null),e(fl,null,null)])}}),ml=C(()=>{const t=J(Q),{data:a,refetch:o}=fe({queryKey:he.auth.passkeys(),queryFn:()=>O.getPasskeys()}),n=u=>{O.deletePasskey(u).then(()=>{o()})},i=C(u=>{const d=w(""),g=y=>{y.preventDefault(),y.stopPropagation(),ye.createPassKey(d.value).then(()=>{o(),u.dialog.destroy()})};return()=>e(L,{onSubmit:g},{default:()=>[e(A,{label:"名称",required:!0},{default:()=>[e(k,{value:d.value,onUpdateValue:y=>{d.value=y},placeholder:"为这个 Passkey 起个名字…"},null)]}),e("div",{class:"flex justify-end"},[e(x,{disabled:d.value.length===0,type:"primary",onClick:g},{default:()=>[v("创建")]})])]})}),{data:c,refetch:p}=fe({queryKey:he.options.detail("authSecurity"),queryFn:async()=>{const{data:u}=await V.get("authSecurity");return u}}),s=u=>{V.patch("authSecurity",{disablePasswordLogin:u}).then(()=>{p()})};return i.props=["dialog"],()=>e(M,{size:"small"},{default:()=>[e("div",{class:"mb-6 flex items-center justify-between"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[e(re,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),v("通行密钥")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[v("使用生物识别或安全密钥登录")])]),e("div",{class:"flex items-center gap-2"},[e(x,{type:"tertiary",onClick:()=>{ye.validate(!0)}},{default:()=>[e(Dt,{class:"mr-1 size-4"},null),v("验证")]}),e(x,{type:"primary",onClick:()=>{const u=dialog.create({title:"创建 Passkey",content:()=>e(i,{dialog:u},null)})}},{default:()=>[e(de,{class:"mr-1 size-4"},null),v("新增")]})])]),e("div",{class:"mb-4 flex items-center justify-between rounded-lg border border-neutral-200 bg-white px-4 py-3 dark:border-neutral-800 dark:bg-neutral-900"},[e("div",{class:"flex flex-col gap-0.5"},[e("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-200"},[v("禁止密码登录")]),e("span",{class:"text-xs text-neutral-500 dark:text-neutral-400"},[v("开启后只能通过 Passkey 或 OAuth 登录")])]),e(z,{value:c.value?.disablePasswordLogin,onUpdateValue:u=>{if(u&&!a.value?.length){message.error("至少需要一个 Passkey 才能开启这个功能");return}s(u)}},null)]),e("div",null,[a.value?a.value.length===0?e("div",{class:l.empty},[e("div",{class:l.emptyIcon},[e(qe,null,null)]),e("h3",{class:l.emptyTitle},[v("暂无通行密钥")]),e("p",{class:l.emptyDescription},[v("添加一个通行密钥以启用无密码登录")])]):e(De,{scrollX:Math.max(600,t.contentWidth.value-t.contentInsetWidth.value),remote:!0,bordered:!1,data:a.value,columns:[{key:"name",title:"名称",render({name:u}){return e("div",{class:"flex items-center gap-2"},[e(re,{class:"size-4 text-blue-500"},null),e("span",{class:"font-medium"},[u])])}},{title:"创建时间",key:"created",render({created:u}){return e(ee,{time:u},null)}},{title:"操作",key:"id",width:100,render({id:u,name:d}){return e(Z,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{n(u)}},{trigger:()=>e(x,{text:!0,type:"error"},{default:()=>[e(te,{class:"size-4"},null)]}),default:()=>e("span",{class:"max-w-48"},[v('确定要删除 Passkey "'),d,v('"?')])})}}]},null):e(I,{text:!0,style:{width:"100%",height:"150px"}},null)])]})}),fl=C(()=>{const t=Ee(),a=ce(),o=w({});return H(async()=>{const{data:n}=await V.get("oauth");o.value=ul(n)}),rl()(o),H(async()=>{const n=t.query.validate;a.replace({query:{...t.query,validate:""}}),n&&await nl()&&(message.success("验证成功"),dialog.create({title:"设定为主人账户？",positiveText:"是",negativeText:"否",onPositiveClick(c){O.authAsOwner()}}))}),()=>e("section",{class:[l.settingsGroup,"mt-8"]},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(ut,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),v("OAuth 登录")]),e("p",{class:l.sectionSubtitle},[v("配置第三方账号登录方式")])])]),e("div",{class:l.authGrid},[e(dl,null,null),e(pl,null,null)])])});function se(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Pe(t)}const hl="mt-6",yl={class:hl,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},We=Symbol("JSONSchemaFormInject"),bl=C({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:t=>t},extendConfigView:{type:Object}},setup(t,{slots:a}){const o=w(t.initialValue);oe(()=>{t.onValueChange?.(o.value)},{flush:"post"});const n=B(()=>t.schema.definitions),i=B(()=>new Map(Object.entries(t.schema.definitions)));Ie(We,{schema:t.schema,definitions:i,getKey:t.getKey});const c=B(()=>Object.keys(n.value)),p=w([c.value[0]]),s=J(Q),u=j(yl);return U(()=>s.viewport.value.mobile,d=>{d?(u.labelPlacement="top",u.labelAlign="left"):(u.labelPlacement="left",u.labelAlign="right")},{immediate:!0}),()=>{let d,g;const{schema:y}=t;return e(T,null,[e(rt,{accordion:!0,defaultExpandedNames:p.value,displayDirective:"if"},se(d=c.value.map(r=>{const h=n.value[r];if(!h.title)return null;switch((h?.["ui:options"]||{})?.type){case"hidden":return null}const b=!!a[r];return e(ot,{title:h.title,"data-schema":JSON.stringify(h)},{default:()=>[e(L,u,{default:()=>[b?a[r]?.():e(T,null,[e(Je,{dataKey:t.getKey(r),formData:o,schema:h,property:r},null),t.extendConfigView?.[r]])]})]})}))?d:{default:()=>[d]}),y.ps.length?e(P,{vertical:!0},se(g=y.ps.map(r=>e(X,{class:"ml-4 mt-8 inline-block text-xs",depth:3},se(r)?r:{default:()=>[r]})))?g:{default:()=>[g]}):null])}}}),Je=C({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0},property:{type:String}},setup(t){const{definitions:a,getKey:o}=Fe(We,{});return()=>{const{schema:n,formData:i,dataKey:c,property:p}=t;return n?e(T,null,[Object.keys(n.properties).map(s=>{const u=n.properties[s];if(u.$ref){const d=a.value.get(u.$ref.split("/").at(-1));return e(Je,{dataKey:`${o(c)}.${s}`,formData:i,schema:d,property:s},null)}return e(gl,{value:ae(i.value,`${o(c)}.${s}`,void 0),onUpdateValue:d=>{ae(i.value,o(c))?we(i.value,`${o(c)}.${s}`,d):we(i.value,o(c),{...ae(i.value,o(c),{}),[s]:d})},title:u.title,type:u.type,options:u?.["ui:options"],description:u.description},null)})]):null}}}),gl=C({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(t){const a=w(t.value);oe(()=>{t.onUpdateValue(a.value)});const o=()=>{const{options:c}=t;switch(t.type){case"url":case"string":{const{type:p}=c;switch(p){case"select":{const{values:s}=c;return e(G,{value:a.value,onUpdateValue:u=>{a.value=u},options:s,filterable:!0},null)}default:return e(k,{inputProps:{id:pt()},value:a.value,onUpdateValue:s=>{a.value=s},type:p||"text",showPasswordOn:"click",autosize:p=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}}case"array":return e(dt,{value:a.value,onUpdateValue:p=>{a.value=p}},null);case"boolean":return e(z,{value:a.value,onUpdateValue:p=>{a.value=p}},null);case"number":case"integer":return e(ct,{value:a.value,onUpdateValue:p=>{a.value=p}},null);default:return null}},n=J(Q),i=B(()=>n.viewport.value.mobile?1:2);return()=>{const{title:c,options:p,description:s}=t,u=e(T,null,[e(A,{label:c},{default:()=>[s?e(P,{class:"w-full",vertical:!0},{default:()=>[o(),e(X,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:it.parse(s)},null)]})]}):o()]})]);return p.halfGrid&&i.value===2?e("div",{class:"inline-block w-1/2"},[u]):u}}});var _=(function(t){return t.OpenAI="openai",t.OpenAICompatible="openai-compatible",t.Anthropic="anthropic",t.OpenRouter="openrouter",t})(_||{});const Qe=[{label:"OpenAI",value:_.OpenAI},{label:"OpenAI 兼容 (DeepSeek/Groq 等)",value:_.OpenAICompatible},{label:"Anthropic (Claude)",value:_.Anthropic},{label:"OpenRouter",value:_.OpenRouter}],_l=t=>Qe.find(a=>a.value===t)?.label||t,wl=t=>{const a=t.name?.trim(),o=_l(t.type);return a||o},Xe=t=>{switch(t){case _.Anthropic:return"claude-sonnet-4.5";case _.OpenAI:return"gpt-5-mini";case _.OpenRouter:return"anthropic/claude-sonnet-4.5";case _.OpenAICompatible:return"";default:return""}},xl=t=>{switch(t){case _.Anthropic:return"如 Claude Sonnet";case _.OpenAI:return"如 OpenAI GPT-4o";case _.OpenRouter:return"如 OpenRouter";case _.OpenAICompatible:return"如 DeepSeek";default:return""}},kl=t=>{switch(t){case _.Anthropic:return"如 claude-sonnet-4.5";case _.OpenAI:return"如 gpt-5-mini";case _.OpenRouter:return"如 anthropic/claude-sonnet-4.5";case _.OpenAICompatible:return"如 deepseek-chat";default:return""}},Al=C({props:{provider:{type:Object,required:!0},onUpdate:{type:Function,required:!0},onDelete:{type:Function,required:!0},onTest:{type:Function},availableModels:{type:Array,default:()=>[]},isLoadingModels:{type:Boolean,default:!1},isTesting:{type:Boolean,default:!1},onRefreshModels:{type:Function}},setup(t){const a=w({...t.provider});U(()=>t.provider,s=>{a.value={...s}},{deep:!0});const o=(s,u)=>{a.value[s]=u,t.onUpdate(a.value)},n=s=>{a.value.type=s,a.value.defaultModel=Xe(s),t.onUpdate(a.value)},i=B(()=>t.availableModels.map(s=>({label:s.name||s.id,value:s.id}))),c=B(()=>a.value.type===_.OpenAICompatible||a.value.type===_.OpenAI||a.value.type===_.OpenRouter),p=B(()=>{if(a.value.name)return a.value.name;switch(a.value.type){case _.Anthropic:return"Anthropic (Claude)";case _.OpenAI:return"OpenAI";case _.OpenRouter:return"OpenRouter";case _.OpenAICompatible:return"OpenAI 兼容";default:return"新 Provider"}});return()=>e(M,{title:p.value,size:"small",class:"mb-4"},{default:()=>e(L,{labelPlacement:"left",labelWidth:120},{default:()=>[e(A,{label:"类型"},{default:()=>[e(G,{value:a.value.type,onUpdateValue:n,options:Qe},null)]}),e(A,{label:"显示名称"},{default:()=>[e(k,{value:a.value.name,onUpdateValue:s=>o("name",s),placeholder:xl(a.value.type)},null)]}),e(A,{label:"API Key"},{default:()=>[e(k,{type:"password",showPasswordOn:"click",value:a.value.apiKey,onUpdateValue:s=>o("apiKey",s),placeholder:a.value.type===_.Anthropic?"sk-ant-...":a.value.type===_.OpenRouter?"sk-or-...":"sk-..."},null)]}),c.value&&e(A,{label:"Endpoint"},{default:()=>[e(k,{value:a.value.endpoint,onUpdateValue:s=>o("endpoint",s),placeholder:a.value.type===_.OpenAICompatible?"必填，如 https://api.deepseek.com":a.value.type===_.OpenRouter?"可选，默认 https://openrouter.ai/api/v1":"可选，留空使用默认"},null)]}),e(A,{label:"默认模型"},{default:()=>[e(P,{align:"center"},{default:()=>[t.availableModels.length>0?e(G,{value:a.value.defaultModel,onUpdateValue:s=>o("defaultModel",s),options:i.value,filterable:!0,tag:!0,style:"min-width: 200px",placeholder:"选择或输入模型名"},null):e(k,{value:a.value.defaultModel,onUpdateValue:s=>o("defaultModel",s),placeholder:kl(a.value.type),style:"min-width: 200px"},null),e(x,{tertiary:!0,type:"primary",loading:t.isLoadingModels,onClick:()=>t.onRefreshModels?.()},{default:()=>[v("获取模型列表")]})]})]}),e(A,{label:"启用"},{default:()=>[e(z,{value:a.value.enabled,onUpdateValue:s=>o("enabled",s)},null)]})]}),action:()=>e("div",{class:"flex justify-end"},[e(P,{align:"center"},{default:()=>[e($,{variant:"success",icon:e(W,null,null),name:"测试连接",disabled:t.isTesting||!a.value.defaultModel,onClick:()=>t.onTest?.(a.value)},null),e(vt,{onDelete:()=>t.onDelete(),message:"确定删除此 Provider？"},null)]})])})}}),ne=C({props:{label:{type:String,required:!0},description:{type:String},assignment:{type:Object},providers:{type:Array,required:!0},providerModels:{type:Object,default:()=>({})},onUpdate:{type:Function,required:!0}},setup(t){const a=w(t.assignment?.providerId||""),o=w(t.assignment?.model||"");U(()=>t.assignment,d=>{a.value=d?.providerId||"",o.value=d?.model||""},{deep:!0});const n=B(()=>t.providers.map(d=>({label:wl(d),value:d.id,disabled:!d.enabled}))),i=B(()=>a.value?t.providerModels[a.value]||[]:[]),c=B(()=>{const d=i.value.map(y=>({label:y.name||y.id,value:y.id})),g=t.providers.find(y=>y.id===a.value);return g?.defaultModel&&(d.some(r=>r.value===g.defaultModel)||d.unshift({label:`${g.defaultModel} (默认)`,value:g.defaultModel})),d}),p=d=>{a.value=d,o.value="",u()},s=d=>{o.value=d,u()},u=()=>{a.value?t.onUpdate({providerId:a.value,model:o.value||void 0}):t.onUpdate(void 0)};return()=>e(A,{label:t.label},{default:()=>[e(P,{vertical:!0,class:"w-full"},{default:()=>[e(P,null,{default:()=>[e(G,{value:a.value||null,onUpdateValue:p,options:n.value,placeholder:"选择 Provider",clearable:!0,style:"min-width: 180px"},null),e(G,{value:o.value||null,onUpdateValue:s,options:c.value,placeholder:"使用 Provider 默认模型",clearable:!0,filterable:!0,tag:!0,style:"min-width: 200px",disabled:!a.value},null)]}),t.description&&e(X,{depth:3,class:"text-xs"},{default:()=>[t.description]})]})]})}}),Cl=C({props:{value:{type:Object,required:!0},onUpdate:{type:Function,required:!0}},setup(t){const a=w({}),o=w(new Set),n=w(new Set),i=B({get:()=>t.value,set:r=>t.onUpdate(r)}),c=async r=>{o.value.add(r.id);try{const h=await le.getModelList({providerId:r.id,type:r.type,apiKey:r.apiKey||void 0,endpoint:r.endpoint||void 0});h.models&&(a.value[r.id]=h.models),h.error&&message.warning(`获取模型列表: ${h.error}`)}catch(h){console.error(`Failed to fetch models for ${r.id}:`,h),h?.response||message.error(`获取模型列表失败: ${h.message||h}`)}finally{o.value.delete(r.id)}},p=async()=>{try{const r=await le.getModels();for(const h of r)h.models&&(a.value[h.provider]=h.models)}catch(r){console.error("Failed to fetch all models:",r)}},s=async r=>{if(!r.defaultModel){message.warning("请先填写默认模型");return}n.value.add(r.id);try{await le.testConfig({providerId:r.id,type:r.type,apiKey:r.apiKey||void 0,endpoint:r.endpoint||void 0,model:r.defaultModel||void 0}),message.success("连接可用")}catch(h){console.error(`Failed to test provider ${r.id}:`,h),h?.response||message.error(`连接失败: ${h.message||h}`)}finally{n.value.delete(r.id)}};H(()=>{i.value.providers?.some(r=>r.enabled)&&p()});const u=r=>{t.onUpdate({...i.value,...r})},d=(r,h)=>{const f=[...i.value.providers||[]];f[r]=h,u({providers:f})},g=r=>{const h=(i.value.providers||[]).filter((f,b)=>b!==r);u({providers:h})},y=()=>{const r=_.OpenAI,h={id:crypto.randomUUID(),name:"",type:r,apiKey:"",defaultModel:Xe(r),enabled:!0};u({providers:[...i.value.providers||[],h]})};return()=>e(P,{vertical:!0,size:"large",class:"w-full"},{default:()=>[e(M,{title:"AI Providers",size:"small"},{default:()=>[e(P,{vertical:!0,class:"w-full"},{default:()=>[i.value.providers?.map((r,h)=>e(Al,{key:r.id,provider:r,onUpdate:f=>d(h,f),onDelete:()=>g(h),onTest:f=>s(f),availableModels:a.value[r.id]||[],isLoadingModels:o.value.has(r.id),isTesting:n.value.has(r.id),onRefreshModels:()=>c(r)},null)),e(x,{onClick:y,dashed:!0,block:!0},{default:()=>[v("+ 添加 Provider")]})]})]}),e(M,{title:"功能模型分配",size:"small"},{default:()=>[e(L,{labelPlacement:"left",labelWidth:150},{default:()=>[e(ne,{label:"摘要功能",description:"用于生成文章摘要的模型",assignment:i.value.summaryModel,providers:i.value.providers||[],providerModels:a.value,onUpdate:r=>u({summaryModel:r})},null),e(ne,{label:"写作助手",description:"用于生成标题、Slug 等的模型",assignment:i.value.writerModel,providers:i.value.providers||[],providerModels:a.value,onUpdate:r=>u({writerModel:r})},null),e(ne,{label:"评论审核",description:"用于审核评论的模型",assignment:i.value.commentReviewModel,providers:i.value.providers||[],providerModels:a.value,onUpdate:r=>u({commentReviewModel:r})},null)]})]}),e(M,{title:"功能开关",size:"small"},{default:()=>[e(L,{labelPlacement:"left",labelWidth:200},{default:()=>[e(A,{label:"启用 AI 摘要"},{default:()=>[e(z,{value:i.value.enableSummary,onUpdateValue:r=>u({enableSummary:r})},null)]}),e(A,{label:"自动生成摘要"},{default:()=>[e(P,{vertical:!0},{default:()=>[e(z,{value:i.value.enableAutoGenerateSummary,onUpdateValue:r=>u({enableAutoGenerateSummary:r}),disabled:!i.value.enableSummary},null),e(X,{depth:3,class:"text-xs"},{default:()=>[v("发布文章时自动生成摘要")]})]})]}),e(A,{label:"摘要目标语言"},{default:()=>[e(k,{value:i.value.aiSummaryTargetLanguage,onUpdateValue:r=>u({aiSummaryTargetLanguage:r}),placeholder:"auto 或 ISO 639-1 语言代码",style:"max-width: 200px"},null)]})]})]})]})}}),Fl="mt-6",Il={class:Fl,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},xe={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},Bl=C(()=>{const{setActions:t}=Te();H(()=>{t(e($,{disabled:!0,onClick:c,icon:e(W,null,null)},null))}),Oe(()=>{t(null)});const a=w();Me(async()=>{a.value=await V.getJsonSchema(),await p()});let o={};const n=j({}),i=w({});U(()=>n,d=>{i.value=Le(o,mt(d))},{deep:!0}),U(()=>i.value,d=>{let g=!1;ue(d)?g=!1:g=!0,t(e($,{disabled:!g,icon:e(W,null,null),onClick:c},null))});async function c(){if(ue(i.value))return;const d=Object.entries(i.value);for await(const[g,y]of d){const r=Object.fromEntries(Object.entries(y).map(([h,f])=>Array.isArray(f)?[h,n[g][h]]:[h,f]));await V.patch(g,r)}await p(),message.success("修改成功")}const p=async()=>{let d=await V.getAll();d=Vt(a.value.default,d),o=K(d),Object.assign(n,d)},s=J(Q),u=j(Il);return U(()=>s.viewport.value.mobile,d=>{d?(u.labelPlacement="top",u.labelAlign="left"):(u.labelPlacement="left",u.labelAlign="right")},{immediate:!0}),()=>e("div",{class:l.tabContent},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(Ue,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),v("系统设置")]),e("p",{class:l.sectionSubtitle},[v("配置站点信息、SEO 设置、邮件服务等")])])]),e("div",{class:l.card},[a.value&&e(bl,{initialValue:n,getKey:d=>d.split(".").map(g=>Nt(g)).join(".").replace("Dto",""),schema:a.value},{AIDto:()=>e(Cl,{value:n.ai||{},onUpdate:d=>{n.ai=d}},null)})])])});function Ye(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Pe(t)}const Sl=C(()=>{const t=w([]),a=w(!0),o=async()=>{a.value=!0;const c=await R.getSessions();t.value=c.data?.map(p=>({...p,date:p.lastActiveAt}))||[],a.value=!1};H(()=>{o()});const n=async(c,p)=>{c?(await R.logout(),Ve(),await Se.signOut(),window.location.reload()):(await R.deleteSession(p),t.value=t.value.filter(s=>s.id!==p))},i=async()=>{await R.deleteAllSessions(),await o()};return()=>e("div",{class:l.tabContent},[e("div",{class:l.settingsGroup},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(ft,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),v("登录设备")]),e("p",{class:l.sectionSubtitle},[v("管理你的登录会话，保护账户安全")])]),e(Z,{onPositiveClick:i},{trigger:()=>e(x,{size:"small",type:"error",ghost:!0,disabled:t.value.length===1&&t.value[0]?.current},{default:()=>[e(te,{class:"mr-1 size-4"},null),v("踢掉全部")]}),default:()=>"确定踢掉全部登录设备（除当前会话）？"})]),a.value?e(El,null,null):e("div",{class:l.sessionList},[t.value.map(({id:c,ua:p,ip:s,date:u,current:d})=>e("div",{key:c,class:[l.sessionItem,d&&l.sessionItemCurrent]},[e("div",{class:l.sessionHeader},[e("span",{class:[l.sessionBadge,d?l.sessionBadgeCurrent:l.sessionBadgeOther]},[d?e(T,null,[e(ie,{class:"size-3"},null),v("当前设备")]):e(T,null,[e(Pt,{class:"size-3"},null),v("其他设备")])]),e(Z,{onPositiveClick:()=>n(!!d,c)},{trigger:()=>e(x,{size:"small",type:d?"warning":"error",ghost:!0},{default:()=>[d?"注销":"踢出"]}),default:()=>d?"确定要注销当前会话？":"确定要踢出此设备？"})]),e("div",{class:l.sessionContent},[p&&e("div",{class:l.sessionUA},[p]),e("div",{class:"mt-3 flex flex-wrap items-center gap-4 text-sm"},[s&&e("div",{class:l.sessionRow},[e(ze,{class:"size-4 text-neutral-400"},null),e(Re,{ip:s,triggerEl:e(x,{quaternary:!0,size:"tiny",type:"primary"},Ye(s)?s:{default:()=>[s]})},null)]),e("div",{class:l.sessionRow},[e("span",{class:l.sessionLabel},[d?"活跃时间:":"登录时间:"]),e(ee,{time:u},null)])])])]))])]),e("div",{class:l.settingsGroup},[e(Pl,null,null)]),e("div",{class:l.settingsGroup},[e(Dl,null,null)])])}),El=C(()=>()=>e("div",{class:l.sessionList},[Array.from({length:3}).map((t,a)=>e("div",{key:a,class:l.sessionItem},[e("div",{class:l.sessionHeader},[e(I,{text:!0,style:{width:"80px",height:"24px"}},null),e(I,{text:!0,style:{width:"60px",height:"28px"}},null)]),e(I,{text:!0,style:{width:"100%",height:"40px",marginTop:"12px"}},null),e("div",{class:"mt-3 flex gap-4"},[e(I,{text:!0,style:{width:"100px"}},null),e(I,{text:!0,style:{width:"120px"}},null)])]))])),Dl=C(()=>{const t=w([]),a=w(!0),o=()=>({name:"",expired:!1,expiredTime:new Date}),n=j(o()),i=async()=>{a.value=!0;const{data:f}=await O.getTokens();t.value=f,a.value=!1};Me(()=>{i()});const c=w(!1),p=w(!1),s=w(null),u=w(new Set),d=async()=>{try{const f={name:n.name,expired:n.expired?n.expiredTime.toISOString():void 0},b=await O.createToken(f);try{await navigator.clipboard.writeText(b.token)}catch{console.warn("复制到剪贴板失败")}c.value=!1;const S=o();for(const m in S)n[m]=S[m];s.value=b,p.value=!0,await i();const D=t.value.findIndex(m=>m.name===f.name);D!==-1&&(t.value[D].token=b.token)}catch{message.error("创建 Token 失败，请重试")}},g=async f=>{await O.deleteToken(f),message.success("删除成功");const b=t.value.findIndex(S=>S.id===f);b!==-1&&t.value.splice(b,1)},y=async f=>{const b=f.id;if(u.value.has(b))u.value.delete(b);else try{const S=await O.getToken(b),D=t.value.findIndex(m=>m.id===b);D!==-1&&(t.value[D].token=S.token),u.value.add(b)}catch(S){console.error("获取Token详情失败:",S),message.error("获取Token详情失败，请重试")}},r=async f=>{try{await navigator.clipboard.writeText(f),message.success("Token 已复制到剪贴板")}catch{const b=document.createElement("textarea");b.value=f,b.style.position="fixed",b.style.left="-9999px",document.body.appendChild(b),b.focus(),b.select();try{document.execCommand("copy"),message.success("Token 已复制到剪贴板")}catch{message.error("复制失败，请手动复制Token")}document.body.removeChild(b)}},h=J(Q);return()=>e(T,null,[e("div",{class:l.tokenCard},[e("div",{class:l.tokenHeader},[e("div",null,[e("h3",{class:l.tokenTitle},[e(qe,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),v("API Token")]),e("p",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-400"},[v("用于 API 调用的访问令牌")])]),e(x,{type:"primary",onClick:()=>{c.value=!0}},{default:()=>[e(de,{class:"mr-1 size-4"},null),v("新增 Token")]})]),a.value?e(I,{text:!0,style:{width:"100%",height:"200px"}},null):e(De,{scrollX:Math.max(800,h.contentWidth.value-h.contentInsetWidth.value),remote:!0,bordered:!1,data:t.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render(f){const{token:b,id:S}=f;return u.value.has(S)&&b&&b!=="*".repeat(40)?e(x,{text:!0,type:"primary",onClick:()=>r(b),class:"max-w-[200px] truncate text-left font-mono"},Ye(b)?b:{default:()=>[b]}):e("span",{class:"font-mono text-neutral-400"},["•".repeat(32)])}},{title:"创建时间",key:"created",render({created:f}){return e(ee,{time:f},null)}},{title:"过期时间",key:"expired",render({expired:f}){return f?ge(f,"yyyy 年 M 月 d 日 HH:mm:ss"):e("span",{class:"text-neutral-400"},[v("永不过期")])}},{title:"操作",key:"id",render(f){const{id:b,name:S}=f,D=u.value.has(b);return e("div",{class:"flex items-center gap-2"},[e(x,{text:!0,type:"primary",onClick:()=>y(f)},{default:()=>[D?e(yt,{class:"size-4"},null):e(bt,{class:"size-4"},null)]}),e(Z,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{g(b)}},{trigger:()=>e(x,{text:!0,type:"error"},{default:()=>[e(te,{class:"size-4"},null)]}),default:()=>e("span",{class:"max-w-48"},[v('确定要删除 Token "'),S,v('"?')])})])}}]},null)]),e(_e,{transformOrigin:"center",show:c.value,onUpdateShow:f=>void(c.value=f)},{default:()=>[e(M,{bordered:!1,title:"创建 Token",class:"w-[500px] max-w-full"},{default:()=>[e(L,null,{default:()=>[e(A,{label:"名称",required:!0},{default:()=>[e(k,{value:n.name,onInput:f=>void(n.name=f),placeholder:"为这个 Token 起个名字…"},null)]}),e(A,{label:"是否过期"},{default:()=>[e(z,{value:n.expired,onUpdateValue:f=>void(n.expired=f)},null)]}),e(A,{label:"过期时间"},{default:()=>[e(gt,{disabled:!n.expired,value:n.expiredTime.getTime(),type:"datetime",onUpdateValue:f=>void(n.expiredTime=new Date(f))},null)]})]}),e("div",{class:"flex justify-end gap-3"},[e(x,{onClick:()=>void(c.value=!1)},{default:()=>[v("取消")]}),e(x,{type:"primary",disabled:!n.name.trim(),onClick:d},{default:()=>[v("确定")]})])]})]}),e(_e,{transformOrigin:"center",show:p.value,onUpdateShow:f=>void(p.value=f)},{default:()=>[e(M,{bordered:!1,title:"Token 创建成功",class:"w-[600px] max-w-full",closable:!0,onClose:()=>void(p.value=!1)},{default:()=>[e("div",{class:"space-y-4"},[e("div",{class:"flex items-center gap-2 rounded-lg bg-green-50 px-4 py-3 text-green-700 dark:bg-green-900/20 dark:text-green-400"},[e(ie,{class:"size-5"},null),e("span",null,[v("Token 创建成功，请妥善保存")])]),e("div",{class:"space-y-3"},[e("div",{class:l.infoRow},[e("span",{class:l.infoLabel},[v("Token 名称:")]),e("span",{class:l.infoValue},[s.value?.name])]),e("div",null,[e("div",{class:"mb-2 text-sm font-medium text-neutral-700 dark:text-neutral-300"},[v("Token:")]),e("div",{class:"flex items-center gap-2 rounded-lg border border-neutral-200 bg-neutral-50 p-3 dark:border-neutral-700 dark:bg-neutral-800"},[e(X,{code:!0,class:"flex-1 break-all text-sm"},{default:()=>[s.value?.token]}),e(x,{size:"small",type:"primary",onClick:async()=>{s.value?.token&&await r(s.value.token)}},{default:()=>[e(Be,{class:"size-4"},null)]})])]),s.value?.expired&&e("div",{class:l.infoRow},[e("span",{class:l.infoLabel},[v("过期时间:")]),e("span",{class:l.infoValue},[ge(s.value.expired,"yyyy 年 M 月 d 日 HH:mm:ss")])])]),e("div",{class:"rounded-lg bg-amber-50 px-4 py-3 text-sm text-amber-700 dark:bg-amber-900/20 dark:text-amber-400"},[v("请将此 Token 保存在安全的地方，关闭此窗口后将无法再次查看完整 Token。")])]),e("div",{class:"mt-6 flex justify-end"},[e(x,{type:"primary",onClick:()=>void(p.value=!1)},{default:()=>[v("我已保存")]})])]})]})])}),Pl=C(()=>{const t=j({password:"",reenteredPassword:""}),a=w(),o=ce(),n=async()=>{a.value&&a.value.validate(async c=>{c||(await R.updateMaster({password:t.password}),message.success("密码修改成功，请重新登录"),Ve(),o.push({name:ht.Login}))})};function i(c,p){return p===t.password}return()=>e("div",{class:l.passwordSection},[e("div",{class:l.passwordHeader},[e("div",{class:l.passwordIcon},[e(Ft,null,null)]),e("div",null,[e("h3",{class:l.passwordTitle},[v("修改密码")]),e("p",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-400"},[v("修改后需要重新登录")])])]),e(L,{ref:a,model:t,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:i,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},{default:()=>[e("div",{class:"grid gap-4 md:grid-cols-2"},[e(A,{label:"新密码",required:!0,path:"password"},{default:()=>[e(k,be(xe,{value:t.password,onInput:c=>void(t.password=c),type:"password",showPasswordOn:"click",placeholder:"输入新密码"}),null)]}),e(A,{label:"确认密码",required:!0,path:"reenteredPassword"},{default:()=>[e(k,be(xe,{value:t.reenteredPassword,onInput:c=>void(t.reenteredPassword=c),type:"password",showPasswordOn:"click",placeholder:"再次输入新密码"}),null)]})]),e("div",{class:"mt-4 flex justify-end"},[e(x,{onClick:n,type:"primary"},{default:()=>[e(Ge,{class:"mr-1 size-4"},null),v("修改密码")]})])]})])}),ke={GitHub:"github",Weibo:"weibo",网易云:"netease",哔哩哔哩:"bilibili"},Ze=C(()=>{const t=w({}),a=w(!0);let o;async function n(){a.value=!0;const m=await R.getMaster();t.value=m,o=K(m),a.value=!1}H(async()=>{await n()});const i=_t(),c=B(()=>Le(o,t.value)),p=B(()=>!ue(c.value)),{setActions:s}=Te(),u=wt({mutationFn:R.updateMaster,onSuccess:async()=>{i.success("保存成功"),await n()}}),d=()=>{if(!p.value)return;const m=K(At(c));m.socialIds&&(m.socialIds=t.value.socialIds),u.mutate(m)};H(()=>{s(e($,{disabled:!0,onClick:d,icon:e(W,null,null)},null))}),Oe(()=>{s(null)}),U(()=>p.value,m=>{s(e($,{disabled:!m,icon:e(W,null,null),onClick:d},null))});const g=Object.keys(ke).map(m=>({label:m,value:ke[m]})),y=B(()=>{const m=t.value.socialIds||{};return Object.entries(m).map(([F,E])=>({key:F,value:String(E)}))}),r=B(()=>new Set(y.value.map(m=>m.key))),h=()=>{t.value.socialIds||(t.value.socialIds={});const m=g.find(F=>!r.value.has(F.value))?.value||"";t.value.socialIds={...t.value.socialIds,[m]:""}},f=(m,F)=>{if(m===F)return;const E={...t.value.socialIds},et=E[m];delete E[m],E[F]=et,t.value.socialIds=E},b=(m,F)=>{t.value.socialIds={...t.value.socialIds,[m]:F}},S=m=>{const F={...t.value.socialIds};delete F[m],t.value.socialIds=F},D=m=>{const F=JSON.parse((m.event?.target).responseText);return m.file.url=F.url,t.value.avatar=F.url,m.file};return()=>e("div",{class:l.userTabContainer},[a.value?e(Tl,null,null):e(T,null,[e("section",{class:l.userSection},[e("div",{class:l.userSectionHeader},[e("div",{class:l.avatarContainer},[e(It,{onFinish:D,type:"avatar"},{default:()=>e("div",{class:l.avatarWrapper},[e(xt,{src:t.value.avatar,size:128},null),e("div",{class:l.avatarUploadOverlay},[e(Et,{class:l.avatarUploadIcon},null)])])})]),e("div",{class:l.userHeaderInfo},[e("h2",{class:l.userName},[t.value.name||"–"]),e("p",{class:l.userHandle},[v("@"),t.value.username]),e("div",{class:l.userMeta},[t.value.mail&&e("span",{class:l.userMetaItem},[e(Bt,{class:l.userMetaIcon,"aria-hidden":"true"},null),t.value.mail]),t.value.lastLoginTime&&e("span",{class:l.userMetaItem},[e(St,{class:l.userMetaIcon,"aria-hidden":"true"},null),v("上次登录: "),e(ee,{time:t.value.lastLoginTime},null)]),t.value.lastLoginIp&&e("span",{class:l.userMetaItem},[e(ze,{class:l.userMetaIcon,"aria-hidden":"true"},null),e(Re,{ip:t.value.lastLoginIp,triggerEl:e(x,{quaternary:!0,size:"tiny",type:"primary"},{default:()=>[t.value.lastLoginIp]})},null)])])])])]),e("section",{class:l.userSection},[e("h3",{class:l.userSectionTitle},[e(He,{class:"mr-1.5 inline-block size-4","aria-hidden":"true"},null),v("基本信息")]),e("div",{class:l.formGrid},[e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-name"},[v("昵称")]),e(k,{value:t.value.name,onInput:m=>t.value.name=m,placeholder:"输入昵称…",inputProps:{id:"user-name",autocomplete:"name"}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-username"},[v("用户名")]),e(k,{value:t.value.username,onInput:m=>t.value.username=m,placeholder:"输入用户名…",inputProps:{id:"user-username",autocomplete:"username",spellcheck:!1}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-mail"},[v("邮箱")]),e(k,{value:t.value.mail,onInput:m=>t.value.mail=m,placeholder:"输入邮箱地址…",inputProps:{id:"user-mail",type:"email",inputmode:"email",autocomplete:"email",spellcheck:!1}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-url"},[v("个人网站")]),e(k,{value:t.value.url,onInput:m=>t.value.url=m,placeholder:"https://example.com",inputProps:{id:"user-url",type:"url",inputmode:"url",autocomplete:"url",spellcheck:!1}},null)]),e("div",{class:[l.formGroup,l.formGroupFull]},[e("label",{class:l.formLabel,for:"user-introduce"},[v("个人简介")]),e(k,{value:t.value.introduce,onInput:m=>t.value.introduce=m,type:"textarea",placeholder:"介绍一下自己…",autosize:{minRows:3,maxRows:6},inputProps:{id:"user-introduce"}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-avatar"},[v("头像 URL")]),e(k,{value:t.value.avatar,onInput:m=>t.value.avatar=m,placeholder:"https://example.com/avatar.jpg",inputProps:{id:"user-avatar",type:"url",inputmode:"url",spellcheck:!1}},null),e("p",{class:l.formDescription},[v("也可以点击上方头像直接上传图片")])])])]),e("section",{class:l.userSection},[e("div",{class:l.userSectionTitleRow},[e("h3",{class:l.userSectionTitle},[e(kt,{class:"mr-1.5 inline-block size-4","aria-hidden":"true"},null),v("社交链接")]),e(x,{size:"small",type:"primary",ghost:!0,onClick:h,disabled:r.value.size>=g.length},{default:()=>[e(de,{class:"mr-1 size-4","aria-hidden":"true"},null),v("添加")]})]),y.value.length===0?e("div",{class:l.socialEmpty},[v("暂未添加任何社交链接")]):e("div",{class:l.socialList},[y.value.map(({key:m,value:F})=>e("div",{class:l.socialRow,key:m},[e(G,{class:l.socialSelect,value:m,options:g.map(E=>({...E,disabled:r.value.has(E.value)&&E.value!==m})),onUpdateValue:E=>f(m,E)},null),e(k,{class:l.socialInput,value:F,onInput:E=>b(m,E),placeholder:"输入链接或 ID…",inputProps:{spellcheck:!1}},null),e("button",{type:"button",class:l.socialRemoveBtn,onClick:()=>S(m),"aria-label":`删除 ${m} 社交链接`},[e(te,{class:"size-4","aria-hidden":"true"},null)])]))])])])])}),Tl=C(()=>()=>e("div",{class:l.userTabContainer},[e("section",{class:l.userSection},[e("div",{class:l.userSectionHeader},[e(I,{circle:!0,style:{width:"128px",height:"128px"}},null),e("div",{class:l.userHeaderInfo},[e(I,{text:!0,style:{width:"120px",height:"28px"}},null),e(I,{text:!0,style:{width:"80px",height:"18px",marginTop:"4px"}},null),e("div",{class:"mt-3 flex gap-4"},[e(I,{text:!0,style:{width:"150px"}},null),e(I,{text:!0,style:{width:"120px"}},null)])])])]),e("section",{class:l.userSection},[e(I,{text:!0,style:{width:"80px",height:"20px"}},null),e("div",{class:"mt-4 grid gap-6 md:grid-cols-2"},[Array.from({length:4}).map((t,a)=>e("div",{key:a},[e(I,{text:!0,style:{width:"60px",height:"16px",marginBottom:"8px"}},null),e(I,{text:!0,style:{width:"100%",height:"34px"}},null)]))])])]));var q=(function(t){return t.User="user",t.System="system",t.Security="security",t.Auth="auth",t})(q||{});const Ae=[{key:q.User,label:"用户",icon:He,component:Ze},{key:q.System,label:"系统",icon:Ue,component:Bl},{key:q.Security,label:"安全",icon:Ge,component:Sl},{key:q.Auth,label:"登入方式",icon:re,component:vl}],Gl=C({setup(){const t=Ee(),a=ce(),o=w(t.params.type||q.User);U(()=>t.params.type,i=>{i&&(o.value=i)});const n=i=>{a.replace({name:t.name,params:{...t.params,type:i}})};return()=>{const i=Ae.find(c=>c.key===o.value)?.component||Ze;return e("div",{class:l.container},[e("nav",{class:l.sidebar},[e("ul",{class:l.navList},[Ae.map(c=>{const p=c.icon,s=o.value===c.key;return e("li",{key:c.key},[e("button",{class:[l.navItem,s&&l.navItemActive],onClick:()=>n(c.key),type:"button"},[e(p,{class:l.navIcon,"aria-hidden":"true"},null),e("span",null,[c.label])])])})])]),e("main",{class:l.content},[e(i,null,null)])])}}});export{Gl as default};
