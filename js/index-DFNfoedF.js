import{c as z,d as f,r as o,b0 as L,O as w,h as e,p as j,X as A,V as R,H as x,bt as V,W as F,Y as B,s as M,i as c,T as C,da as P,aU as S,aa as U,db as D,a as q,G as O,a0 as N}from"./index-DoEgFLcO.js";import{h}from"./health-5f4K94HO.js";import{X as E}from"./index-CBQq4nR6.js";import{F as g}from"./file-text-CxNLTwjh.js";import{c as b,b as k}from"./index-C9y5f5je.js";import{E as y}from"./types-w5g51IlY.js";import{P as H}from"./play-DaxQyYxK.js";import{R as I}from"./rotate-ccw-B555-hPi.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=z("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),Q=f({setup(){const t=o([]),l=o(!1),a=o("native"),i=L(),n=async()=>{l.value=!0;try{t.value=await h.getLogList()}finally{l.value=!1}};w(()=>{n()});const d=o(""),u=o(!1),m=o(""),v=async s=>{const r=await h.getLogContent(s.filename);d.value=r,m.value=s.filename,u.value=!0},p=s=>{i.warning({title:"确认删除",content:`确定要删除日志文件「${s.filename}」吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{await h.deleteLog(s.filename),t.value=t.value.filter(r=>r.filename!==s.filename),M.success("删除成功")}})};return()=>e(B,null,[e(j,{transformOrigin:"center",show:u.value,onUpdateShow:s=>u.value=s},{default:()=>[e("div",{class:"w-full max-w-4xl rounded-xl bg-neutral-900 shadow-2xl"},[e("div",{class:"flex items-center justify-between border-b border-neutral-800 px-5 py-4"},[e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex size-8 items-center justify-center rounded-lg bg-neutral-800"},[e(g,{class:"size-4 text-neutral-400"},null)]),e("h2",{class:"text-base font-medium text-white"},[m.value||"查看日志"])]),e("button",{type:"button",class:"rounded-lg p-1.5 text-neutral-400 transition-colors hover:bg-neutral-800 hover:text-white",onClick:()=>u.value=!1,"aria-label":"关闭"},[e(A,{class:"size-5"},null)])]),e("div",{class:"p-4"},[e(G,{data:d.value},null)])])]}),e("div",{class:"space-y-4"},[e("div",{class:"flex items-center justify-between"},[e(R,{class:"w-36",value:a.value,onUpdateValue:s=>{a.value=s,n()},options:[{label:"PM2 日志",value:"pm2"},{label:"系统日志",value:"native"}],"aria-label":"选择日志类型"},null),e(x,{icon:e(V,null,null),name:"刷新",onClick:n,disabled:l.value},null)]),e(F,{show:l.value},{default:()=>[e("div",{class:"min-h-[300px]"},[t.value.length===0&&!l.value?e($,null,null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[t.value.map(s=>e(W,{key:s.filename,item:s,onView:()=>v(s),onDelete:()=>p(s)},null))])])]})])])}}),W=f({props:{item:{type:Object,required:!0},onView:{type:Function,required:!0},onDelete:{type:Function,required:!0}},setup(t){return()=>{const{item:l}=t,a=l.type==="error"||l.filename.includes("error");return e("div",{class:"group flex items-center gap-4 border-b border-neutral-200 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-800/50"},[e("div",{class:["flex size-10 shrink-0 items-center justify-center rounded-lg",a?"bg-red-50 text-red-500 dark:bg-red-950/50 dark:text-red-400":"bg-neutral-100 text-neutral-500 dark:bg-neutral-800 dark:text-neutral-400"]},[e(g,{class:"size-5"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex items-center gap-2"},[e("span",{class:"truncate text-base font-medium text-neutral-900 dark:text-neutral-100",title:l.filename},[l.filename]),e("span",{class:["shrink-0 rounded-full px-2 py-0.5 text-xs",a?"bg-red-50 text-red-600 dark:bg-red-950/50 dark:text-red-400":"bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"]},[l.type])]),e("div",{class:"mt-0.5 text-sm tabular-nums text-neutral-500 dark:text-neutral-400"},[l.size])]),e("div",{class:"flex shrink-0 items-center gap-2"},[e("button",{onClick:t.onView,class:["rounded-lg px-3 py-1.5 text-sm font-medium","bg-neutral-900 text-white dark:bg-white dark:text-neutral-900","hover:bg-neutral-800 dark:hover:bg-neutral-100","transition-colors duration-150"]},[c("查看")]),e("button",{onClick:t.onDelete,"aria-label":`删除 ${l.filename}`,class:["flex size-8 items-center justify-center rounded-lg","text-neutral-400 hover:text-red-500","hover:bg-red-50 dark:hover:bg-red-950/50","transition-colors duration-150"]},[e(C,{class:"size-4"},null)])])])}}}),$=f({setup(){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(g,{class:"size-8 text-neutral-400"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[c("暂无日志文件")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[c("当前没有可用的日志文件")])])}}),G=f({props:{data:{type:String,default:""}},setup(t){const l=o(!0);return w(()=>{setTimeout(()=>{l.value=!1},300)}),()=>e("div",{class:"relative flex h-[60vh] max-h-[600px] min-h-[300px] overflow-hidden rounded-lg"},[l.value?e("div",{class:"flex h-full w-full items-center justify-center"},[e(F,{show:!0,strokeWidth:14},null)]):e(E,{darkMode:!0,class:"h-full w-full",onReady:a=>{a.write(t.data)}},null)])}}),Y=f({setup(){const t=o(!1),l=o(!1);let a=null;const i=[],n=[],d=(r=!0)=>{b?.socket?.emit("log",{prevLog:r})},u=r=>{if(l.value=!0,t.value){n.push(r);return}a?(i.length>0&&m(a),a.write(r)):i.push(r)},m=r=>{for(;i.length;){const T=i.shift();r.write(T)}},v=()=>{a?.clear(),l.value=!1},p=()=>{if(t.value=!t.value,!t.value&&a&&n.length>0)for(;n.length;){const r=n.shift();a.write(r)}},s=()=>{d(!0)};return P(()=>{d(),k.on(y.STDOUT,u)}),S(()=>{const r=()=>{d(!1)};return b?.socket?.io?.on("open",r),()=>{b?.socket?.io?.off("open",r)}}),U(()=>{b?.socket?.emit("unlog"),k.off(y.STDOUT,u)}),()=>e("div",{class:"flex h-full flex-col"},[e("div",{class:"mb-4 flex items-center justify-between"},[e("div",{class:["flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium",t.value?"bg-amber-50 text-amber-600 dark:bg-amber-950/50 dark:text-amber-400":"bg-green-50 text-green-600 dark:bg-green-950/50 dark:text-green-400"]},[e("span",{class:["size-2 rounded-full",t.value?"bg-amber-500":"animate-pulse bg-green-500"]},null),e("span",null,[t.value?"已暂停":"实时接收中"]),t.value&&n.length>0&&e("span",{class:"rounded-md bg-amber-100 px-1.5 py-0.5 text-xs tabular-nums dark:bg-amber-900/50"},[n.length,c(" 条待处理")])]),e("div",{class:"flex items-center gap-1"},[e(x,{icon:t.value?e(H,null,null):e(X,null,null),name:t.value?"恢复":"暂停",onClick:p},null),e(x,{icon:e(C,null,null),name:"清空",onClick:v,disabled:!l.value},null),e(x,{icon:e(I,null,null),name:"重连",onClick:s},null)])]),e("div",{class:["relative flex-1 overflow-hidden rounded-xl border","border-neutral-200 dark:border-neutral-800","bg-neutral-900"]},[!l.value&&e("div",{class:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-neutral-900/80"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-800"},[e(D,{class:"size-8 text-neutral-500"},null)]),e("p",{class:"mb-1 text-base font-medium text-neutral-300"},[c("等待日志输出...")]),e("p",{class:"text-sm text-neutral-500"},[c("日志将会实时显示在这里")])]),e(E,{darkMode:!0,class:"h-full w-full",onReady:r=>{a=r,m(a)}},null)])])}}),J=[{key:"0",label:"日志文件",icon:g},{key:"1",label:"实时日志",icon:D}],re=f({setup(){const t=N(),l=O(),a=q(()=>t.query.tab?.toString()||"0"),i=n=>{l.replace({...t,query:{...t.query,tab:n}})};return()=>e("div",{class:"flex h-full flex-col"},[e("div",{class:"mb-4 flex items-center gap-1 border-b border-neutral-200 dark:border-neutral-800"},[J.map(n=>{const d=n.icon,u=a.value===n.key;return e("button",{key:n.key,onClick:()=>i(n.key),class:["relative flex items-center gap-2 px-4 py-2.5 text-sm font-medium","transition-colors duration-150","focus-visible:outline-none focus-visible:ring-2","focus-visible:ring-neutral-400 focus-visible:ring-offset-2","dark:focus-visible:ring-neutral-500 dark:focus-visible:ring-offset-neutral-900",u?"text-neutral-900 dark:text-white":"text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200"]},[e(d,{class:"size-4"},null),n.label,u&&e("span",{class:"absolute bottom-0 left-0 right-0 h-0.5 bg-neutral-900 dark:bg-white"},null)])})]),e("div",{class:"min-h-0 flex-1"},[a.value==="0"?e(Q,null,null):e(Y,null,null)])])}});export{re as default};
