import{c as O,bL as st,bM as nt,d as I,r as k,a as E,i as e,aV as ee,bp as rt,bo as ot,bN as it,S as ct,bO as q,bP as dt,bQ as pt,w as ge,v as U,Y as K,x as V,b2 as D,z as B,j as d,aF as Be,B as _,bR as Pe,bS as z,bT as Oe,bU as W,e as te,aR as ae,u as de,O as Q,a0 as Ue,G as xe,M as vt,q as R,bV as Ae,P as X,N as M,bJ as Ge,K as le,n as Z,T as $,A as ue,g as Y,bW as H,t as mt,bX as ne,m as yt,o as J,p as P,s as pe,X as ft,W as bt,V as G,aQ as ht,Z as gt,bY as re,b7 as L,aI as se,bZ as xt,b3 as kt,an as Ct,b_ as oe,br as ie,H as ve,aS as _t,bv as ke,b$ as me,c0 as ze,ap as wt,bz as Bt,b8 as Ne,bx as qe,c1 as j,c2 as Le,aw as At,a_ as ye,a3 as Ft,c3 as Fe,c4 as It,bI as Et,bG as Dt,f as St,h as Ve,aa as Mt,c5 as Tt,c6 as Pt,c7 as Ot,aY as Ut}from"./index-R5yA_R4y.js";import{U as Re}from"./user-Bz6t8xb5.js";import{G as Ce}from"./globe-5W0qxraY.js";import{G as Gt}from"./grip-vertical-BOWrNtFT.js";import{L as je}from"./lock-FGfmHYCf.js";import{C as fe}from"./circle-check-Bv840LvB.js";import{i as be}from"./isEmpty-Cm98nGBp.js";import{U as zt}from"./index-BECoh9jg.js";import{M as Nt}from"./mail-DUIlwbip.js";import{C as qt}from"./calendar-ojjBrQp-.js";import"./Upload-D5pi52BF.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=O("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=O("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=O("fingerprint-pattern",[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=O("github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=O("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=O("list-plus",[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 19H3",key:"zzsher"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=O("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=O("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=O("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=O("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function Ie(t,a,i){const v=Array.isArray(a)?a:typeof a=="string"?st(a):[a];let u=t;for(let r=0;r<v.length-1;r++){const n=v[r],y=v[r+1];u[n]==null&&(u[n]=nt(y)?[]:{}),u=u[n]}const m=v[v.length-1];return u[m]=i,t}const Kt="_container_mr0xl_4",Wt="_sidebar_mr0xl_9",$t="_navList_mr0xl_17",Qt="_navItem_mr0xl_27",Xt="_navItemActive_mr0xl_47",Yt="_navIcon_mr0xl_55",Jt="_navExpandIcon_mr0xl_59",Zt="_navExpandIconOpen_mr0xl_63",ea="_content_mr0xl_154",ta="_sectionHeader_mr0xl_176",aa="_sectionTitle_mr0xl_180",la="_sectionSubtitle_mr0xl_188",ua="_avatarContainer_mr0xl_209",sa="_avatarWrapper_mr0xl_218",na="_avatarUploadOverlay_mr0xl_234",ra="_avatarUploadIcon_mr0xl_242",oa="_formGrid_mr0xl_291",ia="_formGroup_mr0xl_295",ca="_formLabel_mr0xl_299",da="_formDescription_mr0xl_307",pa="_formGroupFull_mr0xl_315",va="_sessionList_mr0xl_345",ma="_sessionItem_mr0xl_349",ya="_sessionItemCurrent_mr0xl_357",fa="_sessionHeader_mr0xl_365",ba="_sessionBadge_mr0xl_369",ha="_sessionBadgeCurrent_mr0xl_373",ga="_sessionBadgeOther_mr0xl_381",xa="_sessionContent_mr0xl_389",ka="_sessionRow_mr0xl_393",Ca="_sessionLabel_mr0xl_397",_a="_sessionUA_mr0xl_413",wa="_tokenCard_mr0xl_422",Ba="_tokenHeader_mr0xl_430",Aa="_tokenTitle_mr0xl_434",Fa="_passwordSection_mr0xl_443",Ia="_passwordHeader_mr0xl_451",Ea="_passwordIcon_mr0xl_455",Da="_passwordTitle_mr0xl_467",Sa="_authGrid_mr0xl_476",Ma="_authProviderIcon_mr0xl_492",Ta="_authProviderName_mr0xl_504",Pa="_empty_mr0xl_578",Oa="_emptyIcon_mr0xl_582",Ua="_emptyTitle_mr0xl_594",Ga="_emptyDescription_mr0xl_602",za="_infoRow_mr0xl_616",Na="_infoLabel_mr0xl_632",qa="_infoValue_mr0xl_640",La="_tabContent_mr0xl_649",Va="_settingsGroup_mr0xl_654",Ra="_userTabContainer_mr0xl_742",ja="_userSection_mr0xl_746",Ha="_userSectionHeader_mr0xl_750",Ka="_userHeaderInfo_mr0xl_754",Wa="_userName_mr0xl_758",$a="_userHandle_mr0xl_766",Qa="_userMeta_mr0xl_774",Xa="_userMetaItem_mr0xl_778",Ya="_userMetaIcon_mr0xl_786",Ja="_userSectionTitle_mr0xl_790",Za="_userSectionTitleRow_mr0xl_798",el="_socialList_mr0xl_807",tl="_socialRow_mr0xl_811",al="_socialSelect_mr0xl_815",ll="_socialInput_mr0xl_819",ul="_socialRemoveBtn_mr0xl_823",sl="_socialEmpty_mr0xl_843",nl="_groupNavItem_mr0xl_852",rl="_groupNavItemActive_mr0xl_870",ol="_groupNavIcon_mr0xl_878",il="_groupNavIconActive_mr0xl_890",cl="_groupNavContent_mr0xl_898",dl="_groupNavTitle_mr0xl_902",pl="_groupNavDescription_mr0xl_910",vl="_sectionCard_mr0xl_919",ml="_sectionCardHeader_mr0xl_927",yl="_sectionCardTitle_mr0xl_935",fl="_sectionCardBody_mr0xl_943",bl="_mobileGroupNav_mr0xl_948",hl="_mobileGroupNavList_mr0xl_956",gl="_mobileGroupNavItem_mr0xl_966",xl="_mobileGroupNavItemActive_mr0xl_982",kl="_mobileGroupNavIcon_mr0xl_990",l={container:Kt,sidebar:Wt,navList:$t,navItem:Qt,navItemActive:Xt,navIcon:Yt,navExpandIcon:Jt,navExpandIconOpen:Zt,content:ea,sectionHeader:ta,sectionTitle:aa,sectionSubtitle:la,avatarContainer:ua,avatarWrapper:sa,avatarUploadOverlay:na,avatarUploadIcon:ra,formGrid:oa,formGroup:ia,formLabel:ca,formDescription:da,formGroupFull:pa,sessionList:va,sessionItem:ma,sessionItemCurrent:ya,sessionHeader:fa,sessionBadge:ba,sessionBadgeCurrent:ha,sessionBadgeOther:ga,sessionContent:xa,sessionRow:ka,sessionLabel:Ca,sessionUA:_a,tokenCard:wa,tokenHeader:Ba,tokenTitle:Aa,passwordSection:Fa,passwordHeader:Ia,passwordIcon:Ea,passwordTitle:Da,authGrid:Sa,authProviderIcon:Ma,authProviderName:Ta,empty:Pa,emptyIcon:Oa,emptyTitle:Ua,emptyDescription:Ga,infoRow:za,infoLabel:Na,infoValue:qa,tabContent:La,settingsGroup:Va,userTabContainer:Ra,userSection:ja,userSectionHeader:Ha,userHeaderInfo:Ka,userName:Wa,userHandle:$a,userMeta:Qa,userMetaItem:Xa,userMetaIcon:Ya,userSectionTitle:Ja,userSectionTitleRow:Za,socialList:el,socialRow:tl,socialSelect:al,socialInput:ll,socialRemoveBtn:ul,socialEmpty:sl,groupNavItem:nl,groupNavItemActive:rl,groupNavIcon:ol,groupNavIconActive:il,groupNavContent:cl,groupNavTitle:dl,groupNavDescription:pl,sectionCard:vl,sectionCardHeader:ml,sectionCardTitle:yl,sectionCardBody:fl,mobileGroupNav:bl,mobileGroupNavList:hl,mobileGroupNavItem:gl,mobileGroupNavItemActive:xl,mobileGroupNavIcon:kl};let S=(function(t){return t.User="user",t.System="system",t.Security="security",t.Auth="auth",t.MetaPreset="meta-preset",t})({});const Ee=[{key:S.User,label:"用户",icon:Re},{key:S.System,label:"系统",icon:ee,hasGroups:!0},{key:S.Security,label:"安全",icon:we},{key:S.Auth,label:"登入方式",icon:he},{key:S.MetaPreset,label:"Meta 预设",icon:_e}],We={globe:Ce,search:ct,bell:Lt,puzzle:it,shield:we,settings:ee,sparkles:ot},Cl=I({props:{activeTab:{type:String,required:!0},activeGroupKey:{type:String,default:""},systemSchema:{type:Object,default:null},onTabChange:{type:Function,required:!0},onGroupChange:{type:Function,required:!0}},setup(t){const a=k(!0),i=E(()=>t.activeTab===S.System),v=r=>We[r]||ee,u=()=>{a.value=!a.value},m=()=>{t.activeTab!==S.System&&t.onTabChange(S.System),u()};return()=>e("nav",{class:l.sidebar},[e("ul",{class:l.navList},[Ee.map(r=>{const n=r.icon,y=t.activeTab===r.key;return e("li",{key:r.key,class:"md:hidden"},[e("button",{class:[l.navItem,y&&l.navItemActive],onClick:()=>t.onTabChange(r.key),type:"button"},[e(n,{class:l.navIcon,"aria-hidden":"true"},null),e("span",null,[r.label])])])})]),e("div",{class:"hidden md:block"},[e("ul",{class:"m-0 list-none p-0"},[Ee.map(r=>{const n=r.icon,y=t.activeTab===r.key;return r.hasGroups?e("li",{key:r.key,class:"mb-2"},[e("button",{class:[l.navItem,y&&l.navItemActive,"w-full justify-between"],onClick:m,type:"button"},[e("div",{class:"flex items-center gap-3"},[e(n,{class:l.navIcon,"aria-hidden":"true"},null),e("span",null,[r.label])]),e(rt,{class:[l.navExpandIcon,a.value&&l.navExpandIconOpen]},null)]),a.value&&t.systemSchema?.groups&&e("ul",{class:"m-0 mt-1 list-none space-y-1 p-0"},[t.systemSchema.groups.map(b=>{const C=v(b.icon),h=y&&t.activeGroupKey===b.key;return e("li",{key:b.key},[e("button",{class:[l.groupNavItem,h&&l.groupNavItemActive],onClick:()=>t.onGroupChange(b.key),type:"button"},[e("div",{class:[l.groupNavIcon,h&&l.groupNavIconActive]},[e(C,null,null)]),e("div",{class:l.groupNavContent},[e("div",{class:l.groupNavTitle},[b.title]),e("div",{class:l.groupNavDescription},[b.description])])])])})])]):e("li",{key:r.key},[e("button",{class:[l.navItem,y&&l.navItemActive],onClick:()=>t.onTabChange(r.key),type:"button"},[e(n,{class:l.navIcon,"aria-hidden":"true"},null),e("span",null,[r.label])])])})])]),i.value&&t.systemSchema?.groups&&e(_l,{groups:t.systemSchema.groups,activeGroupKey:t.activeGroupKey,onGroupChange:t.onGroupChange},null)])}}),_l=I({props:{groups:{type:Array,required:!0},activeGroupKey:{type:String,required:!0},onGroupChange:{type:Function,required:!0}},setup(t){const a=i=>We[i]||ee;return()=>e("div",{class:l.mobileGroupNav},[e("ul",{class:l.mobileGroupNavList},[t.groups.map(i=>{const v=a(i.icon);return e("li",{key:i.key},[e("button",{class:[l.mobileGroupNavItem,t.activeGroupKey===i.key&&l.mobileGroupNavItemActive],onClick:()=>t.onGroupChange(i.key),type:"button"},[e(v,{class:l.mobileGroupNavIcon},null),i.title])])})])])}}),wl=async()=>q.getSession();function Bl(t){const a={};for(const i of t.providers){const v=i.type;v in t.public?a[v]={...t.public[v],enabled:i.enabled,type:v}:console.warn(`Provider type ${v} found in providers but not in public data.`)}return a}const $e=Symbol.for("OauthDataInjectKey"),Al=()=>t=>pt($e,t),Fl=()=>dt($e),Il=()=>e("svg",{viewBox:"0 0 24 24",class:"size-5"},[e("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"},null),e("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"},null),e("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"},null),e("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"},null)]),El={github:He,google:Il},Qe=(t,a)=>I({setup(){const i=async()=>{await Oe.signIn.social({provider:t,callbackURL:`${location.href}?validate=true`})},v=Fl(),u=k({clientId:"",secret:""}),m=k(!1);ge(()=>{if(v.value[t]===void 0)return;const{clientId:h,enabled:p}=v.value[t];m.value=p,u.value.clientId=h});const r=k(null),n={clientId:[{required:!0,message:"Client Id 不能为空"}],secret:[{required:!0,message:"Client Secret 不能为空"}]},y=async()=>{await r.value?.validate(),await W.patch("oauth",{providers:[{type:t,enabled:m.value}],secrets:{[t]:{clientSecret:u.value.secret}},public:{[t]:{clientId:u.value.clientId}}}),message.success("保存成功")},b=async()=>{const h=`${Be}/auth/callback/${t}`;try{await navigator.clipboard.writeText(h),message.success("已复制到剪贴板")}catch{message.error("复制失败")}},C=El[t]||He;return()=>e(U,{size:"small"},{header:()=>e("div",{class:"flex items-center gap-3"},[e("div",{class:l.authProviderIcon},[e(C,null,null)]),e("div",{class:"flex-1"},[e("h3",{class:l.authProviderName},[a.name])]),e("label",{class:"flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-300"},[e(z,{value:m.value,onUpdateValue:h=>{m.value=h}},null)])]),default:()=>e(K,null,[e(V,{model:u.value,ref:r,rules:n,labelPlacement:"left",labelWidth:100},{default:()=>[e(D,{label:"Client ID",path:"clientId",required:!0},{default:()=>[e(B,{value:u.value.clientId,onUpdateValue:h=>{u.value.clientId=h},placeholder:"输入 Client ID"},null)]}),e(D,{label:"Client Secret",required:!0,path:"secret"},{default:()=>[e(B,{showPasswordToggle:!0,type:"password",value:u.value.secret,onUpdateValue:h=>{u.value.secret=h},placeholder:"输入 Client Secret"},null)]})]}),e("div",{class:"mt-4 rounded-lg bg-neutral-50 p-3 dark:bg-neutral-800"},[e("div",{class:"mb-1 text-xs text-neutral-500 dark:text-neutral-400"},[d("Callback URL")]),e("div",{class:"flex items-center gap-2"},[e("span",{class:"flex-1 truncate font-mono text-sm text-neutral-700 dark:text-neutral-200"},[Be,d("/auth/callback/"),t]),e(_,{text:!0,type:"primary",onClick:b},{default:()=>[e(Pe,{class:"size-4"},null)]})])]),e("div",{class:"mt-4 flex items-center justify-end"},[e("div",{class:"flex gap-2"},[e(_,{onClick:i,tertiary:!0,size:"small"},{default:()=>[d("验证")]}),e(_,{onClick:y,type:"primary",size:"small"},{default:()=>[d("保存")]})])])])})}}),Dl=Qe("github",{name:"GitHub"}),Sl=Qe("google",{name:"Google"}),Ml=I({setup(){return()=>e("div",{class:l.tabContent},[e(Tl,null,null),e(Pl,null,null)])}}),Tl=I(()=>{const t=te(ae),{data:a,refetch:i}=de({queryKey:R.auth.passkeys(),queryFn:()=>q.getPasskeys()}),v=y=>{q.deletePasskey(y).then(()=>{i()})},u=I(y=>{const b=k(""),C=h=>{h.preventDefault(),h.stopPropagation(),Ae.createPassKey(b.value).then(()=>{i(),y.dialog.destroy()})};return()=>e(V,{onSubmit:C},{default:()=>[e(D,{label:"名称",required:!0},{default:()=>[e(B,{value:b.value,onUpdateValue:h=>{b.value=h},placeholder:"为这个 Passkey 起个名字…"},null)]}),e("div",{class:"flex justify-end"},[e(_,{disabled:b.value.length===0,type:"primary",onClick:C},{default:()=>[d("创建")]})])]})}),{data:m,refetch:r}=de({queryKey:R.options.detail("authSecurity"),queryFn:async()=>await W.get("authSecurity")}),n=y=>{W.patch("authSecurity",{disablePasswordLogin:y}).then(()=>{r()})};return u.props=["dialog"],()=>e(U,{size:"small"},{default:()=>[e("div",{class:"mb-6 flex items-center justify-between"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[e(he,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("通行密钥")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[d("使用生物识别或安全密钥登录")])]),e("div",{class:"flex items-center gap-2"},[e(_,{type:"tertiary",onClick:()=>{Ae.validate(!0)}},{default:()=>[e(jt,{class:"mr-1 size-4"},null),d("验证")]}),e(_,{type:"primary",onClick:()=>{const y=dialog.create({title:"创建 Passkey",content:()=>e(u,{dialog:y},null)})}},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("新增")]})])]),e("div",{class:"mb-4 flex items-center justify-between rounded-lg border border-neutral-200 bg-white px-4 py-3 dark:border-neutral-800 dark:bg-neutral-900"},[e("div",{class:"flex flex-col gap-0.5"},[e("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-200"},[d("禁止密码登录")]),e("span",{class:"text-xs text-neutral-500 dark:text-neutral-400"},[d("开启后只能通过 Passkey 或 OAuth 登录")])]),e(z,{value:m.value?.disablePasswordLogin,onUpdateValue:y=>{if(y&&!a.value?.length){message.error("至少需要一个 Passkey 才能开启这个功能");return}n(y)}},null)]),e("div",null,[a.value?a.value.length===0?e("div",{class:l.empty},[e("div",{class:l.emptyIcon},[e(Ke,null,null)]),e("h3",{class:l.emptyTitle},[d("暂无通行密钥")]),e("p",{class:l.emptyDescription},[d("添加一个通行密钥以启用无密码登录")])]):e(Ge,{scrollX:Math.max(600,t.contentWidth.value-t.contentInsetWidth.value),remote:!0,bordered:!1,data:a.value,columns:[{key:"name",title:"名称",render({name:y}){return e("div",{class:"flex items-center gap-2"},[e(he,{class:"size-4 text-blue-500"},null),e("span",{class:"font-medium"},[y])])}},{title:"创建时间",key:"created",render({created:y}){return e(le,{time:y},null)}},{title:"操作",key:"id",width:100,render({id:y,name:b}){return e(Z,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{v(y)}},{trigger:()=>e(_,{text:!0,type:"error"},{default:()=>[e($,{class:"size-4"},null)]}),default:()=>e("span",{class:"max-w-48"},[d('确定要删除 Passkey "'),b,d('"?')])})}}]},null):e(M,{text:!0,style:{width:"100%",height:"150px"}},null)])]})}),Pl=I(()=>{const t=Ue(),a=xe(),i=k({});return Q(async()=>{const v=await W.get("oauth");i.value=Bl(v)}),Al()(i),Q(async()=>{const v=t.query.validate;a.replace({query:{...t.query,validate:""}}),v&&await wl()&&(message.success("验证成功"),dialog.create({title:"设定为主人账户？",positiveText:"是",negativeText:"否",onPositiveClick(m){q.authAsOwner()}}))}),()=>e("section",{class:[l.settingsGroup,"mt-8"]},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(vt,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("OAuth 登录")]),e("p",{class:l.sectionSubtitle},[d("配置第三方账号登录方式")])])]),e("div",{class:l.authGrid},[e(Dl,null,null),e(Sl,null,null)])])}),Ol=t=>de({queryKey:E(()=>R.metaPresets.list()),queryFn:()=>H.getAll(mt(t)),select:a=>Array.isArray(a)?a:a?.data??[]}),Ul=()=>{const t=ue();return Y({mutationFn:({id:a,data:i})=>H.update(a,i),onSuccess:(a,{id:i})=>{window.message.success("修改成功"),t.invalidateQueries({queryKey:R.metaPresets.detail(i)}),t.invalidateQueries({queryKey:R.metaPresets.list()})}})},Gl=()=>{const t=ue();return Y({mutationFn:H.delete,onSuccess:()=>{window.message.success("删除成功"),t.invalidateQueries({queryKey:R.metaPresets.all})}})},zl=()=>{const t=ue();return Y({mutationFn:a=>H.updateOrder(a),onSuccess:()=>{t.invalidateQueries({queryKey:R.metaPresets.list()})}})},Nl={text:"文本",textarea:"多行文本",number:"数字",url:"URL",select:"单选","multi-select":"多选",checkbox:"复选框",tags:"标签",boolean:"开关",object:"对象"},ql={post:"博文",note:"笔记",both:"通用"},Ll={post:"info",note:"success",both:"warning"},Vl=I({name:"MetaPresetCard",props:{preset:{type:Object,required:!0},onEdit:{type:Function,required:!0},onDelete:{type:Function,required:!0},onToggleEnabled:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"group flex items-center gap-3 border-b border-neutral-200 px-4 py-3 transition-colors last:border-b-0 hover:bg-neutral-50 dark:border-neutral-800 dark:hover:bg-neutral-900/50"},[!t.preset.isBuiltin&&e("div",{class:"shrink-0 cursor-grab text-neutral-300 dark:text-neutral-600"},[e(Gt,{class:"size-4"},null)]),e("div",{class:"min-w-0 flex-1"},[e("div",{class:"flex flex-wrap items-center gap-2"},[e("span",{class:"font-medium text-neutral-900 dark:text-neutral-100"},[t.preset.label]),e("code",{class:"rounded bg-neutral-100 px-1.5 py-0.5 font-mono text-xs text-neutral-500 dark:bg-neutral-800 dark:text-neutral-400"},[t.preset.key]),t.preset.isBuiltin&&e(ne,{size:"tiny",type:"default",round:!0},{icon:()=>e(je,{class:"size-3"},null),default:()=>e("span",{class:"text-xs"},[d("内置")])})]),e("div",{class:"mt-1 flex flex-wrap items-center gap-2 text-sm text-neutral-500 dark:text-neutral-400"},[e(ne,{size:"tiny",type:"info",bordered:!1},{default:()=>[Nl[t.preset.type]]}),e(ne,{size:"tiny",type:Ll[t.preset.scope],bordered:!1},{default:()=>[ql[t.preset.scope]]}),t.preset.description&&e("span",{class:"truncate"},[t.preset.description])])]),e("div",{class:"ml-auto flex shrink-0 items-center gap-2"},[e(z,{size:"small",value:t.preset.enabled,onUpdateValue:()=>t.onToggleEnabled(t.preset)},null),!t.preset.isBuiltin&&e(_,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>t.onEdit(t.preset.id)},{default:()=>[e(yt,{class:"size-3.5"},null)]}),!t.preset.isBuiltin&&e(Z,{onPositiveClick:()=>t.onDelete(t.preset.id),positiveText:"删除",negativeText:"取消"},{trigger:()=>e(_,{size:"tiny",quaternary:!0,type:"error"},{default:()=>[e($,{class:"size-3.5"},null)]}),default:()=>e("span",null,[d("确定要删除预设字段「"),t.preset.label,d("」吗？")])})])])}}),De=[{label:"文本",value:"text"},{label:"多行文本",value:"textarea"},{label:"数字",value:"number"},{label:"URL",value:"url"},{label:"单选",value:"select"},{label:"多选",value:"multi-select"},{label:"复选框",value:"checkbox"},{label:"标签",value:"tags"},{label:"开关",value:"boolean"},{label:"对象",value:"object"}],Rl=[{label:"博文",value:"post"},{label:"笔记",value:"note"},{label:"通用",value:"both"}],Se=["select","multi-select","checkbox"],N=I({props:{label:{type:String,required:!0},required:{type:Boolean,default:!1},error:{type:String,required:!1},hint:{type:String,required:!1}},setup(t,{slots:a}){return()=>e("div",{class:"mb-4"},[e("label",{class:"mb-1.5 block text-sm font-medium text-neutral-700 dark:text-neutral-300"},[t.label,t.required&&e("span",{class:"ml-0.5 text-red-500"},[d("*")])]),a.default?.(),t.hint&&!t.error&&e("p",{class:"mt-1 text-xs text-neutral-400"},[t.hint]),t.error&&e("p",{class:"mt-1 text-xs text-red-500",role:"alert"},[t.error])])}}),jl=I({name:"MetaPresetModal",props:{show:{type:Boolean,required:!0},onClose:{type:Function,required:!0},id:{type:String,required:!1},onSubmit:{type:Function,required:!1}},setup(t){const a=J({type:"text",scope:"both",enabled:!0}),i=k(!1),v=k(!1),u=J({}),m=()=>{Object.keys(a).forEach(o=>{delete a[o]}),a.type="text",a.scope="both",a.enabled=!0,Object.keys(u).forEach(o=>{delete u[o]})},r=()=>(Object.keys(u).forEach(o=>delete u[o]),a.key?.trim()?/^[\w-]+$/.test(a.key)||(u.key="Key 只能包含字母、数字、下划线和连字符"):u.key="请输入字段 Key",a.label?.trim()||(u.label="请输入显示名称"),a.type||(u.type="请选择字段类型"),Se.includes(a.type)&&(!a.options||a.options.length===0)&&(u.options="请至少添加一个选项"),a.type==="object"&&(!a.children||a.children.length===0)&&(u.children="请至少添加一个子字段"),Object.keys(u).length===0);P(()=>t.id,o=>{o?(i.value=!0,H.getById(o).then(A=>{Object.assign(a,A)}).finally(()=>{i.value=!1})):m()});const n=()=>{t.onClose(),gt(()=>m())},y=Y({mutationFn:o=>H.create(o),onSuccess:o=>{message.success("创建成功"),t.onSubmit?.(o),m()}}),b=Y({mutationFn:({id:o,data:A})=>H.update(o,A),onSuccess:o=>{message.success("修改成功"),t.onSubmit?.(o),m()}}),C=()=>{r()&&(v.value=!0,t.id?b.mutate({id:t.id,data:a},{onSettled:()=>v.value=!1}):y.mutate(a,{onSettled:()=>v.value=!1}))},h=o=>{o.key==="Enter"&&(o.metaKey||o.ctrlKey)&&C()},p=()=>{a.options||(a.options=[]),a.options.push({value:"",label:""})},g=o=>{a.options?.splice(o,1)},s=()=>{a.children||(a.children=[]),a.children.push({key:"",label:"",type:"text"})},f=o=>{a.children?.splice(o,1)};return()=>e(pe,{show:t.show,onUpdateShow:o=>{o||n()},closeOnEsc:!0,transformOrigin:"center"},{default:()=>[e("div",{class:"max-h-[90vh] w-full max-w-2xl overflow-hidden rounded-xl bg-white shadow-xl dark:bg-neutral-900",role:"dialog","aria-modal":"true","aria-labelledby":"meta-preset-modal-title",onKeydown:h},[e("div",{class:"flex items-center justify-between border-b border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e("h2",{id:"meta-preset-modal-title",class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[t.id?"编辑预设字段":"新建预设字段"]),e("button",{type:"button",class:"rounded-lg p-1 text-neutral-400 transition-colors hover:bg-neutral-100 hover:text-neutral-600 dark:hover:bg-neutral-800",onClick:n,"aria-label":"关闭"},[e(ft,{class:"size-5"},null)])]),e("div",{class:"max-h-[calc(90vh-140px)] overflow-y-auto px-5 py-4"},[i.value?e("div",{class:"flex items-center justify-center py-12"},[e(bt,{size:"medium"},null)]):e(K,null,[e("div",{class:"grid grid-cols-2 gap-4"},[e(N,{label:"字段 Key",required:!0,error:u.key},{default:()=>[e(B,{value:a.key,onUpdateValue:o=>a.key=o,placeholder:"如: music, movie"},null)]}),e(N,{label:"显示名称",required:!0,error:u.label},{default:()=>[e(B,{value:a.label,onUpdateValue:o=>a.label=o,placeholder:"如: 音乐, 电影"},null)]})]),e("div",{class:"grid grid-cols-2 gap-4"},[e(N,{label:"字段类型",required:!0,error:u.type},{default:()=>[e(G,{value:a.type,onUpdateValue:o=>a.type=o,options:De},null)]}),e(N,{label:"作用域"},{default:()=>[e(G,{value:a.scope,onUpdateValue:o=>a.scope=o,options:Rl},null)]})]),e(N,{label:"描述",hint:"可选的字段描述"},{default:()=>[e(B,{value:a.description,onUpdateValue:o=>a.description=o,placeholder:"字段用途说明"},null)]}),e(N,{label:"占位文本",hint:"输入框占位提示文本"},{default:()=>[e(B,{value:a.placeholder,onUpdateValue:o=>a.placeholder=o,placeholder:"请输入..."},null)]}),Se.includes(a.type)&&e(N,{label:"选项配置",required:!0,error:u.options},{default:()=>[e("div",{class:"space-y-2"},[a.options?.map((o,A)=>e("div",{key:A,class:"flex items-center gap-2"},[e(B,{value:o.value,onUpdateValue:c=>o.value=c,placeholder:"值",class:"flex-1"},null),e(B,{value:o.label,onUpdateValue:c=>o.label=c,placeholder:"显示文本",class:"flex-1"},null),e(_,{quaternary:!0,type:"error",onClick:()=>g(A)},{default:()=>[e($,{class:"size-4"},null)]})])),e(_,{quaternary:!0,type:"primary",onClick:p},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("添加选项")]})]),(a.type==="select"||a.type==="multi-select")&&e("div",{class:"mt-2 flex items-center gap-2"},[e(ht,{checked:a.allowCustomOption,onUpdateChecked:o=>a.allowCustomOption=o},{default:()=>[d("允许自定义选项")]})])]}),a.type==="object"&&e(N,{label:"子字段配置",required:!0,error:u.children},{default:()=>[e("div",{class:"space-y-3"},[a.children?.map((o,A)=>e("div",{key:A,class:"rounded-lg border border-neutral-200 p-3 dark:border-neutral-700"},[e("div",{class:"mb-2 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-400"},[d("子字段 "),A+1]),e(_,{quaternary:!0,type:"error",size:"tiny",onClick:()=>f(A)},{default:()=>[e($,{class:"size-3.5"},null)]})]),e("div",{class:"grid grid-cols-3 gap-2"},[e(B,{value:o.key,onUpdateValue:c=>o.key=c,placeholder:"Key",size:"small"},null),e(B,{value:o.label,onUpdateValue:c=>o.label=c,placeholder:"显示名称",size:"small"},null),e(G,{value:o.type,onUpdateValue:c=>o.type=c,options:De.filter(c=>c.value!=="object"),size:"small"},null)])])),e(_,{quaternary:!0,type:"primary",onClick:s},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("添加子字段")]})])]}),e("div",{class:"flex items-center justify-between rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 dark:border-neutral-700 dark:bg-neutral-800"},[e("div",null,[e("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-200"},[d("启用此预设")]),e("p",{class:"text-xs text-neutral-500 dark:text-neutral-400"},[d("禁用后不会在写作页面显示")])]),e(z,{value:a.enabled,onUpdateValue:o=>a.enabled=o},null)])])]),e("div",{class:"flex items-center justify-end gap-2 border-t border-neutral-200 px-5 py-4 dark:border-neutral-800"},[e(_,{onClick:n},{default:()=>[d("取消")]}),e(_,{type:"primary",loading:v.value,disabled:i.value,onClick:C},{default:()=>[t.id?"保存修改":"创建预设"]})])])]})}}),Hl=I({name:"TabMetaPresets",setup(){const t=ue(),{data:a,isLoading:i}=Ol(),v=Gl(),u=Ul(),m=zl(),r=k(!1),n=k(""),y=()=>{n.value="",r.value=!0},b=x=>{n.value=x,r.value=!0},C=x=>{v.mutate(x)},h=x=>{u.mutate({id:x.id,data:{enabled:!x.enabled}})},p=()=>{r.value=!1,n.value=""},g=()=>{p(),t.invalidateQueries({queryKey:R.metaPresets.all})},s=k(null),f=x=>{s.value=x},o=(x,F)=>{x.preventDefault(),s.value===null||s.value},A=(x,F)=>{if(x.preventDefault(),s.value===null||!a.value)return;const T=[...a.value],[at]=T.splice(s.value,1);T.splice(F,0,at);const lt=T.map(ut=>ut.id);m.mutate(lt),s.value=null},c=()=>{s.value=null};return()=>e("div",{class:l.tabContent},[e(U,{size:"small"},{default:()=>[e("div",{class:"mb-6 flex items-center justify-between"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-neutral-900 dark:text-neutral-100"},[e(_e,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("Meta 预设字段")]),e("p",{class:"text-sm text-neutral-500 dark:text-neutral-400"},[d("配置可复用的自定义 meta 字段（如音乐、电影、书籍等元数据模板）")])]),e(_,{type:"primary",onClick:y},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("新增预设")]})]),i.value?e(Wl,null,null):!a.value||a.value.length===0?e(Kl,{onAdd:y},null):e("div",{class:"overflow-hidden rounded-lg border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"},[a.value.map((x,F)=>e("div",{key:x.id,draggable:!x.isBuiltin,onDragstart:()=>f(F),onDragover:T=>o(T,F),onDrop:T=>A(T,F),onDragend:c,class:["transition-all",s.value===F&&"opacity-50"]},[e(Vl,{preset:x,onEdit:b,onDelete:C,onToggleEnabled:h},null)]))])]}),e(jl,{show:r.value,id:n.value,onClose:p,onSubmit:g},null)])}}),Kl=I({props:{onAdd:{type:Function,required:!0}},setup(t){return()=>e("div",{class:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-neutral-200 bg-neutral-50/50 py-16 dark:border-neutral-800 dark:bg-neutral-900/50"},[e("div",{class:"mb-4 flex size-16 items-center justify-center rounded-full bg-neutral-100 dark:bg-neutral-800"},[e(_e,{class:"size-8 text-neutral-400","aria-hidden":"true"},null)]),e("h3",{class:"mb-1 text-lg font-medium text-neutral-900 dark:text-neutral-100"},[d("暂无预设字段")]),e("p",{class:"mb-6 text-sm text-neutral-500 dark:text-neutral-400"},[d("创建预设字段来快速配置文章和笔记的元数据")]),e(_,{type:"primary",onClick:t.onAdd},{default:()=>[d("创建第一个预设")]})])}}),Wl=I({setup(){return()=>e("div",{class:"animate-pulse overflow-hidden rounded-lg border border-neutral-200 dark:border-neutral-800"},[[1,2,3].map(t=>e("div",{key:t,class:"flex items-center gap-4 border-b border-neutral-200 px-4 py-4 last:border-b-0 dark:border-neutral-800"},[e("div",{class:"size-5 rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"flex-1"},[e("div",{class:"h-5 w-32 rounded bg-neutral-200 dark:bg-neutral-700"},null),e("div",{class:"mt-2 h-4 w-48 rounded bg-neutral-100 dark:bg-neutral-800"},null)]),e("div",{class:"flex gap-2"},[e("div",{class:"h-6 w-16 rounded bg-neutral-100 dark:bg-neutral-800"},null),e("div",{class:"h-6 w-16 rounded bg-neutral-100 dark:bg-neutral-800"},null)])]))])}}),Xe=I({props:{fields:{type:Array,required:!0},formData:{type:Object,required:!0},dataKeyPrefix:{type:String,required:!0}},setup(t){return()=>{const{fields:a,formData:i,dataKeyPrefix:v}=t;return e(K,null,[a.filter(u=>!u.ui.hidden).map(u=>{const m=`${v}.${u.key}`;return u.fields&&u.fields.length>0?e(Xe,{fields:u.fields,formData:i,dataKeyPrefix:m},null):e($l,{key:m,field:u,value:re(i.value,m,void 0),onUpdateValue:r=>{const n=v;re(i.value,n)?Ie(i.value,m,r):Ie(i.value,n,{...re(i.value,n,{}),[u.key]:r})}},null)})])}}}),$l=I({props:{field:{type:Object,required:!0},value:{type:Object,required:!1},onUpdateValue:{type:Function,required:!0}},setup(t){const a=k(t.value);P(()=>t.value,m=>{a.value=m}),ge(()=>{t.onUpdateValue(a.value)});const i=()=>{const{field:m}=t,{ui:r}=m;switch(r.component){case"input":return e(B,{inputProps:{id:oe()},value:a.value,onUpdateValue:n=>{a.value=n},placeholder:r.placeholder,clearable:!0},null);case"password":return e(B,{inputProps:{id:oe()},value:a.value,onUpdateValue:n=>{a.value=n},type:"password",showPasswordOn:"click",placeholder:r.placeholder,clearable:!0},null);case"textarea":return e(B,{inputProps:{id:oe()},value:a.value,onUpdateValue:n=>{a.value=n},type:"textarea",autosize:{maxRows:5,minRows:3},placeholder:r.placeholder,clearable:!0},null);case"number":return e(Ct,{value:a.value,onUpdateValue:n=>{a.value=n},placeholder:r.placeholder},null);case"switch":return e(z,{value:a.value,onUpdateValue:n=>{a.value=n}},null);case"select":return e(G,{value:a.value,onUpdateValue:n=>{a.value=n},options:r.options,filterable:!0,placeholder:r.placeholder},null);case"tags":return e(kt,{value:a.value,onUpdateValue:n=>{a.value=n}},null);default:return null}},v=te(ae),u=E(()=>v.viewport.value.mobile?1:2);return()=>{const{field:m}=t,{title:r,description:n,ui:y}=m,b=e(D,{label:r},{default:()=>[n?e(L,{class:"w-full",vertical:!0},{default:()=>[i(),e(se,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:xt.parse(n)},null)]})]}):i()]});return y.halfGrid&&u.value===2?e("div",{class:"inline-block w-1/2"},[b]):b}}});var w=(function(t){return t.OpenAI="openai",t.OpenAICompatible="openai-compatible",t.Anthropic="anthropic",t.OpenRouter="openrouter",t})(w||{});const Ye=[{label:"OpenAI",value:w.OpenAI},{label:"OpenAI 兼容 (DeepSeek/Groq 等)",value:w.OpenAICompatible},{label:"Anthropic (Claude)",value:w.Anthropic},{label:"OpenRouter",value:w.OpenRouter}],Ql=t=>Ye.find(a=>a.value===t)?.label||t,Xl=t=>{const a=t.name?.trim(),i=Ql(t.type);return a||i},Je=t=>{switch(t){case w.Anthropic:return"claude-sonnet-4.5";case w.OpenAI:return"gpt-5-mini";case w.OpenRouter:return"anthropic/claude-sonnet-4.5";case w.OpenAICompatible:return"";default:return""}},Yl=t=>{switch(t){case w.Anthropic:return"如 Claude Sonnet";case w.OpenAI:return"如 OpenAI GPT-4o";case w.OpenRouter:return"如 OpenRouter";case w.OpenAICompatible:return"如 DeepSeek";default:return""}},Jl=t=>{switch(t){case w.Anthropic:return"如 claude-sonnet-4.5";case w.OpenAI:return"如 gpt-5-mini";case w.OpenRouter:return"如 anthropic/claude-sonnet-4.5";case w.OpenAICompatible:return"如 deepseek-chat";default:return""}},Zl=I({props:{provider:{type:Object,required:!0},onUpdate:{type:Function,required:!0},onDelete:{type:Function,required:!0},onTest:{type:Function},availableModels:{type:Array,default:()=>[]},isLoadingModels:{type:Boolean,default:!1},isTesting:{type:Boolean,default:!1},onRefreshModels:{type:Function}},setup(t){const a=k({...t.provider});P(()=>t.provider,n=>{a.value={...n}},{deep:!0});const i=(n,y)=>{a.value[n]=y,t.onUpdate(a.value)},v=n=>{a.value.type=n,a.value.defaultModel=Je(n),t.onUpdate(a.value)},u=E(()=>t.availableModels.map(n=>({label:n.name||n.id,value:n.id}))),m=E(()=>a.value.type===w.OpenAICompatible||a.value.type===w.OpenAI||a.value.type===w.OpenRouter),r=E(()=>{if(a.value.name)return a.value.name;switch(a.value.type){case w.Anthropic:return"Anthropic (Claude)";case w.OpenAI:return"OpenAI";case w.OpenRouter:return"OpenRouter";case w.OpenAICompatible:return"OpenAI 兼容";default:return"新 Provider"}});return()=>e(U,{title:r.value,size:"small",class:"mb-4"},{default:()=>e(V,{labelPlacement:"left",labelWidth:120},{default:()=>[e(D,{label:"类型"},{default:()=>[e(G,{value:a.value.type,onUpdateValue:v,options:Ye},null)]}),e(D,{label:"显示名称"},{default:()=>[e(B,{value:a.value.name,onUpdateValue:n=>i("name",n),placeholder:Yl(a.value.type)},null)]}),e(D,{label:"API Key"},{default:()=>[e(B,{type:"password",showPasswordOn:"click",value:a.value.apiKey,onUpdateValue:n=>i("apiKey",n),placeholder:a.value.type===w.Anthropic?"sk-ant-...":a.value.type===w.OpenRouter?"sk-or-...":"sk-..."},null)]}),m.value&&e(D,{label:"Endpoint"},{default:()=>[e(B,{value:a.value.endpoint,onUpdateValue:n=>i("endpoint",n),placeholder:a.value.type===w.OpenAICompatible?"必填，如 https://api.deepseek.com":a.value.type===w.OpenRouter?"可选，默认 https://openrouter.ai/api/v1":"可选，留空使用默认"},null)]}),e(D,{label:"默认模型"},{default:()=>[e(L,{align:"center"},{default:()=>[t.availableModels.length>0?e(G,{value:a.value.defaultModel,onUpdateValue:n=>i("defaultModel",n),options:u.value,filterable:!0,tag:!0,style:"min-width: 200px",placeholder:"选择或输入模型名"},null):e(B,{value:a.value.defaultModel,onUpdateValue:n=>i("defaultModel",n),placeholder:Jl(a.value.type),style:"min-width: 200px"},null),e(_,{tertiary:!0,type:"primary",loading:t.isLoadingModels,onClick:()=>t.onRefreshModels?.()},{default:()=>[d("获取模型列表")]})]})]}),e(D,{label:"启用"},{default:()=>[e(z,{value:a.value.enabled,onUpdateValue:n=>i("enabled",n)},null)]})]}),action:()=>e("div",{class:"flex justify-end"},[e(L,{align:"center"},{default:()=>[e(ve,{variant:"success",icon:e(fe,null,null),name:"测试连接",disabled:t.isTesting||!a.value.defaultModel,onClick:()=>t.onTest?.(a.value)},null),e(_t,{onDelete:()=>t.onDelete(),message:"确定删除此 Provider？"},null)]})])})}}),ce=I({props:{label:{type:String,required:!0},description:{type:String},assignment:{type:Object},providers:{type:Array,required:!0},providerModels:{type:Object,default:()=>({})},onUpdate:{type:Function,required:!0}},setup(t){const a=k(t.assignment?.providerId||""),i=k(t.assignment?.model||"");P(()=>t.assignment,b=>{a.value=b?.providerId||"",i.value=b?.model||""},{deep:!0});const v=E(()=>t.providers.map(b=>({label:Xl(b),value:b.id,disabled:!b.enabled}))),u=E(()=>a.value?t.providerModels[a.value]||[]:[]),m=E(()=>{const b=u.value.map(h=>({label:h.name||h.id,value:h.id})),C=t.providers.find(h=>h.id===a.value);return C?.defaultModel&&(b.some(p=>p.value===C.defaultModel)||b.unshift({label:`${C.defaultModel} (默认)`,value:C.defaultModel})),b}),r=b=>{a.value=b,i.value="",y()},n=b=>{i.value=b,y()},y=()=>{a.value?t.onUpdate({providerId:a.value,model:i.value||void 0}):t.onUpdate(void 0)};return()=>e(D,{label:t.label},{default:()=>[e(L,{vertical:!0,class:"w-full"},{default:()=>[e(L,null,{default:()=>[e(G,{value:a.value||null,onUpdateValue:r,options:v.value,placeholder:"选择 Provider",clearable:!0,style:"min-width: 180px"},null),e(G,{value:i.value||null,onUpdateValue:n,options:m.value,placeholder:"使用 Provider 默认模型",clearable:!0,filterable:!0,tag:!0,style:"min-width: 200px",disabled:!a.value},null)]}),t.description&&e(se,{depth:3,class:"text-xs"},{default:()=>[t.description]})]})]})}}),eu=I({props:{value:{type:Object,required:!0},onUpdate:{type:Function,required:!0}},setup(t){const a=k({}),i=k(new Set),v=k(new Set),u=E({get:()=>t.value,set:p=>t.onUpdate(p)}),m=async p=>{i.value.add(p.id);try{const g=await ie.getModelList({providerId:p.id,type:p.type,apiKey:p.apiKey||void 0,endpoint:p.endpoint||void 0});g.models&&(a.value[p.id]=g.models),g.error&&message.warning(`获取模型列表: ${g.error}`)}catch(g){console.error(`Failed to fetch models for ${p.id}:`,g),g?.response||message.error(`获取模型列表失败: ${g.message||g}`)}finally{i.value.delete(p.id)}},r=async()=>{try{const p=await ie.getModels();for(const g of p)g.models&&(a.value[g.provider]=g.models)}catch(p){console.error("Failed to fetch all models:",p)}},n=async p=>{if(!p.defaultModel){message.warning("请先填写默认模型");return}v.value.add(p.id);try{await ie.testConfig({providerId:p.id,type:p.type,apiKey:p.apiKey||void 0,endpoint:p.endpoint||void 0,model:p.defaultModel||void 0}),message.success("连接可用")}catch(g){console.error(`Failed to test provider ${p.id}:`,g),g?.response||message.error(`连接失败: ${g.message||g}`)}finally{v.value.delete(p.id)}};Q(()=>{u.value.providers?.some(p=>p.enabled)&&r()});const y=p=>{t.onUpdate({...u.value,...p})},b=(p,g)=>{const s=[...u.value.providers||[]];s[p]=g,y({providers:s})},C=p=>{const g=(u.value.providers||[]).filter((s,f)=>f!==p);y({providers:g})},h=()=>{const p=w.OpenAI,g={id:crypto.randomUUID(),name:"",type:p,apiKey:"",defaultModel:Je(p),enabled:!0};y({providers:[...u.value.providers||[],g]})};return()=>e(L,{vertical:!0,size:"large",class:"w-full"},{default:()=>[e(U,{title:"AI Providers",size:"small"},{default:()=>[e(L,{vertical:!0,class:"w-full"},{default:()=>[u.value.providers?.map((p,g)=>e(Zl,{key:p.id,provider:p,onUpdate:s=>b(g,s),onDelete:()=>C(g),onTest:s=>n(s),availableModels:a.value[p.id]||[],isLoadingModels:i.value.has(p.id),isTesting:v.value.has(p.id),onRefreshModels:()=>m(p)},null)),e(_,{onClick:h,dashed:!0,block:!0},{default:()=>[d("+ 添加 Provider")]})]})]}),e(U,{title:"功能模型分配",size:"small"},{default:()=>[e(V,{labelPlacement:"left",labelWidth:150},{default:()=>[e(ce,{label:"摘要功能",description:"用于生成文章摘要的模型",assignment:u.value.summaryModel,providers:u.value.providers||[],providerModels:a.value,onUpdate:p=>y({summaryModel:p})},null),e(ce,{label:"写作助手",description:"用于生成标题、Slug 等的模型",assignment:u.value.writerModel,providers:u.value.providers||[],providerModels:a.value,onUpdate:p=>y({writerModel:p})},null),e(ce,{label:"评论审核",description:"用于审核评论的模型",assignment:u.value.commentReviewModel,providers:u.value.providers||[],providerModels:a.value,onUpdate:p=>y({commentReviewModel:p})},null)]})]}),e(U,{title:"功能开关",size:"small"},{default:()=>[e(V,{labelPlacement:"left",labelWidth:200},{default:()=>[e(D,{label:"启用 AI 摘要"},{default:()=>[e(z,{value:u.value.enableSummary,onUpdateValue:p=>y({enableSummary:p})},null)]}),e(D,{label:"自动生成摘要"},{default:()=>[e(L,{vertical:!0},{default:()=>[e(z,{value:u.value.enableAutoGenerateSummary,onUpdateValue:p=>y({enableAutoGenerateSummary:p}),disabled:!u.value.enableSummary},null),e(se,{depth:3,class:"text-xs"},{default:()=>[d("发布文章时自动生成摘要")]})]})]}),e(D,{label:"摘要目标语言"},{default:()=>[e(B,{value:u.value.aiSummaryTargetLanguage,onUpdateValue:p=>y({aiSummaryTargetLanguage:p}),placeholder:"auto 或 ISO 639-1 语言代码",style:"max-width: 200px"},null)]})]})]})]})}}),Me={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},tu="mt-4",au={class:tu,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},Ze=I({props:{activeGroup:{type:Object,default:null},schema:{type:Object,default:null}},emits:["update:dirty-info"],setup(t,{emit:a,expose:i}){let v={};const u=J({}),m=k({}),r=k(!0);ke(async()=>{await y()}),P(()=>u,s=>{if(!t.schema||r.value||Object.keys(v).length===0)return;const f=ze(v,wt(s)),o={};for(const[A,c]of Object.entries(f))be(c)||(o[A]=c);m.value=o},{deep:!0});async function n(s,f=!1,o=!1){const A=m.value[s];if(be(A))return;const c=u[s];if(!c)return;const x=Object.fromEntries(Object.entries(A).map(([F,T])=>Array.isArray(T)?[F,c[F]]:[F,T]));await W.patch(s,x),f||await y(),o||message.success("修改成功")}const y=async()=>{r.value=!0;const s=await W.getAll();if(!s){r.value=!1;return}v=me(s);for(const f of Object.keys(u))delete u[f];for(const[f,o]of Object.entries(s))u[f]=o;m.value={},r.value=!1};P(()=>t.schema,async s=>{s&&await y()});const b=te(ae),C=J(au);P(()=>b.viewport.value.mobile,s=>{s?(C.labelPlacement="top",C.labelAlign="left"):(C.labelPlacement="left",C.labelAlign="right")},{immediate:!0});const h=E(()=>Object.keys(m.value).length>0),p=E(()=>Object.keys(m.value).length);P([h,p],()=>{a("update:dirty-info",{isDirty:h.value,count:p.value})},{immediate:!0});async function g(){const s=Object.keys(m.value);if(s.length!==0)try{await Promise.all(s.map(f=>n(f,!0,!0))),await y(),message.success(`已保存 ${s.length} 项修改`)}catch(f){console.error("Failed to save:",f),message.error(f?.message||"保存失败，请重试")}}return i({saveAll:g}),()=>{const{activeGroup:s}=t;return s?e("div",{class:"flex flex-col gap-6"},[s.sections.filter(f=>!f.hidden).map(f=>e("div",{key:f.key,id:`section-${f.key}`,class:l.sectionCard},[e("div",{class:l.sectionCardHeader},[e("h3",{class:l.sectionCardTitle},[f.title])]),e("div",{class:l.sectionCardBody},[e(V,C,{default:()=>[f.key==="ai"?e(eu,{value:u.ai||{},onUpdate:o=>{u.ai=o}},null):e(Xe,{fields:f.fields,formData:E(()=>u),dataKeyPrefix:f.key},null)]})])]))]):e("div",{class:"py-12 text-center text-neutral-500"},[d("加载中...")])}}});function et(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!At(t)}const lu=I(()=>{const t=k([]),a=k(!0),i=async()=>{a.value=!0;const m=await j.getSessions();t.value=m?.map(r=>({...r,date:r.lastActiveAt}))||[],a.value=!1};Q(()=>{i()});const v=async(m,r)=>{m?(await j.logout(),Le(),await Oe.signOut(),window.location.reload()):(await j.deleteSession(r),t.value=t.value.filter(n=>n.id!==r))},u=async()=>{await j.deleteAllSessions(),await i()};return()=>e("div",{class:l.tabContent},[e("div",{class:l.settingsGroup},[e("div",{class:l.sectionHeader},[e("div",null,[e("h2",{class:l.sectionTitle},[e(Bt,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("登录设备")]),e("p",{class:l.sectionSubtitle},[d("管理你的登录会话，保护账户安全")])]),e(Z,{onPositiveClick:u},{trigger:()=>e(_,{size:"small",type:"error",tertiary:!0,disabled:t.value.length===1&&t.value[0]?.current},{default:()=>[e($,{class:"mr-1 size-4"},null),d("踢掉全部")]}),default:()=>"确定踢掉全部登录设备（除当前会话）？"})]),a.value?e(uu,null,null):e("div",{class:l.sessionList},[t.value.map(({id:m,ua:r,ip:n,date:y,current:b})=>e("div",{key:m,class:[l.sessionItem,b&&l.sessionItemCurrent]},[e("div",{class:l.sessionHeader},[e("span",{class:[l.sessionBadge,b?l.sessionBadgeCurrent:l.sessionBadgeOther]},[b?e(K,null,[e(Ne,{class:"size-3"},null),d("当前设备")]):e(K,null,[e(Ht,{class:"size-3"},null),d("其他设备")])]),e(Z,{onPositiveClick:()=>v(!!b,m)},{trigger:()=>e(_,{size:"small",type:b?"warning":"error",tertiary:!0},{default:()=>[b?"注销":"踢出"]}),default:()=>b?"确定要注销当前会话？":"确定要踢出此设备？"})]),e("div",{class:l.sessionContent},[r&&e("div",{class:l.sessionUA},[r]),e("div",{class:"mt-3 flex flex-wrap items-center gap-4 text-sm"},[n&&e("div",{class:l.sessionRow},[e(Ce,{class:"size-4 text-neutral-400"},null),e(qe,{ip:n,triggerEl:e(_,{quaternary:!0,size:"tiny",type:"primary"},et(n)?n:{default:()=>[n]})},null)]),e("div",{class:l.sessionRow},[e("span",{class:l.sessionLabel},[b?"活跃时间:":"登录时间:"]),e(le,{time:y},null)])])])]))])]),e("div",{class:l.settingsGroup},[e(nu,null,null)]),e("div",{class:l.settingsGroup},[e(su,null,null)])])}),uu=I(()=>()=>e("div",{class:l.sessionList},[Array.from({length:3}).map((t,a)=>e("div",{key:a,class:l.sessionItem},[e("div",{class:l.sessionHeader},[e(M,{text:!0,style:{width:"80px",height:"24px"}},null),e(M,{text:!0,style:{width:"60px",height:"28px"}},null)]),e(M,{text:!0,style:{width:"100%",height:"40px",marginTop:"12px"}},null),e("div",{class:"mt-3 flex gap-4"},[e(M,{text:!0,style:{width:"100px"}},null),e(M,{text:!0,style:{width:"120px"}},null)])]))])),su=I(()=>{const t=k([]),a=k(!0),i=()=>({name:"",expired:!1,expiredTime:new Date}),v=J(i()),u=async()=>{a.value=!0;const s=await q.getTokens();t.value=s,a.value=!1};ke(()=>{u()});const m=k(!1),r=k(!1),n=k(null),y=k(new Set),b=async()=>{try{const s={name:v.name,expired:v.expired?v.expiredTime.toISOString():void 0},f=await q.createToken(s);try{await navigator.clipboard.writeText(f.token)}catch{console.warn("复制到剪贴板失败")}m.value=!1;const o=i();for(const c in o)v[c]=o[c];n.value=f,r.value=!0,await u();const A=t.value.findIndex(c=>c.name===s.name);A!==-1&&(t.value[A].token=f.token)}catch{message.error("创建 Token 失败，请重试")}},C=async s=>{await q.deleteToken(s),message.success("删除成功");const f=t.value.findIndex(o=>o.id===s);f!==-1&&t.value.splice(f,1)},h=async s=>{const f=s.id;if(y.value.has(f))y.value.delete(f);else try{const o=await q.getToken(f),A=t.value.findIndex(c=>c.id===f);A!==-1&&(t.value[A].token=o.token),y.value.add(f)}catch(o){console.error("获取Token详情失败:",o),message.error("获取Token详情失败，请重试")}},p=async s=>{try{await navigator.clipboard.writeText(s),message.success("Token 已复制到剪贴板")}catch{const f=document.createElement("textarea");f.value=s,f.style.position="fixed",f.style.left="-9999px",document.body.appendChild(f),f.focus(),f.select();try{document.execCommand("copy"),message.success("Token 已复制到剪贴板")}catch{message.error("复制失败，请手动复制Token")}document.body.removeChild(f)}},g=te(ae);return()=>e(K,null,[e("div",{class:l.tokenCard},[e("div",{class:l.tokenHeader},[e("div",null,[e("h3",{class:l.tokenTitle},[e(Ke,{class:"mr-2 inline-block size-5","aria-hidden":"true"},null),d("API Token")]),e("p",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-400"},[d("用于 API 调用的访问令牌")])]),e(_,{type:"primary",onClick:()=>{m.value=!0}},{default:()=>[e(X,{class:"mr-1 size-4"},null),d("新增 Token")]})]),a.value?e(M,{text:!0,style:{width:"100%",height:"200px"}},null):e(Ge,{scrollX:Math.max(800,g.contentWidth.value-g.contentInsetWidth.value),remote:!0,bordered:!1,data:t.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render(s){const{token:f,id:o}=s;return y.value.has(o)&&f&&f!=="*".repeat(40)?e(_,{text:!0,type:"primary",onClick:()=>p(f),class:"max-w-[200px] truncate text-left font-mono"},et(f)?f:{default:()=>[f]}):e("span",{class:"font-mono text-neutral-400"},["•".repeat(32)])}},{title:"创建时间",key:"created",render({created:s}){return e(le,{time:s},null)}},{title:"过期时间",key:"expired",render({expired:s}){return s?Fe(s,"yyyy 年 M 月 d 日 HH:mm:ss"):e("span",{class:"text-neutral-400"},[d("永不过期")])}},{title:"操作",key:"id",render(s){const{id:f,name:o}=s,A=y.value.has(f);return e("div",{class:"flex items-center gap-2"},[e(_,{text:!0,type:"primary",onClick:()=>h(s)},{default:()=>[A?e(It,{class:"size-4"},null):e(Et,{class:"size-4"},null)]}),e(Z,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{C(f)}},{trigger:()=>e(_,{text:!0,type:"error"},{default:()=>[e($,{class:"size-4"},null)]}),default:()=>e("span",{class:"max-w-48"},[d('确定要删除 Token "'),o,d('"?')])})])}}]},null)]),e(pe,{transformOrigin:"center",show:m.value,onUpdateShow:s=>void(m.value=s)},{default:()=>[e(U,{bordered:!1,title:"创建 Token",class:"w-[500px] max-w-full"},{default:()=>[e(V,null,{default:()=>[e(D,{label:"名称",required:!0},{default:()=>[e(B,{value:v.name,onInput:s=>void(v.name=s),placeholder:"为这个 Token 起个名字…"},null)]}),e(D,{label:"是否过期"},{default:()=>[e(z,{value:v.expired,onUpdateValue:s=>void(v.expired=s)},null)]}),e(D,{label:"过期时间"},{default:()=>[e(Dt,{disabled:!v.expired,value:v.expiredTime.getTime(),type:"datetime",onUpdateValue:s=>void(v.expiredTime=new Date(s))},null)]})]}),e("div",{class:"flex justify-end gap-3"},[e(_,{onClick:()=>void(m.value=!1)},{default:()=>[d("取消")]}),e(_,{type:"primary",disabled:!v.name.trim(),onClick:b},{default:()=>[d("确定")]})])]})]}),e(pe,{transformOrigin:"center",show:r.value,onUpdateShow:s=>void(r.value=s)},{default:()=>[e(U,{bordered:!1,title:"Token 创建成功",class:"w-[600px] max-w-full",closable:!0,onClose:()=>void(r.value=!1)},{default:()=>[e("div",{class:"space-y-4"},[e("div",{class:"flex items-center gap-2 rounded-lg bg-green-50 px-4 py-3 text-green-700 dark:bg-green-900/20 dark:text-green-400"},[e(Ne,{class:"size-5"},null),e("span",null,[d("Token 创建成功，请妥善保存")])]),e("div",{class:"space-y-3"},[e("div",{class:l.infoRow},[e("span",{class:l.infoLabel},[d("Token 名称:")]),e("span",{class:l.infoValue},[n.value?.name])]),e("div",null,[e("div",{class:"mb-2 text-sm font-medium text-neutral-700 dark:text-neutral-300"},[d("Token:")]),e("div",{class:"flex items-center gap-2 rounded-lg border border-neutral-200 bg-neutral-50 p-3 dark:border-neutral-700 dark:bg-neutral-800"},[e(se,{code:!0,class:"flex-1 break-all text-sm"},{default:()=>[n.value?.token]}),e(_,{size:"small",type:"primary",onClick:async()=>{n.value?.token&&await p(n.value.token)}},{default:()=>[e(Pe,{class:"size-4"},null)]})])]),n.value?.expired&&e("div",{class:l.infoRow},[e("span",{class:l.infoLabel},[d("过期时间:")]),e("span",{class:l.infoValue},[Fe(n.value.expired,"yyyy 年 M 月 d 日 HH:mm:ss")])])]),e("div",{class:"rounded-lg bg-amber-50 px-4 py-3 text-sm text-amber-700 dark:bg-amber-900/20 dark:text-amber-400"},[d("请将此 Token 保存在安全的地方，关闭此窗口后将无法再次查看完整 Token。")])]),e("div",{class:"mt-6 flex justify-end"},[e(_,{type:"primary",onClick:()=>void(r.value=!1)},{default:()=>[d("我已保存")]})])]})]})])}),nu=I(()=>{const t=J({password:"",reenteredPassword:""}),a=k(),i=xe(),v=async()=>{a.value&&a.value.validate(async m=>{m||(await j.updateMaster({password:t.password}),message.success("密码修改成功，请重新登录"),Le(),i.push({name:Ft.Login}))})};function u(m,r){return r===t.password}return()=>e("div",{class:l.passwordSection},[e("div",{class:l.passwordHeader},[e("div",{class:l.passwordIcon},[e(je,null,null)]),e("div",null,[e("h3",{class:l.passwordTitle},[d("修改密码")]),e("p",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-400"},[d("修改后需要重新登录")])])]),e(V,{ref:a,model:t,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:u,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},{default:()=>[e("div",{class:"grid gap-4 md:grid-cols-2"},[e(D,{label:"新密码",required:!0,path:"password"},{default:()=>[e(B,ye(Me,{value:t.password,onInput:m=>void(t.password=m),type:"password",showPasswordOn:"click",placeholder:"输入新密码"}),null)]}),e(D,{label:"确认密码",required:!0,path:"reenteredPassword"},{default:()=>[e(B,ye(Me,{value:t.reenteredPassword,onInput:m=>void(t.reenteredPassword=m),type:"password",showPasswordOn:"click",placeholder:"再次输入新密码"}),null)]})]),e("div",{class:"mt-4 flex justify-end"},[e(_,{onClick:v,type:"primary"},{default:()=>[e(we,{class:"mr-1 size-4"},null),d("修改密码")]})])]})])}),Te={GitHub:"github",Weibo:"weibo",网易云:"netease",哔哩哔哩:"bilibili"},tt=I(()=>{const t=k({}),a=k(!0);let i;async function v(){a.value=!0;const c=await j.getMaster();t.value=c,i=me(c),a.value=!1}Q(async()=>{await v()});const u=St(),m=E(()=>ze(i,t.value)),r=E(()=>!be(m.value)),{setActions:n}=Ve(),y=Y({mutationFn:j.updateMaster,onSuccess:async()=>{u.success("保存成功"),await v()}}),b=()=>{if(!r.value)return;const c=me(Ot(m));c.socialIds&&(c.socialIds=t.value.socialIds),y.mutate(c)};Q(()=>{n(e(ve,{disabled:!0,onClick:b,icon:e(fe,null,null)},null))}),Mt(()=>{n(null)}),P(()=>r.value,c=>{n(e(ve,{disabled:!c,icon:e(fe,null,null),onClick:b},null))});const C=Object.keys(Te).map(c=>({label:c,value:Te[c]})),h=E(()=>{const c=t.value.socialIds||{};return Object.entries(c).map(([x,F])=>({key:x,value:String(F)}))}),p=E(()=>new Set(h.value.map(c=>c.key))),g=()=>{t.value.socialIds||(t.value.socialIds={});const c=C.find(x=>!p.value.has(x.value))?.value||"";t.value.socialIds={...t.value.socialIds,[c]:""}},s=(c,x)=>{if(c===x)return;const F={...t.value.socialIds},T=F[c];delete F[c],F[x]=T,t.value.socialIds=F},f=(c,x)=>{t.value.socialIds={...t.value.socialIds,[c]:x}},o=c=>{const x={...t.value.socialIds};delete x[c],t.value.socialIds=x},A=c=>{const x=JSON.parse((c.event?.target).responseText);return c.file.url=x.url,t.value.avatar=x.url,c.file};return()=>e("div",{class:l.userTabContainer},[a.value?e(ru,null,null):e(K,null,[e("section",{class:l.userSection},[e("div",{class:l.userSectionHeader},[e("div",{class:l.avatarContainer},[e(zt,{onFinish:A,type:"avatar"},{default:()=>e("div",{class:l.avatarWrapper},[e(Tt,{src:t.value.avatar,size:128},null),e("div",{class:l.avatarUploadOverlay},[e(Vt,{class:l.avatarUploadIcon},null)])])})]),e("div",{class:l.userHeaderInfo},[e("h2",{class:l.userName},[t.value.name||"–"]),e("p",{class:l.userHandle},[d("@"),t.value.username]),e("div",{class:l.userMeta},[t.value.mail&&e("span",{class:l.userMetaItem},[e(Nt,{class:l.userMetaIcon,"aria-hidden":"true"},null),t.value.mail]),t.value.lastLoginTime&&e("span",{class:l.userMetaItem},[e(qt,{class:l.userMetaIcon,"aria-hidden":"true"},null),d("上次登录: "),e(le,{time:t.value.lastLoginTime},null)]),t.value.lastLoginIp&&e("span",{class:l.userMetaItem},[e(Ce,{class:l.userMetaIcon,"aria-hidden":"true"},null),e(qe,{ip:t.value.lastLoginIp,triggerEl:e(_,{quaternary:!0,size:"tiny",type:"primary"},{default:()=>[t.value.lastLoginIp]})},null)])])])])]),e("section",{class:l.userSection},[e("h3",{class:l.userSectionTitle},[e(Re,{class:"mr-1.5 inline-block size-4","aria-hidden":"true"},null),d("基本信息")]),e("div",{class:l.formGrid},[e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-name"},[d("昵称")]),e(B,{value:t.value.name,onInput:c=>t.value.name=c,placeholder:"输入昵称…",inputProps:{id:"user-name",autocomplete:"name"}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-username"},[d("用户名")]),e(B,{value:t.value.username,onInput:c=>t.value.username=c,placeholder:"输入用户名…",inputProps:{id:"user-username",autocomplete:"username",spellcheck:!1}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-mail"},[d("邮箱")]),e(B,{value:t.value.mail,onInput:c=>t.value.mail=c,placeholder:"输入邮箱地址…",inputProps:{id:"user-mail",type:"email",inputmode:"email",autocomplete:"email",spellcheck:!1}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-url"},[d("个人网站")]),e(B,{value:t.value.url,onInput:c=>t.value.url=c,placeholder:"https://example.com",inputProps:{id:"user-url",type:"url",inputmode:"url",autocomplete:"url",spellcheck:!1}},null)]),e("div",{class:[l.formGroup,l.formGroupFull]},[e("label",{class:l.formLabel,for:"user-introduce"},[d("个人简介")]),e(B,{value:t.value.introduce,onInput:c=>t.value.introduce=c,type:"textarea",placeholder:"介绍一下自己…",autosize:{minRows:3,maxRows:6},inputProps:{id:"user-introduce"}},null)]),e("div",{class:l.formGroup},[e("label",{class:l.formLabel,for:"user-avatar"},[d("头像 URL")]),e(B,{value:t.value.avatar,onInput:c=>t.value.avatar=c,placeholder:"https://example.com/avatar.jpg",inputProps:{id:"user-avatar",type:"url",inputmode:"url",spellcheck:!1}},null),e("p",{class:l.formDescription},[d("也可以点击上方头像直接上传图片")])])])]),e("section",{class:l.userSection},[e("div",{class:l.userSectionTitleRow},[e("h3",{class:l.userSectionTitle},[e(Pt,{class:"mr-1.5 inline-block size-4","aria-hidden":"true"},null),d("社交链接")]),e(_,{size:"small",type:"primary",tertiary:!0,onClick:g,disabled:p.value.size>=C.length},{default:()=>[e(X,{class:"mr-1 size-4","aria-hidden":"true"},null),d("添加")]})]),h.value.length===0?e("div",{class:l.socialEmpty},[d("暂未添加任何社交链接")]):e("div",{class:l.socialList},[h.value.map(({key:c,value:x})=>e("div",{class:l.socialRow,key:c},[e(G,{class:l.socialSelect,value:c,options:C.map(F=>({...F,disabled:p.value.has(F.value)&&F.value!==c})),onUpdateValue:F=>s(c,F)},null),e(B,{class:l.socialInput,value:x,onInput:F=>f(c,F),placeholder:"输入链接或 ID…",inputProps:{spellcheck:!1}},null),e("button",{type:"button",class:l.socialRemoveBtn,onClick:()=>o(c),"aria-label":`删除 ${c} 社交链接`},[e($,{class:"size-4","aria-hidden":"true"},null)])]))])])])])}),ru=I(()=>()=>e("div",{class:l.userTabContainer},[e("section",{class:l.userSection},[e("div",{class:l.userSectionHeader},[e(M,{circle:!0,style:{width:"128px",height:"128px"}},null),e("div",{class:l.userHeaderInfo},[e(M,{text:!0,style:{width:"120px",height:"28px"}},null),e(M,{text:!0,style:{width:"80px",height:"18px",marginTop:"4px"}},null),e("div",{class:"mt-3 flex gap-4"},[e(M,{text:!0,style:{width:"150px"}},null),e(M,{text:!0,style:{width:"120px"}},null)])])])]),e("section",{class:l.userSection},[e(M,{text:!0,style:{width:"80px",height:"20px"}},null),e("div",{class:"mt-4 grid gap-6 md:grid-cols-2"},[Array.from({length:4}).map((t,a)=>e("div",{key:a},[e(M,{text:!0,style:{width:"60px",height:"16px",marginBottom:"8px"}},null),e(M,{text:!0,style:{width:"100%",height:"34px"}},null)]))])])])),ou={[S.User]:tt,[S.System]:Ze,[S.Security]:lu,[S.Auth]:Ml,[S.MetaPreset]:Hl},xu=I({setup(){const t=Ue(),a=xe(),{setActions:i}=Ve(),v=k(t.params.type||S.User),u=k(null),m=k(null),r=k({isDirty:!1,count:0}),n=E(()=>{const s=t.query.group;return s&&u.value?.groups?.some(f=>f.key===s)?s:u.value?.groups?.[0]?.key||""});ke(async()=>{try{u.value=await W.getFormSchema()}catch(s){console.error("Failed to load system schema",s)}}),P(()=>t.params.type,s=>{s&&(v.value=s)});const y=s=>{const f=s===S.System?{group:n.value}:{};a.replace({name:t.name,params:{...t.params,type:s},query:f})},b=s=>{a.replace({name:t.name,params:{...t.params,type:S.System},query:{group:s}})},C=E(()=>v.value===S.System),h=E(()=>u.value?.groups?u.value.groups.find(s=>s.key===n.value):null),p=s=>{r.value=s},g=async()=>{m.value?.saveAll&&await m.value.saveAll()};return ge(()=>{const{isDirty:s,count:f}=r.value;C.value&&s?i(e("div",{class:"flex items-center gap-3"},[e("span",{class:"text-sm text-neutral-600 dark:text-neutral-400"},[d("你有 "),f,d(" 项未保存的修改")]),e(_,{type:"primary",size:"small",onClick:g,renderIcon:()=>e(Rt,{size:16},null)},{default:()=>[d("保存全部")]})])):i(null)}),Ut(()=>{i(null)}),()=>{const s=ou[v.value]||tt;return e("div",{class:l.container},[e(Cl,{activeTab:v.value,activeGroupKey:n.value,systemSchema:u.value,onTabChange:y,onGroupChange:b},null),e("main",{class:l.content},[e(Ze,ye({ref:m,activeGroup:h.value,schema:u.value,style:{display:C.value?void 0:"none"}},{"onUpdate:dirty-info":p}),null),!C.value&&e(s,null,null)])])}}});export{xu as default};
